
<!DOCTYPE html>

<html dir="rtl" lang="ur">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>دینی مدرسہ مینجمنٹ سسٹم</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet"/>
<style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu&display=swap');
        body {
            font-family: 'Noto Nastaliq Urdu', serif;
            background-color: #f8f9fa;
        }
        .sidebar {
            height: 100vh;
            position: fixed;
            top: 0;
            right: 0;
            padding-top: 3.5rem;
            background-color: #343a40;
            z-index: 100;
        }
        .sidebar .nav-link {
            color: #fff;
            margin-bottom: 0.5rem;
        }
        .sidebar .nav-link.active {
            background-color: #0d6efd;
        }
        .sidebar .nav-link:hover {
            background-color: #495057;
        }
        .main-content {
            margin-right: 240px;
            padding: 2rem;
            padding-top: 4.5rem;
        }
        .navbar {
            position: fixed;
            width: 100%;
            z-index: 1000;
        }
        .form-label {
            font-weight: bold;
        }
        .card {
            margin-bottom: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card-header {
            background-color: #0d6efd;
            color: white;
            border-radius: 10px 10px 0 0 !important;
        }
        .btn-action {
            margin-right: 0.25rem;
        }
        @media (max-width: 767.98px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                padding-top: 0;
            }
            .main-content {
                margin-right: 0;
                padding-top: 1rem;
            }
            .navbar {
                position: relative;
            }
        }
        .custom-field {
            margin-top: 10px;
            padding: 10px;
            border: 1px dashed #ccc;
            border-radius: 5px;
        }
        .print-section {
            display: none;
        }
        @media print {
            .print-section {
                display: block;
            }
            .no-print {
                display: none !important;
            }
        }
    </style>
<link href="manifest.json" rel="manifest"/></head>
<body>
<nav class="navbar navbar-expand-md navbar-dark bg-primary">
<div class="container-fluid">
<a class="navbar-brand" href="#">دینی مدرسہ مینجمنٹ سسٹم</a>
<button class="navbar-toggler" data-bs-target="#navbarNav" data-bs-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="navbarNav">
<ul class="navbar-nav ms-auto">
<li class="nav-item">
<span class="nav-link" id="datetime"></span>
</li>
</ul>
</div>
</div>
</nav>
<div class="container-fluid">
<div class="row">
<div class="col-md-2 sidebar no-print">
<ul class="nav flex-column">
<li class="nav-item">
<a class="nav-link active" data-page="dashboard" href="#">
<i class="bi bi-speedometer2"></i> ڈیش بورڈ
                        </a>
</li>
<li class="nav-item">
<a class="nav-link" data-page="students" href="#">
<i class="bi bi-mortarboard"></i> طلبہ
                        </a>
</li>
<li class="nav-item">
<a class="nav-link" data-page="teachers" href="#">
<i class="bi bi-person"></i> اساتذہ
                        </a>
</li>
<li class="nav-item">
<a class="nav-link" data-page="classes" href="#">
<i class="bi bi-book"></i> کلاسز
                        </a>
</li>
<li class="nav-item">
<a class="nav-link" data-page="attendance" href="#">
<i class="bi bi-calendar-check"></i> حاضری
                        </a>
</li>
<li class="nav-item">
<a class="nav-link" data-page="fees" href="#">
<i class="bi bi-cash-stack"></i> فیس
                        </a>
</li>
<li class="nav-item">
<a class="nav-link" data-page="salaries" href="#">
<i class="bi bi-wallet"></i> تنخواہیں
                        </a>
</li>
<li class="nav-item">
<a class="nav-link" data-page="reports" href="#">
<i class="bi bi-file-earmark-text"></i> رپورٹس
                        </a>
</li>
<li class="nav-item">
<a class="nav-link" data-page="inventory" href="#">
<i class="bi bi-box"></i> انوینٹری
                        </a>
</li>
<li class="nav-item">
<a class="nav-link" data-page="expenses" href="#">
<i class="bi bi-cash"></i> اخراجات
                        </a>
</li>
<li class="nav-item">
<a class="nav-link" data-page="backup" href="#">
<i class="bi bi-cloud-arrow-up"></i> بیک اپ اور ریسٹور
                        </a>
</li>
</ul>
</div>
<div class="col-md-10 main-content">
<!-- Dashboard Page -->
<div id="dashboard-page">
<h2 class="mb-4">ڈیش بورڈ</h2>
<div class="row">
<div class="col-md-3 mb-4">
<div class="card bg-primary text-white">
<div class="card-body">
<h5 class="card-title">کل طلبہ</h5>
<p class="card-text fs-2" id="total-students">0</p>
</div>
</div>
</div>
<div class="col-md-3 mb-4">
<div class="card bg-success text-white">
<div class="card-body">
<h5 class="card-title">کل اساتذہ</h5>
<p class="card-text fs-2" id="total-teachers">0</p>
</div>
</div>
</div>
<div class="col-md-3 mb-4">
<div class="card bg-warning text-dark">
<div class="card-body">
<h5 class="card-title">کل کلاسز</h5>
<p class="card-text fs-2" id="total-classes">0</p>
</div>
</div>
</div>
<div class="col-md-3 mb-4">
<div class="card bg-info text-dark">
<div class="card-body">
<h5 class="card-title">آج کی حاضری</h5>
<p class="card-text fs-2" id="today-attendance">0</p>
</div>
</div>
</div>
</div>
<div class="row">
<div class="col-md-6">
<div class="card">
<div class="card-header">
<h5>حالیہ فیس ادائیگی</h5>
</div>
<div class="card-body">
<div class="table-responsive">
<table class="table table-striped" id="recent-fees">
<thead>
<tr>
<th>طالب علم</th>
<th>کلاس</th>
<th>رقم</th>
<th>تاریخ</th>
</tr>
</thead>
<tbody>
<!-- Will be filled dynamically -->
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="col-md-6">
<div class="card">
<div class="card-header">
<h5>حالیہ اخراجات</h5>
</div>
<div class="card-body">
<div class="table-responsive">
<table class="table table-striped" id="recent-expenses">
<thead>
<tr>
<th>تفصیل</th>
<th>زمرہ</th>
<th>رقم</th>
<th>تاریخ</th>
</tr>
</thead>
<tbody>
<!-- Will be filled dynamically -->
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- Students Page -->
<div id="students-page" style="display: none;">
<div class="d-flex justify-content-between align-items-center mb-4">
<h2>طلبہ کا انتظام</h2>
<button class="btn btn-primary" id="add-student-btn">
<i class="bi bi-plus-circle"></i> نیا طالب علم
                        </button>
</div>
<div class="card mb-4">
<div class="card-header">
<h5>طلبہ کی فہرست</h5>
</div>
<div class="card-body">
<div class="mb-3">
<input class="form-control" id="student-search" placeholder="طالب علم کی تلاش..." type="text"/>
</div>
<div class="table-responsive">
<table class="table table-striped" id="students-table">
<thead>
<tr>
<th>آئی ڈی</th>
<th>نام</th>
<th>والد کا نام</th>
<th>عمر</th>
<th>کلاس</th>
<th>داخلہ کی تاریخ</th>
<th>رابطہ</th>
<th>ایکشنز</th>
</tr>
</thead>
<tbody>
<!-- Will be filled dynamically -->
</tbody>
</table>
</div>
</div>
</div>
</div>
<!-- Student Modal -->
<div class="modal fade" id="student-modal" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="student-modal-title">طالب علم کا اندراج</h5>
<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body">
<form id="student-form">
<input id="student-id" type="hidden"/>
<div class="row mb-3">
<div class="col-md-6">
<label class="form-label" for="student-name">نام</label>
<input class="form-control" id="student-name" required="" type="text"/>
</div>
<div class="col-md-6">
<label class="form-label" for="student-father">والد کا نام</label>
<input class="form-control" id="student-father" required="" type="text"/>
</div>
</div>
<div class="row mb-3">
<div class="col-md-4">
<label class="form-label" for="student-age">عمر</label>
<input class="form-control" id="student-age" required="" type="number"/>
</div>
<div class="col-md-4">
<label class="form-label" for="student-class">کلاس</label>
<select class="form-select" id="student-class" required="">
<!-- Will be filled dynamically -->
</select>
</div>
<div class="col-md-4">
<label class="form-label" for="student-admission-date">داخلہ کی تاریخ</label>
<input class="form-control" id="student-admission-date" required="" type="date"/>
</div>
</div>
<div class="row mb-3">
<div class="col-md-6">
<label class="form-label" for="student-contact">رابطہ</label>
<input class="form-control" id="student-contact" required="" type="text"/>
</div>
<div class="col-md-6">
<label class="form-label" for="student-address">پتہ</label>
<textarea class="form-control" id="student-address" required="" rows="2"></textarea>
</div>
</div>
<div id="custom-fields-container">
<!-- Custom fields will be added here -->
</div>
<button class="btn btn-outline-secondary mb-3" id="add-custom-field" type="button">
<i class="bi bi-plus-circle"></i> کسٹم فیلڈ شامل کریں
                                    </button>
</form>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" data-bs-dismiss="modal" type="button">منسوخ کریں</button>
<button class="btn btn-primary" id="save-student" type="button">محفوظ کریں</button>
</div>
</div>
</div>
</div>
<!-- Teachers Page -->
<div id="teachers-page" style="display: none;">
<div class="d-flex justify-content-between align-items-center mb-4">
<h2>اساتذہ کا انتظام</h2>
<button class="btn btn-primary" id="add-teacher-btn">
<i class="bi bi-plus-circle"></i> نیا استاد
                        </button>
</div>
<div class="card mb-4">
<div class="card-header">
<h5>اساتذہ کی فہرست</h5>
</div>
<div class="card-body">
<div class="mb-3">
<input class="form-control" id="teacher-search" placeholder="استاد کی تلاش..." type="text"/>
</div>
<div class="table-responsive">
<table class="table table-striped" id="teachers-table">
<thead>
<tr>
<th>آئی ڈی</th>
<th>نام</th>
<th>تخصص</th>
<th>تعلیم</th>
<th>رابطہ</th>
<th>شمولیت کی تاریخ</th>
<th>تنخواہ</th>
<th>ایکشنز</th>
</tr>
</thead>
<tbody>
<!-- Will be filled dynamically -->
</tbody>
</table>
</div>
</div>
</div>
</div>
<!-- Teacher Modal -->
<div class="modal fade" id="teacher-modal" tabindex="-1">
<div class="modal-dialog modal-lg">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="teacher-modal-title">استاد کا اندراج</h5>
<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body">
<form id="teacher-form">
<input id="teacher-id" type="hidden"/>
<div class="row mb-3">
<div class="col-md-6">
<label class="form-label" for="teacher-name">نام</label>
<input class="form-control" id="teacher-name" required="" type="text"/>
</div>
<div class="col-md-6">
<label class="form-label" for="teacher-specialization">تخصص</label>
<input class="form-control" id="teacher-specialization" required="" type="text"/>
</div>
</div>
<div class="row mb-3">
<div class="col-md-6">
<label class="form-label" for="teacher-education">تعلیم</label>
<input class="form-control" id="teacher-education" required="" type="text"/>
</div>
<div class="col-md-6">
<label class="form-label" for="teacher-join-date">شمولیت کی تاریخ</label>
<input class="form-control" id="teacher-join-date" required="" type="date"/>
</div>
</div>
<div class="row mb-3">
<div class="col-md-6">
<label class="form-label" for="teacher-contact">رابطہ</label>
<input class="form-control" id="teacher-contact" required="" type="text"/>
</div>
<div class="col-md-6">
<label class="form-label" for="teacher-salary">تنخواہ</label>
<input class="form-control" id="teacher-salary" required="" type="number"/>
</div>
</div>
<div class="mb-3">
<label class="form-label" for="teacher-address">پتہ</label>
<textarea class="form-control" id="teacher-address" required="" rows="2"></textarea>
</div>
<div id="teacher-custom-fields-container">
<!-- Custom fields will be added here -->
</div>
<button class="btn btn-outline-secondary mb-3" id="add-teacher-custom-field" type="button">
<i class="bi bi-plus-circle"></i> کسٹم فیلڈ شامل کریں
                                    </button>
</form>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" data-bs-dismiss="modal" type="button">منسوخ کریں</button>
<button class="btn btn-primary" id="save-teacher" type="button">محفوظ کریں</button>
</div>
</div>
</div>
</div>
<!-- Classes Page -->
<div id="classes-page" style="display: none;">
<div class="d-flex justify-content-between align-items-center mb-4">
<h2>کلاسز کا انتظام</h2>
<button class="btn btn-primary" id="add-class-btn">
<i class="bi bi-plus-circle"></i> نئی کلاس
                        </button>
</div>
<div class="card mb-4">
<div class="card-header">
<h5>کلاسز کی فہرست</h5>
</div>
<div class="card-body">
<div class="table-responsive">
<table class="table table-striped" id="classes-table">
<thead>
<tr>
<th>آئی ڈی</th>
<th>کلاس کا نام</th>
<th>درجہ</th>
<th>استاد</th>
<th>طلبہ کی تعداد</th>
<th>کمرہ</th>
<th>ایکشنز</th>
</tr>
</thead>
<tbody>
<!-- Will be filled dynamically -->
</tbody>
</table>
</div>
</div>
</div>
</div>
<!-- Class Modal -->
<div class="modal fade" id="class-modal" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="class-modal-title">نئی کلاس</h5>
<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body">
<form id="class-form">
<input id="class-id" type="hidden"/>
<div class="mb-3">
<label class="form-label" for="class-name">کلاس کا نام</label>
<input class="form-control" id="class-name" required="" type="text"/>
</div>
<div class="mb-3">
<label class="form-label" for="class-level">درجہ</label>
<input class="form-control" id="class-level" required="" type="text"/>
</div>
<div class="mb-3">
<label class="form-label" for="class-teacher">استاد</label>
<select class="form-select" id="class-teacher" required="">
<!-- Will be filled dynamically -->
</select>
</div>
<div class="mb-3">
<label class="form-label" for="class-room">کمرہ</label>
<input class="form-control" id="class-room" required="" type="text"/>
</div>
</form>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" data-bs-dismiss="modal" type="button">منسوخ کریں</button>
<button class="btn btn-primary" id="save-class" type="button">محفوظ کریں</button>
</div>
</div>
</div>
</div>
<!-- Attendance Page -->
<div id="attendance-page" style="display: none;">
<h2 class="mb-4">حاضری کا انتظام</h2>
<div class="card mb-4">
<div class="card-header">
<h5>حاضری درج کریں</h5>
</div>
<div class="card-body">
<div class="row mb-3">
<div class="col-md-4">
<label class="form-label" for="attendance-date">تاریخ</label>
<input class="form-control" id="attendance-date" type="date" value=""/>
</div>
<div class="col-md-4">
<label class="form-label" for="attendance-class">کلاس</label>
<select class="form-select" id="attendance-class">
<option value="">کلاس منتخب کریں</option>
<!-- Will be filled dynamically -->
</select>
</div>
<div class="col-md-4">
<label class="form-label"> </label>
<button class="btn btn-primary d-block" id="load-attendance">حاضری لوڈ کریں</button>
</div>
</div>
<div id="attendance-container" style="display: none;">
<div class="table-responsive">
<table class="table" id="attendance-table">
<thead>
<tr>
<th>طالب علم کا نام</th>
<th>حاضری</th>
</tr>
</thead>
<tbody>
<!-- Will be filled dynamically -->
</tbody>
</table>
</div>
<button class="btn btn-success" id="save-attendance">حاضری محفوظ کریں</button>
</div>
</div>
</div>
<div class="card">
<div class="card-header">
<h5>حاضری رپورٹ</h5>
</div>
<div class="card-body">
<div class="row mb-3">
<div class="col-md-3">
<label class="form-label" for="attendance-report-class">کلاس</label>
<select class="form-select" id="attendance-report-class">
<option value="">تمام کلاسز</option>
<!-- Will be filled dynamically -->
</select>
</div>
<div class="col-md-3">
<label class="form-label" for="attendance-report-student">طالب علم</label>
<select class="form-select" id="attendance-report-student">
<option value="">تمام طلبہ</option>
<!-- Will be filled dynamically -->
</select>
</div>
<div class="col-md-3">
<label class="form-label" for="attendance-report-from">شروع تاریخ</label>
<input class="form-control" id="attendance-report-from" type="date"/>
</div>
<div class="col-md-3">
<label class="form-label" for="attendance-report-to">ختم تاریخ</label>
<input class="form-control" id="attendance-report-to" type="date"/>
</div>
</div>
<div class="mb-3">
<button class="btn btn-primary" id="generate-attendance-report">رپورٹ جنریٹ کریں</button>
<button class="btn btn-success ms-2" id="export-attendance-report">ایکسپورٹ (CSV)</button>
<button class="btn btn-info ms-2" id="print-attendance-report">پرنٹ کریں</button>
</div>
<div id="attendance-report-container" style="display: none;">
<div class="table-responsive">
<table class="table table-striped" id="attendance-report-table">
<thead>
<tr>
<th>طالب علم</th>
<th>کلاس</th>
<th>تاریخ</th>
<th>حاضری</th>
</tr>
</thead>
<tbody>
<!-- Will be filled dynamically -->
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<!-- Fees Page -->
<div id="fees-page" style="display: none;">
<h2 class="mb-4">فیس کا انتظام</h2>
<div class="row">
<div class="col-md-6">
<div class="card mb-4">
<div class="card-header d-flex justify-content-between">
<h5>فیس کی ساخت</h5>
<button class="btn btn-sm btn-primary" id="add-fee-structure-btn">
<i class="bi bi-plus-circle"></i> نئی فیس ساخت
                                    </button>
</div>
<div class="card-body">
<div class="table-responsive">
<table class="table table-striped" id="fee-structure-table">
<thead>
<tr>
<th>کلاس</th>
<th>فیس کی قسم</th>
<th>رقم</th>
<th>ادائیگی کا دورانیہ</th>
<th>ایکشنز</th>
</tr>
</thead>
<tbody>
<!-- Will be filled dynamically -->
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="col-md-6">
<div class="card mb-4">
<div class="card-header d-flex justify-content-between">
<h5>فیس کی ادائیگی</h5>
<button class="btn btn-sm btn-primary" id="add-fee-payment-btn">
<i class="bi bi-plus-circle"></i> نئی ادائیگی
                                    </button>
</div>
<div class="card-body">
<div class="table-responsive">
<table class="table table-striped" id="fee-payment-table">
<thead>
<tr>
<th>طالب علم</th>
<th>فیس کی قسم</th>
<th>رقم</th>
<th>تاریخ</th>
<th>حیثیت</th>
<th>ایکشنز</th>
</tr>
</thead>
<tbody>
<!-- Will be filled dynamically -->
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="card">
<div class="card-header">
<h5>فیس کی رپورٹ</h5>
</div>
<div class="card-body">
<div class="row mb-3">
<div class="col-md-3">
<label class="form-label" for="fee-report-class">کلاس</label>
<select class="form-select" id="fee-report-class">
<option value="">تمام کلاسز</option>
<!-- Will be filled dynamically -->
</select>
</div>
<div class="col-md-3">
<label class="form-label" for="fee-report-student">طالب علم</label>
<select class="form-select" id="fee-report-student">
<option value="">تمام طلبہ</option>
<!-- Will be filled dynamically -->
</select>
</div>
<div class="col-md-3">
<label class="form-label" for="fee-report-from">شروع تاریخ</label>
<input class="form-control" id="fee-report-from" type="date"/>
</div>
<div class="col-md-3">
<label class="form-label" for="fee-report-to">ختم تاریخ</label>
<input class="form-control" id="fee-report-to" type="date"/>
</div>
</div>
<div class="mb-3">
<button class="btn btn-primary" id="generate-fee-report">رپورٹ جنریٹ کریں</button>
<button class="btn btn-success ms-2" id="export-fee-report">ایکسپورٹ (CSV)</button>
<button class="btn btn-info ms-2" id="print-fee-report">پرنٹ کریں</button>
</div>
<div id="fee-report-container" style="display: none;">
<div class="table-responsive">
<table class="table table-striped" id="fee-report-table">
<thead>
<tr>
<th>طالب علم</th>
<th>کلاس</th>
<th>فیس کی قسم</th>
<th>رقم</th>
<th>تاریخ</th>
<th>حیثیت</th>
</tr>
</thead>
<tbody>
<!-- Will be filled dynamically -->
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<!-- Fee Structure Modal -->
<div class="modal fade" id="fee-structure-modal" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="fee-structure-modal-title">نئی فیس ساخت</h5>
<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body">
<form id="fee-structure-form">
<input id="fee-structure-id" type="hidden"/>
<div class="mb-3">
<label class="form-label" for="fee-structure-class">کلاس</label>
<select class="form-select" id="fee-structure-class" required="">
<!-- Will be filled dynamically -->
</select>
</div>
<div class="mb-3">
<label class="form-label" for="fee-structure-type">فیس کی قسم</label>
<input class="form-control" id="fee-structure-type" required="" type="text"/>
</div>
<div class="mb-3">
<label class="form-label" for="fee-structure-amount">رقم</label>
<input class="form-control" id="fee-structure-amount" required="" type="number"/>
</div>
<div class="mb-3">
<label class="form-label" for="fee-structure-period">ادائیگی کا دورانیہ</label>
<select class="form-select" id="fee-structure-period" required="">
<option value="monthly">ماہانہ</option>
<option value="quarterly">سہ ماہی</option>
<option value="half-yearly">ششماہی</option>
<option value="yearly">سالانہ</option>
<option value="one-time">ایک بار</option>
</select>
</div>
</form>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" data-bs-dismiss="modal" type="button">منسوخ کریں</button>
<button class="btn btn-primary" id="save-fee-structure" type="button">محفوظ کریں</button>
</div>
</div>
</div>
</div>
<!-- Fee Payment Modal -->
<div class="modal fade" id="fee-payment-modal" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="fee-payment-modal-title">نئی فیس ادائیگی</h5>
<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body">
<form id="fee-payment-form">
<input id="fee-payment-id" type="hidden"/>
<div class="mb-3">
<label class="form-label" for="fee-payment-student">طالب علم</label>
<select class="form-select" id="fee-payment-student" required="">
<!-- Will be filled dynamically -->
</select>
</div>
<div class="mb-3">
<label class="form-label" for="fee-payment-type">فیس کی قسم</label>
<select class="form-select" id="fee-payment-type" required="">
<!-- Will be filled dynamically -->
</select>
</div>
<div class="mb-3">
<label class="form-label" for="fee-payment-amount">رقم</label>
<input class="form-control" id="fee-payment-amount" required="" type="number"/>
</div>
<div class="mb-3">
<label class="form-label" for="fee-payment-date">تاریخ</label>
<input class="form-control" id="fee-payment-date" required="" type="date"/>
</div>
<div class="mb-3">
<label class="form-label" for="fee-payment-status">حیثیت</label>
<select class="form-select" id="fee-payment-status" required="">
<option value="paid">ادا شدہ</option>
<option value="pending">زیر التواء</option>
<option value="partial">جزوی</option>
</select>
</div>
<div class="mb-3">
<label class="form-label" for="fee-payment-notes">نوٹس</label>
<textarea class="form-control" id="fee-payment-notes" rows="2"></textarea>
</div>
</form>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" data-bs-dismiss="modal" type="button">منسوخ کریں</button>
<button class="btn btn-primary" id="save-fee-payment" type="button">محفوظ کریں</button>
</div>
</div>
</div>
</div>
<!-- Salaries Page -->
<div id="salaries-page" style="display: none;">
<h2 class="mb-4">تنخواہوں کا انتظام</h2>
<div class="card mb-4">
<div class="card-header d-flex justify-content-between">
<h5>تنخواہ ادائیگی</h5>
<button class="btn btn-sm btn-primary" id="add-salary-payment-btn">
<i class="bi bi-plus-circle"></i> نئی ادائیگی
                            </button>
</div>
<div class="card-body">
<div class="table-responsive">
<table class="table table-striped" id="salary-payment-table">
<thead>
<tr>
<th>استاد</th>
<th>مہینہ</th>
<th>سال</th>
<th>بنیادی تنخواہ</th>
<th>الاؤنس</th>
<th>کل رقم</th>
<th>ادائیگی کی تاریخ</th>
<th>حیثیت</th>
<th>ایکشنز</th>
</tr>
</thead>
<tbody>
<!-- Will be filled dynamically -->
</tbody>
</table>
</div>
</div>
</div>
<div class="card">
<div class="card-header">
<h5>تنخواہوں کی رپورٹ</h5>
</div>
<div class="card-body">
<div class="row mb-3">
<div class="col-md-3">
<label class="form-label" for="salary-report-teacher">استاد</label>
<select class="form-select" id="salary-report-teacher">
<option value="">تمام اساتذہ</option>
<!-- Will be filled dynamically -->
</select>
</div>
<div class="col-md-3">
<label class="form-label" for="salary-report-year">سال</label>
<select class="form-select" id="salary-report-year">
<!-- Will be filled dynamically -->
</select>
</div>
<div class="col-md-3">
<label class="form-label" for="salary-report-month">مہینہ</label>
<select class="form-select" id="salary-report-month">
<option value="">تمام مہینے</option>
<option value="1">جنوری</option>
<option value="2">فروری</option>
<option value="3">مارچ</option>
<option value="4">اپریل</option>
<option value="5">مئی</option>
<option value="6">جون</option>
<option value="7">جولائی</option>
<option value="8">اگست</option>
<option value="9">ستمبر</option>
<option value="10">اکتوبر</option>
<option value="11">نومبر</option>
<option value="12">دسمبر</option>
</select>
</div>
<div class="col-md-3">
<label class="form-label" for="salary-report-status">حیثیت</label>
<select class="form-select" id="salary-report-status">
<option value="">تمام</option>
<option value="paid">ادا شدہ</option>
<option value="pending">زیر التواء</option>
<option value="partial">جزوی</option>
</select>
</div>
</div>
<div class="mb-3">
<button class="btn btn-primary" id="generate-salary-report">رپورٹ جنریٹ کریں</button>
<button class="btn btn-success ms-2" id="export-salary-report">ایکسپورٹ (CSV)</button>
<button class="btn btn-info ms-2" id="print-salary-report">پرنٹ کریں</button>
</div>
<div id="salary-report-container" style="display: none;">
<div class="table-responsive">
<table class="table table-striped" id="salary-report-table">
<thead>
<tr>
<th>استاد</th>
<th>مہینہ</th>
<th>سال</th>
<th>بنیادی تنخواہ</th>
<th>الاؤنس</th>
<th>کل رقم</th>
<th>ادائیگی کی تاریخ</th>
<th>حیثیت</th>
</tr>
</thead>
<tbody>
<!-- Will be filled dynamically -->
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<!-- Salary Payment Modal -->
<div class="modal fade" id="salary-payment-modal" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="salary-payment-modal-title">نئی تنخواہ ادائیگی</h5>
<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body">
<form id="salary-payment-form">
<input id="salary-payment-id" type="hidden"/>
<div class="mb-3">
<label class="form-label" for="salary-payment-teacher">استاد</label>
<select class="form-select" id="salary-payment-teacher" required="">
<!-- Will be filled dynamically -->
</select>
</div>
<div class="row mb-3">
<div class="col-md-6">
<label class="form-label" for="salary-payment-month">مہینہ</label>
<select class="form-select" id="salary-payment-month" required="">
<option value="1">جنوری</option>
<option value="2">فروری</option>
<option value="3">مارچ</option>
<option value="4">اپریل</option>
<option value="5">مئی</option>
<option value="6">جون</option>
<option value="7">جولائی</option>
<option value="8">اگست</option>
<option value="9">ستمبر</option>
<option value="10">اکتوبر</option>
<option value="11">نومبر</option>
<option value="12">دسمبر</option>
</select>
</div>
<div class="col-md-6">
<label class="form-label" for="salary-payment-year">سال</label>
<select class="form-select" id="salary-payment-year" required="">
<!-- Will be filled dynamically -->
</select>
</div>
</div>
<div class="mb-3">
<label class="form-label" for="salary-payment-base">بنیادی تنخواہ</label>
<input class="form-control" id="salary-payment-base" required="" type="number"/>
</div>
<div class="mb-3">
<label class="form-label" for="salary-payment-allowance">الاؤنس</label>
<input class="form-control" id="salary-payment-allowance" type="number" value="0"/>
</div>
<div class="mb-3">
<label class="form-label" for="salary-payment-total">کل رقم</label>
<input class="form-control" id="salary-payment-total" readonly="" type="number"/>
</div>
<div class="mb-3">
<label class="form-label" for="salary-payment-date">ادائیگی کی تاریخ</label>
<input class="form-control" id="salary-payment-date" required="" type="date"/>
</div>
<div class="mb-3">
<label class="form-label" for="salary-payment-status">حیثیت</label>
<select class="form-select" id="salary-payment-status" required="">
<option value="paid">ادا شدہ</option>
<option value="pending">زیر التواء</option>
<option value="partial">جزوی</option>
</select>
</div>
<div class="mb-3">
<label class="form-label" for="salary-payment-notes">نوٹس</label>
<textarea class="form-control" id="salary-payment-notes" rows="2"></textarea>
</div>
</form>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" data-bs-dismiss="modal" type="button">منسوخ کریں</button>
<button class="btn btn-primary" id="save-salary-payment" type="button">محفوظ کریں</button>
</div>
</div>
</div>
</div>
<!-- Reports Page -->
<div id="reports-page" style="display: none;">
<h2 class="mb-4">رپورٹس</h2>
<div class="row">
<div class="col-md-4 mb-4">
<div class="card">
<div class="card-body">
<h5 class="card-title">طلبہ کی رپورٹ</h5>
<p class="card-text">طلبہ کی تفصیلی رپورٹ جنریٹ کریں، فلٹر اور ایکسپورٹ کریں۔</p>
<a class="btn btn-primary" data-report="student" href="#">رپورٹ دیکھیں</a>
</div>
</div>
</div>
<div class="col-md-4 mb-4">
<div class="card">
<div class="card-body">
<h5 class="card-title">حاضری کی رپورٹ</h5>
<p class="card-text">طلبہ کی حاضری کی رپورٹ جنریٹ کریں، فلٹر اور ایکسپورٹ کریں۔</p>
<a class="btn btn-primary" data-report="attendance" href="#">رپورٹ دیکھیں</a>
</div>
</div>
</div>
<div class="col-md-4 mb-4">
<div class="card">
<div class="card-body">
<h5 class="card-title">فیس کی رپورٹ</h5>
<p class="card-text">فیس کی ادائیگی کی رپورٹ جنریٹ کریں، فلٹر اور ایکسپورٹ کریں۔</p>
<a class="btn btn-primary" data-report="fee" href="#">رپورٹ دیکھیں</a>
</div>
</div>
</div>
<div class="col-md-4 mb-4">
<div class="card">
<div class="card-body">
<h5 class="card-title">تنخواہ کی رپورٹ</h5>
<p class="card-text">اساتذہ کی تنخواہ کی رپورٹ جنریٹ کریں، فلٹر اور ایکسپورٹ کریں۔</p>
<a class="btn btn-primary" data-report="salary" href="#">رپورٹ دیکھیں</a>
</div>
</div>
</div>
<div class="col-md-4 mb-4">
<div class="card">
<div class="card-body">
<h5 class="card-title">اخراجات کی رپورٹ</h5>
<p class="card-text">مدرسے کے اخراجات کی رپورٹ جنریٹ کریں، فلٹر اور ایکسپورٹ کریں۔</p>
<a class="btn btn-primary" data-report="expense" href="#">رپورٹ دیکھیں</a>
</div>
</div>
</div>
<div class="col-md-4 mb-4">
<div class="card">
<div class="card-body">
<h5 class="card-title">انوینٹری کی رپورٹ</h5>
<p class="card-text">مدرسے کی انوینٹری کی رپورٹ جنریٹ کریں، فلٹر اور ایکسپورٹ کریں۔</p>
<a class="btn btn-primary" data-report="inventory" href="#">رپورٹ دیکھیں</a>
</div>
</div>
</div>
</div>
<div class="card" id="report-container" style="display: none;">
<div class="card-header d-flex justify-content-between">
<h5 id="report-title">رپورٹ</h5>
<div>
<button class="btn btn-sm btn-success" id="export-report">ایکسپورٹ (CSV)</button>
<button class="btn btn-sm btn-info ms-2" id="print-report">پرنٹ کریں</button>
</div>
</div>
<div class="card-body">
<div class="mb-3" id="report-filters">
<!-- Filters will be added dynamically -->
</div>
<div id="report-data">
<!-- Report data will be added dynamically -->
</div>
</div>
</div>
</div>
<!-- Inventory Page -->
<div id="inventory-page" style="display: none;">
<div class="d-flex justify-content-between align-items-center mb-4">
<h2>انوینٹری کا انتظام</h2>
<button class="btn btn-primary" id="add-inventory-btn">
<i class="bi bi-plus-circle"></i> نئی آئٹم
                        </button>
</div>
<div class="card mb-4">
<div class="card-header">
<h5>انوینٹری کی فہرست</h5>
</div>
<div class="card-body">
<div class="mb-3">
<input class="form-control" id="inventory-search" placeholder="آئٹم کی تلاش..." type="text"/>
</div>
<div class="table-responsive">
<table class="table table-striped" id="inventory-table">
<thead>
<tr>
<th>آئی ڈی</th>
<th>آئٹم کا نام</th>
<th>زمرہ</th>
<th>تعداد</th>
<th>یونٹ</th>
<th>خریداری کی تاریخ</th>
<th>قیمت</th>
<th>ایکشنز</th>
</tr>
</thead>
<tbody>
<!-- Will be filled dynamically -->
</tbody>
</table>
</div>
</div>
</div>
</div>
<!-- Inventory Modal -->
<div class="modal fade" id="inventory-modal" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="inventory-modal-title">نئی انوینٹری آئٹم</h5>
<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body">
<form id="inventory-form">
<input id="inventory-id" type="hidden"/>
<div class="mb-3">
<label class="form-label" for="inventory-name">آئٹم کا نام</label>
<input class="form-control" id="inventory-name" required="" type="text"/>
</div>
<div class="mb-3">
<label class="form-label" for="inventory-category">زمرہ</label>
<select class="form-select" id="inventory-category" required="">
<option value="furniture">فرنیچر</option>
<option value="stationary">سٹیشنری</option>
<option value="electronics">الیکٹرانکس</option>
<option value="books">کتابیں</option>
<option value="other">دیگر</option>
</select>
</div>
<div class="row mb-3">
<div class="col-md-6">
<label class="form-label" for="inventory-quantity">تعداد</label>
<input class="form-control" id="inventory-quantity" required="" type="number"/>
</div>
<div class="col-md-6">
<label class="form-label" for="inventory-unit">یونٹ</label>
<input class="form-control" id="inventory-unit" required="" type="text"/>
</div>
</div>
<div class="row mb-3">
<div class="col-md-6">
<label class="form-label" for="inventory-purchase-date">خریداری کی تاریخ</label>
<input class="form-control" id="inventory-purchase-date" required="" type="date"/>
</div>
<div class="col-md-6">
<label class="form-label" for="inventory-price">قیمت</label>
<input class="form-control" id="inventory-price" required="" type="number"/>
</div>
</div>
<div class="mb-3">
<label class="form-label" for="inventory-notes">نوٹس</label>
<textarea class="form-control" id="inventory-notes" rows="2"></textarea>
</div>
</form>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" data-bs-dismiss="modal" type="button">منسوخ کریں</button>
<button class="btn btn-primary" id="save-inventory" type="button">محفوظ کریں</button>
</div>
</div>
</div>
</div>
<!-- Expenses Page -->
<div id="expenses-page" style="display: none;">
<div class="d-flex justify-content-between align-items-center mb-4">
<h2>اخراجات کا انتظام</h2>
<button class="btn btn-primary" id="add-expense-btn">
<i class="bi bi-plus-circle"></i> نیا خرچہ
                        </button>
</div>
<div class="card mb-4">
<div class="card-header">
<h5>اخراجات کی فہرست</h5>
</div>
<div class="card-body">
<div class="mb-3">
<input class="form-control" id="expense-search" placeholder="خرچہ تلاش کریں..." type="text"/>
</div>
<div class="table-responsive">
<table class="table table-striped" id="expenses-table">
<thead>
<tr>
<th>آئی ڈی</th>
<th>تفصیل</th>
<th>زمرہ</th>
<th>رقم</th>
<th>تاریخ</th>
<th>ادا کنندہ</th>
<th>ایکشنز</th>
</tr>
</thead>
<tbody>
<!-- Will be filled dynamically -->
</tbody>
</table>
</div>
</div>
</div>
</div>
<!-- Expense Modal -->
<div class="modal fade" id="expense-modal" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="expense-modal-title">نیا خرچہ</h5>
<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body">
<form id="expense-form">
<input id="expense-id" type="hidden"/>
<div class="mb-3">
<label class="form-label" for="expense-description">تفصیل</label>
<input class="form-control" id="expense-description" required="" type="text"/>
</div>
<div class="mb-3">
<label class="form-label" for="expense-category">زمرہ</label>
<select class="form-select" id="expense-category" required="">
<option value="utilities">یوٹیلٹیز</option>
<option value="maintenance">مرمت</option>
<option value="salaries">تنخواہیں</option>
<option value="stationary">سٹیشنری</option>
<option value="furniture">فرنیچر</option>
<option value="electronics">الیکٹرانکس</option>
<option value="other">دیگر</option>
</select>
</div>
<div class="row mb-3">
<div class="col-md-6">
<label class="form-label" for="expense-amount">رقم</label>
<input class="form-control" id="expense-amount" required="" type="number"/>
</div>
<div class="col-md-6">
<label class="form-label" for="expense-date">تاریخ</label>
<input class="form-control" id="expense-date" required="" type="date"/>
</div>
</div>
<div class="mb-3">
<label class="form-label" for="expense-paid-by">ادا کنندہ</label>
<input class="form-control" id="expense-paid-by" required="" type="text"/>
</div>
<div class="mb-3">
<label class="form-label" for="expense-notes">نوٹس</label>
<textarea class="form-control" id="expense-notes" rows="2"></textarea>
</div>
</form>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" data-bs-dismiss="modal" type="button">منسوخ کریں</button>
<button class="btn btn-primary" id="save-expense" type="button">محفوظ کریں</button>
</div>
</div>
</div>
</div>
<!-- Backup and Restore Page -->
<div id="backup-page" style="display: none;">
<h2 class="mb-4">بیک اپ اور ریسٹور</h2>
<div class="row">
<div class="col-md-6">
<div class="card mb-4">
<div class="card-header">
<h5>ڈیٹا بیک اپ</h5>
</div>
<div class="card-body">
<p>اپنے تمام ڈیٹا کا بیک اپ لیں اور اسے اپنے کمپیوٹر پر محفوظ کریں۔</p>
<button class="btn btn-primary" id="backup-data">
<i class="bi bi-download"></i> ڈیٹا بیک اپ کریں
                                    </button>
</div>
</div>
</div>
<div class="col-md-6">
<div class="card mb-4">
<div class="card-header">
<h5>ڈیٹا ریسٹور</h5>
</div>
<div class="card-body">
<p>پہلے محفوظ کیا گیا بیک اپ فائل استعمال کرکے اپنا ڈیٹا ریسٹور کریں۔</p>
<div class="mb-3">
<input accept=".json" class="form-control" id="restore-file" type="file"/>
</div>
<button class="btn btn-danger" id="restore-data">
<i class="bi bi-upload"></i> ڈیٹا ریسٹور کریں
                                    </button>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- Print Section -->
<div class="print-section" id="print-section"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
        // Database initialization
        let db;
        const DB_NAME = 'DeeniMadrasaDB';
        const DB_VERSION = 1;
    
        // Initialize IndexedDB
        function initDB() {
            return new Promise((resolve, reject) => {
                const req = indexedDB.open(DB_NAME, DB_VERSION);
                
                req.onerror = (event) => {
                    console.error('IndexedDB error:', event.target.error);
                    reject('Failed to open database');
                };
                
                req.onsuccess = (event) => {
                    db = event.target.result;
                    console.log('Database opened successfully');
                    resolve(db);
                };
                
                req.onupgradeneeded = (event) => {
                    const d = event.target.result;
                    
                    // Create Students store
                    if (!d.objectStoreNames.contains('students')) {
                        const s = d.createObjectStore('students', { keyPath: 'id', autoIncrement: true });
                        s.createIndex('name', 'name', { unique: false });
                        s.createIndex('class', 'class', { unique: false });
                    }
                    
                    // Create Teachers store
                    if (!d.objectStoreNames.contains('teachers')) {
                        const t = d.createObjectStore('teachers', { keyPath: 'id', autoIncrement: true });
                        t.createIndex('name', 'name', { unique: false });
                    }
                    
                    // Create Classes store
                    if (!d.objectStoreNames.contains('classes')) {
                        const c = d.createObjectStore('classes', { keyPath: 'id', autoIncrement: true });
                        c.createIndex('name', 'name', { unique: false });
                    }
                    
                    // Create Attendance store
                    if (!d.objectStoreNames.contains('attendance')) {
                        const a = d.createObjectStore('attendance', { keyPath: 'id', autoIncrement: true });
                        a.createIndex('date', 'date', { unique: false });
                        a.createIndex('classId', 'classId', { unique: false });
                        a.createIndex('studentId', 'studentId', { unique: false });
                    }
                    
                    // Create Fee Structure store
                    if (!d.objectStoreNames.contains('feeStructures')) {
                        const f = d.createObjectStore('feeStructures', { keyPath: 'id', autoIncrement: true });
                        f.createIndex('classId', 'classId', { unique: false });
                    }
                    
                    // Create Fee Payments store
                    if (!d.objectStoreNames.contains('feePayments')) {
                        const f = d.createObjectStore('feePayments', { keyPath: 'id', autoIncrement: true });
                        f.createIndex('studentId', 'studentId', { unique: false });
                        f.createIndex('date', 'date', { unique: false });
                    }
                    
                    // Create Salary Payments store
                    if (!d.objectStoreNames.contains('salaryPayments')) {
                        const s = d.createObjectStore('salaryPayments', { keyPath: 'id', autoIncrement: true });
                        s.createIndex('teacherId', 'teacherId', { unique: false });
                        s.createIndex('month', 'month', { unique: false });
                        s.createIndex('year', 'year', { unique: false });
                    }
                    
                    // Create Inventory store
                    if (!d.objectStoreNames.contains('inventory')) {
                        const i = d.createObjectStore('inventory', { keyPath: 'id', autoIncrement: true });
                        i.createIndex('category', 'category', { unique: false });
                    }
                    
                    // Create Expenses store
                    if (!d.objectStoreNames.contains('expenses')) {
                        const e = d.createObjectStore('expenses', { keyPath: 'id', autoIncrement: true });
                        e.createIndex('category', 'category', { unique: false });
                        e.createIndex('date', 'date', { unique: false });
                    }
                    
                    console.log('Database schema created');
                };
            });
        }
    
        // Generic database operations
        function addData(storeName, data) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction(storeName, 'readwrite');
                const store = tx.objectStore(storeName);
                const req = store.add(data);
                
                req.onsuccess = (event) => {
                    resolve(event.target.result);
                };
                
                req.onerror = (event) => {
                    reject('Error adding data: ' + event.target.error);
                };
            });
        }
    
        function updateData(storeName, data) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction(storeName, 'readwrite');
                const store = tx.objectStore(storeName);
                const req = store.put(data);
                
                req.onsuccess = () => {
                    resolve(true);
                };
                
                req.onerror = (event) => {
                    reject('Error updating data: ' + event.target.error);
                };
            });
        }
    
        function deleteData(storeName, id) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction(storeName, 'readwrite');
                const store = tx.objectStore(storeName);
                const req = store.delete(id);
                
                req.onsuccess = () => {
                    resolve(true);
                };
                
                req.onerror = (event) => {
                    reject('Error deleting data: ' + event.target.error);
                };
            });
        }
    
        function getData(storeName, id) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction(storeName, 'readonly');
                const store = tx.objectStore(storeName);
                const req = store.get(id);
                
                req.onsuccess = (event) => {
                    resolve(event.target.result);
                };
                
                req.onerror = (event) => {
                    reject('Error getting data: ' + event.target.error);
                };
            });
        }
    
        function getAllData(storeName) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction(storeName, 'readonly');
                const store = tx.objectStore(storeName);
                const req = store.getAll();
                
                req.onsuccess = (event) => {
                    resolve(event.target.result);
                };
                
                req.onerror = (event) => {
                    reject('Error getting all data: ' + event.target.error);
                };
            });
        }
    
        function getDataByIndex(storeName, indexName, value) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction(storeName, 'readonly');
                const store = tx.objectStore(storeName);
                const index = store.index(indexName);
                const req = index.getAll(value);
                
                req.onsuccess = (event) => {
                    resolve(event.target.result);
                };
                
                req.onerror = (event) => {
                    reject('Error getting data by index: ' + event.target.error);
                };
            });
        }
    
        // UI Functions
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.main-content > div').forEach(page => {
                page.style.display = 'none';
            });
            
            // Show the selected page
            document.getElementById(pageId + '-page').style.display = 'block';
            
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`.nav-link[data-page="${pageId}"]`).classList.add('active');
            
            // Page specific initializations
            switch(pageId) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'students':
                    loadStudents();
                    break;
                case 'teachers':
                    loadTeachers();
                    break;
                case 'classes':
                    loadClasses();
                    break;
                case 'attendance':
                    initAttendancePage();
                    break;
                case 'fees':
                    loadFeeStructures();
                    loadFeePayments();
                    break;
                case 'salaries':
                    loadSalaryPayments();
                    break;
                case 'inventory':
                    loadInventory();
                    break;
                case 'expenses':
                    loadExpenses();
                    break;
            }
        }
    
        function updateDateTime() {
            const now = new Date();
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            document.getElementById('datetime').textContent = now.toLocaleDateString('ur-PK', options);
        }
    
        // Dashboard functions
        async function loadDashboard() {
            try {
                // Count total students
                const s = await getAllData('students');
                document.getElementById('total-students').textContent = s.length;
                
                // Count total teachers
                const t = await getAllData('teachers');
                document.getElementById('total-teachers').textContent = t.length;
                
                // Count total classes
                const c = await getAllData('classes');
                document.getElementById('total-classes').textContent = c.length;
                
                // Count today's attendance
                const today = new Date().toISOString().split('T');
                const a = await getDataByIndex('attendance', 'date', today);
                const present = a.filter(record => record.status === 'present').length;
                document.getElementById('today-attendance').textContent = present;
                
                // Recent fee payments
                const fp = await getAllData('feePayments');
                fp.sort((a, b) => new Date(b.date) - new Date(a.date));
                const recentFees = fp.slice(0, 5);
                
                const feeBody = document.querySelector('#recent-fees tbody');
                feeBody.innerHTML = '';
                
                for (const fee of recentFees) {
                    const student = await getData('students', fee.studentId);
                    const cls = student ? await getData('classes', student.class) : null;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${student ? student.name : 'N/A'}</td>
                        <td>${cls ? cls.name : 'N/A'}</td>
                        <td>${fee.amount}</td>
                        <td>${new Date(fee.date).toLocaleDateString('ur-PK')}</td>
                    `;
                    feeBody.appendChild(row);
                }
                
                // Recent expenses
                const ex = await getAllData('expenses');
                ex.sort((a, b) => new Date(b.date) - new Date(a.date));
                const recentExpenses = ex.slice(0, 5);
                
                const expenseBody = document.querySelector('#recent-expenses tbody');
                expenseBody.innerHTML = '';
                
                for (const expense of recentExpenses) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${expense.description}</td>
                        <td>${expense.category}</td>
                        <td>${expense.amount}</td>
                        <td>${new Date(expense.date).toLocaleDateString('ur-PK')}</td>
                    `;
                    expenseBody.appendChild(row);
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }
    
        // Student functions
        async function loadStudents() {
            try {
                const s = await getAllData('students');
                const table = document.getElementById('students-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                for (const student of s) {
                    const cls = student.class ? await getData('classes', student.class) : null;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${student.id}</td>
                        <td>${student.name}</td>
                        <td>${student.father}</td>
                        <td>${student.age}</td>
                        <td>${cls ? cls.name : 'N/A'}</td>
                        <td>${student.admissionDate ? new Date(student.admissionDate).toLocaleDateString('ur-PK') : 'N/A'}</td>
                        <td>${student.contact}</td>
                        <td>
                            <button class="btn btn-sm btn-primary btn-action edit-student" data-id="${student.id}">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger btn-action delete-student" data-id="${student.id}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                }
                
                // Attach event listeners
                document.querySelectorAll('.edit-student').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.getAttribute('data-id'));
                        editStudent(id);
                    });
                });
                
                document.querySelectorAll('.delete-student').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.getAttribute('data-id'));
                        deleteStudent(id);
                    });
                });
                
                // Populate class dropdown in add/edit form
                const c = await getAllData('classes');
                const classSelect = document.getElementById('student-class');
                classSelect.innerHTML = '<option value="">کلاس منتخب کریں</option>';
                
                for (const cls of c) {
                    const option = document.createElement('option');
                    option.value = cls.id;
                    option.textContent = cls.name;
                    classSelect.appendChild(option);
                }
            } catch (error) {
                console.error('Error loading students:', error);
            }
        }
    
        async function editStudent(id) {
            try {
                const s = await getData('students', id);
                
                document.getElementById('student-modal-title').textContent = 'طالب علم کی معلومات میں ترمیم';
                document.getElementById('student-id').value = s.id;
                document.getElementById('student-name').value = s.name;
                document.getElementById('student-father').value = s.father;
                document.getElementById('student-age').value = s.age;
                document.getElementById('student-class').value = s.class;
                document.getElementById('student-admission-date').value = s.admissionDate;
                document.getElementById('student-contact').value = s.contact;
                document.getElementById('student-address').value = s.address;
                
                // Clear existing custom fields
                document.getElementById('custom-fields-container').innerHTML = '';
                
                // Add custom fields if any
                if (s.customFields) {
                    for (const [key, value] of Object.entries(s.customFields)) {
                        addCustomField(key, value);
                    }
                }
                
                const m = new bootstrap.Modal(document.getElementById('student-modal'));
                m.show();
            } catch (error) {
                console.error('Error editing student:', error);
            }
        }
    
        async function deleteStudent(id) {
            if (confirm('کیا آپ واقعی اس طالب علم کو حذف کرنا چاہتے ہیں؟')) {
                try {
                    await deleteData('students', id);
                    loadStudents();
                } catch (error) {
                    console.error('Error deleting student:', error);
                }
            }
        }
    
        function addCustomField(key = '', value = '') {
            const container = document.getElementById('custom-fields-container');
            const fieldId = 'custom-field-' + Date.now();
            
            const div = document.createElement('div');
            div.className = 'row mb-3 custom-field';
            div.innerHTML = `
                <div class="col-md-5">
                    <input type="text" class="form-control custom-field-key" placeholder="فیلڈ کا نام" value="${key}" required>
                </div>
                <div class="col-md-5">
                    <input type="text" class="form-control custom-field-value" placeholder="قیمت" value="${value}" required>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-danger remove-custom-field">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            `;
            container.appendChild(div);
            
            div.querySelector('.remove-custom-field').addEventListener('click', function() {
                div.remove();
            });
        }
    
        // Teacher functions
        async function loadTeachers() {
            try {
                const t = await getAllData('teachers');
                const table = document.getElementById('teachers-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                for (const teacher of t) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${teacher.id}</td>
                        <td>${teacher.name}</td>
                        <td>${teacher.specialization}</td>
                        <td>${teacher.education}</td>
                        <td>${teacher.contact}</td>
                        <td>${teacher.joinDate ? new Date(teacher.joinDate).toLocaleDateString('ur-PK') : 'N/A'}</td>
                        <td>${teacher.salary}</td>
                        <td>
                            <button class="btn btn-sm btn-primary btn-action edit-teacher" data-id="${teacher.id}">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger btn-action delete-teacher" data-id="${teacher.id}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                }
                
                // Attach event listeners
                document.querySelectorAll('.edit-teacher').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.getAttribute('data-id'));
                        editTeacher(id);
                    });
                });
                
                document.querySelectorAll('.delete-teacher').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.getAttribute('data-id'));
                        deleteTeacher(id);
                    });
                });
            } catch (error) {
                console.error('Error loading teachers:', error);
            }
        }
    
        async function editTeacher(id) {
            try {
                const t = await getData('teachers', id);
                
                document.getElementById('teacher-modal-title').textContent = 'استاد کی معلومات میں ترمیم';
                document.getElementById('teacher-id').value = t.id;
                document.getElementById('teacher-name').value = t.name;
                document.getElementById('teacher-specialization').value = t.specialization;
                document.getElementById('teacher-education').value = t.education;
                document.getElementById('teacher-join-date').value = t.joinDate;
                document.getElementById('teacher-contact').value = t.contact;
                document.getElementById('teacher-salary').value = t.salary;
                document.getElementById('teacher-address').value = t.address;
                
                // Clear existing custom fields
                document.getElementById('teacher-custom-fields-container').innerHTML = '';
                
                // Add custom fields if any
                if (t.customFields) {
                    for (const [key, value] of Object.entries(t.customFields)) {
                        addTeacherCustomField(key, value);
                    }
                }
                
                const m = new bootstrap.Modal(document.getElementById('teacher-modal'));
                m.show();
            } catch (error) {
                console.error('Error editing teacher:', error);
            }
        }
    
        async function deleteTeacher(id) {
            if (confirm('کیا آپ واقعی اس استاد کو حذف کرنا چاہتے ہیں؟')) {
                try {
                    await deleteData('teachers', id);
                    loadTeachers();
                } catch (error) {
                    console.error('Error deleting teacher:', error);
                }
            }
        }
    
        function addTeacherCustomField(key = '', value = '') {
            const container = document.getElementById('teacher-custom-fields-container');
            const fieldId = 'teacher-custom-field-' + Date.now();
            
            const div = document.createElement('div');
            div.className = 'row mb-3 custom-field';
            div.innerHTML = `
                <div class="col-md-5">
                    <input type="text" class="form-control teacher-custom-field-key" placeholder="فیلڈ کا نام" value="${key}" required>
                </div>
                <div class="col-md-5">
                    <input type="text" class="form-control teacher-custom-field-value" placeholder="قیمت" value="${value}" required>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-danger remove-teacher-custom-field">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            `;
            container.appendChild(div);
            
            div.querySelector('.remove-teacher-custom-field').addEventListener('click', function() {
                div.remove();
            });
        }
    
        // Class functions
        async function loadClasses() {
            try {
                const c = await getAllData('classes');
                const table = document.getElementById('classes-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                for (const cls of c) {
                    // Get teacher name
                    const t = cls.teacherId ? await getData('teachers', cls.teacherId) : null;
                    
                    // Count students in this class
                    const s = await getDataByIndex('students', 'class', cls.id);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${cls.id}</td>
                        <td>${cls.name}</td>
                        <td>${cls.level}</td>
                        <td>${t ? t.name : 'N/A'}</td>
                        <td>${s.length}</td>
                        <td>${cls.room}</td>
                        <td>
                            <button class="btn btn-sm btn-primary btn-action edit-class" data-id="${cls.id}">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger btn-action delete-class" data-id="${cls.id}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                }
                
                // Attach event listeners
                document.querySelectorAll('.edit-class').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.getAttribute('data-id'));
                        editClass(id);
                    });
                });
                
                document.querySelectorAll('.delete-class').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.getAttribute('data-id'));
                        deleteClass(id);
                    });
                });
                
                // Populate teacher dropdown in add/edit form
                const teachers = await getAllData('teachers');
                const teacherSelect = document.getElementById('class-teacher');
                teacherSelect.innerHTML = '<option value="">استاد منتخب کریں</option>';
                
                for (const teacher of teachers) {
                    const option = document.createElement('option');
                    option.value = teacher.id;
                    option.textContent = teacher.name;
                    teacherSelect.appendChild(option);
                }
            } catch (error) {
                console.error('Error loading classes:', error);
            }
        }
    
        async function editClass(id) {
            try {
                const c = await getData('classes', id);
                
                document.getElementById('class-modal-title').textContent = 'کلاس کی معلومات میں ترمیم';
                document.getElementById('class-id').value = c.id;
                document.getElementById('class-name').value = c.name;
                document.getElementById('class-level').value = c.level;
                document.getElementById('class-teacher').value = c.teacherId;
                document.getElementById('class-room').value = c.room;
                
                const m = new bootstrap.Modal(document.getElementById('class-modal'));
                m.show();
            } catch (error) {
                console.error('Error editing class:', error);
            }
        }
    
        async function deleteClass(id) {
            if (confirm('کیا آپ واقعی اس کلاس کو حذف کرنا چاہتے ہیں؟')) {
                try {
                    await deleteData('classes', id);
                    loadClasses();
                } catch (error) {
                    console.error('Error deleting class:', error);
                }
            }
        }
    
        // Attendance functions
        async function initAttendancePage() {
            try {
                // Set default date to today
                document.getElementById('attendance-date').value = new Date().toISOString().split('T');
                
                // Load classes dropdown
                const classes = await getAllData('classes');
                const classSelect = document.getElementById('attendance-class');
                const reportClassSelect = document.getElementById('attendance-report-class');
                
                classSelect.innerHTML = '<option value="">کلاس منتخب کریں</option>';
                reportClassSelect.innerHTML = '<option value="">تمام کلاسز</option>';
                
                for (const cls of classes) {
                    const option1 = document.createElement('option');
                    option1.value = cls.id;
                    option1.textContent = cls.name;
                    classSelect.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = cls.id;
                    option2.textContent = cls.name;
                    reportClassSelect.appendChild(option2);
                }
                
                // Load students dropdown for report
                const students = await getAllData('students');
                const studentSelect = document.getElementById('attendance-report-student');
                studentSelect.innerHTML = '<option value="">تمام طلبہ</option>';
                
                for (const student of students) {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = student.name;
                    studentSelect.appendChild(option);
                }
                
                // Set default dates for report
                const today = new Date();
                const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
                
                document.getElementById('attendance-report-from').value = firstDay.toISOString().split('T');
                document.getElementById('attendance-report-to').value = today.toISOString().split('T');
            } catch (error) {
                console.error('Error initializing attendance page:', error);
            }
        }
    
        async function loadAttendance() {
            try {
                const classId = document.getElementById('attendance-class').value;
                const date = document.getElementById('attendance-date').value;
                
                if (!classId || !date) {
                    alert('کلاس اور تاریخ منتخب کریں');
                    return;
                }
                
                // Get students in this class
                const students = await getDataByIndex('students', 'class', parseInt(classId));
                
                if (students.length === 0) {
                    alert('اس کلاس میں کوئی طالب علم نہیں ہے');
                    return;
                }
                
                // Check if attendance already exists for this class and date
                const attendanceRecords = await getAllData('attendance');
                const existingRecords = attendanceRecords.filter(record => 
                    record.classId == classId && record.date === date
                );
                
                const table = document.getElementById('attendance-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                for (const student of students) {
                    const existing = existingRecords.find(record => record.studentId == student.id);
                    const status = existing ? existing.status : '';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${student.name}</td>
                        <td>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="attendance-${student.id}" value="present" id="present-${student.id}" ${status === 'present' ? 'checked' : ''}>
                                <label class="form-check-label" for="present-${student.id}">حاضر</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="attendance-${student.id}" value="absent" id="absent-${student.id}" ${status === 'absent' ? 'checked' : ''}>
                                <label class="form-check-label" for="absent-${student.id}">غیر حاضر</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="attendance-${student.id}" value="leave" id="leave-${student.id}" ${status === 'leave' ? 'checked' : ''}>
                                <label class="form-check-label" for="leave-${student.id}">چھٹی</label>
                            </div>
                            <input type="hidden" class="student-id" value="${student.id}">
                            <input type="hidden" class="record-id" value="${existing ? existing.id : ''}">
                        </td>
                    `;
                    table.appendChild(row);
                }
                
                document.getElementById('attendance-container').style.display = 'block';
            } catch (error) {
                console.error('Error loading attendance:', error);
            }
        }
    
        async function saveAttendance() {
            try {
                const classId = document.getElementById('attendance-class').value;
                const date = document.getElementById('attendance-date').value;
                
                if (!classId || !date) {
                    alert('کلاس اور تاریخ منتخب کریں');
                    return;
                }
                
                const rows = document.getElementById('attendance-table').getElementsByTagName('tbody')[0].rows;
                
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i];
                    const studentId = parseInt(row.querySelector('.student-id').value);
                    const recordId = row.querySelector('.record-id').value;
                    const radio = row.querySelector('input[type="radio"]:checked');
                    
                    if (!radio) {
                        continue; // Skip if no attendance marked
                    }
                    
                    const status = radio.value;
                    
                    if (recordId) {
                        // Update existing record
                        const record = await getData('attendance', parseInt(recordId));
                        record.status = status;
                        await updateData('attendance', record);
                    } else {
                        // Add new record
                        const record = {
                            date: date,
                            classId: parseInt(classId),
                            studentId: studentId,
                            status: status
                        };
                        await addData('attendance', record);
                    }
                }
                
                alert('حاضری محفوظ کر دی گئی ہے');
            } catch (error) {
                console.error('Error saving attendance:', error);
            }
        }
    
        async function generateAttendanceReport() {
            try {
                const classId = document.getElementById('attendance-report-class').value;
                const studentId = document.getElementById('attendance-report-student').value;
                const fromDate = document.getElementById('attendance-report-from').value;
                const toDate = document.getElementById('attendance-report-to').value;
                
                if (!fromDate || !toDate) {
                    alert('تاریخیں منتخب کریں');
                    return;
                }
                
                // Get all attendance records
                let records = await getAllData('attendance');
                
                // Filter by date range
                records = records.filter(record => 
                    record.date >= fromDate && record.date <= toDate
                );
                
                // Filter by class if selected
                if (classId) {
                    records = records.filter(record => record.classId == classId);
                }
                
                // Filter by student if selected
                if (studentId) {
                    records = records.filter(record => record.studentId == studentId);
                }
                
                // Sort by date (newest first)
                records.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const table = document.getElementById('attendance-report-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                for (const record of records) {
                    const student = await getData('students', record.studentId);
                    const cls = await getData('classes', record.classId);
                    
                    if (!student || !cls) continue;
                    
                    const row = document.createElement('tr');
                    
                    let statusText = '';
                    switch (record.status) {
                        case 'present':
                            statusText = 'حاضر';
                            break;
                        case 'absent':
                            statusText = 'غیر حاضر';
                            break;
                        case 'leave':
                            statusText = 'چھٹی';
                            break;
                    }
                    
                    row.innerHTML = `
                        <td>${student.name}</td>
                        <td>${cls.name}</td>
                        <td>${new Date(record.date).toLocaleDateString('ur-PK')}</td>
                        <td>${statusText}</td>
                    `;
                    table.appendChild(row);
                }
                
                document.getElementById('attendance-report-container').style.display = records.length > 0 ? 'block' : 'none';
                
                if (records.length === 0) {
                    alert('اس تاریخ کے لیے کوئی حاضری ریکارڈ نہیں ملا');
                }
            } catch (error) {
                console.error('Error generating attendance report:', error);
            }
        }
    
        // Fee functions
        async function loadFeeStructures() {
            try {
                const f = await getAllData('feeStructures');
                const table = document.getElementById('fee-structure-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                for (const fee of f) {
                    const cls = await getData('classes', fee.classId);
                    
                    let periodText = '';
                    switch (fee.period) {
                        case 'monthly':
                            periodText = 'ماہانہ';
                            break;
                        case 'quarterly':
                            periodText = 'سہ ماہی';
                            break;
                        case 'half-yearly':
                            periodText = 'ششماہی';
                            break;
                        case 'yearly':
                            periodText = 'سالانہ';
                            break;
                        case 'one-time':
                            periodText = 'ایک بار';
                            break;
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${cls ? cls.name : 'N/A'}</td>
                        <td>${fee.type}</td>
                        <td>${fee.amount}</td>
                        <td>${periodText}</td>
                        <td>
                            <button class="btn btn-sm btn-primary btn-action edit-fee-structure" data-id="${fee.id}">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger btn-action delete-fee-structure" data-id="${fee.id}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                }
                
                // Attach event listeners
                document.querySelectorAll('.edit-fee-structure').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.getAttribute('data-id'));
                        editFeeStructure(id);
                    });
                });
                
                document.querySelectorAll('.delete-fee-structure').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.getAttribute('data-id'));
                        deleteFeeStructure(id);
                    });
                });
                
                // Populate class dropdown in add/edit form
                const c = await getAllData('classes');
                const classSelect = document.getElementById('fee-structure-class');
                classSelect.innerHTML = '<option value="">کلاس منتخب کریں</option>';
                
                for (const cls of c) {
                    const option = document.createElement('option');
                    option.value = cls.id;
                    option.textContent = cls.name;
                    classSelect.appendChild(option);
                }
            } catch (error) {
                console.error('Error loading fee structures:', error);
            }
        }
    
        async function editFeeStructure(id) {
            try {
                const f = await getData('feeStructures', id);
                
                document.getElementById('fee-structure-modal-title').textContent = 'فیس کی ساخت میں ترمیم';
                document.getElementById('fee-structure-id').value = f.id;
                document.getElementById('fee-structure-class').value = f.classId;
                document.getElementById('fee-structure-type').value = f.type;
                document.getElementById('fee-structure-amount').value = f.amount;
                document.getElementById('fee-structure-period').value = f.period;
                
                const m = new bootstrap.Modal(document.getElementById('fee-structure-modal'));
                m.show();
            } catch (error) {
                console.error('Error editing fee structure:', error);
            }
        }
    
        async function deleteFeeStructure(id) {
            if (confirm('کیا آپ واقعی اس فیس کی ساخت کو حذف کرنا چاہتے ہیں؟')) {
                try {
                    await deleteData('feeStructures', id);
                    loadFeeStructures();
                } catch (error) {
                    console.error('Error deleting fee structure:', error);
                }
            }
        }
    
        async function loadFeePayments() {
            try {
                const f = await getAllData('feePayments');
                const table = document.getElementById('fee-payment-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                for (const fee of f) {
                    const student = await getData('students', fee.studentId);
                    
                    let statusText = '';
                    switch (fee.status) {
                        case 'paid':
                            statusText = 'ادا شدہ';
                            break;
                        case 'pending':
                            statusText = 'زیر التواء';
                            break;
                        case 'partial':
                            statusText = 'جزوی';
                            break;
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${student ? student.name : 'N/A'}</td>
                        <td>${fee.type}</td>
                        <td>${fee.amount}</td>
                        <td>${new Date(fee.date).toLocaleDateString('ur-PK')}</td>
                        <td>${statusText}</td>
                        <td>
                            <button class="btn btn-sm btn-primary btn-action edit-fee-payment" data-id="${fee.id}">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger btn-action delete-fee-payment" data-id="${fee.id}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                }
                
                // Attach event listeners
                document.querySelectorAll('.edit-fee-payment').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.getAttribute('data-id'));
                        editFeePayment(id);
                    });
                });
                
                document.querySelectorAll('.delete-fee-payment').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.getAttribute('data-id'));
                        deleteFeePayment(id);
                    });
                });
                
                // Populate student dropdown in add/edit form
                const s = await getAllData('students');
                const studentSelect = document.getElementById('fee-payment-student');
                studentSelect.innerHTML = '<option value="">طالب علم منتخب کریں</option>';
                
                for (const student of s) {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = student.name;
                    studentSelect.appendChild(option);
                }
                
                // Populate fee type dropdown
                const feeTypes = await getAllData('feeStructures');
                const typeSelect = document.getElementById('fee-payment-type');
                typeSelect.innerHTML = '<option value="">فیس کی قسم منتخب کریں</option>';
                
                for (const fee of feeTypes) {
                    const option = document.createElement('option');
                    option.value = fee.type;
                    option.textContent = fee.type;
                    option.dataset.amount = fee.amount;
                    typeSelect.appendChild(option);
                }
                
                // Set default date to today
                document.getElementById('fee-payment-date').value = new Date().toISOString().split('T');
                
                // Add event listener to fee type to auto-fill amount
                typeSelect.addEventListener('change', function() {
                    const selectedOption = this.options[this.selectedIndex];
                    if (selectedOption.dataset.amount) {
                        document.getElementById('fee-payment-amount').value = selectedOption.dataset.amount;
                    }
                });
                
                // Populate class dropdown in report form
                const c = await getAllData('classes');
                const reportClassSelect = document.getElementById('fee-report-class');
                reportClassSelect.innerHTML = '<option value="">تمام کلاسز</option>';
                
                for (const cls of c) {
                    const option = document.createElement('option');
                    option.value = cls.id;
                    option.textContent = cls.name;
                    reportClassSelect.appendChild(option);
                }
                
                // Populate student dropdown in report form
                const reportStudentSelect = document.getElementById('fee-report-student');
                reportStudentSelect.innerHTML = '<option value="">تمام طلبہ</option>';
                
                for (const student of s) {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = student.name;
                    reportStudentSelect.appendChild(option);
                }
                
                // Set default dates for report
                const today = new Date();
                const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
                
                document.getElementById('fee-report-from').value = firstDay.toISOString().split('T');
                document.getElementById('fee-report-to').value = today.toISOString().split('T');
            } catch (error) {
                console.error('Error loading fee payments:', error);
            }
        }
    
        async function editFeePayment(id) {
            try {
                const f = await getData('feePayments', id);
                
                document.getElementById('fee-payment-modal-title').textContent = 'فیس ادائیگی میں ترمیم';
                document.getElementById('fee-payment-id').value = f.id;
                document.getElementById('fee-payment-student').value = f.studentId;
                document.getElementById('fee-payment-type').value = f.type;
                document.getElementById('fee-payment-amount').value = f.amount;
                document.getElementById('fee-payment-date').value = f.date;
                document.getElementById('fee-payment-status').value = f.status;
                document.getElementById('fee-payment-notes').value = f.notes || '';
                
                const m = new bootstrap.Modal(document.getElementById('fee-payment-modal'));
                m.show();
            } catch (error) {
                console.error('Error editing fee payment:', error);
            }
        }
    
        async function deleteFeePayment(id) {
            if (confirm('کیا آپ واقعی اس فیس ادائیگی کو حذف کرنا چاہتے ہیں؟')) {
                try {
                    await deleteData('feePayments', id);
                    loadFeePayments();
                } catch (error) {
                    console.error('Error deleting fee payment:', error);
                }
            }
        }
    
        async function generateFeeReport() {
            try {
                const classId = document.getElementById('fee-report-class').value;
                const studentId = document.getElementById('fee-report-student').value;
                const fromDate = document.getElementById('fee-report-from').value;
                const toDate = document.getElementById('fee-report-to').value;
                
                if (!fromDate || !toDate) {
                    alert('تاریخیں منتخب کریں');
                    return;
                }
                
                // Get all fee payments
                let payments = await getAllData('feePayments');
                
                // Filter by date range
                payments = payments.filter(payment => 
                    payment.date >= fromDate && payment.date <= toDate
                );
                
                // Filter by student if selected
                if (studentId) {
                    payments = payments.filter(payment => payment.studentId == studentId);
                } else if (classId) {
                    // Filter by class if student not selected but class is
                    const students = await getDataByIndex('students', 'class', parseInt(classId));
                    const studentIds = students.map(student => student.id);
                    payments = payments.filter(payment => studentIds.includes(payment.studentId));
                }
                
                // Sort by date (newest first)
                payments.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const table = document.getElementById('fee-report-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                for (const payment of payments) {
                    const student = await getData('students', payment.studentId);
                    if (!student) continue;
                    
                    const cls = student.class ? await getData('classes', student.class) : null;
                    
                    let statusText = '';
                    switch (payment.status) {
                        case 'paid':
                            statusText = 'ادا شدہ';
                            break;
                        case 'pending':
                            statusText = 'زیر التواء';
                            break;
                        case 'partial':
                            statusText = 'جزوی';
                            break;
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${student.name}</td>
                        <td>${cls ? cls.name : 'N/A'}</td>
                        <td>${payment.type}</td>
                        <td>${payment.amount}</td>
                        <td>${new Date(payment.date).toLocaleDateString('ur-PK')}</td>
                        <td>${statusText}</td>
                    `;
                    table.appendChild(row);
                }
                
                document.getElementById('fee-report-container').style.display = payments.length > 0 ? 'block' : 'none';
                
                if (payments.length === 0) {
                    alert('اس تاریخ کے لیے کوئی فیس ریکارڈ نہیں ملا');
                }
            } catch (error) {
                console.error('Error generating fee report:', error);
            }
        }
    
        // Salary functions
        async function loadSalaryPayments() {
            try {
                const s = await getAllData('salaryPayments');
                const table = document.getElementById('salary-payment-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                for (const salary of s) {
                    const teacher = await getData('teachers', salary.teacherId);
                    
                    let statusText = '';
                    switch (salary.status) {
                        case 'paid':
                            statusText = 'ادا شدہ';
                            break;
                        case 'pending':
                            statusText = 'زیر التواء';
                            break;
                        case 'partial':
                            statusText = 'جزوی';
                            break;
                    }
                    
                    let monthText = '';
                    switch (salary.month) {
                        case 1: monthText = 'جنوری'; break;
                        case 2: monthText = 'فروری'; break;
                        case 3: monthText = 'مارچ'; break;
                        case 4: monthText = 'اپریل'; break;
                        case 5: monthText = 'مئی'; break;
                        case 6: monthText = 'جون'; break;
                        case 7: monthText = 'جولائی'; break;
                        case 8: monthText = 'اگست'; break;
                        
case 9: monthText = 'ستمبر'; break;
case 10: monthText = 'اکتوبر'; break;
case 11: monthText = 'نومبر'; break;
case 12: monthText = 'دسمبر'; break;
}

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${teacher ? teacher.name : 'N/A'}</td>
                        <td>${monthText}</td>
                        <td>${salary.year}</td>
                        <td>${salary.baseAmount}</td>
                        <td>${salary.allowance}</td>
                        <td>${salary.totalAmount}</td>
                        <td>${new Date(salary.paymentDate).toLocaleDateString('ur-PK')}</td>
                        <td>${statusText}</td>
                        <td>
                            <button class="btn btn-sm btn-primary btn-action edit-salary" data-id="${salary.id}">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger btn-action delete-salary" data-id="${salary.id}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                }
                
                // Attach event listeners
                document.querySelectorAll('.edit-salary').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.getAttribute('data-id'));
                        editSalary(id);
                    });
                });
                
                document.querySelectorAll('.delete-salary').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.getAttribute('data-id'));
                        deleteSalary(id);
                    });
                });
                
                // Populate teacher dropdown in add/edit form
                const teachers = await getAllData('teachers');
                const teacherSelect = document.getElementById('salary-payment-teacher');
                const reportTeacherSelect = document.getElementById('salary-report-teacher');
                
                teacherSelect.innerHTML = '<option value="">استاد منتخب کریں</option>';
                reportTeacherSelect.innerHTML = '<option value="">تمام اساتذہ</option>';
                
                for (const teacher of teachers) {
                    const option1 = document.createElement('option');
                    option1.value = teacher.id;
                    option1.textContent = teacher.name;
                    option1.dataset.salary = teacher.salary;
                    teacherSelect.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = teacher.id;
                    option2.textContent = teacher.name;
                    reportTeacherSelect.appendChild(option2);
                }
                
                // Add event listener to teacher select to auto-fill base salary
                teacherSelect.addEventListener('change', function() {
                    const selectedOption = this.options[this.selectedIndex];
                    if (selectedOption.dataset.salary) {
                        document.getElementById('salary-payment-base').value = selectedOption.dataset.salary;
                        updateTotalSalary();
                    }
                });
                
                // Add event listeners to salary inputs to calculate total
                document.getElementById('salary-payment-base').addEventListener('input', updateTotalSalary);
                document.getElementById('salary-payment-allowance').addEventListener('input', updateTotalSalary);
                
                // Populate year dropdowns
                const currentYear = new Date().getFullYear();
                const yearSelect = document.getElementById('salary-payment-year');
                const reportYearSelect = document.getElementById('salary-report-year');
                
                yearSelect.innerHTML = '';
                reportYearSelect.innerHTML = '';
                
                for (let year = currentYear; year >= currentYear - 5; year--) {
                    const option1 = document.createElement('option');
                    option1.value = year;
                    option1.textContent = year;
                    yearSelect.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = year;
                    option2.textContent = year;
                    reportYearSelect.appendChild(option2);
                }
                
                // Set default date to today
                document.getElementById('salary-payment-date').value = new Date().toISOString().split('T');
                
                // Set current month
                document.getElementById('salary-payment-month').value = new Date().getMonth() + 1;
            } catch (error) {
                console.error('Error loading salary payments:', error);
            }
        }
    
        function updateTotalSalary() {
            const base = parseFloat(document.getElementById('salary-payment-base').value) || 0;
            const allowance = parseFloat(document.getElementById('salary-payment-allowance').value) || 0;
            document.getElementById('salary-payment-total').value = base + allowance;
        }
    
        async function editSalary(id) {
            try {
                const s = await getData('salaryPayments', id);
                
                document.getElementById('salary-payment-modal-title').textContent = 'تنخواہ ادائیگی میں ترمیم';
                document.getElementById('salary-payment-id').value = s.id;
                document.getElementById('salary-payment-teacher').value = s.teacherId;
                document.getElementById('salary-payment-month').value = s.month;
                document.getElementById('salary-payment-year').value = s.year;
                document.getElementById('salary-payment-base').value = s.baseAmount;
                document.getElementById('salary-payment-allowance').value = s.allowance;
                document.getElementById('salary-payment-total').value = s.totalAmount;
                document.getElementById('salary-payment-date').value = s.paymentDate;
                document.getElementById('salary-payment-status').value = s.status;
                document.getElementById('salary-payment-notes').value = s.notes || '';
                
                const m = new bootstrap.Modal(document.getElementById('salary-payment-modal'));
                m.show();
            } catch (error) {
                console.error('Error editing salary payment:', error);
            }
        }
    
        async function deleteSalary(id) {
            if (confirm('کیا آپ واقعی اس تنخواہ ادائیگی کو حذف کرنا چاہتے ہیں؟')) {
                try {
                    await deleteData('salaryPayments', id);
                    loadSalaryPayments();
                } catch (error) {
                    console.error('Error deleting salary payment:', error);
                }
            }
        }
    
        async function generateSalaryReport() {
            try {
                const teacherId = document.getElementById('salary-report-teacher').value;
                const year = document.getElementById('salary-report-year').value;
                const month = document.getElementById('salary-report-month').value;
                const status = document.getElementById('salary-report-status').value;
                
                if (!year) {
                    alert('سال منتخب کریں');
                    return;
                }
                
                // Get all salary payments
                let payments = await getAllData('salaryPayments');
                
                // Filter by year
                payments = payments.filter(payment => payment.year == year);
                
                // Filter by teacher if selected
                if (teacherId) {
                    payments = payments.filter(payment => payment.teacherId == teacherId);
                }
                
                // Filter by month if selected
                if (month) {
                    payments = payments.filter(payment => payment.month == month);
                }
                
                // Filter by status if selected
                if (status) {
                    payments = payments.filter(payment => payment.status === status);
                }
                
                // Sort by month and teacher name
                payments.sort((a, b) => (a.month - b.month) || a.teacherId - b.teacherId);
                
                const table = document.getElementById('salary-report-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                for (const payment of payments) {
                    const teacher = await getData('teachers', payment.teacherId);
                    if (!teacher) continue;
                    
                    let statusText = '';
                    switch (payment.status) {
                        case 'paid':
                            statusText = 'ادا شدہ';
                            break;
                        case 'pending':
                            statusText = 'زیر التواء';
                            break;
                        case 'partial':
                            statusText = 'جزوی';
                            break;
                    }
                    
                    let monthText = '';
                    switch (parseInt(payment.month)) {
                        case 1: monthText = 'جنوری'; break;
                        case 2: monthText = 'فروری'; break;
                        case 3: monthText = 'مارچ'; break;
                        case 4: monthText = 'اپریل'; break;
                        case 5: monthText = 'مئی'; break;
                        case 6: monthText = 'جون'; break;
                        case 7: monthText = 'جولائی'; break;
                        case 8: monthText = 'اگست'; break;
                        case 9: monthText = 'ستمبر'; break;
                        case 10: monthText = 'اکتوبر'; break;
                        case 11: monthText = 'نومبر'; break;
                        case 12: monthText = 'دسمبر'; break;
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${teacher.name}</td>
                        <td>${monthText}</td>
                        <td>${payment.year}</td>
                        <td>${payment.baseAmount}</td>
                        <td>${payment.allowance}</td>
                        <td>${payment.totalAmount}</td>
                        <td>${new Date(payment.paymentDate).toLocaleDateString('ur-PK')}</td>
                        <td>${statusText}</td>
                    `;
                    table.appendChild(row);
                }
                
                document.getElementById('salary-report-container').style.display = payments.length > 0 ? 'block' : 'none';
                
                if (payments.length === 0) {
                    alert('اس فلٹر کے لیے کوئی تنخواہ ریکارڈ نہیں ملا');
                }
            } catch (error) {
                console.error('Error generating salary report:', error);
            }
        }
    
        // Inventory functions
        async function loadInventory() {
            try {
                const i = await getAllData('inventory');
                const table = document.getElementById('inventory-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                for (const item of i) {
                    let categoryText = '';
                    switch (item.category) {
                        case 'furniture':
                            categoryText = 'فرنیچر';
                            break;
                        case 'stationary':
                            categoryText = 'سٹیشنری';
                            break;
                        case 'electronics':
                            categoryText = 'الیکٹرانکس';
                            break;
                        case 'books':
                            categoryText = 'کتابیں';
                            break;
                        case 'other':
                            categoryText = 'دیگر';
                            break;
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.id}</td>
                        <td>${item.name}</td>
                        <td>${categoryText}</td>
                        <td>${item.quantity}</td>
                        <td>${item.unit}</td>
                        <td>${new Date(item.purchaseDate).toLocaleDateString('ur-PK')}</td>
                        <td>${item.price}</td>
                        <td>
                            <button class="btn btn-sm btn-primary btn-action edit-inventory" data-id="${item.id}">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger btn-action delete-inventory" data-id="${item.id}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                }
                
                // Attach event listeners
                document.querySelectorAll('.edit-inventory').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.getAttribute('data-id'));
                        editInventory(id);
                    });
                });
                
                document.querySelectorAll('.delete-inventory').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.getAttribute('data-id'));
                        deleteInventory(id);
                    });
                });
                
                // Set default date to today
                document.getElementById('inventory-purchase-date').value = new Date().toISOString().split('T');
            } catch (error) {
                console.error('Error loading inventory:', error);
            }
        }
    
        async function editInventory(id) {
            try {
                const i = await getData('inventory', id);
                
                document.getElementById('inventory-modal-title').textContent = 'انوینٹری آئٹم میں ترمیم';
                document.getElementById('inventory-id').value = i.id;
                document.getElementById('inventory-name').value = i.name;
                document.getElementById('inventory-category').value = i.category;
                document.getElementById('inventory-quantity').value = i.quantity;
                document.getElementById('inventory-unit').value = i.unit;
                document.getElementById('inventory-purchase-date').value = i.purchaseDate;
                document.getElementById('inventory-price').value = i.price;
                document.getElementById('inventory-notes').value = i.notes || '';
                
                const m = new bootstrap.Modal(document.getElementById('inventory-modal'));
                m.show();
            } catch (error) {
                console.error('Error editing inventory item:', error);
            }
        }
    
        async function deleteInventory(id) {
            if (confirm('کیا آپ واقعی اس انوینٹری آئٹم کو حذف کرنا چاہتے ہیں؟')) {
                try {
                    await deleteData('inventory', id);
                    loadInventory();
                } catch (error) {
                    console.error('Error deleting inventory item:', error);
                }
            }
        }
    
        // Expense functions
        async function loadExpenses() {
            try {
                const e = await getAllData('expenses');
                const table = document.getElementById('expenses-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                for (const expense of e) {
                    let categoryText = '';
                    switch (expense.category) {
                        case 'utilities':
                            categoryText = 'یوٹیلٹیز';
                            break;
                        case 'maintenance':
                            categoryText = 'مرمت';
                            break;
                        case 'salaries':
                            categoryText = 'تنخواہیں';
                            break;
                        case 'stationary':
                            categoryText = 'سٹیشنری';
                            break;
                        case 'furniture':
                            categoryText = 'فرنیچر';
                            break;
                        case 'electronics':
                            categoryText = 'الیکٹرانکس';
                            break;
                        case 'other':
                            categoryText = 'دیگر';
                            break;
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${expense.id}</td>
                        <td>${expense.description}</td>
                        <td>${categoryText}</td>
                        <td>${expense.amount}</td>
                        <td>${new Date(expense.date).toLocaleDateString('ur-PK')}</td>
                        <td>${expense.paidBy}</td>
                        <td>
                            <button class="btn btn-sm btn-primary btn-action edit-expense" data-id="${expense.id}">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger btn-action delete-expense" data-id="${expense.id}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    `;
                    table.appendChild(row);
                }
                
                // Attach event listeners
                document.querySelectorAll('.edit-expense').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.getAttribute('data-id'));
                        editExpense(id);
                    });
                });
                
                document.querySelectorAll('.delete-expense').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.currentTarget.getAttribute('data-id'));
                        deleteExpense(id);
                    });
                });
                
                // Set default date to today
                document.getElementById('expense-date').value = new Date().toISOString().split('T');
            } catch (error) {
                console.error('Error loading expenses:', error);
            }
        }
    
        async function editExpense(id) {
            try {
                const e = await getData('expenses', id);
                
                document.getElementById('expense-modal-title').textContent = 'خرچے میں ترمیم';
                document.getElementById('expense-id').value = e.id;
                document.getElementById('expense-description').value = e.description;
                document.getElementById('expense-category').value = e.category;
                document.getElementById('expense-amount').value = e.amount;
                document.getElementById('expense-date').value = e.date;
                document.getElementById('expense-paid-by').value = e.paidBy;
                document.getElementById('expense-notes').value = e.notes || '';
                
                const m = new bootstrap.Modal(document.getElementById('expense-modal'));
                m.show();
            } catch (error) {
                console.error('Error editing expense:', error);
            }
        }
    
        async function deleteExpense(id) {
            if (confirm('کیا آپ واقعی اس خرچے کو حذف کرنا چاہتے ہیں؟')) {
                try {
                    await deleteData('expenses', id);
                    loadExpenses();
                } catch (error) {
                    console.error('Error deleting expense:', error);
                }
            }
        }
    
        // Backup and Restore functions
        async function backupData() {
            try {
                const backup = {};
                
                const stores = ['students', 'teachers', 'classes', 'attendance', 'feeStructures', 
                                'feePayments', 'salaryPayments', 'inventory', 'expenses'];
                
                for (const store of stores) {
                    backup[store] = await getAllData(store);
                }
                
                const json = JSON.stringify(backup, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                
                const date = new Date().toISOString().split('T');
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `madrasa_backup_${date}.json`;
                a.click();
                
                alert('بیک اپ کامیابی سے ڈاؤن لوڈ ہو گیا ہے');
            } catch (error) {
                console.error('Error creating backup:', error);
                alert('بیک اپ بنانے میں خرابی: ' + error);
            }
        }
    
        function restoreData() {
            const fileInput = document.getElementById('restore-file');
            
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('براہ کرم پہلے بیک اپ فائل منتخب کریں');
                return;
            }
            
            if (!confirm('کیا آپ واقعی بیک اپ سے ڈیٹا ریسٹور کرنا چاہتے ہیں؟ موجودہ ڈیٹا مٹا دیا جائے گا۔')) {
                return;
            }
            
            const file = fileInput.files;
            const reader = new FileReader();
            
            reader.onload = async function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    // Clear all stores and restore from backup
                    const stores = ['students', 'teachers', 'classes', 'attendance', 'feeStructures', 
                                    'feePayments', 'salaryPayments', 'inventory', 'expenses'];
                    
                    for (const store of stores) {
                        const tx = db.transaction(store, 'readwrite');
                        const s = tx.objectStore(store);
                        
                        // Clear store
                        await new Promise((resolve, reject) => {
                            const req = s.clear();
                            req.onsuccess = () => resolve();
                            req.onerror = (e) => reject(e.target.error);
                        });
                        
                        // Add backup data
                        if (backup[store] && Array.isArray(backup[store])) {
                            for (const item of backup[store]) {
                                await new Promise((resolve, reject) => {
                                    const req = s.add(item);
                                    req.onsuccess = () => resolve();
                                    req.onerror = (e) => reject(e.target.error);
                                });
                            }
                        }
                    }
                    
                    alert('ڈیٹا کامیابی سے ریسٹور ہو گیا ہے');
                    location.reload(); // Refresh the page
                } catch (error) {
                    console.error('Error restoring backup:', error);
                    alert('بیک اپ ریسٹور کرنے میں خرابی: ' + error);
                }
            };
            
            reader.readAsText(file);
        }
    
        // Export functions
        function exportToCsv(tableId, filename) {
            const table = document.getElementById(tableId);
            let csv = [];
            
            // Get headers
            const headers = [];
            const headerCells = table.querySelectorAll('thead th');
            headerCells.forEach(cell => {
                headers.push(cell.textContent);
            });
            csv.push(headers.join(','));
            
            // Get rows
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const data = [];
                const cells = row.querySelectorAll('td');
                cells.forEach(cell => {
                    // Replace commas with semicolons to avoid CSV issues
                    data.push('"' + cell.textContent.replace(/"/g, '""') + '"');
                });
                csv.push(data.join(','));
            });
            
            // Download CSV file
            const csvString = csv.join('\n');
            const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.setAttribute('download', filename);
            link.click();
        }
    
        function printReport(elementId, title) {
            const printSection = document.getElementById('print-section');
            const elementToPrint = document.getElementById(elementId);
            
            // Create a clone of the element to print
            const clone = elementToPrint.cloneNode(true);
            
            // Create header with title
            const header = document.createElement('div');
            header.innerHTML = `
                <h2 style="text-align: center; margin-bottom: 20px;">${title}</h2>
                <h4 style="text-align: center; margin-bottom: 30px;">دینی مدرسہ مینجمنٹ سسٹم</h4>
            `;
            
            // Clear print section and add header and clone
            printSection.innerHTML = '';
            printSection.appendChild(header);
            printSection.appendChild(clone);
            
            // Print
            window.print();
        }
    
        // Event Listeners
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Initialize database
                await initDB();
                
                // Update date and time
                updateDateTime();
                setInterval(updateDateTime, 60000);
                
                // Navigation
                document.querySelectorAll('.nav-link[data-page]').forEach(link => {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        const pageId = this.getAttribute('data-page');
                        showPage(pageId);
                    });
                });
                
                // Show dashboard by default
                showPage('dashboard');
                
                // Student events
                document.getElementById('add-student-btn').addEventListener('click', function() {
                    document.getElementById('student-modal-title').textContent = 'طالب علم کا اندراج';
                    document.getElementById('student-form').reset();
                    document.getElementById('student-id').value = '';
                    document.getElementById('custom-fields-container').innerHTML = '';
                    document.getElementById('student-admission-date').value = new Date().toISOString().split('T');
                    const m = new bootstrap.Modal(document.getElementById('student-modal'));
                    m.show();
                });
                
                document.getElementById('add-custom-field').addEventListener('click', function() {
                    addCustomField();
                });
                
                document.getElementById('save-student').addEventListener('click', async function() {
                    const form = document.getElementById('student-form');
                    
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return;
                    }
                    
                    try {
                        const id = document.getElementById('student-id').value;
                        
                        // Collect custom fields
                        const customFields = {};
                        document.querySelectorAll('.custom-field').forEach(field => {
                            const key = field.querySelector('.custom-field-key').value;
                            const value = field.querySelector('.custom-field-value').value;
                            if (key && value) {
                                customFields[key] = value;
                            }
                        });
                        
                        const student = {
                            name: document.getElementById('student-name').value,
                            father: document.getElementById('student-father').value,
                            age: parseInt(document.getElementById('student-age').value),
                            class: document.getElementById('student-class').value ? parseInt(document.getElementById('student-class').value) : null,
                            admissionDate: document.getElementById('student-admission-date').value,
                            contact: document.getElementById('student-contact').value,
                            address: document.getElementById('student-address').value,
                            customFields: customFields
                        };
                        
                        if (id) {
                            // Update existing student
                            student.id = parseInt(id);
                            await updateData('students', student);
                        } else {
                            // Add new student
                            await addData('students', student);
                        }
                        
                        const m = bootstrap.Modal.getInstance(document.getElementById('student-modal'));
                        m.hide();
                        
                        loadStudents();
                    } catch (error) {
                        console.error('Error saving student:', error);
                        alert('طالب علم کو محفوظ کرنے میں خرابی');
                    }
                });
                
                // Teacher events
                document.getElementById('add-teacher-btn').addEventListener('click', function() {
                    document.getElementById('teacher-modal-title').textContent = 'استاد کا اندراج';
                    document.getElementById('teacher-form').reset();
                    document.getElementById('teacher-id').value = '';
                    document.getElementById('teacher-custom-fields-container').innerHTML = '';
                    document.getElementById('teacher-join-date').value = new Date().toISOString().split('T');
                    const m = new bootstrap.Modal(document.getElementById('teacher-modal'));
                    m.show();
                });
                
                document.getElementById('add-teacher-custom-field').addEventListener('click', function() {
                    addTeacherCustomField();
                });
                
                document.getElementById('save-teacher').addEventListener('click', async function() {
                    const form = document.getElementById('teacher-form');
                    
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return;
                    }
                    
                    try {
                        const id = document.getElementById('teacher-id').value;
                        
                        // Collect custom fields
                        const customFields = {};
                        document.querySelectorAll('.teacher-custom-field').forEach(field => {
                            const key = field.querySelector('.teacher-custom-field-key').value;
                            const value = field.querySelector('.teacher-custom-field-value').value;
                            if (key && value) {
                                customFields[key] = value;
                            }
                        });
                        
                        const teacher = {
                            name: document.getElementById('teacher-name').value,
                            specialization: document.getElementById('teacher-specialization').value,
                            education: document.getElementById('teacher-education').value,
                            joinDate: document.getElementById('teacher-join-date').value,
                            contact: document.getElementById('teacher-contact').value,
                            salary: parseFloat(document.getElementById('teacher-salary').value),
                            address: document.getElementById('teacher-address').value,
                            customFields: customFields
                        };
                        
                        if (id) {
                            // Update existing teacher
                            teacher.id = parseInt(id);
                            await updateData('teachers', teacher);
                        } else {
                            // Add new teacher
                            await addData('teachers', teacher);
                        }
                        
                        const m = bootstrap.Modal.getInstance(document.getElementById('teacher-modal'));
                        m.hide();
                        
                        loadTeachers();
                    } catch (error) {
                        console.error('Error saving teacher:', error);
                        alert('استاد کو محفوظ کرنے میں خرابی');
                    }
                });
                
                // Class events
                document.getElementById('add-class-btn').addEventListener('click', function() {
                    document.getElementById('class-modal-title').textContent = 'نئی کلاس';
                    document.getElementById('class-form').reset();
                    document.getElementById('class-id').value = '';
                    const m = new bootstrap.Modal(document.getElementById('class-modal'));
                    m.show();
                });
                
                document.getElementById('save-class').addEventListener('click', async function() {
                    const form = document.getElementById('class-form');
                    
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return;
                    }
                    
                    try {
                        const id = document.getElementById('class-id').value;
                        
                        const cls = {
                            name: document.getElementById('class-name').value,
                            level: document.getElementById('class-level').value,
                            teacherId: document.getElementById('class-teacher').value ? parseInt(document.getElementById('class-teacher').value) : null,
                            room: document.getElementById('class-room').value
                        };
                        
                        if (id) {
                            // Update existing class
                            cls.id = parseInt(id);
                            await updateData('classes', cls);
                        } else {
                            // Add new class
                            await addData('classes', cls);
                        }
                        
                        const m = bootstrap.Modal.getInstance(document.getElementById('class-modal'));
                        m.hide();
                        
                        loadClasses();
                    } catch (error) {
                        console.error('Error saving class:', error);
                        alert('کلاس کو محفوظ کرنے میں خرابی');
                    }
                });
                
                // Attendance events
                document.getElementById('load-attendance').addEventListener('click', loadAttendance);
                document.getElementById('save-attendance').addEventListener('click', saveAttendance);
                document.getElementById('generate-attendance-report').addEventListener('click', generateAttendanceReport);
                document.getElementById('export-attendance-report').addEventListener('click', function() {
                    exportToCsv('attendance-report-table', 'attendance_report.csv');
                });
                document.getElementById('print-attendance-report').addEventListener('click', function() {
                    printReport('attendance-report-container', 'حاضری رپورٹ');
                });
                
                // Fee events
                document.getElementById('add-fee-structure-btn').addEventListener('click', function() {
                    document.getElementById('fee-structure-modal-title').textContent = 'نئی فیس ساخت';
                    document.getElementById('fee-structure-form').reset();
                    document.getElementById('fee-structure-id').value = '';
                    const m = new bootstrap.Modal(document.getElementById('fee-structure-modal'));
                    m.show();
                });
                
                document.getElementById('save-fee-structure').addEventListener('click', async function() {
                    const form = document.getElementById('fee-structure-form');
                    
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return;
                    }
                    
                    try {
                        const id = document.getElementById('fee-structure-id').value;
                        
                        const fee = {
                            classId: parseInt(document.getElementById('fee-structure-class').value),
                            type: document.getElementById('fee-structure-type').value,
                            amount: parseFloat(document.getElementById('fee-structure-amount').value),
                            period: document.getElementById('fee-structure-period').value
                        };
                        
                        if (id) {
                            // Update existing fee structure
                            fee.id = parseInt(id);
                            await updateData('feeStructures', fee);
                        } else {
                            // Add new fee structure
                            await addData('feeStructures', fee);
                        }
                        
                        const m = bootstrap.Modal.getInstance(document.getElementById('fee-structure-modal'));
                        m.hide();
                        
                        loadFeeStructures();
                    } catch (error) {
                        console.error('Error saving fee structure:', error);
                        alert('فیس ساخت کو محفوظ کرنے میں خرابی');
                    }
                });
                
                document.getElementById('add-fee-payment-btn').addEventListener('click', function() {
                    document.getElementById('fee-payment-modal-title').textContent = 'نئی فیس ادائیگی';
                    document.getElementById('fee-payment-form').reset();
                    document.getElementById('fee-payment-id').value = '';
                    document.getElementById('fee-payment-date').value = new Date().toISOString().split('T');
                    const m = new bootstrap.Modal(document.getElementById('fee-payment-modal'));
                    m.show();
                });
                
                document.getElementById('save-fee-payment').addEventListener('click', async function() {
                    const form = document.getElementById('fee-payment-form');
                    
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return;
                    }
                    
                    try {
                        const id = document.getElementById('fee-payment-id').value;
                        
                        const payment = {
                            studentId: parseInt(document.getElementById('fee-payment-student').value),
                            type: document.getElementById('fee-payment-type').value,
                            amount: parseFloat(document.getElementById('fee-payment-amount').value),
                            date: document.getElementById('fee-payment-date').value,
                            status: document.getElementById('fee-payment-status').value,
                            notes: document.getElementById('fee-payment-notes').value
                        };
                        
                        if (id) {
                            // Update existing payment
                            payment.id = parseInt(id);
                            await updateData('feePayments', payment);
                        } else {
                            // Add new payment
                            await addData('feePayments', payment);
                        }
                        
                        const m = bootstrap.Modal.getInstance(document.getElementById('fee-payment-modal'));
                        m.hide();
                        
                        loadFeePayments();
                    } catch (error) {
                        console.error('Error saving fee payment:', error);
                        alert('فیس ادائیگی کو محفوظ کرنے میں خرابی');
                    }
                });
                
                document.getElementById('generate-fee-report').addEventListener('click', generateFeeReport);
                document.getElementById('export-fee-report').addEventListener('click', function() {
                    exportToCsv('fee-report-table', 'fee_report.csv');
                });
                document.getElementById('print-fee-report').addEventListener('click', function() {
                    printReport('fee-report-container', 'فیس رپورٹ');
                });
                
                // Salary events
                document.getElementById('add-salary-payment-btn').addEventListener('click', function() {
                    document.getElementById('salary-payment-modal-title').textContent = 'نئی تنخواہ ادائیگی';
                    document.getElementById('salary-payment-form').reset();
                    document.getElementById('salary-payment-id').value = '';
                    document.getElementById('salary-payment-date').value = new Date().toISOString().split('T');
                    document.getElementById('salary-payment-month').value = new Date().getMonth() + 1;
                    document.getElementById('salary-payment-year').value = new Date().getFullYear();
                    const m = new bootstrap.Modal(document.getElementById('salary-payment-modal'));
                    m.show();
                });
                
                document.getElementById('save-salary-payment').addEventListener('click', async function() {
                    const form = document.getElementById('salary-payment-form');
                    
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return;
                    }
                    
                    try {
                        const id = document.getElementById('salary-payment-id').value;
                        
                        const payment = {
                            teacherId: parseInt(document.getElementById('salary-payment-teacher').value),
                            month: parseInt(document.getElementById('salary-payment-month').value),
                            year: parseInt(document.getElementById('salary-payment-year').value),
                            baseAmount: parseFloat(document.getElementById('salary-payment-base').value),
                            allowance: parseFloat(document.getElementById('salary-payment-allowance').value),
                            totalAmount: parseFloat(document.getElementById('salary-payment-total').value),
                            paymentDate: document.getElementById('salary-payment-date').value,
                            status: document.getElementById('salary-payment-status').value,
                            notes: document.getElementById('salary-payment-notes').value
                        };
                        
                        if (id) {
                            // Update existing payment
                            payment.id = parseInt(id);
                            await updateData('salaryPayments', payment);
                        } else {
                            // Add new payment
                            await addData('salaryPayments', payment);
                        }
                        
                        const m = bootstrap.Modal.getInstance(document.getElementById('salary-payment-modal'));
                        m.hide();
                        
                        loadSalaryPayments();
                    } catch (error) {
                        console.error('Error saving salary payment:', error);
                        alert('تنخواہ ادائیگی کو محفوظ کرنے میں خرابی');
                    }
                });
                
                document.getElementById('generate-salary-report').addEventListener('click', generateSalaryReport);
                document.getElementById('export-salary-report').addEventListener('click', function() {
                    exportToCsv('salary-report-table', 'salary_report.csv');
                });
                document.getElementById('print-salary-report').addEventListener('click', function() {
                    printReport('salary-report-container', 'تنخواہ رپورٹ');
                });
                
                // Inventory events
                document.getElementById('add-inventory-btn').addEventListener('click', function() {
                    document.getElementById('inventory-modal-title').textContent = 'نئی انوینٹری آئٹم';
                    document.getElementById('inventory-form').reset();
                    document.getElementById('inventory-id').value = '';
                    document.getElementById('inventory-purchase-date').value = new Date().toISOString().split('T');
                    const m = new bootstrap.Modal(document.getElementById('inventory-modal'));
                    m.show();
                });
                
                document.getElementById('save-inventory').addEventListener('click', async function() {
                    const form = document.getElementById('inventory-form');
                    
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return;
                    }
                    
                    try {
                        const id = document.getElementById('inventory-id').value;
                        
                        const item = {
                            name: document.getElementById('inventory-name').value,
                            category: document.getElementById('inventory-category').value,
                            quantity: parseInt(document.getElementById('inventory-quantity').value),
                            unit: document.getElementById('inventory-unit').value,
                            purchaseDate: document.getElementById('inventory-purchase-date').value,
                            price: parseFloat(document.getElementById('inventory-price').value),
                            notes: document.getElementById('inventory-notes').value
                        };
                        
                        if (id) {
                            // Update existing inventory
                            item.id = parseInt(id);
                            await updateData('inventory', item);
                        } else {
                            // Add new inventory
                            await addData('inventory', item);
                        }
                        
                        const m = bootstrap.Modal.getInstance(document.getElementById('inventory-modal'));
                        m.hide();
                        
                        loadInventory();
                    } catch (error) {
                        console.error('Error saving inventory:', error);
                        alert('انوینٹری کو محفوظ کرنے میں خرابی');
                    }
                });
                
                // Expense events
                document.getElementById('add-expense-btn').addEventListener('click', function() {
                    document.getElementById('expense-modal-title').textContent = 'نیا خرچہ';
                    document.getElementById('expense-form').reset();
                    document.getElementById('expense-id').value = '';
                    document.getElementById('expense-date').value = new Date().toISOString().split('T');
                    const m = new bootstrap.Modal(document.getElementById('expense-modal'));
                    m.show();
                });
                
                document.getElementById('save-expense').addEventListener('click', async function() {
                    const form = document.getElementById('expense-form');
                    
                    if (!form.checkValidity()) {
                        form.reportValidity();
                        return;
                    }
                    
                    try {
                        const id = document.getElementById('expense-id').value;
                        
                        const expense = {
                            description: document.getElementById('expense-description').value,
                            category: document.getElementById('expense-category').value,
                            amount: parseFloat(document.getElementById('expense-amount').value),
                            date: document.getElementById('expense-date').value,
                            paidBy: document.getElementById('expense-paid-by').value,
                            notes: document.getElementById('expense-notes').value
                        };
                        
                        if (id) {
                            // Update existing expense
                            expense.id = parseInt(id);
                            await updateData('expenses', expense);
                        } else {
                            // Add new expense
                            await addData('expenses', expense);
                        }
                        
                        const m = bootstrap.Modal.getInstance(document.getElementById('expense-modal'));
                        m.hide();
                        
                        loadExpenses();
                    } catch (error) {
                        console.error('Error saving expense:', error);
                        alert('خرچہ محفوظ کرنے میں خرابی');
                    }
                });
                
                // Backup and restore events
                document.getElementById('backup-data').addEventListener('click', backupData);
                document.getElementById('restore-data').addEventListener('click', restoreData);
                
                // Reports page events
                document.querySelectorAll('[data-report]').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        const reportType = this.getAttribute('data-report');
                        
                        // Hide report container first
                        document.getElementById('report-container').style.display = 'none';
                        
                        // Set report title based on type
                        let title = '';
                        switch(reportType) {
                            case 'student':
                                title = 'طلبہ کی رپورٹ';
                                showStudentReport();
                                break;
                            case 'attendance':
                                title = 'حاضری کی رپورٹ';
                                showPage('attendance');
                                break;
                            case 'fee':
                                title = 'فیس کی رپورٹ';
                                showPage('fees');
                                break;
                            case 'salary':
                                title = 'تنخواہ کی رپورٹ';
                                showPage('salaries');
                                break;
                            case 'expense':
                                title = 'اخراجات کی رپورٹ';
                                showExpenseReport();
                                break;
                            case 'inventory':
                                title = 'انوینٹری کی رپورٹ';
                                showInventoryReport();
                                break;
                        }
                        
                        document.getElementById('report-title').textContent = title;
                    });
                });
                
                // Export report event
                document.getElementById('export-report').addEventListener('click', function() {
                    const reportData = document.querySelector('#report-data table');
                    if (reportData) {
                        exportToCsv(reportData.id, 'report.csv');
                    }
                });
                
                // Print report event
                document.getElementById('print-report').addEventListener('click', function() {
                    printReport('report-data', document.getElementById('report-title').textContent);
                });
                
                console.log('All event listeners attached');
            } catch (error) {
                console.error('Initialization error:', error);
            }
        });
    
        // Helper function to show student report
        async function showStudentReport() {
            try {
                const students = await getAllData('students');
                
                // Create filters
                const filtersContainer = document.getElementById('report-filters');
                filtersContainer.innerHTML = `
                    <div class="row">
                        <div class="col-md-4">
                            <label for="student-report-class" class="form-label">کلاس</label>
                            <select class="form-select" id="student-report-class">
                                <option value="">تمام کلاسز</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="student-report-age" class="form-label">عمر</label>
                            <select class="form-select" id="student-report-age">
                                <option value="">تمام عمر</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <br>
                            <button class="btn btn-primary mt-2" id="filter-student-report">فلٹر کریں</button>
                        </div>
                    </div>
                `;
                
                // Load classes for filter
                const classes = await getAllData('classes');
                const classSelect = document.getElementById('student-report-class');
                
                for (const cls of classes) {
                    const option = document.createElement('option');
                    option.value = cls.id;
                    option.textContent = cls.name;
                    classSelect.appendChild(option);
                }
                
                // Create age ranges for filter
                const ageSelect = document.getElementById('student-report-age');
                const ageRanges = ['5-10', '11-15', '16-20', '21+'];
                
                for (const range of ageRanges) {
                    const option = document.createElement('option');
                    option.value = range;
                    option.textContent = range;
                    ageSelect.appendChild(option);
                }
                
                // Create table
                const reportContainer = document.getElementById('report-data');
                reportContainer.innerHTML = `
                    <div class="table-responsive">
                        <table class="table table-striped" id="student-report-table">
                            <thead>
                                <tr>
                                    <th>آئی ڈی</th>
                                    <th>نام</th>
                                    <th>والد کا نام</th>
                                    <th>عمر</th>
                                    <th>کلاس</th>
                                    <th>داخلہ کی تاریخ</th>
                                    <th>رابطہ</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                `;
                
                // Load initial data
                loadStudentReportData();
                
                // Add filter event
                document.getElementById('filter-student-report').addEventListener('click', loadStudentReportData);
                
                // Show report container
                document.getElementById('report-container').style.display = 'block';
            } catch (error) {
                console.error('Error showing student report:', error);
            }
        }
    
        async function loadStudentReportData() {
            try {
                const classId = document.getElementById('student-report-class').value;
                const ageRange = document.getElementById('student-report-age').value;
                
                // Get all students
                let students = await getAllData('students');
                
                // Filter by class if selected
                if (classId) {
                    students = students.filter(student => student.class == classId);
                }
                
                // Filter by age range if selected
                if (ageRange) {
                    const [min, max] = ageRange.split('-');
                    if (max) {
                        students = students.filter(student => student.age >= parseInt(min) && student.age <= parseInt(max));
                    } else {
                        // Handle 21+ case
                        students = students.filter(student => student.age >= 21);
                    }
                }
                
                // Sort by name
                students.sort((a, b) => a.name.localeCompare(b.name));
                
                const table = document.getElementById('student-report-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                for (const student of students) {
                    const cls = student.class ? await getData('classes', student.class) : null;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${student.id}</td>
                        <td>${student.name}</td>
                        <td>${student.father}</td>
                        <td>${student.age}</td>
                        <td>${cls ? cls.name : 'N/A'}</td>
                        <td>${student.admissionDate ? new Date(student.admissionDate).toLocaleDateString('ur-PK') : 'N/A'}</td>
                        <td>${student.contact}</td>
                    `;
                    table.appendChild(row);
                }
            } catch (error) {
                console.error('Error loading student report data:', error);
            }
        }
    
        // Helper function to show expense report
        async function showExpenseReport() {
            try {
                // Create filters
                const filtersContainer = document.getElementById('report-filters');
                filtersContainer.innerHTML = `
                    <div class="row">
                        <div class="col-md-3">
                            <label for="expense-report-category" class="form-label">زمرہ</label>
                            <select class="form-select" id="expense-report-category">
                                <option value="">تمام زمرے</option>
                                <option value="utilities">یوٹیلٹیز</option>
                                <option value="maintenance">مرمت</option>
                                <option value="salaries">تنخواہیں</option>
                                <option value="stationary">سٹیشنری</option>
                                <option value="furniture">فرنیچر</option>
                                <option value="electronics">الیکٹرانکس</option>
                                <option value="other">دیگر</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="expense-report-from" class="form-label">شروع تاریخ</label>
                            <input type="date" class="form-control" id="expense-report-from">
                        </div>
                        <div class="col-md-3">
                            <label for="expense-report-to" class="form-label">ختم تاریخ</label>
                            <input type="date" class="form-control" id="expense-report-to">
                        </div>
                        <div class="col-md-3">
                            <br>
                            <button class="btn btn-primary mt-2" id="filter-expense-report">فلٹر کریں</button>
                        </div>
                    </div>
                `;
                
                // Create table
                const reportContainer = document.getElementById('report-data');
                reportContainer.innerHTML = `
                    <div class="table-responsive">
                        <table class="table table-striped" id="expense-report-table">
                            <thead>
                                <tr>
                                    <th>آئی ڈی</th>
                                    <th>تفصیل</th>
                                    <th>زمرہ</th>
                                    <th>رقم</th>
                                    <th>تاریخ</th>
                                    <th>ادا کنندہ</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-3">
                        <h5>کل اخراجات: <span id="total-expenses">0</span></h5>
                    </div>
                `;
                
                // Set default dates
                const today = new Date();
                const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
                
                document.getElementById('expense-report-from').value = firstDay.toISOString().split('T');
                document.getElementById('expense-report-to').value = today.toISOString().split('T');
                
                // Load initial data
                loadExpenseReportData();
                
                // Add filter event
                document.getElementById('filter-expense-report').addEventListener('click', loadExpenseReportData);
                
                // Show report container
                document.getElementById('report-container').style.display = 'block';
            } catch (error) {
                console.error('Error showing expense report:', error);
            }
        }
    
        async function loadExpenseReportData() {
            try {
                const category = document.getElementById('expense-report-category').value;
                const fromDate = document.getElementById('expense-report-from').value;
                const toDate = document.getElementById('expense-report-to').value;
                
                if (!fromDate || !toDate) {
                    alert('تاریخیں منتخب کریں');
                    return;
                }
                
                // Get all expenses
                let expenses = await getAllData('expenses');
                
                // Filter by date range
                expenses = expenses.filter(expense => 
                    expense.date >= fromDate && expense.date <= toDate
                );
                
                // Filter by category if selected
                if (category) {
                    expenses = expenses.filter(expense => expense.category === category);
                }
                
                // Sort by date (newest first)
                expenses.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const table = document.getElementById('expense-report-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                let totalExpenses = 0;
                
                for (const expense of expenses) {
                    let categoryText = '';
                    switch (expense.category) {
                        case 'utilities':
                            categoryText = 'یوٹیلٹیز';
                            break;
                        case 'maintenance':
                            categoryText = 'مرمت';
                            break;
                        case 'salaries':
                            categoryText = 'تنخواہیں';
                            break;
                        case 'stationary':
                            categoryText = 'سٹیشنری';
                            break;
                        case 'furniture':
                            categoryText = 'فرنیچر';
                            break;
                        case 'electronics':
                            categoryText = 'الیکٹرانکس';
                            break;
                        case 'other':
                            categoryText = 'دیگر';
                            break;
                    }
                    
                    totalExpenses += expense.amount;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${expense.id}</td>
                        <td>${expense.description}</td>
                        <td>${categoryText}</td>
                        <td>${expense.amount}</td>
                        <td>${new Date(expense.date).toLocaleDateString('ur-PK')}</td>
                        <td>${expense.paidBy}</td>
                    `;
                    table.appendChild(row);
                }
                
                document.getElementById('total-expenses').textContent = totalExpenses;
            } catch (error) {
                console.error('Error loading expense report data:', error);
            }
        }
    
        // Helper function to show inventory report
        async function showInventoryReport() {
            try {
                // Create filters
                const filtersContainer = document.getElementById('report-filters');
                filtersContainer.innerHTML = `
                    <div class="row">
                        <div class="col-md-4">
                            <label for="inventory-report-category" class="form-label">زمرہ</label>
                            <select class="form-select" id="inventory-report-category">
                                <option value="">تمام زمرے</option>
                                <option value="furniture">فرنیچر</option>
                                <option value="stationary">سٹیشنری</option>
                                <option value="electronics">الیکٹرانکس</option>
                                <option value="books">کتابیں</option>
                                <option value="other">دیگر</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="inventory-report-search" class="form-label">تلاش</label>
                            <input type="text" class="form-control" id="inventory-report-search" placeholder="آئٹم کا نام...">
                        </div>
                        <div class="col-md-4">
                            <br>
                            <button class="btn btn-primary mt-2" id="filter-inventory-report">فلٹر کریں</button>
                        </div>
                    </div>
                `;
                
                // Create table
                const reportContainer = document.getElementById('report-data');
                reportContainer.innerHTML = `
                    <div class="table-responsive">
                        <table class="table table-striped" id="inventory-report-table">
                            <thead>
                                <tr>
                                    <th>آئی ڈی</th>
                                    <th>آئٹم کا نام</th>
                                    <th>زمرہ</th>
                                    <th>تعداد</th>
                                    <th>یونٹ</th>
                                    <th>خریداری کی تاریخ</th>
                                    <th>قیمت</th>
                                    <th>کل قیمت</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-3">
                        <h5>کل آئٹمز: <span id="total-items">0</span></h5>
                        <h5>کل قیمت: <span id="total-value">0</span></h5>
                    </div>
                `;
                
                // Load initial data
                loadInventoryReportData();
                
                // Add filter event
                document.getElementById('filter-inventory-report').addEventListener('click', loadInventoryReportData);
                
                // Show report container
                document.getElementById('report-container').style.display = 'block';
            } catch (error) {
                console.error('Error showing inventory report:', error);
            }
        }
    
        async function loadInventoryReportData() {
            try {
                const category = document.getElementById('inventory-report-category').value;
                const search = document.getElementById('inventory-report-search').value.toLowerCase();

                // Get all inventory items
                let inventory = await getAllData('inventory');
                
                // Filter by category if selected
                if (category) {
                    inventory = inventory.filter(item => item.category === category);
                }
                
                // Filter by search term if provided
                if (search) {
                    inventory = inventory.filter(item => 
                        item.name.toLowerCase().includes(search)
                    );
                }
                
                // Sort by name
                inventory.sort((a, b) => a.name.localeCompare(b.name));
                
                const table = document.getElementById('inventory-report-table').getElementsByTagName('tbody')[0];
                table.innerHTML = '';
                
                let totalItems = 0;
                let totalValue = 0;
                
                for (const item of inventory) {
                    let categoryText = '';
                    switch (item.category) {
                        case 'furniture':
                            categoryText = 'فرنیچر';
                            break;
                        case 'stationary':
                            categoryText = 'سٹیشنری';
                            break;
                        case 'electronics':
                            categoryText = 'الیکٹرانکس';
                            break;
                        case 'books':
                            categoryText = 'کتابیں';
                            break;
                        case 'other':
                            categoryText = 'دیگر';
                            break;
                    }
                    
                    const totalPrice = item.quantity * item.price;
                    totalItems += item.quantity;
                    totalValue += totalPrice;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.id}</td>
                        <td>${item.name}</td>
                        <td>${categoryText}</td>
                        <td>${item.quantity}</td>
                        <td>${item.unit}</td>
                        <td>${new Date(item.purchaseDate).toLocaleDateString('ur-PK')}</td>
                        <td>${item.price}</td>
                        <td>${totalPrice}</td>
                    `;
                    table.appendChild(row);
                }
                
                document.getElementById('total-items').textContent = totalItems;
                document.getElementById('total-value').textContent = totalValue;
            } catch (error) {
                console.error('Error loading inventory report data:', error);
            }
        }
    </script>
<script>if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js').then(r => console.log('ServiceWorker registered.')).catch(e => console.log('ServiceWorker registration failed: ', e)); }); }</script></body>
</html>