<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School & Madrasa Management App</title>
    <style>
        html,
        body {
            height: 100%;
        }
        * {
            box-sizing: border-box;
            font-family: 'Jameel Noori Nastaleeq', 'Noto Nastaliq Urdu', Arial, sans-serif;
        }
        body {
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
            direction: rtl;
        }
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .header h1 {
            margin: 0;
            font-size: 28px;
        }
        .sidebar {
            width: 250px;
            background-color: #34495e;
            height: 100vh;
            position: fixed;
            top: 0;
            right: 0;
            padding-top: 70px;
            color: white;
            transition: all 0.3s;
            z-index: 999;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }
        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .sidebar-menu li {
            padding: 10px 20px;
            border-bottom: 1px solid #465c6e;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .sidebar-menu li:hover {
            background-color: #2c3e50;
        }
        .sidebar-menu i {
            margin-left: 10px;
        }
        .main-container {
            margin-right: 250px;
            transition: all 0.3s;
            height: 100vh;
            overflow-y: auto;
            width: 81%;
            padding: 12px;
        }
        .main-content-inner {
            direction: rtl;
            padding: 20px;
        }
        .dashboard-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            flex: 1;
            min-width: 250px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        .card-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #2c3e50;
            font-weight: bold;
        }
        .card-value {
            font-size: 32px;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 10px;
        }
        .card-subtitle {
            color: #7f8c8d;
            font-size: 14px;
        }
        .form-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .form-title {
            font-size: 22px;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
            gap: 15px;
        }
        .form-group {
            flex: 1;
            min-width: 250px;
        }
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            direction: rtl;
        }
        .form-control:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.25);
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        .btn-primary:hover {
            background-color: #2980b9;
        }
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        .btn-danger:hover {
            background-color: #c0392b;
        }
        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        .btn-success:hover {
            background-color: #27ae60;
        }
        .table-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        .table th,
        .table td {
            padding: 12px 15px;
            text-align: right;
        }
        .table thead th {
            background-color: #f1f1f1;
            color: #333;
            font-weight: bold;
            border-bottom: 2px solid #ddd;
        }
        .table tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .table tbody tr:hover {
            background-color: #f1f1f1;
        }
        .table td {
            border-bottom: 1px solid #ddd;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            cursor: pointer;
        }
        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .section-view {
            display: none;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover {
            color: black;
        }
        .profile-card {
            display: flex;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }
        .profile-image {
            width: 150px;
            padding: 20px;
        }
        .profile-image img {
            width: 100%;
            border-radius: 50%;
            border: 3px solid #3498db;
        }
        .profile-details {
            flex: 1;
            padding: 20px;
        }
        .profile-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .profile-info {
            margin-bottom: 5px;
        }
        .profile-info span {
            font-weight: bold;
            margin-left: 10px;
            color: #7f8c8d;
        }
        @media print {
            .sidebar,
            .header,
            .no-print {
                display: none !important;
            }
            .main-container {
                margin: 0;
                padding: 0;
            }
            .print-only {
                display: block;
            }
            .table-container,
            .form-container,
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 0;
                padding-top: 60px;
            }
            .sidebar.active {
                width: 250px;
            }
            .main-container {
                margin-right: 0;
            }
            .main-container.sidebar-active {
                margin-right: 250px;
            }
            .menu-toggle {
                display: block;
            }
            .dashboard-cards {
                flex-direction: column;
            }
            .card {
                min-width: 100%;
            }
            .form-group {
                min-width: 100%;
            }
        }
        .menu-toggle {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 1000;
            cursor: pointer;
            background-color: #3498db;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1100;
        }
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        .notification {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 15px 20px;
            border-radius: 4px;
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1200;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s;
        }
        .notification.success {
            background-color: #2ecc71;
        }
        .notification.error {
            background-color: #e74c3c;
        }
        .notification.info {
            background-color: #3498db;
        }
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        .calendar {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .calendar-title {
            font-size: 20px;
            font-weight: bold;
            color: #2c3e50;
        }
        .calendar-nav button {
            background-color: transparent;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #3498db;
        }
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }
        .calendar-weekdays div {
            text-align: center;
            font-weight: bold;
            color: #7f8c8d;
        }
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        .calendar-day {
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .calendar-day:hover {
            background-color: #f1f1f1;
        }
        .calendar-day.today {
            background-color: #3498db;
            color: white;
        }
        .calendar-day.has-event {
            border: 2px solid #e74c3c;
        }
        * {
            font-family: calibri;
        }
        #js-report-output-area .dashboard-cards .card {
            margin-bottom: 10px;
        }
        .filter-header-toggle {
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }
        .filter-toggle-icon {
            font-size: 1.2em;
            transition: transform 0.2s ease-in-out;
        }
        /* .filter-content:not([style*="display: none"]) + .filter-header-toggle .filter-toggle-icon {
    transform: rotate(180deg);
} */
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>
    <div class="notification" id="notification"></div>
    <div class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars">â˜°</i>
    </div>
    <div class="sidebar" id="sidebar">
        <ul class="sidebar-menu">
            <li data-view="dashboard"><i class="fas fa-tachometer-alt">ğŸ“Š</i> ÚˆÛŒØ´ Ø¨ÙˆØ±Úˆ</li>
            <li data-view="students"><i class="fas fa-user-graduate">ğŸ‘¨â€ğŸ“</i> Ø·Ù„Ø¨Ø§Ø¡</li>
            <li data-view="teachers"><i class="fas fa-chalkboard-teacher">ğŸ‘¨â€ğŸ«</i> Ø§Ø³Ø§ØªØ°Û</li>
            <li data-view="staff"><i class="fas fa-user-tie">ğŸ‘¨â€ğŸ’¼</i> Ø¹Ù…Ù„Û</li>
            <li data-view="classes"><i class="fas fa-chalkboard">ğŸ«</i> Ú©Ù„Ø§Ø³Ø²</li>
            <li data-view="subjects"><i class="fas fa-book">ğŸ“š</i> Ù…Ø¶Ø§Ù…ÛŒÙ†</li>
            <li data-view="attendance"><i class="fas fa-clipboard-check">ğŸ“‹</i> Ø­Ø§Ø¶Ø±ÛŒ</li>
            <li data-view="exams"><i class="fas fa-file-alt">ğŸ“</i> Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</li>
            <li data-view="fees"><i class="fas fa-money-bill-wave">ğŸ’°</i> ÙÛŒØ³</li>
            <li data-view="salaries"><i class="fas fa-wallet">ğŸ‘›</i> ØªÙ†Ø®ÙˆØ§Û</li>
            <li data-view="library"><i class="fas fa-book-reader">ğŸ“–</i> Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒ</li>
            <li data-view="users"><i class="fas fa-users-cog">ğŸ‘¥</i> ØµØ§Ø±ÙÛŒÙ†</li>
            <li data-view="reports"><i class="fas fa-chart-bar">ğŸ“Š</i> Ø±Ù¾ÙˆØ±Ù¹Ø³</li>
            <li data-view="settings"><i class="fas fa-cog">âš™ï¸</i> ØªØ±ØªÛŒØ¨Ø§Øª</li>
            <li data-view="backup"><i class="fas fa-database">ğŸ’¾</i> Ø¨ÛŒÚ© Ø§Ù¾</li>
        </ul>
    </div>
    <div class="main-container" id="mainContainer">
        <div class="main-content-inner"></div>
        <div class="header">
            <h1>School & Madrasa Management App</h1>
        </div>
        <div class="section-view" id="dashboard-view" style="display: block;">
            <h2>ÚˆÛŒØ´ Ø¨ÙˆØ±Úˆ</h2>
            <div class="dashboard-cards">
                <div class="card">
                    <div class="card-title">Ú©Ù„ Ø·Ù„Ø¨Ø§Ø¡</div>
                    <div class="card-value" id="total-students">0</div>
                    <div class="card-subtitle">Ø±Ø¬Ø³Ù¹Ø±Úˆ Ø·Ù„Ø¨Ø§Ø¡</div>
                </div>
                <div class="card">
                    <div class="card-title">Ú©Ù„ Ø§Ø³Ø§ØªØ°Û</div>
                    <div class="card-value" id="total-teachers">0</div>
                    <div class="card-subtitle">Ø±Ø¬Ø³Ù¹Ø±Úˆ Ø§Ø³Ø§ØªØ°Û</div>
                </div>
                <div class="card">
                    <div class="card-title">Ú©Ù„ Ú©Ù„Ø§Ø³Ø²</div>
                    <div class="card-value" id="total-classes">0</div>
                    <div class="card-subtitle">ÙØ¹Ø§Ù„ Ú©Ù„Ø§Ø³Ø²</div>
                </div>
                <div class="card">
                    <div class="card-title">Ø¢Ø¬ Ú©ÛŒ Ø­Ø§Ø¶Ø±ÛŒ</div>
                    <div class="card-value" id="today-attendance">0%</div>
                    <div class="card-subtitle">Ø·Ù„Ø¨Ø§Ø¡ Ø­Ø§Ø¶Ø±</div>
                </div>
            </div>
            <div class="dashboard-cards">
                <div class="card">
                    <div class="card-title">Ù…Ø§ÛØ§Ù†Û ÙÛŒØ³ Ú©Ù„ÛŒÚ©Ø´Ù†</div>
                    <div class="card-value" id="monthly-fee">0 Ø±ÙˆÙ¾Û’</div>
                    <div class="card-subtitle">Ù…ÙˆØ¬ÙˆØ¯Û Ù…ÛÛŒÙ†Û</div>
                </div>
                <div class="card">
                    <div class="card-title">Ø¨Ù‚Ø§ÛŒØ§ ÙÛŒØ³</div>
                    <div class="card-value" id="pending-fee">0 Ø±ÙˆÙ¾Û’</div>
                    <div class="card-subtitle">ÙˆØ§Ø¬Ø¨ Ø§Ù„Ø§Ø¯Ø§ ÙÛŒØ³</div>
                </div>
            </div>
            <div class="form-container">
                <div class="form-title">Ø¢Ù†Û’ ÙˆØ§Ù„Û’ Ù¾Ø±ÙˆÚ¯Ø±Ø§Ù…Ø²</div>
                <div id="upcoming-events">
                    <div class="table-container">
                        <table class="table" id="events-table">
                            <thead>
                                <tr>
                                    <th>Ù†Ù…Ø¨Ø±</th>
                                    <th>Ù¾Ø±ÙˆÚ¯Ø±Ø§Ù…</th>
                                    <th>ØªØ§Ø±ÛŒØ®</th>
                                    <th>Ù…Ù‚Ø§Ù…</th>
                                    <th>ØªÙØµÛŒÙ„Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="form-container">
                <div class="form-title">Ø­Ø§Ù„ÛŒÛ Ø³Ø±Ú¯Ø±Ù…ÛŒØ§Úº</div>
                <div id="recent-activities">
                    <div class="table-container">
                        <table class="table" id="activities-table">
                            <thead>
                                <tr>
                                    <th>Ù†Ù…Ø¨Ø±</th>
                                    <th>Ø³Ø±Ú¯Ø±Ù…ÛŒ</th>
                                    <th>ØªØ§Ø±ÛŒØ®</th>
                                    <th>Ù…ØªØ¹Ù„Ù‚Û Ø´Ø®Øµ</th>
                                    <th>ØªÙØµÛŒÙ„Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="section-view" id="students-view">
            <h2>Ø·Ù„Ø¨Ø§Ø¡</h2>
            <div class="tabs">
                <div class="tab active" data-tab="students-list">Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ÙÛØ±Ø³Øª</div>
                <div class="tab" data-tab="add-student">Ù†ÛŒØ§ Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù…</div>
            </div>
            <div class="tab-content active" id="students-list">
                <div class="form-container">
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" class="form-control" id="student-search"
                                placeholder="Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©Ø§ Ù†Ø§Ù…ØŒ Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø± ÛŒØ§ Ú©Ù„Ø§Ø³ Ø³Û’ ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº">
                        </div>
                        <div class="form-group" style="flex: 0 0 auto;">
                            <button class="btn btn-primary" id="search-student-btn">ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº</button>
                        </div>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table" id="students-table">
                        <thead>
                            <tr>
                                <th>Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø±</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>ÙˆØ§Ù„Ø¯ Ú©Ø§ Ù†Ø§Ù…</th>
                                <th>Ú©Ù„Ø§Ø³</th>
                                <th>Ø³ÛŒÚ©Ø´Ù†</th>
                                <th>Ø±Ø§Ø¨Ø·Û Ù†Ù…Ø¨Ø±</th>
                                <th>Ø¯Ø§Ø®Ù„Û ØªØ§Ø±ÛŒØ®</th>
                                <th>Ø¹Ù…Ù„</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" id="add-student">
                <div class="form-container">
                    <div class="form-title">Ù†ÛŒØ§ Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº</div>
                    <form id="student-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©Ø§ Ù†Ø§Ù…</label>
                                <input type="text" class="form-control" id="student-name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÙˆØ§Ù„Ø¯ Ú©Ø§ Ù†Ø§Ù…</label>
                                <input type="text" class="form-control" id="student-father" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">ØªØ§Ø±ÛŒØ® Ù¾ÛŒØ¯Ø§Ø¦Ø´</label>
                                <input type="date" class="form-control" id="student-dob" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¬Ù†Ø³</label>
                                <select class="form-control" id="student-gender" required>
                                    <option value="Ù…Ø±Ø¯">Ù…Ø±Ø¯</option>
                                    <option value="Ø¹ÙˆØ±Øª">Ø¹ÙˆØ±Øª</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ú©Ù„Ø§Ø³</label>
                                <select class="form-control" id="student-class" required>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø³ÛŒÚ©Ø´Ù†</label>
                                <select class="form-control" id="student-section" required>
                                    <option value="Ø§Ù„Ù">Ø§Ù„Ù</option>
                                    <option value="Ø¨">Ø¨</option>
                                    <option value="Ø¬">Ø¬</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø±Ø§Ø¨Ø·Û Ù†Ù…Ø¨Ø±</label>
                                <input type="tel" class="form-control" id="student-contact" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§ÛŒ Ù…ÛŒÙ„</label>
                                <input type="email" class="form-control" id="student-email">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø³Ø±Ù¾Ø±Ø³Øª Ú©Ø§ Ù†Ø§Ù…</label>
                                <input type="text" class="form-control" id="student-guardian">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø³Ø±Ù¾Ø±Ø³Øª Ú©Ø§ Ø±Ø§Ø¨Ø·Û Ù†Ù…Ø¨Ø±</label>
                                <input type="tel" class="form-control" id="student-guardian-contact">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ù…Ú©Ù…Ù„ Ù¾ØªÛ</label>
                                <textarea class="form-control" id="student-address" rows="3" required></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©ÛŒ ØªØµÙˆÛŒØ±</label>
                                <input type="file" class="form-control" id="student-photo" accept="image/*">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¯Ø§Ø®Ù„Û ØªØ§Ø±ÛŒØ®</label>
                                <input type="date" class="form-control" id="student-admission-date" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">ÙÛŒØ³ Ú©ÛŒÙ¹ÛŒÚ¯Ø±ÛŒ</label>
                                <select class="form-control" id="student-fee-category">
                                    <option value="Ø¹Ø§Ù…">Ø¹Ø§Ù…</option>
                                    <option value="Ù…Ø³ØªØ­Ù‚">Ù…Ø³ØªØ­Ù‚</option>
                                    <option value="Ø§Ø³Ú©Ø§Ù„Ø±Ø´Ù¾">Ø§Ø³Ú©Ø§Ù„Ø±Ø´Ù¾</option>
                                    <option value="Ù…Ú©Ù…Ù„ Ù…Ø¹Ø§Ù">Ù…Ú©Ù…Ù„ Ù…Ø¹Ø§Ù</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ù…Ø§ÛØ§Ù†Û ÙÛŒØ³</label>
                                <input type="number" class="form-control" id="student-monthly-fee" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø§Ø¶Ø§ÙÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</label>
                                <textarea class="form-control" id="student-notes" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº</button>
                            <button type="reset" class="btn btn-danger" style="margin-right: 10px;">ÙØ§Ø±Ù… Ø±ÛŒ Ø³ÛŒÙ¹
                                Ú©Ø±ÛŒÚº</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="section-view" id="teachers-view">
            <h2>Ø§Ø³Ø§ØªØ°Û</h2>
            <div class="tabs">
                <div class="tab active" data-tab="teachers-list">Ø§Ø³Ø§ØªØ°Û Ú©ÛŒ ÙÛØ±Ø³Øª</div>
                <div class="tab" data-tab="add-teacher">Ù†ÛŒØ§ Ø§Ø³ØªØ§Ø¯</div>
            </div>
            <div class="tab-content active" id="teachers-list">
                <div class="form-container">
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" class="form-control" id="teacher-search"
                                placeholder="Ø§Ø³ØªØ§Ø¯ Ú©Ø§ Ù†Ø§Ù…ØŒ Ù…Ø¶Ù…ÙˆÙ† ÛŒØ§ Ú©Ù„Ø§Ø³ Ø³Û’ ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº">
                        </div>
                        <div class="form-group" style="flex: 0 0 auto;">
                            <button class="btn btn-primary" id="search-teacher-btn">ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº</button>
                        </div>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table" id="teachers-table">
                        <thead>
                            <tr>
                                <th>Ø´Ù†Ø§Ø®ØªÛŒ Ù†Ù…Ø¨Ø±</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>Ù‚Ø§Ø¨Ù„ÛŒØª</th>
                                <th>Ù…Ø¶Ù…ÙˆÙ†</th>
                                <th>Ø±Ø§Ø¨Ø·Û Ù†Ù…Ø¨Ø±</th>
                                <th>Ø´Ù…ÙˆÙ„ÛŒØª ØªØ§Ø±ÛŒØ®</th>
                                <th>ØªÙ†Ø®ÙˆØ§Û</th>
                                <th>Ø¹Ù…Ù„</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" id="add-teacher">
                <div class="form-container">
                    <div class="form-title">Ù†ÛŒØ§ Ø§Ø³ØªØ§Ø¯ Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº</div>
                    <form id="teacher-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø§Ø³ØªØ§Ø¯ Ú©Ø§ Ù†Ø§Ù…</label>
                                <input type="text" class="form-control" id="teacher-name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÙˆØ§Ù„Ø¯ Ú©Ø§ Ù†Ø§Ù…</label>
                                <input type="text" class="form-control" id="teacher-father" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">ØªØ§Ø±ÛŒØ® Ù¾ÛŒØ¯Ø§Ø¦Ø´</label>
                                <input type="date" class="form-control" id="teacher-dob" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¬Ù†Ø³</label>
                                <select class="form-control" id="teacher-gender" required>
                                    <option value="Ù…Ø±Ø¯">Ù…Ø±Ø¯</option>
                                    <option value="Ø¹ÙˆØ±Øª">Ø¹ÙˆØ±Øª</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ù‚Ø§Ø¨Ù„ÛŒØª</label>
                                <input type="text" class="form-control" id="teacher-qualification" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ØªØ®ØµØµ</label>
                                <input type="text" class="form-control" id="teacher-specialization" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø§Ø³Ø§ØªØ°Û Ú©Ø§ Ù…Ø¶Ù…ÙˆÙ†</label>
                                <select class="form-control" id="teacher-subject" multiple required>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ú©Ù„Ø§Ø³</label>
                                <select class="form-control" id="teacher-class" multiple>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø±Ø§Ø¨Ø·Û Ù†Ù…Ø¨Ø±</label>
                                <input type="tel" class="form-control" id="teacher-contact" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§ÛŒ Ù…ÛŒÙ„</label>
                                <input type="email" class="form-control" id="teacher-email">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ù…Ú©Ù…Ù„ Ù¾ØªÛ</label>
                                <textarea class="form-control" id="teacher-address" rows="3" required></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø´Ù†Ø§Ø®ØªÛŒ Ú©Ø§Ø±Úˆ Ù†Ù…Ø¨Ø±</label>
                                <input type="text" class="form-control" id="teacher-cnic" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ø³ØªØ§Ø¯ Ú©ÛŒ ØªØµÙˆÛŒØ±</label>
                                <input type="file" class="form-control" id="teacher-photo" accept="image/*">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø´Ù…ÙˆÙ„ÛŒØª ØªØ§Ø±ÛŒØ®</label>
                                <input type="date" class="form-control" id="teacher-joining-date" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¨Ù†ÛŒØ§Ø¯ÛŒ ØªÙ†Ø®ÙˆØ§Û</label>
                                <input type="number" class="form-control" id="teacher-basic-salary" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„Ø§Ø¤Ù†Ø³Ø²</label>
                                <input type="number" class="form-control" id="teacher-allowances">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ú©Ù¹ÙˆØªÛŒØ§Úº</label>
                                <input type="number" class="form-control" id="teacher-deductions">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø§Ø¶Ø§ÙÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</label>
                                <textarea class="form-control" id="teacher-notes" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">Ø§Ø³ØªØ§Ø¯ Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº</button>
                            <button type="reset" class="btn btn-danger" style="margin-right: 10px;">ÙØ§Ø±Ù… Ø±ÛŒ Ø³ÛŒÙ¹
                                Ú©Ø±ÛŒÚº</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="section-view" id="staff-view">
            <h2>Ø¹Ù…Ù„Û</h2>
            <div class="tabs">
                <div class="tab active" data-tab="staff-list">Ø¹Ù…Ù„Û’ Ú©ÛŒ ÙÛØ±Ø³Øª</div>
                <div class="tab" data-tab="add-staff">Ù†ÛŒØ§ Ø¹Ù…Ù„Û</div>
            </div>
            <div class="tab-content active" id="staff-list">
                <div class="form-container">
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" class="form-control" id="staff-search"
                                placeholder="Ø¹Ù…Ù„Û’ Ú©Ø§ Ù†Ø§Ù…ØŒ Ø¹ÛØ¯Û ÛŒØ§ Ø´Ø¹Ø¨Û Ø³Û’ ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº">
                        </div>
                        <div class="form-group" style="flex: 0 0 auto;">
                            <button class="btn btn-primary" id="search-staff-btn">ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº</button>
                        </div>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table" id="staff-table">
                        <thead>
                            <tr>
                                <th>Ø´Ù†Ø§Ø®ØªÛŒ Ù†Ù…Ø¨Ø±</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>Ø¹ÛØ¯Û</th>
                                <th>Ø´Ø¹Ø¨Û</th>
                                <th>Ø±Ø§Ø¨Ø·Û Ù†Ù…Ø¨Ø±</th>
                                <th>Ø´Ù…ÙˆÙ„ÛŒØª ØªØ§Ø±ÛŒØ®</th>
                                <th>ØªÙ†Ø®ÙˆØ§Û</th>
                                <th>Ø¹Ù…Ù„</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" id="add-staff">
                <div class="form-container">
                    <div class="form-title">Ù†ÛŒØ§ Ø¹Ù…Ù„Û Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº</div>
                    <form id="staff-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø¹Ù…Ù„Û’ Ú©Ø§ Ù†Ø§Ù…</label>
                                <input type="text" class="form-control" id="staff-name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÙˆØ§Ù„Ø¯ Ú©Ø§ Ù†Ø§Ù…</label>
                                <input type="text" class="form-control" id="staff-father" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">ØªØ§Ø±ÛŒØ® Ù¾ÛŒØ¯Ø§Ø¦Ø´</label>
                                <input type="date" class="form-control" id="staff-dob" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¬Ù†Ø³</label>
                                <select class="form-control" id="staff-gender" required>
                                    <option value="Ù…Ø±Ø¯">Ù…Ø±Ø¯</option>
                                    <option value="Ø¹ÙˆØ±Øª">Ø¹ÙˆØ±Øª</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø¹ÛØ¯Û</label>
                                <select class="form-control" id="staff-designation" required>
                                    <option value="Ø¯ÙØªØ±ÛŒ Ú©Ù„Ø±Ú©">Ø¯ÙØªØ±ÛŒ Ú©Ù„Ø±Ú©</option>
                                    <option value="Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒÙ†">Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒÙ†</option>
                                    <option value="Ø³ÛŒÚ©ÛŒÙˆØ±Ù¹ÛŒ Ú¯Ø§Ø±Úˆ">Ø³ÛŒÚ©ÛŒÙˆØ±Ù¹ÛŒ Ú¯Ø§Ø±Úˆ</option>
                                    <option value="ØµÙØ§Ø¦ÛŒ Ú©Ø±Ù†Û’ ÙˆØ§Ù„Ø§">ØµÙØ§Ø¦ÛŒ Ú©Ø±Ù†Û’ ÙˆØ§Ù„Ø§</option>
                                    <option value="ÚˆØ±Ø§Ø¦ÛŒÙˆØ±">ÚˆØ±Ø§Ø¦ÛŒÙˆØ±</option>
                                    <option value="Ø¯ÛŒÚ¯Ø±">Ø¯ÛŒÚ¯Ø±</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø´Ø¹Ø¨Û</label>
                                <select class="form-control" id="staff-department" required>
                                    <option value="Ø§Ù†ØªØ¸Ø§Ù…ÛŒÛ">Ø§Ù†ØªØ¸Ø§Ù…ÛŒÛ</option>
                                    <option value="Ø§Ú©Ø§Ø¤Ù†Ù¹Ø³">Ø§Ú©Ø§Ø¤Ù†Ù¹Ø³</option>
                                    <option value="Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒ">Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒ</option>
                                    <option value="Ø³ÛŒÚ©ÛŒÙˆØ±Ù¹ÛŒ">Ø³ÛŒÚ©ÛŒÙˆØ±Ù¹ÛŒ</option>
                                    <option value="Ù¹Ø±Ø§Ù†Ø³Ù¾ÙˆØ±Ù¹">Ù¹Ø±Ø§Ù†Ø³Ù¾ÙˆØ±Ù¹</option>
                                    <option value="ØµÙØ§Ø¦ÛŒ">ØµÙØ§Ø¦ÛŒ</option>
                                    <option value="Ø¯ÛŒÚ¯Ø±">Ø¯ÛŒÚ¯Ø±</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ù‚Ø§Ø¨Ù„ÛŒØª</label>
                                <input type="text" class="form-control" id="staff-qualification">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø°Ù…Û Ø¯Ø§Ø±ÛŒØ§Úº</label>
                                <input type="text" class="form-control" id="staff-responsibilities" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø±Ø§Ø¨Ø·Û Ù†Ù…Ø¨Ø±</label>
                                <input type="tel" class="form-control" id="staff-contact" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§ÛŒ Ù…ÛŒÙ„</label>
                                <input type="email" class="form-control" id="staff-email">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ù…Ú©Ù…Ù„ Ù¾ØªÛ</label>
                                <textarea class="form-control" id="staff-address" rows="3" required></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø´Ù†Ø§Ø®ØªÛŒ Ú©Ø§Ø±Úˆ Ù†Ù…Ø¨Ø±</label>
                                <input type="text" class="form-control" id="staff-cnic" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¹Ù…Ù„Û’ Ú©ÛŒ ØªØµÙˆÛŒØ±</label>
                                <input type="file" class="form-control" id="staff-photo" accept="image/*">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø´Ù…ÙˆÙ„ÛŒØª ØªØ§Ø±ÛŒØ®</label>
                                <input type="date" class="form-control" id="staff-joining-date" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¨Ù†ÛŒØ§Ø¯ÛŒ ØªÙ†Ø®ÙˆØ§Û</label>
                                <input type="number" class="form-control" id="staff-basic-salary" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„Ø§Ø¤Ù†Ø³Ø²</label>
                                <input type="number" class="form-control" id="staff-allowances">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ú©Ù¹ÙˆØªÛŒØ§Úº</label>
                                <input type="number" class="form-control" id="staff-deductions">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø§Ø¶Ø§ÙÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</label>
                                <textarea class="form-control" id="staff-notes" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">Ø¹Ù…Ù„Û Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº</button>
                            <button type="reset" class="btn btn-danger" style="margin-right: 10px;">ÙØ§Ø±Ù… Ø±ÛŒ Ø³ÛŒÙ¹
                                Ú©Ø±ÛŒÚº</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="section-view" id="classes-view">
            <h2>Ú©Ù„Ø§Ø³Ø²</h2>
            <div class="tabs">
                <div class="tab active" data-tab="classes-list">Ú©Ù„Ø§Ø³Ø² Ú©ÛŒ ÙÛØ±Ø³Øª</div>
                <div class="tab" data-tab="add-class">Ù†Ø¦ÛŒ Ú©Ù„Ø§Ø³</div>
                <div class="tab" data-tab="sections">Ø³ÛŒÚ©Ø´Ù†Ø²</div>
            </div>
            <div class="tab-content active" id="classes-list">
                <div class="table-container">
                    <table class="table" id="classes-table">
                        <thead>
                            <tr>
                                <th>Ù†Ù…Ø¨Ø±</th>
                                <th>Ú©Ù„Ø§Ø³ Ú©Ø§ Ù†Ø§Ù…</th>
                                <th>Ú©Ù„Ø§Ø³ Ø§Ù†Ú†Ø§Ø±Ø¬</th>
                                <th>Ø³ÛŒÚ©Ø´Ù†Ø²</th>
                                <th>Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ØªØ¹Ø¯Ø§Ø¯</th>
                                <th>Ø¹Ù…Ù„</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" id="add-class">
                <div class="form-container">
                    <div class="form-title">Ù†Ø¦ÛŒ Ú©Ù„Ø§Ø³ Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº</div>
                    <form id="class-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ú©Ù„Ø§Ø³ Ú©Ø§ Ù†Ø§Ù…</label>
                                <input type="text" class="form-control" id="class-name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ú©Ù„Ø§Ø³ Ø§Ù†Ú†Ø§Ø±Ø¬</label>
                                <select class="form-control" id="class-incharge" required>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ú©Ù„Ø§Ø³ Ø¯ÙˆØ±Û</label>
                                <input type="text" class="form-control" id="class-level" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø³ÛŒÚ©Ø´Ù†Ø²</label>
                                <select class="form-control" id="class-sections" multiple required>
                                    <option value="Ø§Ù„Ù">Ø§Ù„Ù</option>
                                    <option value="Ø¨">Ø¨</option>
                                    <option value="Ø¬">Ø¬</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ú©Ù…Ø±Û Ù†Ù…Ø¨Ø±</label>
                                <input type="text" class="form-control" id="class-room">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÙÛŒØ³ Ú©ÛŒÙ¹ÛŒÚ¯Ø±ÛŒ</label>
                                <select class="form-control" id="class-fee-category">
                                    <option value="Ø¹Ø§Ù…">Ø¹Ø§Ù…</option>
                                    <option value="Ø®ØµÙˆØµÛŒ">Ø®ØµÙˆØµÛŒ</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ù…Ø§ÛØ§Ù†Û ÙÛŒØ³</label>
                                <input type="number" class="form-control" id="class-monthly-fee" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¯Ø§Ø®Ù„Û ÙÛŒØ³</label>
                                <input type="number" class="form-control" id="class-admission-fee" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø§Ø¶Ø§ÙÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</label>
                                <textarea class="form-control" id="class-notes" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">Ú©Ù„Ø§Ø³ Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº</button>
                            <button type="reset" class="btn btn-danger" style="margin-right: 10px;">ÙØ§Ø±Ù… Ø±ÛŒ Ø³ÛŒÙ¹
                                Ú©Ø±ÛŒÚº</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="tab-content" id="sections">
                <div class="form-container">
                    <div class="form-title">Ø³ÛŒÚ©Ø´Ù† Ù…ÛŒÙ†Ø¬Ù…Ù†Ù¹</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„Ø§Ø³</label>
                            <select class="form-control" id="section-class" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø³ÛŒÚ©Ø´Ù†</label>
                            <select class="form-control" id="section-name" required>
                                <option value="Ø§Ù„Ù">Ø§Ù„Ù</option>
                                <option value="Ø¨">Ø¨</option>
                                <option value="Ø¬">Ø¬</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø³ÛŒÚ©Ø´Ù† Ø§Ù†Ú†Ø§Ø±Ø¬</label>
                            <select class="form-control" id="section-incharge" required>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="save-section">Ø³ÛŒÚ©Ø´Ù† Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table" id="sections-table">
                        <thead>
                            <tr>
                                <th>Ù†Ù…Ø¨Ø±</th>
                                <th>Ú©Ù„Ø§Ø³</th>
                                <th>Ø³ÛŒÚ©Ø´Ù†</th>
                                <th>Ø³ÛŒÚ©Ø´Ù† Ø§Ù†Ú†Ø§Ø±Ø¬</th>
                                <th>Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ØªØ¹Ø¯Ø§Ø¯</th>
                                <th>Ø¹Ù…Ù„</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="section-view" id="subjects-view">
            <h2>Ù…Ø¶Ø§Ù…ÛŒÙ†</h2>
            <div class="tabs">
                <div class="tab active" data-tab="subjects-list">Ù…Ø¶Ø§Ù…ÛŒÙ† Ú©ÛŒ ÙÛØ±Ø³Øª</div>
                <div class="tab" data-tab="add-subject">Ù†ÛŒØ§ Ù…Ø¶Ù…ÙˆÙ†</div>
                <div class="tab" data-tab="class-subjects">Ú©Ù„Ø§Ø³ Ù…Ø¶Ø§Ù…ÛŒÙ†</div>
            </div>
            <div class="tab-content active" id="subjects-list">
                <div class="table-container">
                    <table class="table" id="subjects-table">
                        <thead>
                            <tr>
                                <th>Ù†Ù…Ø¨Ø±</th>
                                <th>Ù…Ø¶Ù…ÙˆÙ† Ú©Ø§ Ù†Ø§Ù…</th>
                                <th>Ù…Ø¶Ù…ÙˆÙ† Ú©ÙˆÚˆ</th>
                                <th>Ù…Ø¶Ù…ÙˆÙ† Ú©ÛŒ Ù‚Ø³Ù…</th>
                                <th>ØªÙØµÛŒÙ„Ø§Øª</th>
                                <th>Ø¹Ù…Ù„</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" id="add-subject">
                <div class="form-container">
                    <div class="form-title">Ù†ÛŒØ§ Ù…Ø¶Ù…ÙˆÙ† Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº</div>
                    <form id="subject-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ù…Ø¶Ù…ÙˆÙ† Ú©Ø§ Ù†Ø§Ù…</label>
                                <input type="text" class="form-control" id="subject-name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ù…Ø¶Ù…ÙˆÙ† Ú©ÙˆÚˆ</label>
                                <input type="text" class="form-control" id="subject-code" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ù…Ø¶Ù…ÙˆÙ† Ú©ÛŒ Ù‚Ø³Ù…</label>
                                <select class="form-control" id="subject-type" required>
                                    <option value="Ù‚Ø±Ø¢Ù†">Ù‚Ø±Ø¢Ù†</option>
                                    <option value="Ø­Ø¯ÛŒØ«">Ø­Ø¯ÛŒØ«</option>
                                    <option value="ÙÙ‚Û">ÙÙ‚Û</option>
                                    <option value="Ø¹Ù‚ÛŒØ¯Û">Ø¹Ù‚ÛŒØ¯Û</option>
                                    <option value="Ø³ÛŒØ±Øª">Ø³ÛŒØ±Øª</option>
                                    <option value="Ø§Ø®Ù„Ø§Ù‚">Ø§Ø®Ù„Ø§Ù‚</option>
                                    <option value="Ø¹Ø±Ø¨ÛŒ">Ø¹Ø±Ø¨ÛŒ</option>
                                    <option value="ÙØ§Ø±Ø³ÛŒ">ÙØ§Ø±Ø³ÛŒ</option>
                                    <option value="Ø§Ø±Ø¯Ùˆ">Ø§Ø±Ø¯Ùˆ</option>
                                    <option value="Ø§Ù†Ú¯Ø±ÛŒØ²ÛŒ">Ø§Ù†Ú¯Ø±ÛŒØ²ÛŒ</option>
                                    <option value="Ø±ÛŒØ§Ø¶ÛŒ">Ø±ÛŒØ§Ø¶ÛŒ</option>
                                    <option value="Ø³Ø§Ø¦Ù†Ø³">Ø³Ø§Ø¦Ù†Ø³</option>
                                    <option value="Ø³Ù…Ø§Ø¬ÛŒ Ø¹Ù„ÙˆÙ…">Ø³Ù…Ø§Ø¬ÛŒ Ø¹Ù„ÙˆÙ…</option>
                                    <option value="Ø¯ÛŒÚ¯Ø±">Ø¯ÛŒÚ¯Ø±</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÛÙØªÛ ÙˆØ§Ø± Ù¾ÛŒØ±ÛŒÚˆØ²</label>
                                <input type="number" class="form-control" id="subject-periods" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ù…Ø¶Ù…ÙˆÙ† Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª</label>
                                <textarea class="form-control" id="subject-details" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">Ù…Ø¶Ù…ÙˆÙ† Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº</button>
                            <button type="reset" class="btn btn-danger" style="margin-right: 10px;">ÙØ§Ø±Ù… Ø±ÛŒ Ø³ÛŒÙ¹
                                Ú©Ø±ÛŒÚº</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="tab-content" id="class-subjects">
                <div class="form-container">
                    <div class="form-title">Ú©Ù„Ø§Ø³ Ú©Û’ Ù…Ø¶Ø§Ù…ÛŒÙ†</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„Ø§Ø³</label>
                            <select class="form-control" id="class-subject-class" required>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ù…Ø¶Ø§Ù…
                                in</label>
                            <select class="form-control" id="class-subject-subject" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ø³ØªØ§Ø¯</label>
                            <select class="form-control" id="class-subject-teacher" required>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="save-class-subject">Ù…Ø¶Ù…ÙˆÙ† Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table" id="class-subjects-table">
                        <thead>
                            <tr>
                                <th>Ù†Ù…Ø¨Ø±</th>
                                <th>Ú©Ù„Ø§Ø³</th>
                                <th>Ù…Ø¶Ù…ÙˆÙ†</th>
                                <th>Ø§Ø³ØªØ§Ø¯</th>
                                <th>Ø¹Ù…Ù„</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="section-view" id="attendance-view">
            <h2>Ø­Ø§Ø¶Ø±ÛŒ</h2>
            <div class="tabs">
                <div class="tab active" data-tab="mark-attendance">Ø­Ø§Ø¶Ø±ÛŒ Ù„Ú¯Ø§Ø¦ÛŒÚº</div>
                <div class="tab" data-tab="view-attendance">Ø­Ø§Ø¶Ø±ÛŒ Ø¯ÛŒÚ©Ú¾ÛŒÚº</div>
                <div class="tab" data-tab="attendance-report">Ø­Ø§Ø¶Ø±ÛŒ Ø±Ù¾ÙˆØ±Ù¹</div>
            </div>
            <div class="tab-content active" id="mark-attendance">
                <div class="form-container">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ØªØ§Ø±ÛŒØ®</label>
                            <input type="date" class="form-control" id="attendance-date" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„Ø§Ø³</label>
                            <select class="form-control" id="attendance-class" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø³ÛŒÚ©Ø´Ù†</label>
                            <select class="form-control" id="attendance-section" required>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="load-attendance">Ø·Ù„Ø¨Ø§Ø¡ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº</button>
                    </div>
                </div>
                <div class="table-container" id="attendance-table-container" style="display: none;">
                    <form id="attendance-form">
                        <table class="table" id="attendance-table">
                            <thead>
                                <tr>
                                    <th>Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø±</th>
                                    <th>Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©Ø§ Ù†Ø§Ù…</th>
                                    <th>Ø­Ø§Ø¶Ø±ÛŒ</th>
                                    <th>ØªØ§Ø®ÛŒØ±</th>
                                    <th>Ø±Ø®ØµØª</th>
                                    <th>Ù†ÙˆÙ¹</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">Ø­Ø§Ø¶Ø±ÛŒ Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="tab-content" id="view-attendance">
                <div class="form-container">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ØªØ§Ø±ÛŒØ®</label>
                            <input type="date" class="form-control" id="view-attendance-date" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„Ø§Ø³</label>
                            <select class="form-control" id="view-attendance-class" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø³ÛŒÚ©Ø´Ù†</label>
                            <select class="form-control" id="view-attendance-section" required>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="view-attendance-btn">Ø­Ø§Ø¶Ø±ÛŒ Ø¯ÛŒÚ©Ú¾ÛŒÚº</button>
                    </div>
                </div>
                <div class="table-container" id="view-attendance-table-container" style="display: none;">
                    <table class="table" id="view-attendance-table">
                        <thead>
                            <tr>
                                <th>Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø±</th>
                                <th>Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©Ø§ Ù†Ø§Ù…</th>
                                <th>Ø­Ø§Ø¶Ø±ÛŒ</th>
                                <th>ØªØ§Ø®ÛŒØ±</th>
                                <th>Ø±Ø®ØµØª</th>
                                <th>Ù†ÙˆÙ¹</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="print-attendance">Ù¾Ø±Ù†Ù¹ Ú©Ø±ÛŒÚº</button>
                    </div>
                </div>
            </div>
            <div class="tab-content" id="attendance-report">
                <div class="form-container">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„Ø§Ø³</label>
                            <select class="form-control" id="report-attendance-class" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø³ÛŒÚ©Ø´Ù†</label>
                            <select class="form-control" id="report-attendance-section" required>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø´Ø±ÙˆØ¹ ØªØ§Ø±ÛŒØ®</label>
                            <input type="date" class="form-control" id="report-start-date" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø®ØªÙ… ØªØ§Ø±ÛŒØ®</label>
                            <input type="date" class="form-control" id="report-end-date" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="generate-attendance-report">Ø±Ù¾ÙˆØ±Ù¹
                            Ø¨Ù†Ø§Ø¦ÛŒÚº</button>
                    </div>
                </div>
                <div class="table-container" id="report-attendance-table-container" style="display: none;">
                    <table class="table" id="report-attendance-table">
                        <thead>
                            <tr>
                                <th>Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø±</th>
                                <th>Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©Ø§ Ù†Ø§Ù…</th>
                                <th>Ú©Ù„ Ø¯Ù†</th>
                                <th>Ø­Ø§Ø¶Ø±</th>
                                <th>ØºÛŒØ± Ø­Ø§Ø¶Ø±</th>
                                <th>ØªØ§Ø®ÛŒØ±</th>
                                <th>Ø±Ø®ØµØª</th>
                                <th>Ø­Ø§Ø¶Ø±ÛŒ ÙÛŒØµØ¯</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="print-attendance-report">Ù¾Ø±Ù†Ù¹ Ú©Ø±ÛŒÚº</button>
                        <button type="button" class="btn btn-success" id="export-attendance-report"
                            style="margin-right: 10px;">Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ Ú©Ø±ÛŒÚº</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="section-view" id="exams-view">
            <h2>Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h2>
            <div class="tabs">
                <div class="tab active" data-tab="exams-list">Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ú©ÛŒ ÙÛØ±Ø³Øª</div>
                <div class="tab" data-tab="add-exam">Ù†ÛŒØ§ Ø§Ù…ØªØ­Ø§Ù†</div>
                <div class="tab" data-tab="marks-entry">Ù†Ù…Ø¨Ø± Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº</div>
                <div class="tab" data-tab="result-cards">Ø±Ø²Ù„Ù¹ Ú©Ø§Ø±ÚˆØ²</div>
            </div>
            <div class="tab-content active" id="exams-list">
                <div class="table-container">
                    <table class="table" id="exams-table">
                        <thead>
                            <tr>
                                <th>Ù†Ù…Ø¨Ø±</th>
                                <th>Ø§Ù…ØªØ­Ø§Ù† Ú©Ø§ Ù†Ø§Ù…</th>
                                <th>Ø´Ø±ÙˆØ¹ ØªØ§Ø±ÛŒØ®</th>
                                <th>Ø®ØªÙ… ØªØ§Ø±ÛŒØ®</th>
                                <th>Ú©Ù„Ø§Ø³Ø²</th>
                                <th>Ø­ÛŒØ«ÛŒØª</th>
                                <th>Ø¹Ù…Ù„</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" id="add-exam">
                <div class="form-container">
                    <div class="form-title">Ù†ÛŒØ§ Ø§Ù…ØªØ­Ø§Ù† Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº</div>
                    <form id="exam-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø§Ù…ØªØ­Ø§Ù† Ú©Ø§ Ù†Ø§Ù…</label>
                                <input type="text" class="form-control" id="exam-name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù…ØªØ­Ø§Ù† Ú©ÛŒ Ù‚Ø³Ù…</label>
                                <select class="form-control" id="exam-type" required>
                                    <option value="Ù…Ø§ÛØ§Ù†Û">Ù…Ø§ÛØ§Ù†Û</option>
                                    <option value="Ø³Û Ù…Ø§ÛÛŒ">Ø³Û Ù…Ø§ÛÛŒ</option>
                                    <option value="Ø´Ø´Ù…Ø§ÛÛŒ">Ø´Ø´Ù…Ø§ÛÛŒ</option>
                                    <option value="Ø³Ø§Ù„Ø§Ù†Û">Ø³Ø§Ù„Ø§Ù†Û</option>
                                    <option value="Ø¯ÛŒÚ¯Ø±">Ø¯ÛŒÚ¯Ø±</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø´Ø±ÙˆØ¹ ØªØ§Ø±ÛŒØ®</label>
                                <input type="date" class="form-control" id="exam-start-date" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø®ØªÙ… ØªØ§Ø±ÛŒØ®</label>
                                <input type="date" class="form-control" id="exam-end-date" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ú©Ù„Ø§Ø³Ø²</label>
                                <select class="form-control" id="exam-classes" multiple required>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ù¾Ø§Ø³Ù†Ú¯ ÙÛŒØµØ¯</label>
                                <input type="number" class="form-control" id="exam-passing-percent" required min="0"
                                    max="100" value="33">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">ØªÙØµÛŒÙ„Ø§Øª</label>
                                <textarea class="form-control" id="exam-details" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">Ø§Ù…ØªØ­Ø§Ù† Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº</button>
                            <button type="reset" class="btn btn-danger" style="margin-right: 10px;">ÙØ§Ø±Ù… Ø±ÛŒ Ø³ÛŒÙ¹
                                Ú©Ø±ÛŒÚº</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="tab-content" id="marks-entry">
                <div class="form-container">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù…ØªØ­Ø§Ù†</label>
                            <select class="form-control" id="marks-exam" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„Ø§Ø³</label>
                            <select class="form-control" id="marks-class" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø³ÛŒÚ©Ø´Ù†</label>
                            <select class="form-control" id="marks-section" required>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ù…Ø¶Ù…ÙˆÙ†</label>
                            <select class="form-control" id="marks-subject" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„ Ù†Ù…Ø¨Ø±</label>
                            <input type="number" class="form-control" id="marks-total" required value="100">
                        </div>
                    </div>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="load-students-marks">Ø·Ù„Ø¨Ø§Ø¡ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº</button>
                    </div>
                </div>
                <div class="table-container" id="marks-table-container" style="display: none;">
                    <form id="marks-form">
                        <table class="table" id="marks-table">
                            <thead>
                                <tr>
                                    <th>Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø±</th>
                                    <th>Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©Ø§ Ù†Ø§Ù…</th>
                                    <th>Ø­Ø§ØµÙ„ Ú©Ø±Ø¯Û Ù†Ù…Ø¨Ø±</th>
                                    <th>ÙÛŒØµØ¯</th>
                                    <th>Ú¯Ø±ÛŒÚˆ</th>
                                    <th>Ù†ÙˆÙ¹</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">Ù†Ù…Ø¨Ø± Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="tab-content" id="result-cards">
                <div class="form-container">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø§Ù…ØªØ­Ø§Ù†</label>
                            <select class="form-control" id="result-exam" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„Ø§Ø³</label>
                            <select class="form-control" id="result-class" required>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø³ÛŒÚ©Ø´Ù†</label>
                            <select class="form-control" id="result-section" required>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="generate-result-cards">Ø±Ø²Ù„Ù¹ Ú©Ø§Ø±ÚˆØ²
                            Ø¨Ù†Ø§Ø¦ÛŒÚº</button>
                    </div>
                </div>
                <div id="result-cards-container" style="display: none;">
                </div>
            </div>
        </div>
        <div class="section-view" id="fees-view">
            <h2>ÙÛŒØ³</h2>
            <div class="tabs">
                <div class="tab active" data-tab="fee-collection">ÙÛŒØ³ Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº</div>
                <div class="tab" data-tab="fee-structure">ÙÛŒØ³ Ø³Ù¹Ø±Ú©Ú†Ø±</div>
                <div class="tab" data-tab="fee-reports">ÙÛŒØ³ Ø±Ù¾ÙˆØ±Ù¹Ø³</div>
                <div class="tab" data-tab="fee-defaulters">Ø¨Ù‚Ø§ÛŒØ§ ÙÛŒØ³ ÙˆØ§Ù„Û’</div>
            </div>
            <div class="tab-content active" id="fee-collection">
                <div class="form-container">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©ÛŒ ØªÙ„Ø§Ø´</label>
                            <input type="text" class="form-control" id="fee-student-search"
                                placeholder="Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø± ÛŒØ§ Ù†Ø§Ù… Ø³Û’ ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº">
                        </div>
                        <div class="form-group" style="flex: 0 0 auto;">
                            <label class="form-label" style="visibility: hidden;">ØªÙ„Ø§Ø´</label>
                            <button type="button" class="btn btn-primary" id="search-student-fee">ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº</button>
                        </div>
                    </div>
                </div>
                <div class="form-container" id="fee-student-details" style="display: none;">
                    <div class="form-title">Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø±</label>
                            <input type="text" class="form-control" id="fee-roll-number" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ù†Ø§Ù…</label>
                            <input type="text" class="form-control" id="fee-student-name" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„Ø§Ø³</label>
                            <input type="text" class="form-control" id="fee-class" readonly>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">ÙÛŒØ³ Ú©ÛŒÙ¹ÛŒÚ¯Ø±ÛŒ</label>
                            <input type="text" class="form-control" id="fee-category" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ù…Ø§ÛØ§Ù†Û ÙÛŒØ³</label>
                            <input type="text" class="form-control" id="fee-monthly" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø¨Ù‚Ø§ÛŒØ§ ÙÛŒØ³</label>
                            <input type="text" class="form-control" id="fee-due" readonly>
                        </div>
                    </div>
                </div>
                <div class="form-container" id="fee-payment-form" style="display: none;">
                    <div class="form-title">ÙÛŒØ³ Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº</div>
                    <form id="fee-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ù…ÛÛŒÙ†Û</label>
                                <select class="form-control" id="fee-month" required>
                                    <option value="Ø¬Ù†ÙˆØ±ÛŒ">Ø¬Ù†ÙˆØ±ÛŒ</option>
                                    <option value="ÙØ±ÙˆØ±ÛŒ">ÙØ±ÙˆØ±ÛŒ</option>
                                    <option value="Ù…Ø§Ø±Ú†">Ù…Ø§Ø±Ú†</option>
                                    <option value="Ø§Ù¾Ø±ÛŒÙ„">Ø§Ù¾Ø±ÛŒÙ„</option>
                                    <option value="Ù…Ø¦ÛŒ">Ù…Ø¦ÛŒ</option>
                                    <option value="Ø¬ÙˆÙ†">Ø¬ÙˆÙ†</option>
                                    <option value="Ø¬ÙˆÙ„Ø§Ø¦ÛŒ">Ø¬ÙˆÙ„Ø§Ø¦ÛŒ</option>
                                    <option value="Ø§Ú¯Ø³Øª">Ø§Ú¯Ø³Øª</option>
                                    <option value="Ø³ØªÙ…Ø¨Ø±">Ø³ØªÙ…Ø¨Ø±</option>
                                    <option value="Ø§Ú©ØªÙˆØ¨Ø±">Ø§Ú©ØªÙˆØ¨Ø±</option>
                                    <option value="Ù†ÙˆÙ…Ø¨Ø±">Ù†ÙˆÙ…Ø¨Ø±</option>
                                    <option value="Ø¯Ø³Ù…Ø¨Ø±">Ø¯Ø³Ù…Ø¨Ø±</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø³Ø§Ù„</label>
                                <input type="number" class="form-control" id="fee-year" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ù…Ø§ÛØ§Ù†Û ÙÛŒØ³</label>
                                <input type="number" class="form-control" id="fee-amount" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¬Ø±Ù…Ø§Ù†Û</label>
                                <input type="number" class="form-control" id="fee-fine" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø±Ø¹Ø§ÛŒØª</label>
                                <input type="number" class="form-control" id="fee-discount" value="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ú©Ù„ Ø±Ù‚Ù…</label>
                                <input type="number" class="form-control" id="fee-total" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©ÛŒ ØªØ§Ø±ÛŒØ®</label>
                                <input type="date" class="form-control" id="fee-payment-date" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©Ø§ Ø·Ø±ÛŒÙ‚Û</label>
                                <select class="form-control" id="fee-payment-method" required>
                                    <option value="Ù†Ù‚Ø¯">Ù†Ù‚Ø¯</option>
                                    <option value="Ú†ÛŒÚ©">Ú†ÛŒÚ©</option>
                                    <option value="Ø¨ÛŒÙ†Ú© Ù¹Ø±Ø§Ù†Ø³ÙØ±">Ø¨ÛŒÙ†Ú© Ù¹Ø±Ø§Ù†Ø³ÙØ±</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ù†ÙˆÙ¹</label>
                                <textarea class="form-control" id="fee-notes" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">ÙÛŒØ³ Ø¬Ù…Ø¹ Ú©Ø±ÛŒÚº</button>
                            <button type="button" class="btn btn-success" id="print-receipt"
                                style="margin-right: 10px;">Ø±Ø³ÛŒØ¯ Ù¾Ø±Ù†Ù¹ Ú©Ø±ÛŒÚº</button>
                        </div>
                    </form>
                </div>
                <div class="table-container" id="fee-history-container" style="display: none;">
                    <div class="form-title">ÙÛŒØ³ Ø¬Ù…Ø¹ Ú©Ø±Ù†Û’ Ú©ÛŒ ØªØ§Ø±ÛŒØ®</div>
                    <table class="table" id="fee-history-table">
                        <thead>
                            <tr>
                                <th>Ø±Ø³ÛŒØ¯ Ù†Ù…Ø¨Ø±</th>
                                <th>Ù…ÛÛŒÙ†Û</th>
                                <th>ØªØ§Ø±ÛŒØ®</th>
                                <th>ÙÛŒØ³</th>
                                <th>Ø¬Ø±Ù…Ø§Ù†Û</th>
                                <th>Ø±Ø¹Ø§ÛŒØª</th>
                                <th>Ú©Ù„ Ø±Ù‚Ù…</th>
                                <th>Ø¹Ù…Ù„</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" id="fee-structure">
                <div class="form-container">
                    <div class="form-title">ÙÛŒØ³ Ø³Ù¹Ø±Ú©Ú†Ø±</div>
                    <form id="fee-structure-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ú©Ù„Ø§Ø³</label>
                                <select class="form-control" id="fee-structure-class" required>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÙÛŒØ³ Ú©ÛŒÙ¹ÛŒÚ¯Ø±ÛŒ</label>
                                <select class="form-control" id="fee-structure-category" required>
                                    <option value="Ø¹Ø§Ù…">Ø¹Ø§Ù…</option>
                                    <option value="Ù…Ø³ØªØ­Ù‚">Ù…Ø³ØªØ­Ù‚</option>
                                    <option value="Ø§Ø³Ú©Ø§Ù„Ø±Ø´Ù¾">Ø§Ø³Ú©Ø§Ù„Ø±Ø´Ù¾</option>
                                    <option value="Ù…Ú©Ù…Ù„ Ù…Ø¹Ø§Ù">Ù…Ú©Ù…Ù„ Ù…Ø¹Ø§Ù</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ù…Ø§ÛØ§Ù†Û ÙÛŒØ³</label>
                                <input type="number" class="form-control" id="fee-structure-monthly" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¯Ø§Ø®Ù„Û ÙÛŒØ³</label>
                                <input type="number" class="form-control" id="fee-structure-admission" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù…ØªØ­Ø§Ù†ÛŒ ÙÛŒØ³</label>
                                <input type="number" class="form-control" id="fee-structure-exam" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ú©Ù…Ù¾ÛŒÙˆÙ¹Ø± ÙÛŒØ³</label>
                                <input type="number" class="form-control" id="fee-structure-computer">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ù¹Ø±Ø§Ù†Ø³Ù¾ÙˆØ±Ù¹ ÙÛŒØ³</label>
                                <input type="number" class="form-control" id="fee-structure-transport">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¯ÛŒÚ¯Ø± ÙÛŒØ³</label>
                                <input type="number" class="form-control" id="fee-structure-other">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">ØªÙØµÛŒÙ„Ø§Øª</label>
                                <textarea class="form-control" id="fee-structure-details" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">ÙÛŒØ³ Ø³Ù¹Ø±Ú©Ú†Ø± Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
                        </div>
                    </form>
                </div>
                <div class="table-container">
                    <table class="table" id="fee-structure-table">
                        <thead>
                            <tr>
                                <th>Ù†Ù…Ø¨Ø±</th>
                                <th>Ú©Ù„Ø§Ø³</th>
                                <th>ÙÛŒØ³ Ú©ÛŒÙ¹ÛŒÚ¯Ø±ÛŒ</th>
                                <th>Ù…Ø§ÛØ§Ù†Û ÙÛŒØ³</th>
                                <th>Ø¯Ø§Ø®Ù„Û ÙÛŒØ³</th>
                                <th>Ø§Ù…ØªØ­Ø§Ù†ÛŒ ÙÛŒØ³</th>
                                <th>Ú©Ù„ ÙÛŒØ³</th>
                                <th>Ø¹Ù…Ù„</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" id="fee-reports">
                <div class="form-container">
                    <div class="form-title">ÙÛŒØ³ Ø±Ù¾ÙˆØ±Ù¹Ø³</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø±Ù¾ÙˆØ±Ù¹ Ú©ÛŒ Ù‚Ø³Ù…</label>
                            <select class="form-control" id="fee-report-type" required>
                                <option value="daily">Ø±ÙˆØ²Ø§Ù†Û</option>
                                <option value="monthly" selected>Ù…Ø§ÛØ§Ù†Û</option>
                                <option value="yearly">Ø³Ø§Ù„Ø§Ù†Û</option>
                                <option value="class">Ú©Ù„Ø§Ø³ Ú©Û’ Ù…Ø·Ø§Ø¨Ù‚</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row" id="fee-report-date-row">
                        <div class="form-group">
                            <label class="form-label">ØªØ§Ø±ÛŒØ®</label>
                            <input type="date" class="form-control" id="fee-report-date">
                        </div>
                    </div>
                    <div class="form-row" id="fee-report-month-row">
                        <div class="form-group">
                            <label class="form-label">Ù…ÛÛŒÙ†Û</label>
                            <select class="form-control" id="fee-report-month">
                                <option value="1">Ø¬Ù†ÙˆØ±ÛŒ</option>
                                <option value="2">ÙØ±ÙˆØ±ÛŒ</option>
                                <option value="3">Ù…Ø§Ø±Ú†</option>
                                <option value="4">Ø§Ù¾Ø±ÛŒÙ„</option>
                                <option value="5">Ù…Ø¦ÛŒ</option>
                                <option value="6">Ø¬ÙˆÙ†</option>
                                <option value="7">Ø¬ÙˆÙ„Ø§Ø¦ÛŒ</option>
                                <option value="8">Ø§Ú¯Ø³Øª</option>
                                <option value="9">Ø³ØªÙ…Ø¨Ø±</option>
                                <option value="10">Ø§Ú©ØªÙˆØ¨Ø±</option>
                                <option value="11">Ù†ÙˆÙ…Ø¨Ø±</option>
                                <option value="12">Ø¯Ø³Ù…Ø¨Ø±</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø³Ø§Ù„</label>
                            <input type="number" class="form-control" id="fee-report-year">
                        </div>
                    </div>
                    <div class="form-row" id="fee-report-class-row" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„Ø§Ø³</label>
                            <select class="form-control" id="fee-report-class">
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø³ÛŒÚ©Ø´Ù†</label>
                            <select class="form-control" id="fee-report-section">
                                <option value="all">ØªÙ…Ø§Ù…</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="generate-fee-report">Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ø¦ÛŒÚº</button>
                    </div>
                </div>
                <div class="form-container" id="fee-report-summary" style="display: none;">
                    <div class="form-title">Ø±Ù¾ÙˆØ±Ù¹ Ø³Ù…Ø±ÛŒ</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„ Ø¬Ù…Ø¹ ÙÛŒØ³</label>
                            <input type="text" class="form-control" id="fee-report-total-collected" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„ Ø·Ù„Ø¨Ø§Ø¡</label>
                            <input type="text" class="form-control" id="fee-report-total-students" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ÙÛŒØ³ Ø¬Ù…Ø¹ Ú©Ø±Ù†Û’ ÙˆØ§Ù„Û’ Ø·Ù„Ø¨Ø§Ø¡</label>
                            <input type="text" class="form-control" id="fee-report-paid-students" readonly>
                        </div>
                    </div>
                </div>
                <div class="table-container" id="fee-report-table-container" style="display: none;">
                    <table class="table" id="fee-report-table">
                        <thead>
                            <tr>
                                <th>Ø±Ø³ÛŒØ¯ Ù†Ù…Ø¨Ø±</th>
                                <th>Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©Ø§ Ù†Ø§Ù…</th>
                                <th>Ú©Ù„Ø§Ø³</th>
                                <th>Ù…ÛÛŒÙ†Û</th>
                                <th>ØªØ§Ø±ÛŒØ®</th>
                                <th>ÙÛŒØ³</th>
                                <th>Ø¬Ø±Ù…Ø§Ù†Û</th>
                                <th>Ø±Ø¹Ø§ÛŒØª</th>
                                <th>Ú©Ù„ Ø±Ù‚Ù…</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="print-fee-report">Ù¾Ø±Ù†Ù¹ Ú©Ø±ÛŒÚº</button>
                        <button type="button" class="btn btn-success" id="export-fee-report"
                            style="margin-right: 10px;">Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ Ú©Ø±ÛŒÚº</button>
                    </div>
                </div>
            </div>
            <div class="tab-content" id="fee-defaulters">
                <div class="form-container">
                    <div class="form-title">Ø¨Ù‚Ø§ÛŒØ§ ÙÛŒØ³ ÙˆØ§Ù„Û’ Ø·Ù„Ø¨Ø§Ø¡</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„Ø§Ø³</label>
                            <select class="form-control" id="defaulter-class">
                                <option value="all">ØªÙ…Ø§Ù… Ú©Ù„Ø§Ø³Ø²</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ù…ÛÛŒÙ†Û</label>
                            <select class="form-control" id="defaulter-month">
                                <option value="1">Ø¬Ù†ÙˆØ±ÛŒ</option>
                                <option value="2">ÙØ±ÙˆØ±ÛŒ</option>
                                <option value="3">Ù…Ø§Ø±Ú†</option>
                                <option value="4">Ø§Ù¾Ø±ÛŒÙ„</option>
                                <option value="5">Ù…Ø¦ÛŒ</option>
                                <option value="6">Ø¬ÙˆÙ†</option>
                                <option value="7">Ø¬ÙˆÙ„Ø§Ø¦ÛŒ</option>
                                <option value="8">Ø§Ú¯Ø³Øª</option>
                                <option value="9">Ø³ØªÙ…Ø¨Ø±</option>
                                <option value="10">Ø§Ú©ØªÙˆØ¨Ø±</option>
                                <option value="11">Ù†ÙˆÙ…Ø¨Ø±</option>
                                <option value="12">Ø¯Ø³Ù…Ø¨Ø±</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø³Ø§Ù„</label>
                            <input type="number" class="form-control" id="defaulter-year">
                        </div>
                    </div>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="generate-defaulters">Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ø¦ÛŒÚº</button>
                    </div>
                </div>
                <div class="table-container" id="defaulters-table-container" style="display: none;">
                    <table class="table" id="defaulters-table">
                        <thead>
                            <tr>
                                <th>Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø±</th>
                                <th>Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©Ø§ Ù†Ø§Ù…</th>
                                <th>Ú©Ù„Ø§Ø³</th>
                                <th>Ù…Ø§ÛØ§Ù†Û ÙÛŒØ³</th>
                                <th>Ø¨Ù‚Ø§ÛŒØ§ Ù…ÛÛŒÙ†Û’</th>
                                <th>Ú©Ù„ Ø¨Ù‚Ø§ÛŒØ§ Ø±Ù‚Ù…</th>
                                <th>Ø±Ø§Ø¨Ø·Û Ù†Ù…Ø¨Ø±</th>
                                <th>Ø¹Ù…Ù„</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="print-defaulters">Ù¾Ø±Ù†Ù¹ Ú©Ø±ÛŒÚº</button>
                        <button type="button" class="btn btn-success" id="send-reminders"
                            style="margin-right: 10px;">ÛŒØ§Ø¯Ø¯ÛØ§Ù†ÛŒ Ø¨Ú¾ÛŒØ¬ÛŒÚº</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="section-view" id="salaries-view">
            <h2>ØªÙ†Ø®ÙˆØ§ÛÛŒÚº</h2>
            <div class="tabs">
                <div class="tab active" data-tab="salary-payment">ØªÙ†Ø®ÙˆØ§Û Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</div>
                <div class="tab" data-tab="salary-structure">ØªÙ†Ø®ÙˆØ§Û Ø³Ù¹Ø±Ú©Ú†Ø±</div>
                <div class="tab" data-tab="salary-reports">ØªÙ†Ø®ÙˆØ§Û Ø±Ù¾ÙˆØ±Ù¹Ø³</div>
            </div>
            <div class="tab-content active" id="salary-payment">
                <div class="form-container">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ù…Ù„Ø§Ø²Ù… Ú©ÛŒ Ù‚Ø³Ù…</label>
                            <select class="form-control" id="salary-employee-type" required>
                                <option value="teacher">Ø§Ø³ØªØ§Ø¯</option>
                                <option value="staff">Ø¹Ù…Ù„Û</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ù…Ù„Ø§Ø²Ù… Ú©ÛŒ ØªÙ„Ø§Ø´</label>
                            <input type="text" class="form-control" id="salary-employee-search"
                                placeholder="Ù†Ø§Ù… ÛŒØ§ Ø´Ù†Ø§Ø®ØªÛŒ Ù†Ù…Ø¨Ø± Ø³Û’ ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº">
                        </div>
                        <div class="form-group" style="flex: 0 0 auto;">
                            <label class="form-label" style="visibility: hidden;">ØªÙ„Ø§Ø´</label>
                            <button type="button" class="btn btn-primary" id="search-employee-salary">ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº</button>
                        </div>
                    </div>
                </div>
                <div class="form-container" id="salary-employee-details" style="display: none;">
                    <div class="form-title">Ù…Ù„Ø§Ø²Ù… Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø´Ù†Ø§Ø®ØªÛŒ Ù†Ù…Ø¨Ø±</label>
                            <input type="text" class="form-control" id="salary-employee-id" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ù†Ø§Ù…</label>
                            <input type="text" class="form-control" id="salary-employee-name" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø¹ÛØ¯Û</label>
                            <input type="text" class="form-control" id="salary-employee-designation" readonly>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø¨Ù†ÛŒØ§Ø¯ÛŒ ØªÙ†Ø®ÙˆØ§Û</label>
                            <input type="text" class="form-control" id="salary-basic" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø§Ø¤Ù†Ø³Ø²</label>
                            <input type="text" class="form-control" id="salary-allowances" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„ ØªÙ†Ø®ÙˆØ§Û</label>
                            <input type="text" class="form-control" id="salary-total" readonly>
                        </div>
                    </div>
                </div>
                <div class="form-container" id="salary-payment-form" style="display: none;">
                    <div class="form-title">ØªÙ†Ø®ÙˆØ§Û Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</div>
                    <form id="salary-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ù…ÛÛŒÙ†Û</label>
                                <select class="form-control" id="salary-month" required>
                                    <option value="Ø¬Ù†ÙˆØ±ÛŒ">Ø¬Ù†ÙˆØ±ÛŒ</option>
                                    <option value="ÙØ±ÙˆØ±ÛŒ">ÙØ±ÙˆØ±ÛŒ</option>
                                    <option value="Ù…Ø§Ø±Ú†">Ù…Ø§Ø±Ú†</option>
                                    <option value="Ø§Ù¾Ø±ÛŒÙ„">Ø§Ù¾Ø±ÛŒÙ„</option>
                                    <option value="Ù…Ø¦ÛŒ">Ù…Ø¦ÛŒ</option>
                                    <option value="Ø¬ÙˆÙ†">Ø¬ÙˆÙ†</option>
                                    <option value="Ø¬ÙˆÙ„Ø§Ø¦ÛŒ">Ø¬ÙˆÙ„Ø§Ø¦ÛŒ</option>
                                    <option value="Ø§Ú¯Ø³Øª">Ø§Ú¯Ø³Øª</option>
                                    <option value="Ø³ØªÙ…Ø¨Ø±">Ø³ØªÙ…Ø¨Ø±</option>
                                    <option value="Ø§Ú©ØªÙˆØ¨Ø±">Ø§Ú©ØªÙˆØ¨Ø±</option>
                                    <option value="Ù†ÙˆÙ…Ø¨Ø±">Ù†ÙˆÙ…Ø¨Ø±</option>
                                    <option value="Ø¯Ø³Ù…Ø¨Ø±">Ø¯Ø³Ù…Ø¨Ø±</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø³Ø§Ù„</label>
                                <input type="number" class="form-control" id="salary-year" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø¨Ù†ÛŒØ§Ø¯ÛŒ ØªÙ†Ø®ÙˆØ§Û</label>
                                <input type="number" class="form-control" id="salary-payment-basic" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ù„Ø§Ø¤Ù†Ø³Ø²</label>
                                <input type="number" class="form-control" id="salary-payment-allowances">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø¨ÙˆÙ†Ø³</label>
                                <input type="number" class="form-control" id="salary-payment-bonus" value="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ú©Ù¹ÙˆØªÛŒØ§Úº</label>
                                <input type="number" class="form-control" id="salary-payment-deductions" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ØºÛŒØ± Ø­Ø§Ø¶Ø±ÛŒ Ú©Ù¹ÙˆØªÛŒ</label>
                                <input type="number" class="form-control" id="salary-payment-absence" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ù¹ÛŒÚ©Ø³</label>
                                <input type="number" class="form-control" id="salary-payment-tax" value="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ú©Ù„ Ù‚Ø§Ø¨Ù„ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</label>
                                <input type="number" class="form-control" id="salary-payment-total" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©ÛŒ ØªØ§Ø±ÛŒØ®</label>
                                <input type="date" class="form-control" id="salary-payment-date" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©Ø§ Ø·Ø±ÛŒÙ‚Û</label>
                                <select class="form-control" id="salary-payment-method" required>
                                    <option value="Ù†Ù‚Ø¯">Ù†Ù‚Ø¯</option>
                                    <option value="Ú†ÛŒÚ©">Ú†ÛŒÚ©</option>
                                    <option value="Ø¨ÛŒÙ†Ú© Ù¹Ø±Ø§Ù†Ø³ÙØ±">Ø¨ÛŒÙ†Ú© Ù¹Ø±Ø§Ù†Ø³ÙØ±</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ù¹Ø±Ø§Ù†Ø²ÛŒÚ©Ø´Ù† Ø¢Ø¦ÛŒ ÚˆÛŒ/Ú†ÛŒÚ© Ù†Ù…Ø¨Ø±</label>
                                <input type="text" class="form-control" id="salary-payment-transaction">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ù†ÙˆÙ¹</label>
                                <textarea class="form-control" id="salary-payment-notes" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">ØªÙ†Ø®ÙˆØ§Û Ø§Ø¯Ø§ Ú©Ø±ÛŒÚº</button>
                            <button type="button" class="btn btn-success" id="print-salary-slip"
                                style="margin-right: 10px;">Ø³ÛŒÙ„Ø±ÛŒ Ø³Ù„Ù¾ Ù¾Ø±Ù†Ù¹ Ú©Ø±ÛŒÚº</button>
                        </div>
                    </form>
                </div>
                <div class="table-container" id="salary-history-container" style="display: none;">
                    <div class="form-title">ØªÙ†Ø®ÙˆØ§Û Ú©ÛŒ ØªØ§Ø±ÛŒØ®</div>
                    <table class="table" id="salary-history-table">
                        <thead>
                            <tr>
                                <th>ÙˆØ¤Ú†Ø± Ù†Ù…Ø¨Ø±</th>
                                <th>Ù…ÛÛŒÙ†Û</th>
                                <th>ØªØ§Ø±ÛŒØ®</th>
                                <th>Ø¨Ù†ÛŒØ§Ø¯ÛŒ ØªÙ†Ø®ÙˆØ§Û</th>
                                <th>Ø§Ù„Ø§Ø¤Ù†Ø³Ø²</th>
                                <th>Ú©Ù¹ÙˆØªÛŒØ§Úº</th>
                                <th>Ú©Ù„ ØªÙ†Ø®ÙˆØ§Û</th>
                                <th>Ø¹Ù…Ù„</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" id="salary-structure">
                <div class="form-container">
                    <div class="form-title">ØªÙ†Ø®ÙˆØ§Û Ø³Ù¹Ø±Ú©Ú†Ø±</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ù…Ù„Ø§Ø²Ù… Ú©ÛŒ Ù‚Ø³Ù…</label>
                            <select class="form-control" id="structure-employee-type" required>
                                <option value="teacher">Ø§Ø³ØªØ§Ø¯</option>
                                <option value="staff">Ø¹Ù…Ù„Û</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ù…Ù„Ø§Ø²Ù…</label>
                            <select class="form-control" id="structure-employee" required>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø¨Ù†ÛŒØ§Ø¯ÛŒ ØªÙ†Ø®ÙˆØ§Û</label>
                            <input type="number" class="form-control" id="structure-basic-salary" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ú¯Ú¾Ø± Ú©Ø±Ø§ÛŒÛ Ø§Ù„Ø§Ø¤Ù†Ø³</label>
                            <input type="number" class="form-control" id="structure-house-rent">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ù¹Ø±Ø§Ù†Ø³Ù¾ÙˆØ±Ù¹ Ø§Ù„Ø§Ø¤Ù†Ø³</label>
                            <input type="number" class="form-control" id="structure-transport">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ù…ÛŒÚˆÛŒÚ©Ù„ Ø§Ù„Ø§Ø¤Ù†Ø³</label>
                            <input type="number" class="form-control" id="structure-medical">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø¯ÛŒÚ¯Ø± Ø§Ù„Ø§Ø¤Ù†Ø³Ø²</label>
                            <input type="number" class="form-control" id="structure-other-allowances">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„ ØªÙ†Ø®ÙˆØ§Û</label>
                            <input type="number" class="form-control" id="structure-total-salary" readonly>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ù…Ø³ØªÙ‚Ù„ Ú©Ù¹ÙˆØªÛŒØ§Úº</label>
                            <input type="number" class="form-control" id="structure-deductions">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ØªÙØµÛŒÙ„Ø§Øª</label>
                            <textarea class="form-control" id="structure-details" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="save-salary-structure">ØªÙ†Ø®ÙˆØ§Û Ø³Ù¹Ø±Ú©Ú†Ø± Ù…Ø­ÙÙˆØ¸
                            Ú©Ø±ÛŒÚº</button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table" id="salary-structure-table">
                        <thead>
                            <tr>
                                <th>Ù†Ù…Ø¨Ø±</th>
                                <th>Ù…Ù„Ø§Ø²Ù… Ú©Ø§ Ù†Ø§Ù…</th>
                                <th>Ø¹ÛØ¯Û</th>
                                <th>Ø¨Ù†ÛŒØ§Ø¯ÛŒ ØªÙ†Ø®ÙˆØ§Û</th>
                                <th>Ø§Ù„Ø§Ø¤Ù†Ø³Ø²</th>
                                <th>Ú©Ù¹ÙˆØªÛŒØ§Úº</th>
                                <th>Ú©Ù„ ØªÙ†Ø®ÙˆØ§Û</th>
                                <th>Ø¹Ù…Ù„</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" id="salary-reports">
                <div class="form-container">
                    <div class="form-title">ØªÙ†Ø®ÙˆØ§Û Ø±Ù¾ÙˆØ±Ù¹Ø³</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø±Ù¾ÙˆØ±Ù¹ Ú©ÛŒ Ù‚Ø³Ù…</label>
                            <select class="form-control" id="salary-report-type" required>
                                <option value="monthly" selected>Ù…Ø§ÛØ§Ù†Û</option>
                                <option value="yearly">Ø³Ø§Ù„Ø§Ù†Û</option>
                                <option value="employee">Ù…Ù„Ø§Ø²Ù… Ú©Û’ Ù…Ø·Ø§Ø¨Ù‚</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ù…Ù„Ø§Ø²Ù… Ú©ÛŒ Ù‚Ø³Ù…</label>
                            <select class="form-control" id="salary-report-employee-type">
                                <option value="all">ØªÙ…Ø§Ù…</option>
                                <option value="teacher">Ø§Ø³Ø§ØªØ°Û</option>
                                <option value="staff">Ø¹Ù…Ù„Û</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row" id="salary-report-month-row">
                        <div class="form-group">
                            <label class="form-label">Ù…ÛÛŒÙ†Û</label>
                            <select class="form-control" id="salary-report-month">
                                <option value="1">Ø¬Ù†ÙˆØ±ÛŒ</option>
                                <option value="2">ÙØ±ÙˆØ±ÛŒ</option>
                                <option value="3">Ù…Ø§Ø±Ú†</option>
                                <option value="4">Ø§Ù¾Ø±ÛŒÙ„</option>
                                <option value="5">Ù…Ø¦ÛŒ</option>
                                <option value="6">Ø¬ÙˆÙ†</option>
                                <option value="7">Ø¬ÙˆÙ„Ø§Ø¦ÛŒ</option>
                                <option value="8">Ø§Ú¯Ø³Øª</option>
                                <option value="9">Ø³ØªÙ…Ø¨Ø±</option>
                                <option value="10">Ø§Ú©ØªÙˆØ¨Ø±</option>
                                <option value="11">Ù†ÙˆÙ…Ø¨Ø±</option>
                                <option value="12">Ø¯Ø³Ù…Ø¨Ø±</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø³Ø§Ù„</label>
                            <input type="number" class="form-control" id="salary-report-year">
                        </div>
                    </div>
                    <div class="form-row" id="salary-report-employee-row" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">Ù…Ù„Ø§Ø²Ù…</label>
                            <select class="form-control" id="salary-report-employee">
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="generate-salary-report">Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ø¦ÛŒÚº</button>
                    </div>
                </div>
                <div class="form-container" id="salary-report-summary" style="display: none;">
                    <div class="form-title">Ø±Ù¾ÙˆØ±Ù¹ Ø³Ù…Ø±ÛŒ</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„ Ø§Ø¯Ø§ Ú©Ø±Ø¯Û ØªÙ†Ø®ÙˆØ§Û</label>
                            <input type="text" class="form-control" id="salary-report-total-paid" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ú©Ù„ Ù…Ù„Ø§Ø²Ù…ÛŒÙ†</label>
                            <input type="text" class="form-control" id="salary-report-total-employees" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ØªÙ†Ø®ÙˆØ§Û ÙˆØµÙˆÙ„ Ú©Ø±Ù†Û’ ÙˆØ§Ù„Û’ Ù…Ù„Ø§Ø²Ù…ÛŒÙ†</label>
                            <input type="text" class="form-control" id="salary-report-paid-employees" readonly>
                        </div>
                    </div>
                </div>
                <div class="table-container" id="salary-report-table-container" style="display: none;">
                    <table class="table" id="salary-report-table">
                        <thead>
                            <tr>
                                <th>ÙˆØ¤Ú†Ø± Ù†Ù…Ø¨Ø±</th>
                                <th>Ù…Ù„Ø§Ø²Ù… Ú©Ø§ Ù†Ø§Ù…</th>
                                <th>Ø¹ÛØ¯Û</th>
                                <th>Ù…ÛÛŒÙ†Û</th>
                                <th>ØªØ§Ø±ÛŒØ®</th>
                                <th>Ø¨Ù†ÛŒØ§Ø¯ÛŒ ØªÙ†Ø®ÙˆØ§Û</th>
                                <th>Ø§Ù„Ø§Ø¤Ù†Ø³Ø²</th>
                                <th>Ú©Ù¹ÙˆØªÛŒØ§Úº</th>
                                <th>Ú©Ù„ ØªÙ†Ø®ÙˆØ§Û</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="print-salary-report">Ù¾Ø±Ù†Ù¹ Ú©Ø±ÛŒÚº</button>
                        <button type="button" class="btn btn-success" id="export-salary-report"
                            style="margin-right: 10px;">Ø§ÛŒÚ©Ø³Ù¾ÙˆØ±Ù¹ Ú©Ø±ÛŒÚº</button>
                        <select class="form-control" id="auto-backup-frequency" required>
                            <option value="daily">Ø±ÙˆØ²Ø§Ù†Û</option>
                            <option value="weekly">ÛÙØªÛ ÙˆØ§Ø±</option>
                            <option value="monthly" selected>Ù…Ø§ÛØ§Ù†Û</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ø¨ÛŒÚ© Ø§Ù¾ Ø±Ú©Ú¾Ù†Û’ Ú©ÛŒ Ù…Ø¯Øª</label>
                        <select class="form-control" id="auto-backup-retention" required>
                            <option value="1">1 Ù…ÛÛŒÙ†Û</option>
                            <option value="3" selected>3 Ù…ÛÛŒÙ†Û’</option>
                            <option value="6">6 Ù…ÛÛŒÙ†Û’</option>
                            <option value="12">1 Ø³Ø§Ù„</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <button type="button" class="btn btn-primary" id="save-auto-backup">ØªØ±ØªÛŒØ¨Ø§Øª Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
                </div>
            </div>
        </div>
        <div class="section-view" id="backup-view">
            <h2>Ø¨ÛŒÚ© Ø§Ù¾ Ø§ÙˆØ± Ø¨Ø­Ø§Ù„ÛŒ</h2>
            <div class="form-container no-print">
                <div class="form-title">Ø¯Ø³ØªÛŒ Ø¨ÛŒÚ© Ø§Ù¾</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Ø¨ÛŒÚ© Ø§Ù¾ Ú©ÛŒ Ù‚Ø³Ù…</label>
                        <select class="form-control" id="backup-type">
                            <option value="full">Ù…Ú©Ù…Ù„ Ø¨ÛŒÚ© Ø§Ù¾</option>
                            <option value="students">ØµØ±Ù Ø·Ù„Ø¨Ø§Ø¡</option>
                            <option value="teachers">ØµØ±Ù Ø§Ø³Ø§ØªØ°Û</option>
                            <option value="staff">ØµØ±Ù Ø¹Ù…Ù„Û</option>
                            <option value="fees">ØµØ±Ù ÙÛŒØ³</option>
                            <option value="salaries">ØµØ±Ù ØªÙ†Ø®ÙˆØ§ÛÛŒÚº</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ø¨ÛŒÚ© Ø§Ù¾ ÙØ§Ø±Ù…ÛŒÙ¹</label>
                        <select class="form-control" id="backup-format">
                            <option value="json">JSON</option>
                        </select>
                    </div>
                    <div class="form-group" style="align-self: flex-end;">
                        <button type="button" class="btn btn-primary" id="create-backup">Ø¨ÛŒÚ© Ø§Ù¾ Ø¨Ù†Ø§Ø¦ÛŒÚº</button>
                    </div>
                </div>
            </div>
            <div class="form-container no-print">
                <div class="form-title">ÚˆÛŒÙ¹Ø§ Ø¨Ø­Ø§Ù„ Ú©Ø±ÛŒÚº</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Ø¨ÛŒÚ© Ø§Ù¾ ÙØ§Ø¦Ù„ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</label>
                        <input type="file" class="form-control" id="restore-file" accept=".json">
                    </div>
                    <div class="form-group" style="align-self: flex-end;">
                        <button type="button" class="btn btn-danger" id="restore-backup">ÚˆÛŒÙ¹Ø§ Ø¨Ø­Ø§Ù„ Ú©Ø±ÛŒÚº</button>
                    </div>
                </div>
            </div>
            <div class="form-container no-print">
                <div class="form-title">Ø¢Ù¹ÙˆÙ…ÛŒÙ¹Ú© Ø¨ÛŒÚ© Ø§Ù¾ ØªØ±ØªÛŒØ¨Ø§Øª</div>
                <div class="form-row">
                    <div class="form-group" style="flex: 0 0 auto; align-items: center; display: flex;">
                        <input type="checkbox" id="auto-backup-enable"
                            style="width: 20px; height: 20px; margin-left: 10px;">
                        <label class="form-label" for="auto-backup-enable" style="margin-bottom: 0;">Ø¢Ù¹ÙˆÙ…ÛŒÙ¹Ú© Ø¨ÛŒÚ© Ø§Ù¾ ÙØ¹Ø§Ù„
                            Ú©Ø±ÛŒÚº</label>
                    </div>
                </div>
                <div id="auto-backup-options" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ø¨ÛŒÚ© Ø§Ù¾ Ú©ÛŒ ÙØ±ÛŒÚ©ÙˆØ¦Ù†Ø³ÛŒ</label>
                            <select class="form-control" id="auto-backup-frequency" required>
                                <option value="daily">Ø±ÙˆØ²Ø§Ù†Û</option>
                                <option value="weekly">ÛÙØªÛ ÙˆØ§Ø±</option>
                                <option value="monthly" selected>Ù…Ø§ÛØ§Ù†Û</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø¨ÛŒÚ© Ø§Ù¾ Ø±Ú©Ú¾Ù†Û’ Ú©ÛŒ Ù…Ø¯Øª</label>
                            <select class="form-control" id="auto-backup-retention" required>
                                <option value="1">1 Ù…ÛÛŒÙ†Û</option>
                                <option value="3" selected>3 Ù…ÛÛŒÙ†Û’</option>
                                <option value="6">6 Ù…ÛÛŒÙ†Û’</option>
                                <option value="12">1 Ø³Ø§Ù„</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="save-auto-backup">ØªØ±ØªÛŒØ¨Ø§Øª Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
                    </div>
                </div>
            </div>
            <div class="table-container">
                <div class="form-title">Ø¨ÛŒÚ© Ø§Ù¾ ØªØ§Ø±ÛŒØ®</div>
                <table class="table" id="backup-history-table">
                    <thead>
                        <tr>
                            <th>Ù†Ù…Ø¨Ø±</th>
                            <th>ØªØ§Ø±ÛŒØ®</th>
                            <th>ÙˆÙ‚Øª</th>
                            <th>Ù‚Ø³Ù…</th>
                            <th>Ø³Ø§Ø¦Ø²</th>
                            <th>Ø¹Ù…Ù„</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="section-view" id="library-view">
            <h2>Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒ</h2>
            <div class="tabs">
                <div class="tab active" data-tab="books-list">Ú©ØªØ§Ø¨ÙˆÚº Ú©ÛŒ ÙÛØ±Ø³Øª</div>
                <div class="tab" data-tab="add-book">Ù†Ø¦ÛŒ Ú©ØªØ§Ø¨</div>
                <div class="tab" data-tab="issue-book">Ú©ØªØ§Ø¨ Ø¬Ø§Ø±ÛŒ Ú©Ø±ÛŒÚº</div>
                <div class="tab" data-tab="return-book">Ú©ØªØ§Ø¨ ÙˆØ§Ù¾Ø³</div>
            </div>
            <div class="tab-content active" id="books-list">
                <div class="table-container">
                    <table class="table" id="books-table">
                        <thead>
                            <tr>
                                <th>Ú©ØªØ§Ø¨ Ø¢Ø¦ÛŒ ÚˆÛŒ</th>
                                <th>Ú©ØªØ§Ø¨ Ú©Ø§ Ù†Ø§Ù…</th>
                                <th>Ù…ØµÙ†Ù</th>
                                <th>Ú©ÛŒÙ¹ÛŒÚ¯Ø±ÛŒ</th>
                                <th>Ø¯Ø³ØªÛŒØ§Ø¨</th>
                                <th>Ø¹Ù…Ù„</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" id="add-book">
                <div class="form-container">
                    <div class="form-title">Ù†Ø¦ÛŒ Ú©ØªØ§Ø¨ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</div>
                    <form id="book-form">
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Ú©ØªØ§Ø¨ Ú©Ø§ Ù†Ø§Ù…</label><input type="text"
                                    class="form-control" id="book-name" required></div>
                            <div class="form-group"><label class="form-label">Ù…ØµÙ†Ù</label><input type="text"
                                    class="form-control" id="book-author" required></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Ú©ÛŒÙ¹ÛŒÚ¯Ø±ÛŒ</label><input type="text"
                                    class="form-control" id="book-category" required></div>
                            <div class="form-group"><label class="form-label">ISBN</label><input type="text"
                                    class="form-control" id="book-isbn"></div>
                        </div>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">Ú©ØªØ§Ø¨ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="tab-content" id="issue-book">
                <div class="form-container">
                    <div class="form-title">Ú©ØªØ§Ø¨ Ø¬Ø§Ø±ÛŒ Ú©Ø±ÛŒÚº</div>
                    <form id="issue-form">
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Ú©ØªØ§Ø¨</label><select class="form-control"
                                    id="issue-book-select" required></select></div>
                            <div class="form-group"><label class="form-label">Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù…</label><select
                                    class="form-control" id="issue-student-select" required></select></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Ø¬Ø§Ø±ÛŒ Ú©Ø±Ù†Û’ Ú©ÛŒ ØªØ§Ø±ÛŒØ®</label><input
                                    type="date" class="form-control" id="issue-date" required></div>
                            <div class="form-group"><label class="form-label">ÙˆØ§Ù¾Ø³ÛŒ Ú©ÛŒ ØªØ§Ø±ÛŒØ®</label><input type="date"
                                    class="form-control" id="return-due-date" required></div>
                        </div>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">Ú©ØªØ§Ø¨ Ø¬Ø§Ø±ÛŒ Ú©Ø±ÛŒÚº</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="tab-content" id="return-book">
                <div class="form-container">
                    <div class="form-title">Ú©ØªØ§Ø¨ ÙˆØ§Ù¾Ø³ Ú©Ø±ÛŒÚº</div>
                    <form id="return-form">
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Ø¬Ø§Ø±ÛŒ Ø´Ø¯Û Ú©ØªØ§Ø¨ÛŒÚº</label><select
                                    class="form-control" id="return-book-select" required></select></div>
                            <div class="form-group"><label class="form-label">ÙˆØ§Ù¾Ø³ÛŒ Ú©ÛŒ ØªØ§Ø±ÛŒØ®</label><input type="date"
                                    class="form-control" id="actual-return-date" required></div>
                        </div>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">Ú©ØªØ§Ø¨ ÙˆØ§Ù¾Ø³ Ú©Ø±ÛŒÚº</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="section-view" id="users-view">
            <h2>ØµØ§Ø±ÙÛŒÙ† Ø§ÙˆØ± Ø±ÙˆÙ„Ø²</h2>
            <div class="tabs">
                <div class="tab active" data-tab="users-list">ØµØ§Ø±ÙÛŒÙ† Ú©ÛŒ ÙÛØ±Ø³Øª</div>
                <div class="tab" data-tab="add-user">Ù†ÛŒØ§ ØµØ§Ø±Ù</div>
                <div class="tab" data-tab="user-roles">ØµØ§Ø±ÙÛŒÙ† Ú©Û’ Ø±ÙˆÙ„Ø²</div>
            </div>
            <div class="tab-content active" id="users-list">
                <div class="table-container">
                    <table class="table" id="users-table">
                        <thead>
                            <tr>
                                <th>ØµØ§Ø±Ù Ù†Ø§Ù…</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>Ø§ÛŒ Ù…ÛŒÙ„</th>
                                <th>Ø±ÙˆÙ„</th>
                                <th>Ø­ÛŒØ«ÛŒØª</th>
                                <th>Ø¹Ù…Ù„</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" id="add-user">
                <div class="form-container">
                    <div class="form-title">Ù†ÛŒØ§ ØµØ§Ø±Ù Ø¨Ù†Ø§Ø¦ÛŒÚº</div>
                    <form id="user-form">
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Ù†Ø§Ù…</label><input type="text"
                                    class="form-control" id="user-name" required></div>
                            <div class="form-group"><label class="form-label">ØµØ§Ø±Ù Ù†Ø§Ù…</label><input type="text"
                                    class="form-control" id="user-username" required></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Ù¾Ø§Ø³ ÙˆØ±Úˆ</label><input type="password"
                                    class="form-control" id="user-password" required></div>
                            <div class="form-group"><label class="form-label">Ù¾Ø§Ø³ ÙˆØ±Úˆ Ú©ÛŒ ØªØµØ¯ÛŒÙ‚</label><input
                                    type="password" class="form-control" id="user-confirm-password" required></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Ø§ÛŒ Ù…ÛŒÙ„</label><input type="email"
                                    class="form-control" id="user-email" required></div>
                            <div class="form-group"><label class="form-label">Ù…ÙˆØ¨Ø§Ø¦Ù„</label><input type="tel"
                                    class="form-control" id="user-mobile"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Ø±ÙˆÙ„</label>
                                <select class="form-control" id="user-role" required>
                                    <option value="admin">Ø§ÛŒÚˆÙ…Ù†</option>
                                    <option value="teacher">Ø§Ø³ØªØ§Ø¯</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ø­ÛŒØ«ÛŒØª</label>
                                <select class="form-control" id="user-status" required>
                                    <option value="active">ÙØ¹Ø§Ù„</option>
                                    <option value="inactive">ØºÛŒØ± ÙØ¹Ø§Ù„</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row"><button type="submit" class="btn btn-primary">ØµØ§Ø±Ù Ø¨Ù†Ø§Ø¦ÛŒÚº</button></div>
                    </form>
                </div>
            </div>
            <div class="tab-content" id="user-roles">
                <div class="form-container">
                    <div class="form-title">Ù†ÛŒØ§ Ø±ÙˆÙ„ Ø¨Ù†Ø§Ø¦ÛŒÚº</div>
                    <form id="role-form">
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Ø±ÙˆÙ„ Ú©Ø§ Ù†Ø§Ù…</label><input type="text"
                                    class="form-control" id="role-name" required></div>
                            <div class="form-group"><label class="form-label">ØªÙØµÛŒÙ„</label><input type="text"
                                    class="form-control" id="role-description"></div>
                        </div>
                        <div class="form-row"><button type="submit" class="btn btn-primary">Ø±ÙˆÙ„ Ø¨Ù†Ø§Ø¦ÛŒÚº</button></div>
                    </form>
                </div>
                <div class="table-container">
                    <table class="table" id="roles-table">
                        <thead>
                            <tr>
                                <th>Ø±ÙˆÙ„ Ù†Ø§Ù…</th>
                                <th>ØªÙØµÛŒÙ„</th>
                                <th>Ø¹Ù…Ù„</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="section-view" id="reports-view">
            <h2>Ø±Ù¾ÙˆØ±Ù¹Ø³</h2>
            <div class="tabs">
                <div class="tab active" data-tab="student-reports">Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ Ø±Ù¾ÙˆØ±Ù¹Ø³</div>
                <div class="tab" data-tab="fee-reports-tab">ÙÛŒØ³ Ø±Ù¾ÙˆØ±Ù¹Ø³</div>
                <div class="tab" data-tab="attendance-reports-tab">Ø­Ø§Ø¶Ø±ÛŒ Ø±Ù¾ÙˆØ±Ù¹Ø³</div>
            </div>
            <div class="tab-content active" id="student-reports">
                <div class="form-container">
                    <div class="form-title">Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ Ø±Ù¾ÙˆØ±Ù¹</div>
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">Ú©Ù„Ø§Ø³</label><select class="form-control"
                                id="report-class"></select></div>
                        <div class="form-group"><label class="form-label">Ø±Ù¾ÙˆØ±Ù¹ Ú©ÛŒ Ù‚Ø³Ù…</label><select
                                class="form-control" id="student-report-type">
                                <option value="all">ØªÙ…Ø§Ù… Ø·Ù„Ø¨Ø§Ø¡</option>
                                <option value="present">Ù…ÙˆØ¬ÙˆØ¯Û Ø·Ù„Ø¨Ø§Ø¡</option>
                            </select></div>
                    </div>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="generate-student-report">Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ø¦ÛŒÚº</button>
                    </div>
                </div>
                <div class="table-container" id="student-report-container" style="display: none;">
                    <table class="table" id="student-report-table">
                        <thead>
                            <tr>
                                <th>Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø±</th>
                                <th>Ù†Ø§Ù…</th>
                                <th>ÙˆØ§Ù„Ø¯ Ú©Ø§ Ù†Ø§Ù…</th>
                                <th>Ú©Ù„Ø§Ø³</th>
                                <th>Ø±Ø§Ø¨Ø·Û Ù†Ù…Ø¨Ø±</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="tab-content" id="fee-reports-tab">
                <div class="form-container">
                    <div class="form-title">ÙÛŒØ³ Ø±Ù¾ÙˆØ±Ù¹</div>
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">Ù…ÛÛŒÙ†Û</label><select class="form-control"
                                id="fee-report-month2">
                                <option value="1">Ø¬Ù†ÙˆØ±ÛŒ</option>
                                <option value="2">ÙØ±ÙˆØ±ÛŒ</option>
                            </select></div>
                        <div class="form-group"><label class="form-label">Ø³Ø§Ù„</label><input type="number"
                                class="form-control" id="fee-report-year2"></div>
                    </div>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="generate-fee-report2">ÙÛŒØ³ Ø±Ù¾ÙˆØ±Ù¹
                            Ø¨Ù†Ø§Ø¦ÛŒÚº</button>
                    </div>
                </div>
            </div>
            <div class="tab-content" id="attendance-reports-tab">
                <div class="form-container">
                    <div class="form-title">Ø­Ø§Ø¶Ø±ÛŒ Ø±Ù¾ÙˆØ±Ù¹</div>
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">Ú©Ù„Ø§Ø³</label><select class="form-control"
                                id="attendance-report-class2"></select></div>
                        <div class="form-group"><label class="form-label">Ù…ÛÛŒÙ†Û</label><select class="form-control"
                                id="attendance-report-month2">
                                <option value="1">Ø¬Ù†ÙˆØ±ÛŒ</option>
                            </select></div>
                    </div>
                    <div class="form-row">
                        <button type="button" class="btn btn-primary" id="generate-attendance-report2">Ø­Ø§Ø¶Ø±ÛŒ Ø±Ù¾ÙˆØ±Ù¹
                            Ø¨Ù†Ø§Ø¦ÛŒÚº</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="section-view" id="settings-view">
            <h2>ØªØ±ØªÛŒØ¨Ø§Øª</h2>
            <div class="tabs">
                <div class="tab active" data-tab="general-settings">Ø¹Ù…ÙˆÙ…ÛŒ ØªØ±ØªÛŒØ¨Ø§Øª</div>
                <div class="tab" data-tab="system-settings">Ø³Ø³Ù¹Ù… ØªØ±ØªÛŒØ¨Ø§Øª</div>
            </div>
            <div class="tab-content active" id="general-settings">
                <div class="form-container">
                    <div class="form-title">Ù…Ø¯Ø±Ø³Û Ú©ÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</div>
                    <form id="school-settings-form">
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Ù…Ø¯Ø±Ø³Û Ú©Ø§ Ù†Ø§Ù…</label><input type="text"
                                    class="form-control" id="school-name" required></div>
                            <div class="form-group"><label class="form-label">Ù¾Ø±Ù†Ø³Ù¾Ù„ Ú©Ø§ Ù†Ø§Ù…</label><input type="text"
                                    class="form-control" id="principal-name" required></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Ù¾ØªÛ</label><textarea class="form-control"
                                    id="school-address" rows="3" required></textarea></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Ø±Ø§Ø¨Ø·Û Ù†Ù…Ø¨Ø±</label><input type="tel"
                                    class="form-control" id="school-contact" required></div>
                            <div class="form-group"><label class="form-label">Ø§ÛŒ Ù…ÛŒÙ„</label><input type="email"
                                    class="form-control" id="school-email"></div>
                        </div>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">ØªØ±ØªÛŒØ¨Ø§Øª Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="tab-content" id="system-settings">
                <div class="form-container">
                    <div class="form-title">Ø³Ø³Ù¹Ù… Ú©ÛŒ ØªØ±ØªÛŒØ¨Ø§Øª</div>
                    <form id="system-settings-form">
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">ÚˆÛŒÙ¹Ø§Ø¨ÛŒØ³ Ø¨ÛŒÚ© Ø§Ù¾</label><select
                                    class="form-control" id="auto-backup-freq">
                                    <option value="daily">Ø±ÙˆØ²Ø§Ù†Û</option>
                                    <option value="weekly">ÛÙØªÛ ÙˆØ§Ø±</option>
                                </select></div>
                            <div class="form-group"><label class="form-label">Ø²Ø¨Ø§Ù†</label><select class="form-control"
                                    id="system-language">
                                    <option value="ur">Ø§Ø±Ø¯Ùˆ</option>
                                    <option value="en">Ø§Ù†Ú¯Ø±ÛŒØ²ÛŒ</option>
                                </select></div>
                        </div>
                        <div class="form-row">
                            <button type="submit" class="btn btn-primary">ØªØ±ØªÛŒØ¨Ø§Øª Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script>
        let db;
        const DB_NAME = 'DeeniMadrasaDB';
        const DB_VERSION = 1;
        const STORES = {
            STUDENTS: 'students',
            TEACHERS: 'teachers',
            STAFF: 'staff',
            CLASSES: 'classes',
            SECTIONS: 'sections',
            SUBJECTS: 'subjects',
            CLASS_SUBJECTS: 'classSubjects',
            ATTENDANCE: 'attendance',
            EXAMS: 'exams',
            MARKS: 'marks',
            FEES: 'fees',
            FEE_STRUCTURE: 'feeStructure',
            SALARY: 'salary',
            SALARY_STRUCTURE: 'salaryStructure',
            BOOKS: 'books',
            BOOK_ISSUES: 'bookIssues',
            USERS: 'users',
            ROLES: 'roles',
            SETTINGS: 'settings',
            EVENTS: 'events',
            ACTIVITIES: 'activities',
            BACKUP: 'backup'
        };
        document.addEventListener('DOMContentLoaded', function () {
            showLoading();
            openDatabase()
                .then(initializeApp)
                .catch(error => {
                    console.error('Database initialization error:', error);
                    showNotification('ÚˆÛŒÙ¹Ø§ Ø¨ÛŒØ³ Ø§Ù†Ø´ÛŒÙ„Ø§Ø¦Ø²ÛŒØ´Ù† Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
                })
                .finally(() => {
                    hideLoading();
                });
            document.getElementById('menuToggle').addEventListener('click', toggleSidebar);
            const menuItems = document.querySelectorAll('.sidebar-menu li');
            menuItems.forEach(item => {
                item.addEventListener('click', function () {
                    const viewName = this.getAttribute('data-view');
                    showView(viewName);
                });
            });
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function () {
                    const tabGroup = this.parentElement;
                    const tabContentId = this.getAttribute('data-tab');
                    tabGroup.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tabGroup.parentElement.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById(tabContentId).classList.add('active');
                });
            });
            /* document.getElementById('report-type').addEventListener('change', function () {
                const reportType = this.value;
                document.querySelectorAll('[id$="-report-filters"]').forEach(container => {
                    container.style.display = 'none';
                });
                document.getElementById(`${reportType}-report-filters`).style.display = 'flex';
            }); */
            document.getElementById('school-settings-form').addEventListener('submit', async function (e) {
                e.preventDefault();
                const existing = await getFromStore(STORES.SETTINGS, 'general') || { id: 'general' };
                const updated = {
                    ...existing,
                    schoolName: document.getElementById('school-name').value,
                    principalName: document.getElementById('principal-name').value,
                    schoolAddress: document.getElementById('school-address').value,
                    schoolPhone: document.getElementById('school-contact').value,
                    schoolEmail: document.getElementById('school-email').value,
                };
                await addToStore(STORES.SETTINGS, updated, true);
                showNotification('ØªØ±ØªÛŒØ¨Ø§Øª Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù…Ø­ÙÙˆØ¸ Ú©Ø± Ù„ÛŒ Ú¯Ø¦ÛŒÚº', 'success');
            });
            document.getElementById('system-settings-form').addEventListener('submit', async function (e) {
                e.preventDefault();
                const existing = await getFromStore(STORES.SETTINGS, 'general') || { id: 'general' };
                const updated = {
                    ...existing,
                    autoBackupFrequency: document.getElementById('auto-backup-freq').value,
                    language: document.getElementById('system-language').value,
                };
                await addToStore(STORES.SETTINGS, updated, true);
                showNotification('Ø³Ø³Ù¹Ù… ØªØ±ØªÛŒØ¨Ø§Øª Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù…Ø­ÙÙˆØ¸ Ú©Ø± Ù„ÛŒ Ú¯Ø¦ÛŒÚº', 'success');
            });
            document.getElementById('auto-backup-enable').addEventListener('change', function () {
                document.getElementById('auto-backup-options').style.display = this.checked ? 'block' : 'none';
            });
            const salaryInputs = document.querySelectorAll('#salary-payment-basic, #salary-payment-allowances, #salary-payment-bonus, #salary-payment-deductions, #salary-payment-absence, #salary-payment-tax');
            salaryInputs.forEach(input => {
                input.addEventListener('input', calculateSalaryTotal);
            });
            const feeInputs = document.querySelectorAll('#fee-amount, #fee-fine, #fee-discount');
            feeInputs.forEach(input => {
                input.addEventListener('input', calculateFeeTotal);
            });
            setupFormHandlers();
            setCurrentDateDefaults();
        });
        function openDatabase() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                request.onerror = event => {
                    reject('Database error: ' + event.target.errorCode);
                };
                request.onsuccess = event => {
                    db = event.target.result;
                    console.log('Database opened successfully');
                    resolve(db);
                };
                request.onupgradeneeded = event => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains(STORES.STUDENTS)) {
                        const studentStore = db.createObjectStore(STORES.STUDENTS, { keyPath: 'id', autoIncrement: true });
                        studentStore.createIndex('rollNumber', 'rollNumber', { unique: true });
                        studentStore.createIndex('name', 'name', { unique: false });
                        studentStore.createIndex('classId', 'classId', { unique: false });
                        studentStore.createIndex('sectionId', 'sectionId', { unique: false });
                    }
                    if (!db.objectStoreNames.contains(STORES.TEACHERS)) {
                        const teacherStore = db.createObjectStore(STORES.TEACHERS, { keyPath: 'id', autoIncrement: true });
                        teacherStore.createIndex('employeeId', 'employeeId', { unique: true });
                        teacherStore.createIndex('name', 'name', { unique: false });
                        teacherStore.createIndex('subjects', 'subjects', { unique: false, multiEntry: true });
                    }
                    if (!db.objectStoreNames.contains(STORES.STAFF)) {
                        const staffStore = db.createObjectStore(STORES.STAFF, { keyPath: 'id', autoIncrement: true });
                        staffStore.createIndex('employeeId', 'employeeId', { unique: true });
                        staffStore.createIndex('name', 'name', { unique: false });
                        staffStore.createIndex('department', 'department', { unique: false });
                    }
                    if (!db.objectStoreNames.contains(STORES.CLASSES)) {
                        const classStore = db.createObjectStore(STORES.CLASSES, { keyPath: 'id', autoIncrement: true });
                        classStore.createIndex('name', 'name', { unique: true });
                    }
                    if (!db.objectStoreNames.contains(STORES.SECTIONS)) {
                        const sectionStore = db.createObjectStore(STORES.SECTIONS, { keyPath: 'id', autoIncrement: true });
                        sectionStore.createIndex('classId', 'classId', { unique: false });
                        sectionStore.createIndex('name', 'name', { unique: false });
                        sectionStore.createIndex('classSection', ['classId', 'name'], { unique: true });
                    }
                    if (!db.objectStoreNames.contains(STORES.SUBJECTS)) {
                        const subjectStore = db.createObjectStore(STORES.SUBJECTS, { keyPath: 'id', autoIncrement: true });
                        subjectStore.createIndex('name', 'name', { unique: true });
                        subjectStore.createIndex('code', 'code', { unique: true });
                        subjectStore.createIndex('type', 'type', { unique: false });
                    }
                    if (!db.objectStoreNames.contains(STORES.CLASS_SUBJECTS)) {
                        const classSubjectStore = db.createObjectStore(STORES.CLASS_SUBJECTS, { keyPath: 'id', autoIncrement: true });
                        classSubjectStore.createIndex('classId', 'classId', { unique: false });
                        classSubjectStore.createIndex('subjectId', 'subjectId', { unique: false });
                        classSubjectStore.createIndex('teacherId', 'teacherId', { unique: false });
                        classSubjectStore.createIndex('classSubject', ['classId', 'subjectId'], { unique: true });
                    }
                    if (!db.objectStoreNames.contains(STORES.ATTENDANCE)) {
                        const attendanceStore = db.createObjectStore(STORES.ATTENDANCE, { keyPath: 'id', autoIncrement: true });
                        attendanceStore.createIndex('date', 'date', { unique: false });
                        attendanceStore.createIndex('classId', 'classId', { unique: false });
                        attendanceStore.createIndex('sectionId', 'sectionId', { unique: false });
                        attendanceStore.createIndex('studentId', 'studentId', { unique: false });
                        attendanceStore.createIndex('dateClassSection', ['date', 'classId', 'sectionId'], { unique: false });
                        attendanceStore.createIndex('dateStudent', ['date', 'studentId'], { unique: true });
                    }
                    if (!db.objectStoreNames.contains(STORES.EXAMS)) {
                        const examStore = db.createObjectStore(STORES.EXAMS, { keyPath: 'id', autoIncrement: true });
                        examStore.createIndex('name', 'name', { unique: false });
                        examStore.createIndex('startDate', 'startDate', { unique: false });
                        examStore.createIndex('endDate', 'endDate', { unique: false });
                    }
                    if (!db.objectStoreNames.contains(STORES.MARKS)) {
                        const marksStore = db.createObjectStore(STORES.MARKS, { keyPath: 'id', autoIncrement: true });
                        marksStore.createIndex('examId', 'examId', { unique: false });
                        marksStore.createIndex('studentId', 'studentId', { unique: false });
                        marksStore.createIndex('subjectId', 'subjectId', { unique: false });
                        marksStore.createIndex('examStudentSubject', ['examId', 'studentId', 'subjectId'], { unique: true });
                    }
                    if (!db.objectStoreNames.contains(STORES.FEES)) {
                        const feesStore = db.createObjectStore(STORES.FEES, { keyPath: 'id', autoIncrement: true });
                        feesStore.createIndex('studentId', 'studentId', { unique: false });
                        feesStore.createIndex('date', 'date', { unique: false });
                        feesStore.createIndex('month', 'month', { unique: false });
                        feesStore.createIndex('year', 'year', { unique: false });
                        feesStore.createIndex('studentMonthYear', ['studentId', 'month', 'year'], { unique: true });
                    }
                    if (!db.objectStoreNames.contains(STORES.FEE_STRUCTURE)) {
                        const feeStructureStore = db.createObjectStore(STORES.FEE_STRUCTURE, { keyPath: 'id', autoIncrement: true });
                        feeStructureStore.createIndex('classId', 'classId', { unique: false });
                        feeStructureStore.createIndex('category', 'category', { unique: false });
                        feeStructureStore.createIndex('classCategory', ['classId', 'category'], { unique: true });
                    }
                    if (!db.objectStoreNames.contains(STORES.SALARY)) {
                        const salaryStore = db.createObjectStore(STORES.SALARY, { keyPath: 'id', autoIncrement: true });
                        salaryStore.createIndex('employeeId', 'employeeId', { unique: false });
                        salaryStore.createIndex('employeeType', 'employeeType', { unique: false });
                        salaryStore.createIndex('month', 'month', { unique: false });
                        salaryStore.createIndex('year', 'year', { unique: false });
                        salaryStore.createIndex('date', 'date', { unique: false });
                        salaryStore.createIndex('employeeMonthYear', ['employeeId', 'month', 'year'], { unique: true });
                    }
                    if (!db.objectStoreNames.contains(STORES.SALARY_STRUCTURE)) {
                        const salaryStructureStore = db.createObjectStore(STORES.SALARY_STRUCTURE, { keyPath: 'id', autoIncrement: true });
                        salaryStructureStore.createIndex('employeeId', 'employeeId', { unique: false });
                        salaryStructureStore.createIndex('employeeType', 'employeeType', { unique: false });
                        salaryStructureStore.createIndex('employeeTypeId', ['employeeType', 'employeeId'], { unique: true });
                    }
                    if (!db.objectStoreNames.contains(STORES.BOOKS)) {
                        const booksStore = db.createObjectStore(STORES.BOOKS, { keyPath: 'id', autoIncrement: true });
                        booksStore.createIndex('name', 'name', { unique: false });
                        booksStore.createIndex('author', 'author', { unique: false });
                        booksStore.createIndex('category', 'category', { unique: false });
                        booksStore.createIndex('isbn', 'isbn', { unique: false });
                    }
                    if (!db.objectStoreNames.contains(STORES.BOOK_ISSUES)) {
                        const bookIssuesStore = db.createObjectStore(STORES.BOOK_ISSUES, { keyPath: 'id', autoIncrement: true });
                        bookIssuesStore.createIndex('bookId', 'bookId', { unique: false });
                        bookIssuesStore.createIndex('memberId', 'memberId', { unique: false });
                        bookIssuesStore.createIndex('memberType', 'memberType', { unique: false });
                        bookIssuesStore.createIndex('issueDate', 'issueDate', { unique: false });
                        bookIssuesStore.createIndex('returnDate', 'returnDate', { unique: false });
                        bookIssuesStore.createIndex('status', 'status', { unique: false });
                    }
                    if (!db.objectStoreNames.contains(STORES.USERS)) {
                        const usersStore = db.createObjectStore(STORES.USERS, { keyPath: 'id', autoIncrement: true });
                        usersStore.createIndex('username', 'username', { unique: true });
                        usersStore.createIndex('email', 'email', { unique: true });
                        usersStore.createIndex('role', 'role', { unique: false });
                    }
                    if (!db.objectStoreNames.contains(STORES.ROLES)) {
                        const rolesStore = db.createObjectStore(STORES.ROLES, { keyPath: 'id', autoIncrement: true });
                        rolesStore.createIndex('name', 'name', { unique: true });
                    }
                    if (!db.objectStoreNames.contains(STORES.SETTINGS)) {
                        const settingsStore = db.createObjectStore(STORES.SETTINGS, { keyPath: 'id', autoIncrement: false });
                    }
                    if (!db.objectStoreNames.contains(STORES.EVENTS)) {
                        const eventsStore = db.createObjectStore(STORES.EVENTS, { keyPath: 'id', autoIncrement: true });
                        eventsStore.createIndex('date', 'date', { unique: false });
                        eventsStore.createIndex('type', 'type', { unique: false });
                    }
                    if (!db.objectStoreNames.contains(STORES.ACTIVITIES)) {
                        const activitiesStore = db.createObjectStore(STORES.ACTIVITIES, { keyPath: 'id', autoIncrement: true });
                        activitiesStore.createIndex('date', 'date', { unique: false });
                        activitiesStore.createIndex('type', 'type', { unique: false });
                        activitiesStore.createIndex('userId', 'userId', { unique: false });
                    }
                    if (!db.objectStoreNames.contains(STORES.BACKUP)) {
                        const backupStore = db.createObjectStore(STORES.BACKUP, { keyPath: 'id', autoIncrement: true });
                        backupStore.createIndex('date', 'date', { unique: false });
                        backupStore.createIndex('type', 'type', { unique: false });
                    }
                    console.log('Database setup completed');
                };
            });
        }
        async function initializeApp() {
            console.log('Initializing application...');
            await loadSettings();
            await loadDashboardData();
            await loadDropdownData();
            //await checkAndLoadSampleData();
            setupEventListeners();
            console.log('[FIX] Directly attaching event listeners for attendance dropdowns...');
            try {
                document.getElementById('attendance-class').addEventListener('change', () => populateAttendanceSections('attendance-class', 'attendance-section'));
                document.getElementById('view-attendance-class').addEventListener('change', () => populateAttendanceSections('view-attendance-class', 'view-attendance-section'));
                document.getElementById('report-attendance-class').addEventListener('change', () => populateAttendanceSections('report-attendance-class', 'report-attendance-section'));
                console.log('[FIX] Attendance dropdown listeners attached successfully.');
            } catch (e) {
                console.error('[FIX] FAILED TO ATTACH ATTENDANCE LISTENERS:', e);
            }
            showView('dashboard');
            console.log('Application initialized successfully');
        }
        function renderBarChart(canvasId, chartTitle, labels, dataValues) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) {
                console.warn("Canvas not found for chart:", canvasId);
                return;
            }
            if (typeof Chart === 'undefined') {
                console.warn("Chart.js library is not loaded. Skipping chart rendering.");
                const placeholder = document.getElementById(canvasId);
                if (placeholder) placeholder.innerHTML = '<p style="text-align:center; color: #777;"><em>Chart.js library not loaded.</em></p>';
                return;
            }
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: chartTitle,
                        data: dataValues,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        function renderPieChart(canvasId, chartTitle, labels, dataValues) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) {
                console.warn("Canvas not found for chart:", canvasId);
                return;
            }
            if (typeof Chart === 'undefined') {
                console.warn("Chart.js library is not loaded. Skipping chart rendering.");
                const placeholder = document.getElementById(canvasId);
                if (placeholder) placeholder.innerHTML = '<p style="text-align:center; color: #777;"><em>Chart.js library not loaded.</em></p>';
                return;
            }
            const backgroundColors = dataValues.map(() => `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 0.7)`);
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        label: chartTitle,
                        data: dataValues,
                        backgroundColor: backgroundColors,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: chartTitle
                        }
                    }
                }
            });
        }
        async function showView(viewName) {
            document.querySelectorAll('.section-view').forEach(view => {
                view.style.display = 'none';
            });
            const selectedView = document.getElementById(viewName + '-view');
            if (selectedView) {
                selectedView.style.display = 'block';
            } else {
                console.error(`View not found for: ${viewName}`);
                return;
            }
            const filterContainerIds = [
                'js-student-filters-container',
                'js-teacher-filters-container',
                'js-staff-filters-container'
            ];
            filterContainerIds.forEach(id => {
                const container = document.getElementById(id);
                let parentListOfContainer = null;
                if (container && container.parentElement) {
                    parentListOfContainer = container.parentElement.id;
                }
                if (container) {
                    let shouldRemove = true;
                    if (viewName === 'students' && parentListOfContainer === 'students-list' && id === 'js-student-filters-container') {
                        shouldRemove = false;
                    } else if (viewName === 'teachers' && parentListOfContainer === 'teachers-list' && id === 'js-teacher-filters-container') {
                        shouldRemove = false;
                    } else if (viewName === 'staff' && parentListOfContainer === 'staff-list' && id === 'js-staff-filters-container') {
                        shouldRemove = false;
                    }
                    if (shouldRemove) {
                        container.remove();
                    }
                }
            });
            if (viewName !== 'reports') {
                const reportOutputArea = document.getElementById('js-report-output-area');
                if (reportOutputArea) reportOutputArea.innerHTML = '';
                if (currentReportChart) {
                    currentReportChart.destroy();
                    currentReportChart = null;
                }
            }
            try {
                switch (viewName) {
                    case 'dashboard':
                        loadDashboardData();
                        break;
                    case 'students':
                        loadStudentsTable();
                        createCollapsibleFilterUI(
                            'students-list',
                            'js-student-filters-container',
                            'Ø·Ù„Ø¨Ø§Ø¡ Ú©Û’ ÙÙ„Ù¹Ø±Ø²',
                            createStudentFilterRows,
                            populateStudentFilterDropdownsJS,
                            applyStudentFiltersJS,
                            resetStudentFiltersJS,
                            [{ dropdownId: 'js-filter-student-class', handlerFn: populateStudentFilterSectionsJS }]
                        );
                        break;
                    case 'teachers':
                        loadTeachersTable();
                        createCollapsibleFilterUI(
                            'teachers-list',
                            'js-teacher-filters-container',
                            'Ø§Ø³Ø§ØªØ°Û Ú©Û’ ÙÙ„Ù¹Ø±Ø²',
                            createTeacherFilterRows,
                            populateTeacherFilterDropdownsJS,
                            applyTeacherFiltersJS,
                            resetTeacherFiltersJS
                        );
                        break;
                    case 'staff':
                        loadStaffTable();
                        createCollapsibleFilterUI(
                            'staff-list',
                            'js-staff-filters-container',
                            'Ø¹Ù…Ù„Û Ú©Û’ ÙÙ„Ù¹Ø±Ø²',
                            createStaffFilterRows,
                            null,
                            applyStaffFiltersJS,
                            resetStaffFiltersJS
                        );
                        break;
                    case 'classes':
                        loadClassesTable();
                        break;
                    case 'subjects':
                        loadSubjectsTable();
                        break;
                    case 'attendance':
                        loadClassDropdowns();
                        populateAttendanceSections('attendance-class', 'attendance-section');
                        break;
                    case 'exams':
                        loadExamsTable();
                        loadClassDropdowns();
                        loadSubjectDropdowns();
                        loadExamDropdowns();
                        break;
                    case 'fees':
                        loadFeeStructureTable();
                        loadClassDropdowns();
                        break;
                    case 'salaries':
                        loadSalaryStructureTable();
                        loadEmployeesForSalaryStructure();
                        break;
                    case 'library':
                        loadBooksTable();
                        populateLibraryDropdowns();
                        break;
                    case 'users':
                        loadUsersTable();
                        loadRolesTable();
                        break;
                    case 'reports':
                        initializeReportsViewJS();
                        break;
                    case 'settings':
                        loadSchoolSettings();
                        break;
                    case 'backup':
                        loadBackupHistoryTable();
                        break;
                    default:
                        console.warn(`No specific load actions defined for view: ${viewName}`);
                }
            } catch (e) {
                console.error(`Error in showView during content loading for '${viewName}':`, e);
                showNotification(`'${viewName}' Ù…Ù†Ø¸Ø± Ù„ÙˆÚˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”`, 'error');
            }
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                if (sidebar && sidebar.classList.contains('active')) {
                    toggleSidebar();
                }
            }
        }
        async function loadExamDropdowns() {
            try {
                const exams = getAllFromStore(STORES.EXAMS);
                const examDropdowns = document.querySelectorAll('select[id$="-exam"], select[id^="marks-exam"], select[id^="result-exam"]');
                examDropdowns.forEach(dropdown => {
                    const currentVal = dropdown.value;
                    const fixedOptions = Array.from(dropdown.options).filter(opt => opt.value === "" || opt.dataset.fixed);
                    dropdown.innerHTML = '';
                    fixedOptions.forEach(opt => dropdown.appendChild(opt.cloneNode(true)));
                    exams.sort((a, b) => new Date(b.startDate) - new Date(a.startDate));
                    exams.forEach(exam => {
                        const option = document.createElement('option');
                        option.value = exam.id;
                        option.textContent = `${exam.name} (${formatDate(exam.startDate)})`;
                        dropdown.appendChild(option);
                    });
                    if (Array.from(dropdown.options).some(opt => opt.value === currentVal)) {
                        dropdown.value = currentVal;
                    }
                });
            } catch (error) {
                console.error('Error loading exam dropdowns:', error);
            }
        }
        async function addStudent() {
            showLoading();
            const form = document.getElementById('student-form');
            const editId = form.dataset.editId ? parseInt(form.dataset.editId) : null;
            try {
                const studentName = document.getElementById('student-name').value;
                const fatherName = document.getElementById('student-father').value;
                const studentClass = document.getElementById('student-class').value;
                const studentAdmissionDate = document.getElementById('student-admission-date').value;
                if (!studentName || !fatherName || !studentClass || !studentAdmissionDate) {
                    showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªÙ…Ø§Ù… Ø¶Ø±ÙˆØ±ÛŒ ÙÛŒÙ„ÚˆØ² Ú©Ùˆ Ù¾ÙØ± Ú©Ø±ÛŒÚºÛ” (*)', 'error');
                    hideLoading();
                    return;
                }
                const studentData = {
                    name: studentName,
                    fatherName: fatherName,
                    dob: document.getElementById('student-dob').value,
                    gender: document.getElementById('student-gender').value,
                    classId: parseInt(studentClass),
                    sectionId: parseInt(document.getElementById('student-section').value),
                    contact: document.getElementById('student-contact').value,
                    email: document.getElementById('student-email').value,
                    guardian: document.getElementById('student-guardian').value,
                    guardianContact: document.getElementById('student-guardian-contact').value,
                    address: document.getElementById('student-address').value,
                    admissionDate: studentAdmissionDate,
                    feeCategory: document.getElementById('student-fee-category').value,
                    monthlyFee: parseFloat(document.getElementById('student-monthly-fee').value),
                    notes: document.getElementById('student-notes').value,
                    createdAt: new Date().toISOString()
                };
                if (studentData.classId) {
                    const classInfo = await getFromStore(STORES.CLASSES, studentData.classId);
                    studentData.className = classInfo ? classInfo.name : 'N/A';
                }
                if (studentData.sectionId) {
                    const sectionInfo = await getFromStore(STORES.SECTIONS, studentData.sectionId);
                    studentData.sectionName = sectionInfo ? sectionInfo.name : 'N/A';
                }
                if (editId) {
                    studentData.updatedAt = new Date().toISOString();
                    await updateInStore(STORES.STUDENTS, editId, studentData);
                    showNotification('Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©Ø§ Ø±ÛŒÚ©Ø§Ø±Úˆ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø± Ø¯ÛŒØ§ Ú¯ÛŒØ§Û”', 'success');
                } else {
                    const studentsCount = await getCount(STORES.STUDENTS);
                    studentData.rollNumber = String(studentsCount + 1).padStart(4, '0');
                    await addToStore(STORES.STUDENTS, studentData);
                    showNotification('Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¯Ø§Ø®Ù„ Ú©Ø± Ù„ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’Û”', 'success');
                }
                form.reset();
                delete form.dataset.editId;
                const submitButton = form.querySelector('button[type="submit"]');
                if (submitButton) submitButton.textContent = 'Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº';
                const studentListTab = document.querySelector('.tab[data-tab="students-list"]');
                if (studentListTab && !studentListTab.classList.contains('active')) {
                    studentListTab.click();
                }
                await loadStudentsTable();
            } catch (error) {
                console.error('Error saving student:', error);
                showNotification('Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©Ùˆ Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”', 'error');
            } finally {
                hideLoading();
            }
        }
        async function handlePhotoUpload(inputId) {
            const photoInput = document.getElementById(inputId);
            if (photoInput && photoInput.files && photoInput.files[0]) {
                return await fileToBase64(photoInput.files[0]);
            }
            return null;
        }
        function setupEventListeners() {
            // Sidebar menu navigation
            document.querySelector('[data-tab="students-list"]').addEventListener('click', () => loadStudentsTable());
            document.querySelector('[data-tab="teachers-list"]').addEventListener('click', () => loadTeachersTable());
            document.querySelector('[data-tab="staff-list"]').addEventListener('click', () => loadStaffTable());
            document.querySelector('[data-tab="classes-list"]').addEventListener('click', () => loadClassesTable());
            document.querySelector('[data-tab="sections"]').addEventListener('click', () => loadSectionsTable());
            document.querySelector('[data-tab="subjects-list"]').addEventListener('click', () => loadSubjectsTable());
            document.querySelector('[data-tab="class-subjects"]').addEventListener('click', () => loadClassSubjectsTable());
            document.querySelector('[data-tab="exams-list"]').addEventListener('click', () => loadExamsTable());
            document.querySelector('[data-tab="user-roles"]').addEventListener('click', () => loadRolesTable());
            document.querySelector('[data-tab="fee-structure"]').addEventListener('click', () => loadFeeStructureTable());
            document.querySelector('[data-tab="salary-structure"]').addEventListener('click', () => loadSalaryStructureTable());
            document.querySelector('[data-view="library"]').addEventListener('click', () => loadBooksTable());
            document.querySelector('[data-view="users"]').addEventListener('click', () => loadUsersTable());
            document.querySelector('[data-view="backup"]').addEventListener('click', () => loadBackupHistoryTable());
            // Search buttons
            document.getElementById('search-student-btn').addEventListener('click', searchStudents);
            document.getElementById('search-teacher-btn').addEventListener('click', searchTeachers);
            document.getElementById('search-staff-btn').addEventListener('click', searchStaff);
            document.getElementById('search-student-fee').addEventListener('click', searchStudentForFee);
            document.getElementById('search-employee-salary').addEventListener('click', searchEmployeeForSalary);
            // Data loading and report generation buttons
            document.getElementById('load-attendance').addEventListener('click', loadStudentsForAttendance);
            document.getElementById('view-attendance-btn').addEventListener('click', viewAttendance);
            document.getElementById('generate-attendance-report').addEventListener('click', generateAttendanceReport);
            document.getElementById('load-students-marks').addEventListener('click', loadStudentsForMarks);
            document.getElementById('generate-result-cards').addEventListener('click', generateResultCards);
            document.getElementById('generate-fee-report').addEventListener('click', generateFeeReport);
            document.getElementById('generate-defaulters').addEventListener('click', generateDefaultersReport);
            document.getElementById('generate-salary-report').addEventListener('click', generateSalaryReport);
            // Backup and Restore
            document.getElementById('create-backup').addEventListener('click', createBackup);
            document.getElementById('restore-backup').addEventListener('click', restoreBackup);
            document.getElementById('save-auto-backup').addEventListener('click', saveAutoBackupSettings);
            document.getElementById('auto-backup-enable').addEventListener('change', function () {
                document.getElementById('auto-backup-options').style.display = this.checked ? 'block' : 'none';
            });
            // Dropdown change listeners
            document.getElementById('student-class').addEventListener('change', populateSectionsForStudentForm);
            document.getElementById('attendance-class').addEventListener('change', () => populateAttendanceSections('attendance-class', 'attendance-section'));
            document.getElementById('view-attendance-class').addEventListener('change', () => populateAttendanceSections('view-attendance-class', 'view-attendance-section'));
            document.getElementById('report-attendance-class').addEventListener('change', () => populateAttendanceSections('report-attendance-class', 'report-attendance-section'));
            document.getElementById('fee-report-type').addEventListener('change', toggleFeeReportFields);
            document.getElementById('salary-report-type').addEventListener('change', toggleSalaryReportFields);
            document.getElementById('structure-employee-type').addEventListener('change', loadEmployeesForSalaryStructure);
        }
        async function loadStaffTable() {
            try {
                const staffList = await getAllFromStore(STORES.STAFF);
                const tbody = document.querySelector('#staff-table tbody');
                tbody.innerHTML = '';
                if (!staffList || staffList.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Ú©ÙˆØ¦ÛŒ Ø¹Ù…Ù„Û Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’Û”</td></tr>';
                    return;
                }
                staffList.forEach(staff => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${staff.employeeId}</td>
                <td>${staff.name}</td>
                <td>${staff.designation}</td>
                <td>${staff.department}</td>
                <td>${staff.contact}</td>
                <td>${formatDate(staff.joiningDate)}</td>
                <td>${staff.basicSalary ? formatCurrency(staff.basicSalary) : 'N/A'}</td>
                <td class="no-print">
                    <button class="btn btn-primary btn-sm" onclick="editStaff(${staff.id})">ØªØ±Ù…ÛŒÙ…</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteItem('${STORES.STAFF}', ${staff.id})">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button>
                </td>
            `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading staff table:', error);
            }
        }
        async function editStaff(id) {
            showLoading();
            try {
                const staff = await getFromStore(STORES.STAFF, id);
                if (!staff) { return; }
                const form = document.getElementById('staff-form');
                form.dataset.editId = id;
                document.getElementById('staff-name').value = staff.name;
                document.getElementById('staff-father').value = staff.fatherName;
                document.getElementById('staff-dob').value = staff.dob;
                document.getElementById('staff-gender').value = staff.gender;
                document.getElementById('staff-designation').value = staff.designation;
                document.getElementById('staff-department').value = staff.department;
                document.getElementById('staff-qualification').value = staff.qualification;
                document.getElementById('staff-responsibilities').value = staff.responsibilities;
                document.getElementById('staff-contact').value = staff.contact;
                document.getElementById('staff-email').value = staff.email;
                document.getElementById('staff-address').value = staff.address;
                document.getElementById('staff-cnic').value = staff.cnic;
                document.getElementById('staff-joining-date').value = staff.joiningDate;
                document.getElementById('staff-basic-salary').value = staff.basicSalary;
                document.getElementById('staff-allowances').value = staff.allowances;
                document.getElementById('staff-deductions').value = staff.deductions;
                document.getElementById('staff-notes').value = staff.notes;
                document.querySelector('.tab[data-tab="add-staff"]').click();
                form.querySelector('button[type="submit"]').textContent = 'Ø±ÛŒÚ©Ø§Ø±Úˆ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº';
            } catch (e) { console.error(e); } finally { hideLoading(); }
        }
        async function loadClassesTable() {
            try {
                const classes = await getAllFromStore(STORES.CLASSES);
                const tbody = document.querySelector('#classes-table tbody');
                tbody.innerHTML = '';
                if (!classes || classes.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Ú©ÙˆØ¦ÛŒ Ú©Ù„Ø§Ø³ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’Û”</td></tr>';
                    return;
                }
                for (const cls of classes) {
                    const row = document.createElement('tr');
                    const teacher = cls.inChargeId ? await getFromStore(STORES.TEACHERS, cls.inChargeId) : null;
                    const studentsCount = (await getAllFromIndex(STORES.STUDENTS, 'classId', cls.id)).length;
                    const sections = (await getAllFromIndex(STORES.SECTIONS, 'classId', cls.id)).map(s => s.name).join(', ');
                    row.innerHTML = `
                <td>${cls.id}</td>
                <td>${cls.name}</td>
                <td>${teacher ? teacher.name : 'N/A'}</td>
                <td>${sections || '-'}</td>
                <td>${studentsCount}</td>
                <td class="no-print">
                    <button class="btn btn-primary btn-sm" onclick="editClass(${cls.id})">ØªØ±Ù…ÛŒÙ…</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteItem('${STORES.CLASSES}', ${cls.id})">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button>
                </td>
            `;
                    tbody.appendChild(row);
                }
            } catch (error) { console.error('Error loading classes table:', error); }
        }
        async function editClass(id) {
            showLoading();
            try {
                const cls = await getFromStore(STORES.CLASSES, id);
                if (!cls) { return; }
                const form = document.getElementById('class-form');
                form.dataset.editId = id;
                document.getElementById('class-name').value = cls.name;
                document.getElementById('class-incharge').value = cls.inChargeId;
                document.getElementById('class-level').value = cls.level;
                document.getElementById('class-room').value = cls.roomNumber;
                document.getElementById('class-fee-category').value = cls.feeCategory;
                document.getElementById('class-monthly-fee').value = cls.monthlyFee;
                document.getElementById('class-admission-fee').value = cls.admissionFee;
                document.getElementById('class-notes').value = cls.notes;
                const sections = await getAllFromIndex(STORES.SECTIONS, 'classId', id);
                const sectionNames = sections.map(s => s.name);
                Array.from(document.getElementById('class-sections').options).forEach(opt => {
                    opt.selected = sectionNames.includes(opt.value);
                });
                document.querySelector('.tab[data-tab="add-class"]').click();
                form.querySelector('button[type="submit"]').textContent = 'Ø±ÛŒÚ©Ø§Ø±Úˆ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº';
            } catch (e) { console.error(e); } finally { hideLoading(); }
        }
        async function loadSectionsTable() {
            try {
                const sections = await getAllFromStore(STORES.SECTIONS);
                const tbody = document.querySelector('#sections-table tbody');
                tbody.innerHTML = '';
                if (!sections || sections.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Ú©ÙˆØ¦ÛŒ Ø³ÛŒÚ©Ø´Ù† Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’Û”</td></tr>';
                    return;
                }
                for (const section of sections) {
                    const row = document.createElement('tr');
                    const classData = await getFromStore(STORES.CLASSES, section.classId);
                    const teacher = section.inChargeId ? await getFromStore(STORES.TEACHERS, section.inChargeId) : null;
                    const studentsCount = (await getAllFromIndex(STORES.STUDENTS, 'sectionId', section.id)).length;
                    row.innerHTML = `
                        <td>${section.id}</td>
                        <td>${classData ? classData.name : 'N/A'}</td>
                        <td>${section.name}</td>
                        <td>${teacher ? teacher.name : 'N/A'}</td>
                        <td>${studentsCount}</td>
                        <td class="no-print">
                            <button class="btn btn-primary btn-sm">ØªØ±Ù…ÛŒÙ…</button>
                            <button class="btn btn-danger btn-sm">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                }
            } catch (error) {
                console.error('Error loading sections table:', error);
            }
        }
        async function loadSubjectsTable() {
            try {
                const subjects = await getAllFromStore(STORES.SUBJECTS);
                const tbody = document.querySelector('#subjects-table tbody');
                tbody.innerHTML = '';
                if (!subjects || subjects.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Ú©ÙˆØ¦ÛŒ Ù…Ø¶Ù…ÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’Û”</td></tr>';
                    return;
                }
                subjects.forEach(subject => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${subject.id}</td>
                <td>${subject.name}</td>
                <td>${subject.code}</td>
                <td>${subject.type}</td>
                <td>${subject.details || '-'}</td>
                <td class="no-print">
                    <button class="btn btn-primary btn-sm" onclick="editSubject(${subject.id})">ØªØ±Ù…ÛŒÙ…</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteItem('${STORES.SUBJECTS}', ${subject.id})">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button>
                </td>
            `;
                    tbody.appendChild(row);
                });
            } catch (error) { console.error('Error loading subjects table:', error); }
        }
        async function editSubject(id) {
            showLoading();
            try {
                const subject = await getFromStore(STORES.SUBJECTS, id);
                if (!subject) { return; }
                const form = document.getElementById('subject-form');
                form.dataset.editId = id;
                document.getElementById('subject-name').value = subject.name;
                document.getElementById('subject-code').value = subject.code;
                document.getElementById('subject-type').value = subject.type;
                document.getElementById('subject-periods').value = subject.periods;
                document.getElementById('subject-details').value = subject.details;
                document.querySelector('.tab[data-tab="add-subject"]').click();
                form.querySelector('button[type="submit"]').textContent = 'Ø±ÛŒÚ©Ø§Ø±Úˆ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº';
            } catch (e) { console.error(e); } finally { hideLoading(); }
        }
        async function loadClassSubjectsTable() {
            const tbody = document.querySelector('#class-subjects-table tbody');
            tbody.innerHTML = '';
            showLoading();
            try {
                const classSubjects = await getAllFromStore(STORES.CLASS_SUBJECTS);
                if (classSubjects.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;">Ú©ÙˆØ¦ÛŒ Ú©Ù„Ø§Ø³ Ù…Ø¶Ù…ÙˆÙ† ØªÙÙˆÛŒØ¶ Ù†ÛÛŒÚº Ú©ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’Û”</td></tr>';
                    return;
                }
                for (const cs of classSubjects) {
                    const classData = await getFromStore(STORES.CLASSES, cs.classId);
                    const subjectData = await getFromStore(STORES.SUBJECTS, cs.subjectId);
                    const teacherData = await getFromStore(STORES.TEACHERS, cs.teacherId);
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${cs.id}</td>
                <td>${classData ? classData.name : 'N/A'}</td>
                <td>${subjectData ? subjectData.name : 'N/A'}</td>
                <td>${teacherData ? teacherData.name : 'N/A'}</td>
                <td><button class="btn btn-danger btn-sm">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button></td>
            `;
                    tbody.appendChild(row);
                }
            } catch (e) {
                console.error("Error loading class subjects:", e);
            } finally {
                hideLoading();
            }
        }
        async function loadExamsTable() {
            try {
                const exams = await getAllFromStore(STORES.EXAMS);
                const tbody = document.querySelector('#exams-table tbody');
                tbody.innerHTML = '';
                if (!exams || exams.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">Ú©ÙˆØ¦ÛŒ Ø§Ù…ØªØ­Ø§Ù† Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’Û”</td></tr>';
                    return;
                }
                for (const exam of exams) {
                    const row = document.createElement('tr');
                    const classNames = exam.classes ? (await Promise.all(exam.classes.map(id => getFromStore(STORES.CLASSES, id)))).map(c => c ? c.name : '').join(', ') : 'N/A';
                    row.innerHTML = `
                <td>${exam.id}</td>
                <td>${exam.name}</td>
                <td>${formatDate(exam.startDate)}</td>
                <td>${formatDate(exam.endDate)}</td>
                <td>${classNames}</td>
                <td>${exam.status}</td>
                <td class="no-print">
                    <button class="btn btn-primary btn-sm" disabled>ØªØ±Ù…ÛŒÙ…</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteItem('${STORES.EXAMS}', ${exam.id})">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button>
                </td>
            `;
                    tbody.appendChild(row);
                }
            } catch (error) {
                console.error('Error loading exams table:', error);
            }
        }
        async function deleteItem(storeName, id) {
            const refreshFunctions = {
                [STORES.STUDENTS]: loadStudentsTable,
                [STORES.TEACHERS]: loadTeachersTable,
                [STORES.STAFF]: loadStaffTable,
                [STORES.CLASSES]: loadClassesTable,
                [STORES.SUBJECTS]: loadSubjectsTable,
                [STORES.EXAMS]: loadExamsTable,
            };
            if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø³ Ø±ÛŒÚ©Ø§Ø±Úˆ Ú©Ùˆ Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ ÛŒÛ Ø¹Ù…Ù„ ÙˆØ§Ù¾Ø³ Ù†ÛÛŒÚº Ú©ÛŒØ§ Ø¬Ø§ Ø³Ú©ØªØ§Û”')) {
                showLoading();
                try {
                    await deleteFromStore(storeName, id);
                    showNotification('Ø±ÛŒÚ©Ø§Ø±Úˆ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø­Ø°Ù Ú©Ø± Ø¯ÛŒØ§ Ú¯ÛŒØ§Û”', 'success');
                    if (refreshFunctions[storeName]) {
                        refreshFunctions[storeName]();
                    } else {
                        console.warn(`No refresh function is defined for the store: ${storeName}`);
                    }
                } catch (error) {
                    console.error(`Error deleting item from ${storeName}:`, error);
                    showNotification('Ø±ÛŒÚ©Ø§Ø±Úˆ Ø­Ø°Ù Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”', 'error');
                } finally {
                    hideLoading();
                }
            }
        }
        async function editBook(id) {
            showLoading();
            try {
                const book = await getFromStore(STORES.BOOKS, id);
                if (!book) return;
                const form = document.getElementById('add-book-form');
                form.dataset.editId = id;
                document.getElementById('book-name').value = book.name;
                document.getElementById('book-author').value = book.author;
                document.getElementById('book-category').value = book.category;
                document.getElementById('book-isbn').value = book.isbn;
                document.getElementById('book-copies').value = book.copies;
                document.getElementById('book-shelf').value = book.shelf;
                document.querySelector('.tab[data-tab="add-book-tab"]').click();
                form.querySelector('button[type="submit"]').textContent = 'Ø±ÛŒÚ©Ø§Ø±Úˆ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº';
            } catch (e) { console.error(e); } finally { hideLoading(); }
        }
        async function loadFeeStructureTable() {
            const tbody = document.querySelector('#fee-structure-table tbody');
            tbody.innerHTML = '';
            const structures = await getAllFromStore(STORES.FEE_STRUCTURE);
            if (!structures || structures.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Ú©ÙˆØ¦ÛŒ ÙÛŒØ³ Ø³Ù¹Ø±Ú©Ú†Ø± Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’Û”</td></tr>';
                return;
            }
            for (const structure of structures) {
                const classData = await getFromStore(STORES.CLASSES, structure.classId);
                const total = (structure.monthlyFee || 0) + (structure.admissionFee || 0) + (structure.examFee || 0) + (structure.computerFee || 0) + (structure.transportFee || 0) + (structure.otherFee || 0);
                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${structure.id}</td>
            <td>${classData ? classData.name : 'N/A'}</td>
            <td>${structure.category}</td>
            <td>${formatCurrency(structure.monthlyFee || 0)}</td>
            <td>${formatCurrency(structure.admissionFee || 0)}</td>
            <td>${formatCurrency(structure.examFee || 0)}</td>
            <td>${formatCurrency(total)}</td>
            <td class="no-print">
                <button class="btn btn-danger btn-sm" onclick="deleteItem('${STORES.FEE_STRUCTURE}', ${structure.id})">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button>
            </td>
        `;
                tbody.appendChild(row);
            }
        }
        async function loadSalaryStructureTable() {
            const tbody = document.querySelector('#salary-structure-table tbody');
            tbody.innerHTML = '';
            const structures = await getAllFromStore(STORES.SALARY_STRUCTURE);
            if (!structures || structures.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Ú©ÙˆØ¦ÛŒ ØªÙ†Ø®ÙˆØ§Û Ø³Ù¹Ø±Ú©Ú†Ø± Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’Û”</td></tr>';
                return;
            }
            for (const structure of structures) {
                const employeeStore = structure.employeeType === 'teacher' ? STORES.TEACHERS : STORES.STAFF;
                const employee = await getFromStore(employeeStore, structure.employeeId);
                const total = (structure.basicSalary || 0) + (structure.houseRent || 0) + (structure.transport || 0) + (structure.medical || 0) + (structure.otherAllowances || 0) - (structure.deductions || 0);
                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${structure.id}</td>
            <td>${employee ? employee.name : 'N/A'}</td>
            <td>${employee ? (employee.designation || 'Ø§Ø³ØªØ§Ø¯') : 'N/A'}</td>
            <td>${formatCurrency(structure.basicSalary || 0)}</td>
            <td>${formatCurrency((structure.houseRent || 0) + (structure.transport || 0) + (structure.medical || 0) + (structure.otherAllowances || 0))}</td>
            <td>${formatCurrency(structure.deductions || 0)}</td>
            <td>${formatCurrency(total)}</td>
            <td class="no-print">
                 <button class="btn btn-danger btn-sm" onclick="deleteItem('${STORES.SALARY_STRUCTURE}', ${structure.id})">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button>
            </td>
        `;
                tbody.appendChild(row);
            }
        }
        async function loadBackupHistoryTable() {
            const tbody = document.querySelector('#backup-history-table tbody');
            tbody.innerHTML = '';
            const history = await getAllFromStore(STORES.BACKUP);
            if (!history || history.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Ú©ÙˆØ¦ÛŒ Ø¨ÛŒÚ© Ø§Ù¾ ÛØ³Ù¹Ø±ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’Û”</td></tr>';
                return;
            }
            history.sort((a, b) => new Date(b.date) - new Date(a.date));
            history.forEach((backup, index) => {
                const row = document.createElement('tr');
                const backupDate = new Date(backup.date);
                row.innerHTML = `
            <td>${index + 1}</td>
            <td>${backupDate.toLocaleDateString('ur-PK')}</td>
            <td>${backupDate.toLocaleTimeString('ur-PK')}</td>
            <td>${backup.type}</td>
            <td>${(backup.size / 1024).toFixed(2)} KB</td>
            <td class="no-print">
                <button class="btn btn-danger btn-sm" onclick="deleteItem('${STORES.BACKUP}', ${backup.id})">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button>
            </td>
        `;
                tbody.appendChild(row);
            });
        }
        async function searchStudents() {
            showLoading();
            try {
                const searchTerm = document.getElementById('student-search').value.toLowerCase();
                const allStudents = await getAllFromStore(STORES.STUDENTS);
                const filteredStudents = allStudents.filter(student => {
                    return student.name.toLowerCase().includes(searchTerm) ||
                        String(student.rollNumber).includes(searchTerm) ||
                        student.className.toLowerCase().includes(searchTerm);
                });
                const tbody = document.querySelector('#students-table tbody');
                tbody.innerHTML = '';
                if (filteredStudents.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Ú©ÙˆØ¦ÛŒ Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ù†ÛÛŒÚº Ù…Ù„Ø§Û”</td></tr>';
                    return;
                }
                filteredStudents.forEach(student => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${student.rollNumber}</td>
                        <td>${student.name}</td>
                        <td>${student.fatherName}</td>
                        <td>${student.className}</td>
                        <td>${student.sectionName}</td>
                        <td>${student.contact}</td>
                        <td>${formatDate(student.admissionDate)}</td>
                        <td></td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error("Error searching students:", error);
                showNotification('Ø·Ù„Ø¨Ø§Ø¡ Ú©Ùˆ ØªÙ„Ø§Ø´ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”', 'error');
            } finally {
                hideLoading();
            }
        }
        async function searchTeachers() {
            showLoading();
            try {
                const searchTerm = document.getElementById('teacher-search').value.toLowerCase();
                const allTeachers = await getAllFromStore(STORES.TEACHERS);
                const filteredTeachers = allTeachers.filter(teacher => {
                    return teacher.name.toLowerCase().includes(searchTerm) ||
                        teacher.specialization.toLowerCase().includes(searchTerm) ||
                        teacher.qualification.toLowerCase().includes(searchTerm);
                });
                loadTeachersTable(filteredTeachers);
            } catch (error) {
                console.error("Error searching teachers:", error);
                showNotification('Ø§Ø³Ø§ØªØ°Û Ú©Ùˆ ØªÙ„Ø§Ø´ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”', 'error');
            } finally {
                hideLoading();
            }
        }
        async function searchStaff() {
            showLoading();
            try {
                const searchTerm = document.getElementById('staff-search').value.toLowerCase();
                const allStaff = await getAllFromStore(STORES.STAFF);
                const filteredStaff = allStaff.filter(staff => {
                    return staff.name.toLowerCase().includes(searchTerm) ||
                        staff.designation.toLowerCase().includes(searchTerm) ||
                        staff.department.toLowerCase().includes(searchTerm);
                });
                loadStaffTable(filteredStaff);
            } catch (error) {
                console.error("Error searching staff:", error);
                showNotification('Ø¹Ù…Ù„Û’ Ú©Ùˆ ØªÙ„Ø§Ø´ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”', 'error');
            } finally {
                hideLoading();
            }
        }
        async function viewAttendance() {
            const date = document.getElementById('view-attendance-date').value;
            const classId = parseInt(document.getElementById('view-attendance-class').value);
            const sectionId = parseInt(document.getElementById('view-attendance-section').value);
            const tbody = document.querySelector('#view-attendance-table tbody');
            const container = document.getElementById('view-attendance-table-container');
            if (!date || isNaN(classId) || isNaN(sectionId)) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªØ§Ø±ÛŒØ®ØŒ Ú©Ù„Ø§Ø³ Ø§ÙˆØ± Ø³ÛŒÚ©Ø´Ù† Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”', 'error');
                return;
            }
            showLoading();
            tbody.innerHTML = '';
            container.style.display = 'none';
            try {
                const records = await getAllFromIndex(STORES.ATTENDANCE, 'dateClassSection', [date, classId, sectionId]);
                if (records.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="6" style="text-align:center;">Ø§Ø³ ØªØ§Ø±ÛŒØ® Ú©Û’ Ù„ÛŒÛ’ Ø­Ø§Ø¶Ø±ÛŒ Ú©Ø§ Ú©ÙˆØ¦ÛŒ Ø±ÛŒÚ©Ø§Ø±Úˆ Ù†ÛÛŒÚº Ù…Ù„Ø§Û”</td></tr>`;
                } else {
                    for (const record of records) {
                        const student = await getFromStore(STORES.STUDENTS, record.studentId);
                        if (student) {
                            const row = document.createElement('tr');
                            let statusText = '-';
                            if (record.status === 'present') statusText = 'Ø­Ø§Ø¶Ø±';
                            else if (record.status === 'absent') statusText = 'ØºÛŒØ± Ø­Ø§Ø¶Ø±';
                            row.innerHTML = `
                        <td>${student.rollNumber}</td>
                        <td>${student.name}</td>
                        <td>${statusText}</td>
                        <td>${record.isLate ? 'ÛØ§Úº' : 'Ù†ÛÛŒÚº'}</td>
                        <td>${record.isLeave ? 'ÛØ§Úº' : 'Ù†ÛÛŒÚº'}</td>
                        <td>${record.notes || '-'}</td>
                    `;
                            tbody.appendChild(row);
                        }
                    }
                }
                container.style.display = 'block';
            } catch (error) {
                console.error("Error viewing attendance:", error);
                showNotification('Ø­Ø§Ø¶Ø±ÛŒ Ø¯ÛŒÚ©Ú¾Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”', 'error');
            } finally {
                hideLoading();
            }
        }
        async function generateAttendanceReport() {
            const classId = parseInt(document.getElementById('report-attendance-class').value);
            const sectionId = document.getElementById('report-attendance-section').value;
            const startDate = document.getElementById('report-start-date').value;
            const endDate = document.getElementById('report-end-date').value;
            const tbody = document.querySelector('#report-attendance-table tbody');
            const container = document.getElementById('report-attendance-table-container');
            if (isNaN(classId) || !sectionId || !startDate || !endDate) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªÙ…Ø§Ù… ÙÙ„Ù¹Ø±Ø² Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”', 'error');
                return;
            }
            showLoading();
            tbody.innerHTML = '';
            container.style.display = 'none';
            try {
                let students = await getAllFromIndex(STORES.STUDENTS, 'classId', classId);
                if (sectionId !== 'all') {
                    students = students.filter(s => s.sectionId === parseInt(sectionId));
                }
                if (students.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Ø§Ø³ Ú©Ù„Ø§Ø³/Ø³ÛŒÚ©Ø´Ù† Ù…ÛŒÚº Ú©ÙˆØ¦ÛŒ Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ù†ÛÛŒÚº ÛÛ’Û”</td></tr>';
                    container.style.display = 'block';
                    return;
                }
                const allAttendance = await getAllFromStore(STORES.ATTENDANCE);
                const dateFilteredAttendance = allAttendance.filter(rec => {
                    const recDate = new Date(rec.date);
                    return recDate >= new Date(startDate) && recDate <= new Date(endDate);
                });
                for (const student of students) {
                    const studentAttendance = dateFilteredAttendance.filter(rec => rec.studentId === student.id);
                    const totalDays = studentAttendance.length;
                    const present = studentAttendance.filter(r => r.status === 'present').length;
                    const absent = studentAttendance.filter(r => r.status === 'absent').length;
                    const leave = studentAttendance.filter(r => r.isLeave).length;
                    const late = studentAttendance.filter(r => r.isLate).length;
                    const percentage = totalDays > 0 ? ((present / totalDays) * 100).toFixed(2) : 0;
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${student.rollNumber}</td>
                <td>${student.name}</td>
                <td>${totalDays}</td>
                <td>${present}</td>
                <td>${absent}</td>
                <td>${late}</td>
                <td>${leave}</td>
                <td>${percentage}%</td>
            `;
                    tbody.appendChild(row);
                }
                container.style.display = 'block';
            } catch (error) {
                console.error("Error generating attendance report:", error);
                showNotification('Ø­Ø§Ø¶Ø±ÛŒ Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”', 'error');
            } finally {
                hideLoading();
            }
        }
        async function loadStudentsForMarks() {
            const classId = parseInt(document.getElementById('marks-class').value);
            const sectionId = parseInt(document.getElementById('marks-section').value);
            if (!classId || !sectionId) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ú©Ù„Ø§Ø³ Ø§ÙˆØ± Ø³ÛŒÚ©Ø´Ù† Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”', 'error');
                return;
            }
            showLoading();
            try {
                const allStudents = await getAllFromStore(STORES.STUDENTS);
                const classStudents = allStudents.filter(s => s.classId === classId && s.sectionId === sectionId);
                const marksTbody = document.querySelector('#marks-table tbody');
                marksTbody.innerHTML = '';
                if (classStudents.length === 0) {
                    marksTbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Ø§Ø³ Ú©Ù„Ø§Ø³ Ù…ÛŒÚº Ú©ÙˆØ¦ÛŒ Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ù†ÛÛŒÚº ÛÛ’Û”</td></tr>';
                }
                classStudents.forEach(student => {
                    const row = document.createElement('tr');
                    row.dataset.studentId = student.id;
                    row.innerHTML = `
                        <td>${student.rollNumber}</td>
                        <td>${student.name}</td>
                        <td><input type="number" class="form-control" name="marks_${student.id}" min="0" max="100"></td>
                        <td>-</td>
                        <td>-</td>
                        <td><input type="text" class="form-control" name="notes_${student.id}"></td>
                    `;
                    marksTbody.appendChild(row);
                });
                document.getElementById('marks-table-container').style.display = 'block';
            } catch (error) {
                console.error("Error loading students for marks entry:", error);
            } finally {
                hideLoading();
            }
        }
        async function generateResultCards() {
            const examId = parseInt(document.getElementById('result-exam').value);
            const classId = parseInt(document.getElementById('result-class').value);
            const sectionId = parseInt(document.getElementById('result-section').value);
            const container = document.getElementById('result-cards-container');
            if (isNaN(examId) || isNaN(classId) || isNaN(sectionId)) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø§Ù…ØªØ­Ø§Ù†ØŒ Ú©Ù„Ø§Ø³ Ø§ÙˆØ± Ø³ÛŒÚ©Ø´Ù† Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”', 'error');
                return;
            }
            showLoading();
            container.innerHTML = '';
            container.style.display = 'none';
            try {
                const students = (await getAllFromStore(STORES.STUDENTS)).filter(s => s.classId === classId && s.sectionId === sectionId);
                const allMarks = (await getAllFromStore(STORES.MARKS)).filter(m => m.examId === examId);
                const exam = await getFromStore(STORES.EXAMS, examId);
                if (students.length === 0) {
                    container.innerHTML = `<div class="form-container"><p>Ø§Ø³ Ú©Ù„Ø§Ø³/Ø³ÛŒÚ©Ø´Ù† Ù…ÛŒÚº Ú©ÙˆØ¦ÛŒ Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ù†ÛÛŒÚº ÛÛ’Û”</p></div>`;
                    container.style.display = 'block';
                    return;
                }
                for (const student of students) {
                    const studentMarks = allMarks.filter(m => m.studentId === student.id);
                    let totalObtained = 0;
                    let totalMarks = 0;
                    let resultStatus = 'Ú©Ø§Ù…ÛŒØ§Ø¨';
                    let marksTable = `
                <table class="table" style="font-size: 14px; margin-top: 10px;">
                    <thead><tr><th>Ù…Ø¶Ù…ÙˆÙ†</th><th>Ú©Ù„ Ù†Ù…Ø¨Ø±</th><th>Ø­Ø§ØµÙ„ Ú©Ø±Ø¯Û</th><th>Ù†ØªÛŒØ¬Û</th></tr></thead>
                    <tbody>
            `;
                    for (const mark of studentMarks) {
                        const subject = await getFromStore(STORES.SUBJECTS, mark.subjectId);
                        totalObtained += mark.obtainedMarks;
                        totalMarks += mark.totalMarks;
                        if (!mark.isPassed) resultStatus = 'Ù†Ø§Ú©Ø§Ù…';
                        marksTable += `
                    <tr>
                        <td>${subject ? subject.name : 'N/A'}</td>
                        <td>${mark.totalMarks}</td>
                        <td>${mark.obtainedMarks}</td>
                        <td>${mark.isPassed ? 'Ú©Ø§Ù…ÛŒØ§Ø¨' : 'Ù†Ø§Ú©Ø§Ù…'}</td>
                    </tr>
                `;
                    }
                    marksTable += `</tbody></table>`;
                    const percentage = totalMarks > 0 ? ((totalObtained / totalMarks) * 100).toFixed(2) : 0;
                    const cardHTML = `
                <div class="card" style="margin-bottom: 20px; page-break-inside: avoid;">
                    <h4 class="card-title" style="text-align: center; border-bottom: 1px solid #eee; padding-bottom: 10px;">${exam.name} - Ø±Ø²Ù„Ù¹ Ú©Ø§Ø±Úˆ</h4>
                    <div style="display: flex; justify-content: space-between;">
                        <p><strong>Ù†Ø§Ù…:</strong> ${student.name}</p>
                        <p><strong>Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø±:</strong> ${student.rollNumber}</p>
                    </div>
                     <div style="display: flex; justify-content: space-between;">
                        <p><strong>ÙˆØ§Ù„Ø¯ Ú©Ø§ Ù†Ø§Ù…:</strong> ${student.fatherName}</p>
                        <p><strong>Ú©Ù„Ø§Ø³:</strong> ${student.className} (${student.sectionName})</p>
                    </div>
                    ${marksTable}
                    <div style="display: flex; justify-content: space-around; background-color: #f9f9f9; padding: 10px; border-radius: 4px; margin-top: 15px;">
                        <p><strong>Ú©Ù„ Ø­Ø§ØµÙ„ Ú©Ø±Ø¯Û:</strong> ${totalObtained} / ${totalMarks}</p>
                        <p><strong>ÙÛŒØµØ¯:</strong> ${percentage}%</p>
                        <p><strong>Ù†ØªÛŒØ¬Û:</strong> ${resultStatus}</p>
                    </div>
                </div>
            `;
                    container.innerHTML += cardHTML;
                }
                container.style.display = 'block';
            } catch (error) {
                console.error("Error generating result cards:", error);
                showNotification('Ø±Ø²Ù„Ù¹ Ú©Ø§Ø±Úˆ Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”', 'error');
            } finally {
                hideLoading();
            }
        }
        async function searchStudentForFee() {
            const searchTerm = document.getElementById('fee-student-search').value;
            if (!searchTerm) return;
            showLoading();
            try {
                const allStudents = await getAllFromStore(STORES.STUDENTS);
                const student = allStudents.find(s => String(s.rollNumber) === searchTerm || s.name.toLowerCase().includes(searchTerm.toLowerCase()));
                if (!student) {
                    showNotification('Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ù†ÛÛŒÚº Ù…Ù„Ø§Û”', 'error');
                    document.getElementById('fee-student-details').style.display = 'none';
                    document.getElementById('fee-payment-form').style.display = 'none';
                    return;
                }
                document.getElementById('fee-roll-number').value = student.rollNumber;
                document.getElementById('fee-roll-number').dataset.studentId = student.id;
                document.getElementById('fee-student-name').value = student.name;
                document.getElementById('fee-class').value = student.className;
                document.getElementById('fee-category').value = student.feeCategory;
                document.getElementById('fee-monthly').value = student.monthlyFee;
                document.getElementById('fee-due').value = "0 (Calculation needed)";
                document.getElementById('fee-student-details').style.display = 'block';
                document.getElementById('fee-payment-form').style.display = 'block';
                document.getElementById('fee-history-container').style.display = 'block';
                loadFeeHistory(student.id);
            } catch (error) {
                console.error("Error searching student for fee:", error);
            } finally {
                hideLoading();
            }
        }
        async function loadFeeHistory(studentId) {
            const allFees = await getAllFromIndex(STORES.FEES, 'studentId', studentId);
            const historyTbody = document.querySelector('#fee-history-table tbody');
            historyTbody.innerHTML = '';
            if (allFees.length === 0) {
                historyTbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Ú©ÙˆØ¦ÛŒ ÙÛŒØ³ ÛØ³Ù¹Ø±ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’Û”</td></tr>';
                return;
            }
            allFees.forEach(fee => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${fee.receiptNumber}</td>
                    <td>${fee.month} ${fee.year}</td>
                    <td>${formatDate(fee.date)}</td>
                    <td>${formatCurrency(fee.amount)}</td>
                    <td>${formatCurrency(fee.fine)}</td>
                    <td>${formatCurrency(fee.discount)}</td>
                    <td>${formatCurrency(fee.total)}</td>
                    <td><button class="btn btn-sm btn-primary">Ø±Ø³ÛŒØ¯</button></td>
                `;
                historyTbody.appendChild(row);
            });
        }
        async function generateFeeReport() {
            const reportType = document.getElementById('fee-report-type').value;
            consttbody = document.querySelector('#fee-report-table tbody');
            const container = document.getElementById('fee-report-table-container');
            const summaryContainer = document.getElementById('fee-report-summary');
            showLoading();
            tbody.innerHTML = '';
            container.style.display = 'none';
            summaryContainer.style.display = 'none';
            try {
                let allFees = await getAllFromStore(STORES.FEES);
                let filteredFees = [];
                switch (reportType) {
                    case 'daily':
                        const date = document.getElementById('fee-report-date').value;
                        if (!date) { showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªØ§Ø±ÛŒØ® Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”', 'error'); return; }
                        filteredFees = allFees.filter(fee => fee.date === date);
                        break;
                    case 'monthly':
                        const month = document.getElementById('fee-report-month').value;
                        const year = parseInt(document.getElementById('fee-report-year').value);
                        if (!month || isNaN(year)) { showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù…ÛÛŒÙ†Û Ø§ÙˆØ± Ø³Ø§Ù„ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”', 'error'); return; }
                        filteredFees = allFees.filter(fee => fee.month === month && fee.year === year);
                        break;
                    case 'class':
                        const classId = parseInt(document.getElementById('fee-report-class').value);
                        if (isNaN(classId)) { showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ú©Ù„Ø§Ø³ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”', 'error'); return; }
                        const studentsInClass = (await getAllFromIndex(STORES.STUDENTS, 'classId', classId)).map(s => s.id);
                        filteredFees = allFees.filter(fee => studentsInClass.includes(fee.studentId));
                        break;
                    default:
                        filteredFees = allFees;
                }
                let totalCollected = 0;
                let paidStudents = new Set();
                for (const fee of filteredFees) {
                    const student = await getFromStore(STORES.STUDENTS, fee.studentId);
                    totalCollected += fee.total;
                    paidStudents.add(fee.studentId);
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${fee.receiptNumber}</td>
                <td>${student ? student.name : 'N/A'}</td>
                <td>${student ? student.className : 'N/A'}</td>
                <td>${fee.month}, ${fee.year}</td>
                <td>${formatDate(fee.date)}</td>
                <td>${formatCurrency(fee.amount)}</td>
                <td>${formatCurrency(fee.fine)}</td>
                <td>${formatCurrency(fee.discount)}</td>
                <td>${formatCurrency(fee.total)}</td>
            `;
                    tbody.appendChild(row);
                }
                if (filteredFees.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;">Ø§Ø³ Ù…Ø¯Øª Ú©Û’ Ù„ÛŒÛ’ Ú©ÙˆØ¦ÛŒ ÙÛŒØ³ Ø±ÛŒÚ©Ø§Ø±Úˆ Ù†ÛÛŒÚº Ù…Ù„Ø§Û”</td></tr>';
                }
                document.getElementById('fee-report-total-collected').value = formatCurrency(totalCollected);
                document.getElementById('fee-report-total-students').value = (await getCount(STORES.STUDENTS));
                document.getElementById('fee-report-paid-students').value = paidStudents.size;
                summaryContainer.style.display = 'block';
                container.style.display = 'block';
            } catch (error) {
                console.error("Error generating fee report:", error);
                showNotification('ÙÛŒØ³ Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”', 'error');
            } finally {
                hideLoading();
            }
        }
        async function generateDefaultersReport() {
            const classId = document.getElementById('defaulter-class').value;
            const month = document.getElementById('defaulter-month').value;
            const year = parseInt(document.getElementById('defaulter-year').value);
            const tbody = document.querySelector('#defaulters-table tbody');
            const container = document.getElementById('defaulters-table-container');
            if (!month || isNaN(year)) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù…ÛÛŒÙ†Û Ø§ÙˆØ± Ø³Ø§Ù„ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”', 'error');
                return;
            }
            showLoading();
            tbody.innerHTML = '';
            container.style.display = 'none';
            try {
                let students = await getAllFromStore(STORES.STUDENTS);
                if (classId !== 'all') {
                    students = students.filter(s => s.classId === parseInt(classId));
                }
                const feeRecords = await getAllFromStore(STORES.FEES);
                const paidFees = new Map();
                feeRecords.forEach(rec => {
                    const key = `${rec.studentId}-${rec.month}-${rec.year}`;
                    paidFees.set(key, true);
                });
                let hasDefaulters = false;
                for (const student of students) {
                    const lookupKey = `${student.id}-${month}-${year}`;
                    if (!paidFees.has(lookupKey)) {
                        hasDefaulters = true;
                        const row = document.createElement('tr');
                        row.innerHTML = `
                    <td>${student.rollNumber}</td>
                    <td>${student.name}</td>
                    <td>${student.className}</td>
                    <td>${formatCurrency(student.monthlyFee)}</td>
                    <td>${month}, ${year}</td>
                    <td>${formatCurrency(student.monthlyFee)}</td>
                    <td>${student.contact}</td>
                    <td><button class="btn btn-primary btn-sm">Ù†ÙˆÙ¹Ø³ Ø¨Ú¾ÛŒØ¬ÛŒÚº</button></td>
                `;
                        tbody.appendChild(row);
                    }
                }
                if (!hasDefaulters) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Ø§Ø³ Ù…ÛÛŒÙ†Û’ Ú©ÙˆØ¦ÛŒ ÚˆÛŒÙØ§Ù„Ù¹Ø± Ù†ÛÛŒÚº ÛÛ’Û”</td></tr>';
                }
                container.style.display = 'block';
            } catch (error) {
                console.error("Error generating defaulters report:", error);
                showNotification('ÚˆÛŒÙØ§Ù„Ù¹Ø±Ø² Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”', 'error');
            } finally {
                hideLoading();
            }
        }
        async function searchEmployeeForSalary() {
            const searchTerm = document.getElementById('salary-employee-search').value;
            const employeeType = document.getElementById('salary-employee-type').value;
            if (!searchTerm) return;
            showLoading();
            try {
                const storeName = employeeType === 'teacher' ? STORES.TEACHERS : STORES.STAFF;
                const allEmployees = await getAllFromStore(storeName);
                const employee = allEmployees.find(e => e.employeeId === searchTerm || e.name.toLowerCase().includes(searchTerm.toLowerCase()));
                if (!employee) {
                    showNotification('Ù…Ù„Ø§Ø²Ù… Ù†ÛÛŒÚº Ù…Ù„Ø§Û”', 'error');
                    document.getElementById('salary-employee-details').style.display = 'none';
                    return;
                }
                document.getElementById('salary-employee-id').value = employee.employeeId;
                document.getElementById('salary-employee-id').dataset.employeeId = employee.id;
                document.getElementById('salary-employee-name').value = employee.name;
                document.getElementById('salary-employee-designation').value = employee.designation || employee.qualification;
                document.getElementById('salary-basic').value = employee.basicSalary;
                document.getElementById('salary-allowances').value = employee.allowances || 0;
                document.getElementById('salary-total').value = (employee.basicSalary || 0) + (employee.allowances || 0);
                document.getElementById('salary-employee-details').style.display = 'block';
                document.getElementById('salary-payment-form').style.display = 'block';
            } catch (error) {
                console.error("Error searching employee:", error);
            } finally {
                hideLoading();
            }
        }
        async function generateSalaryReport() {
            const reportType = document.getElementById('salary-report-type').value;
            const employeeTypeFilter = document.getElementById('salary-report-employee-type').value;
            const tbody = document.querySelector('#salary-report-table tbody');
            const container = document.getElementById('salary-report-table-container');
            const summaryContainer = document.getElementById('salary-report-summary');
            showLoading();
            tbody.innerHTML = '';
            container.style.display = 'none';
            summaryContainer.style.display = 'none';
            try {
                let allSalaries = await getAllFromStore(STORES.SALARY);
                let filteredSalaries = [];
                switch (reportType) {
                    case 'monthly':
                        const month = document.getElementById('salary-report-month').value;
                        const year = parseInt(document.getElementById('salary-report-year').value);
                        if (!month || isNaN(year)) {
                            showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù…ÛÛŒÙ†Û Ø§ÙˆØ± Ø³Ø§Ù„ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”', 'error');
                            return;
                        }
                        filteredSalaries = allSalaries.filter(s => s.month === month && s.year === year);
                        break;
                    case 'employee':
                        const employeeIdVal = document.getElementById('salary-report-employee').value;
                        if (!employeeIdVal || employeeIdVal === 'all') {
                            showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø§ÛŒÚ© Ù…Ù„Ø§Ø²Ù… Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”', 'error');
                            return;
                        }
                        const employeeId = parseInt(employeeIdVal.split('_').pop());
                        filteredSalaries = allSalaries.filter(s => s.employeeId === employeeId);
                        break;
                    case 'yearly':
                        const reportYear = parseInt(document.getElementById('salary-report-year').value);
                        if (isNaN(reportYear)) {
                            showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø³Ø§Ù„ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”', 'error');
                            return;
                        }
                        filteredSalaries = allSalaries.filter(s => s.year === reportYear);
                        break;
                    default:
                        filteredSalaries = allSalaries;
                }
                if (employeeTypeFilter !== 'all') {
                    filteredSalaries = filteredSalaries.filter(s => s.employeeType === employeeTypeFilter);
                }
                let totalPaid = 0;
                let paidEmployees = new Set();
                for (const salary of filteredSalaries) {
                    const employeeStore = salary.employeeType === 'teacher' ? STORES.TEACHERS : STORES.STAFF;
                    const employee = await getFromStore(employeeStore, salary.employeeId);
                    totalPaid += salary.total;
                    paidEmployees.add(salary.employeeId);
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${salary.voucherNumber || '-'}</td>
                <td>${salary.employeeName}</td>
                <td>${employee ? (employee.designation || employee.specialization) : 'N/A'}</td>
                <td>${salary.month}, ${salary.year}</td>
                <td>${formatDate(salary.date)}</td>
                <td>${formatCurrency(salary.basicSalary)}</td>
                <td>${formatCurrency(salary.allowances)}</td>
                <td>${formatCurrency(salary.deductions + salary.absenceDeduction + salary.tax)}</td>
                <td>${formatCurrency(salary.total)}</td>
            `;
                    tbody.appendChild(row);
                }
                if (filteredSalaries.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;">Ø§Ø³ Ù…Ø¹ÛŒØ§Ø± Ú©Û’ Ù…Ø·Ø§Ø¨Ù‚ Ú©ÙˆØ¦ÛŒ ØªÙ†Ø®ÙˆØ§Û Ø±ÛŒÚ©Ø§Ø±Úˆ Ù†ÛÛŒÚº Ù…Ù„Ø§Û”</td></tr>';
                }
                document.getElementById('salary-report-total-paid').value = formatCurrency(totalPaid);
                document.getElementById('salary-report-total-employees').value = (await getCount(STORES.TEACHERS)) + (await getCount(STORES.STAFF));
                document.getElementById('salary-report-paid-employees').value = paidEmployees.size;
                summaryContainer.style.display = 'block';
                container.style.display = 'block';
            } catch (error) {
                console.error("Error generating salary report:", error);
                showNotification('ØªÙ†Ø®ÙˆØ§Û Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”', 'error');
            } finally {
                hideLoading();
            }
        }
        async function generateReport() {
            const type = document.getElementById('report-type').value;
            const outputDiv = document.getElementById('report-output');
            if (!type) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø±Ù¾ÙˆØ±Ù¹ Ú©ÛŒ Ù‚Ø³Ù… Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            outputDiv.style.display = 'block';
            outputDiv.innerHTML = '<div class="spinner"></div>';
            try {
                let htmlContent = '';
                switch (type) {
                    case 'student_strength':
                        htmlContent = await generateStudentStrengthReport();
                        break;
                    case 'class_list':
                        htmlContent = await generateClassListReport();
                        break;
                    case 'fee_defaulters':
                        showNotification('ÙÛŒØ³ ÚˆÛŒÙØ§Ù„Ù¹Ø±Ø² Ø±Ù¾ÙˆØ±Ù¹ Ú©Û’ Ù„ÛŒÛ’ØŒ Ø¨Ø±Ø§Û Ú©Ø±Ù… "ÙÛŒØ³" Ø³ÛŒÚ©Ø´Ù† Ù…ÛŒÚº "Ø¨Ù‚Ø§ÛŒØ§ ÙÛŒØ³ ÙˆØ§Ù„Û’" Ù¹ÛŒØ¨ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚºÛ”', 'info');
                        htmlContent = '<p>ÛŒÛ Ø±Ù¾ÙˆØ±Ù¹ "ÙÛŒØ³" Ø³ÛŒÚ©Ø´Ù† Ù…ÛŒÚº Ø¯Ø³ØªÛŒØ§Ø¨ ÛÛ’Û”</p>';
                        break;
                    default:
                        htmlContent = '<p>Ù…Ù†ØªØ®Ø¨ Ú©Ø±Ø¯Û Ø±Ù¾ÙˆØ±Ù¹ Ú©ÛŒ Ù‚Ø³Ù… Ú©Û’ Ù„ÛŒÛ’ Ú©ÙˆØ¦ÛŒ Ø¹Ù…Ù„ Ø¯Ø±Ø¢Ù…Ø¯ Ù†ÛÛŒÚº ÛÛ’Û”</p>';
                }
                outputDiv.innerHTML = htmlContent;
            } catch (e) {
                console.error("Error in generic report generation:", e);
                outputDiv.innerHTML = '<p style="color:red;">Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”</p>';
            } finally {
            }
        }
        function toggleFeeReportFields() {
            const reportType = document.getElementById('fee-report-type').value;
            document.getElementById('fee-report-date-row').style.display = 'none';
            document.getElementById('fee-report-month-row').style.display = 'none';
            document.getElementById('fee-report-class-row').style.display = 'none';
            switch (reportType) {
                case 'daily': document.getElementById('fee-report-date-row').style.display = 'flex'; break;
                case 'monthly':
                case 'yearly':
                    document.getElementById('fee-report-month-row').style.display = 'flex'; break;
                case 'class': document.getElementById('fee-report-class-row').style.display = 'flex'; break;
            }
        }
        function toggleSalaryReportFields() {
            const reportType = document.getElementById('salary-report-type').value;
            document.getElementById('salary-report-month-row').style.display = 'none';
            document.getElementById('salary-report-employee-row').style.display = 'none';
            switch (reportType) {
                case 'monthly':
                case 'yearly':
                    document.getElementById('salary-report-month-row').style.display = 'flex';
                    break;
                case 'employee':
                    document.getElementById('salary-report-employee-row').style.display = 'flex';
                    loadEmployeesForSalaryReport();
                    break;
            }
        }
        async function loadEmployeesForSalaryReport() {
            console.log("loadEmployeesForSalaryReport needs implementation.");
        }
        async function loadEmployeesForSalaryStructure() {
            const employeeType = document.getElementById('structure-employee-type').value;
            const storeName = employeeType === 'teacher' ? STORES.TEACHERS : STORES.STAFF;
            const employees = await getAllFromStore(storeName);
            const select = document.getElementById('structure-employee');
            select.innerHTML = '';
            employees.forEach(e => {
                select.innerHTML += `<option value="${e.id}">${e.name} (${e.employeeId})</option>`;
            });
        }
        async function populateSectionsForStudentForm() {
            const classId = parseInt(document.getElementById('student-class').value);
            const sectionDropdown = document.getElementById('student-section');
            sectionDropdown.innerHTML = '<option value="">Ù¾ÛÙ„Û’ Ú©Ù„Ø§Ø³ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</option>';
            if (!classId) {
                return;
            }
            try {
                const sections = await getAllFromIndex(STORES.SECTIONS, 'classId', classId);
                if (sections && sections.length > 0) {
                    sections.forEach(section => {
                        const option = document.createElement('option');
                        option.value = section.id;
                        option.textContent = section.name;
                        sectionDropdown.appendChild(option);
                    });
                } else {
                    sectionDropdown.innerHTML = '<option value="">Ø§Ø³ Ú©Ù„Ø§Ø³ Ù…ÛŒÚº Ú©ÙˆØ¦ÛŒ Ø³ÛŒÚ©Ø´Ù† Ù†ÛÛŒÚº</option>';
                }
            } catch (error) {
                console.error('Error populating sections dropdown:', error);
                sectionDropdown.innerHTML = '<option value="">Ø³ÛŒÚ©Ø´Ù† Ù„ÙˆÚˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ</option>';
            }
        }
        async function saveThemeSettings(e) { e.preventDefault(); showNotification("Theme settings saved (simulation).", "success"); }
        async function resetThemeSettings() { showNotification("Theme reset (simulation).", "info"); }
        async function saveGeneralSettings(e) { e.preventDefault(); showNotification("General settings saved (simulation).", "success"); }
        async function saveAcademicSettings(e) { e.preventDefault(); showNotification("Academic settings saved (simulation).", "success"); }
        async function loadDashboardData() {
            try {
                const totalStudents = await getCount(STORES.STUDENTS);
                document.getElementById('total-students').textContent = totalStudents;
                const totalTeachers = await getCount(STORES.TEACHERS);
                document.getElementById('total-teachers').textContent = totalTeachers;
                const totalClasses = await getCount(STORES.CLASSES);
                document.getElementById('total-classes').textContent = totalClasses;
                const today = new Date().toISOString().split('T');
                const attendancePercentage = await getTodayAttendancePercentage(today);
                document.getElementById('today-attendance').textContent = attendancePercentage + '%';
                const currentMonth = new Date().getMonth() + 1;
                const currentYear = new Date().getFullYear();
                const monthlyFee = await getMonthlyFeeCollection(currentMonth, currentYear);
                document.getElementById('monthly-fee').textContent = monthlyFee + ' Ø±ÙˆÙ¾Û’';
                const pendingFee = await getTotalPendingFee();
                document.getElementById('pending-fee').textContent = pendingFee + ' Ø±ÙˆÙ¾Û’';
                await loadUpcomingEvents();
                await loadRecentActivities();
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showNotification('ÚˆÛŒØ´ Ø¨ÙˆØ±Úˆ ÚˆÛŒÙ¹Ø§ Ù„ÙˆÚˆÙ†Ú¯ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            }
        }
        async function loadUpcomingEvents() {
            try {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const events = await getAllFromIndex(STORES.EVENTS, 'date', IDBKeyRange.lowerBound(today.toISOString()));
                events.sort((a, b) => new Date(a.date) - new Date(b.date));
                const upcomingEvents = events.slice(0, 5);
                const tbody = document.querySelector('#events-table tbody');
                tbody.innerHTML = '';
                if (upcomingEvents.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="5" style="text-align: center;">Ú©ÙˆØ¦ÛŒ Ø¢Ù†Û’ ÙˆØ§Ù„Ø§ Ù¾Ø±ÙˆÚ¯Ø±Ø§Ù… Ù†ÛÛŒÚº ÛÛ’</td>`;
                    tbody.appendChild(row);
                    return;
                }
                upcomingEvents.forEach((event, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${event.title}</td>
                        <td>${formatDate(event.date)}</td>
                        <td>${event.location || '-'}</td>
                        <td>${event.description || '-'}</td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading upcoming events:', error);
                showNotification('Ø¢Ù†Û’ ÙˆØ§Ù„Û’ Ù¾Ø±ÙˆÚ¯Ø±Ø§Ù…ÙˆÚº Ú©ÛŒ Ù„ÙˆÚˆÙ†Ú¯ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            }
        }
        async function loadRecentActivities() {
            try {
                const activities = await getAllFromStore(STORES.ACTIVITIES, 5);
                activities.sort((a, b) => new Date(b.date) - new Date(a.date));
                const tbody = document.querySelector('#activities-table tbody');
                tbody.innerHTML = '';
                if (activities.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="5" style="text-align: center;">Ú©ÙˆØ¦ÛŒ Ø­Ø§Ù„ÛŒÛ Ø³Ø±Ú¯Ø±Ù…ÛŒ Ù†ÛÛŒÚº ÛÛ’</td>`;
                    tbody.appendChild(row);
                    return;
                }
                activities.forEach((activity, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${activity.description}</td>
                        <td>${formatDateTime(activity.date)}</td>
                        <td>${activity.user || '-'}</td>
                        <td>${activity.details || '-'}</td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading recent activities:', error);
                showNotification('Ø­Ø§Ù„ÛŒÛ Ø³Ø±Ú¯Ø±Ù…ÛŒÙˆÚº Ú©ÛŒ Ù„ÙˆÚˆÙ†Ú¯ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            }
        }
        async function getTodayAttendancePercentage(date) {
            try {
                const attendanceRecords = await getAllFromIndex(STORES.ATTENDANCE, 'date', date);
                if (attendanceRecords.length === 0) {
                    return 0;
                }
                const presentCount = attendanceRecords.filter(record => record.status === 'present').length;
                const percentage = Math.round((presentCount / attendanceRecords.length) * 100);
                return percentage;
            } catch (error) {
                console.error('Error getting today attendance percentage:', error);
                return 0;
            }
        }
        async function getMonthlyFeeCollection(month, year) {
            try {
                const feeRecords = await getAllFromStore(STORES.FEES);
                const monthlyRecords = feeRecords.filter(record => {
                    return record.month === month && record.year === year;
                });
                const totalAmount = monthlyRecords.reduce((total, record) => {
                    return total + (record.amount + record.fine - record.discount);
                }, 0);
                return totalAmount;
            } catch (error) {
                console.error('Error getting monthly fee collection:', error);
                return 0;
            }
        }
        async function getTotalPendingFee() {
            try {
                const students = await getAllFromStore(STORES.STUDENTS);
                const feeStructures = await getAllFromStore(STORES.FEE_STRUCTURE);
                const feeRecords = await getAllFromStore(STORES.FEES);
                let totalPendingFee = 0;
                const currentDate = new Date();
                const currentMonth = currentDate.getMonth() + 1;
                const currentYear = currentDate.getFullYear();
                for (const student of students) {
                    const feeStructure = feeStructures.find(fs =>
                        fs.classId === student.classId && fs.category === student.feeCategory
                    );
                    if (!feeStructure) continue;
                    const monthlyFee = feeStructure.monthlyFee || 0;
                    const admissionDate = new Date(student.admissionDate);
                    const startMonth = admissionDate.getMonth() + 1;
                    const startYear = admissionDate.getFullYear();
                    for (let year = startYear; year <= currentYear; year++) {
                        const startMonthInYear = (year === startYear) ? startMonth : 1;
                        const endMonthInYear = (year === currentYear) ? currentMonth : 12;
                        for (let month = startMonthInYear; month <= endMonthInYear; month++) {
                            const feeRecord = feeRecords.find(record =>
                                record.studentId === student.id &&
                                record.month === month &&
                                record.year === year
                            );
                            if (!feeRecord) {
                                totalPendingFee += monthlyFee;
                            }
                        }
                    }
                }
                return totalPendingFee;
            } catch (error) {
                console.error('Error getting total pending fee:', error);
                return 0;
            }
        }
        async function loadSettings() {
            try {
                const settings = await getFromStore(STORES.SETTINGS, 'general');
                if (!settings) {
                    const defaultSettings = {
                        id: 'general',
                        schoolName: 'ÚˆÛŒÙ†ÛŒ Ù…Ø¯Ø±Ø³Û',
                        schoolShortName: 'DM',
                        schoolAddress: 'Ù…Ø¯Ø±Ø³Û Ø±ÙˆÚˆØŒ Ø´ÛØ±',
                        schoolPhone: '0300-1234567',
                        schoolEmail: 'info@deenimadrasa.com',
                        schoolWebsite: 'www.deenimadrasa.com',
                        currentSession: new Date().getFullYear() + '-' + (new Date().getFullYear() + 1),
                        sessionStart: new Date(new Date().getFullYear(), 3, 1).toISOString().split('T'),
                        sessionEnd: new Date(new Date().getFullYear() + 1, 2, 31).toISOString().split('T'),
                        schoolTimeStart: '08:00',
                        schoolTimeEnd: '14:00',
                        periodDuration: 45,
                        weeklyHoliday: ['Ø¬Ù…Ø¹Û'],
                        feeDueDay: 10,
                        feeLateFinÃ©: 50,
                        libraryReturnDays: 14,
                        libraryLateFine: 5,
                        primaryColor: '#3498db',
                        secondaryColor: '#2c3e50',
                        fontSize: 'medium',
                        fontFamily: 'Jameel Noori Nastaleeq',
                        sidebarPosition: 'right',
                        sidebarTheme: 'dark',
                        createdAt: new Date().toISOString()
                    };
                    await addToStore(STORES.SETTINGS, defaultSettings);
                    console.log('Default settings created');
                } else {
                    console.log('Settings loaded successfully');
                }
                applySettings();
            } catch (error) {
                console.error('Error loading settings:', error);
                showNotification('ØªØ±ØªÛŒØ¨Ø§Øª Ù„ÙˆÚˆÙ†Ú¯ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            }
        }
        async function applySettings() {
            try {
                const settings = await getFromStore(STORES.SETTINGS, 'general');
                if (!settings) return;
                document.documentElement.style.setProperty('--primary-color', settings.primaryColor || '#3498db');
                document.documentElement.style.setProperty('--secondary-color', settings.secondaryColor || '#2c3e50');
                let fontSizeValue = '16px';
                switch (settings.fontSize) {
                    case 'small': fontSizeValue = '14px'; break;
                    case 'medium': fontSizeValue = '16px'; break;
                    case 'large': fontSizeValue = '18px'; break;
                }
                document.documentElement.style.setProperty('--font-size', fontSizeValue);
                document.documentElement.style.setProperty('--font-family', settings.fontFamily || 'Jameel Noori Nastaleeq');
                const sidebar = document.getElementById('sidebar');
                const mainContainer = document.getElementById('mainContainer');
                if (settings.sidebarPosition === 'left') {
                    sidebar.style.right = 'auto';
                    sidebar.style.left = '0';
                    mainContainer.style.marginRight = '0';
                    mainContainer.style.marginLeft = '250px';
                } else {
                    sidebar.style.right = '0';
                    sidebar.style.left = 'auto';
                    mainContainer.style.marginRight = '250px';
                    mainContainer.style.marginLeft = '0';
                }
                if (settings.sidebarTheme === 'light') {
                    sidebar.style.backgroundColor = '#f5f5f5';
                    sidebar.style.color = '#333';
                } else {
                    sidebar.style.backgroundColor = '#34495e';
                    sidebar.style.color = 'white';
                }
                console.log('Settings applied successfully');
            } catch (error) {
                console.error('Error applying settings:', error);
            }
        }
        async function loadDropdownData() {
            try {
                await loadClassDropdowns();
                await loadSubjectDropdowns();
                await loadTeacherDropdowns();
                console.log('Dropdown data loaded successfully');
            } catch (error) {
                console.error('Error loading dropdown data:', error);
                showNotification('ÚˆØ±Ø§Ù¾ ÚˆØ§Ø¤Ù† ÚˆÛŒÙ¹Ø§ Ù„ÙˆÚˆÙ†Ú¯ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            }
        }
        async function loadClassDropdowns() {
            try {
                const classes = await getAllFromStore(STORES.CLASSES);
                const classDropdowns = document.querySelectorAll('select[id$="-class"]');
                classDropdowns.forEach(dropdown => {
                    const existingOptions = Array.from(dropdown.options).filter(option => {
                        return option.value === 'all' || option.dataset.fixed === 'true';
                    });
                    dropdown.innerHTML = '';
                    existingOptions.forEach(option => {
                        dropdown.appendChild(option);
                    });
                    classes.forEach(cls => {
                        const option = document.createElement('option');
                        option.value = cls.id;
                        option.textContent = cls.name;
                        dropdown.appendChild(option);
                    });
                });
                console.log('Class dropdowns loaded successfully');
            } catch (error) {
                console.error('Error loading class dropdowns:', error);
            }
        }
        async function loadSubjectDropdowns() {
            try {
                const subjects = await getAllFromStore(STORES.SUBJECTS);
                const subjectDropdowns = document.querySelectorAll('select[id$="-subject"]');
                subjectDropdowns.forEach(dropdown => {
                    const existingOptions = Array.from(dropdown.options).filter(option => {
                        return option.value === 'all' || option.dataset.fixed === 'true';
                    });
                    dropdown.innerHTML = '';
                    existingOptions.forEach(option => {
                        dropdown.appendChild(option);
                    });
                    subjects.forEach(subject => {
                        const option = document.createElement('option');
                        option.value = subject.id;
                        option.textContent = subject.name;
                        dropdown.appendChild(option);
                    });
                });
                console.log('Subject dropdowns loaded successfully');
            } catch (error) {
                console.error('Error loading subject dropdowns:', error);
            }
        }
        async function loadStudentsTable(studentsToLoad = null) {
            try {
                const students = studentsToLoad === null ? await getAllFromStore(STORES.STUDENTS) : studentsToLoad;
                const tbody = document.querySelector('#students-table tbody');
                tbody.innerHTML = '';
                if (!students || students.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Ú©ÙˆØ¦ÛŒ Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’ ÛŒØ§ ÙÙ„Ù¹Ø± Ø³Û’ Ú©ÙˆØ¦ÛŒ Ù†ØªÛŒØ¬Û Ù†ÛÛŒÚº Ù…Ù„Ø§Û”</td></tr>';
                    return;
                }
                for (const student of students) {
                    const row = document.createElement('tr');
                    const classData = student.classId ? await getFromStore(STORES.CLASSES, student.classId) : null;
                    const sectionData = student.sectionId ? await getFromStore(STORES.SECTIONS, student.sectionId) : null;
                    row.innerHTML = `
                <td>${student.rollNumber}</td>
                <td>${student.name}</td>
                <td>${student.fatherName}</td>
                <td>${classData ? classData.name : 'N/A'}</td>
                <td>${sectionData ? sectionData.name : 'N/A'}</td>
                <td>${student.contact}</td>
                <td>${formatDate(student.admissionDate)}</td>
                <td class="no-print">
                    <button class="btn btn-primary btn-sm" onclick="editStudent(${student.id})">ØªØ±Ù…ÛŒÙ…</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteStudent(${student.id})">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button>
                </td>
            `;
                    tbody.appendChild(row);
                }
            } catch (error) {
                console.error('Error loading students table:', error);
                const tbody = document.querySelector('#students-table tbody');
                if (tbody) tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ÙÛØ±Ø³Øª Ù„ÙˆÚˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”</td></tr>';
            }
        }
        async function editStudent(id) {
            showLoading();
            try {
                const student = await getFromStore(STORES.STUDENTS, id);
                if (!student) {
                    showNotification('Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©Ø§ Ø±ÛŒÚ©Ø§Ø±Úˆ Ù†ÛÛŒÚº Ù…Ù„Ø§Û”', 'error');
                    return;
                }
                const form = document.getElementById('student-form');
                form.dataset.editId = id;
                document.getElementById('student-name').value = student.name;
                document.getElementById('student-father').value = student.fatherName;
                document.getElementById('student-dob').value = student.dob;
                document.getElementById('student-gender').value = student.gender;
                document.getElementById('student-class').value = student.classId;
                await populateSectionsForStudentForm();
                document.getElementById('student-section').value = student.sectionId;
                document.getElementById('student-contact').value = student.contact;
                document.getElementById('student-email').value = student.email;
                document.getElementById('student-guardian').value = student.guardian;
                document.getElementById('student-guardian-contact').value = student.guardianContact;
                document.getElementById('student-address').value = student.address;
                document.getElementById('student-admission-date').value = student.admissionDate;
                document.getElementById('student-fee-category').value = student.feeCategory;
                document.getElementById('student-monthly-fee').value = student.monthlyFee;
                document.getElementById('student-notes').value = student.notes;
                document.querySelector('.tab[data-tab="add-student"]').click();
                form.querySelector('button[type="submit"]').textContent = 'Ø±ÛŒÚ©Ø§Ø±Úˆ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø±ÛŒÚº';
            } catch (e) {
                showNotification('ØªØ±Ù…ÛŒÙ… Ú©Û’ Ù„ÛŒÛ’ ÚˆÛŒÙ¹Ø§ Ù„ÙˆÚˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”', 'error');
                console.error(e);
            } finally {
                hideLoading();
            }
        }
        async function deleteStudent(id) {
            if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø³ Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©Ùˆ Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) {
                console.log('Deleting student with ID:', id);
                await deleteFromStore(STORES.STUDENTS, id);
                loadStudentsTable();
                showNotification('Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©Ùˆ Ø­Ø°Ù Ú©Ø± Ø¯ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’Û”', 'success');
            }
        }
        function editTeacher(id) {
            console.log('Editing teacher with ID:', id);
            showNotification('ØªØ±Ù…ÛŒÙ… Ú©Ø§ ÙÙ†Ú©Ø´Ù† Ø§Ø¨Ú¾ÛŒ Ø²ÛŒØ± ØªØ¹Ù…ÛŒØ± ÛÛ’Û”', 'info');
        }
        async function deleteTeacher(id) {
            if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø³ Ø§Ø³ØªØ§Ø¯ Ú©Ùˆ Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) {
                console.log('Deleting teacher with ID:', id);
                await deleteFromStore(STORES.TEACHERS, id);
                loadTeachersTable();
                showNotification('Ø§Ø³ØªØ§Ø¯ Ú©Ùˆ Ø­Ø°Ù Ú©Ø± Ø¯ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’Û”', 'success');
            }
        }
        async function checkAndLoadSampleData() {
            try {
                const studentsCount = await getCount(STORES.STUDENTS);
                const teachersCount = await getCount(STORES.TEACHERS);
                const classesCount = await getCount(STORES.CLASSES);
                if (studentsCount === 0 && teachersCount === 0 && classesCount === 0) {
                    await loadSampleData();
                    console.log('Sample data loaded successfully');
                } else {
                    console.log('Database already contains data, skipping sample data loading');
                }
            } catch (error) {
                console.error('Error checking and loading sample data:', error);
                showNotification('Ø³ÛŒÙ…Ù¾Ù„ ÚˆÛŒÙ¹Ø§ Ù„ÙˆÚˆÙ†Ú¯ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            }
        }
        async function loadSampleData() {
            try {
                showLoading();
                const classesData = [
                    { name: 'Ù¾ÛÙ„ÛŒ Ø¬Ù…Ø§Ø¹Øª', level: 'Ø§Ø¨ØªØ¯Ø§Ø¦ÛŒ', inChargeId: null, roomNumber: '101', monthlyFee: 500, admissionFee: 1000 },
                    { name: 'Ø¯ÙˆØ³Ø±ÛŒ Ø¬Ù…Ø§Ø¹Øª', level: 'Ø§Ø¨ØªØ¯Ø§Ø¦ÛŒ', inChargeId: null, roomNumber: '102', monthlyFee: 500, admissionFee: 1000 },
                    { name: 'ØªÛŒØ³Ø±ÛŒ Ø¬Ù…Ø§Ø¹Øª', level: 'Ø§Ø¨ØªØ¯Ø§Ø¦ÛŒ', inChargeId: null, roomNumber: '103', monthlyFee: 600, admissionFee: 1000 },
                    { name: 'Ú†ÙˆØªÚ¾ÛŒ Ø¬Ù…Ø§Ø¹Øª', level: 'Ø§Ø¨ØªØ¯Ø§Ø¦ÛŒ', inChargeId: null, roomNumber: '104', monthlyFee: 600, admissionFee: 1000 },
                    { name: 'Ù¾Ø§Ù†Ú†ÙˆÛŒÚº Ø¬Ù…Ø§Ø¹Øª', level: 'Ø§Ø¨ØªØ¯Ø§Ø¦ÛŒ', inChargeId: null, roomNumber: '105', monthlyFee: 700, admissionFee: 1000 },
                    { name: 'Ú†Ú¾Ù¹ÛŒ Ø¬Ù…Ø§Ø¹Øª', level: 'Ø«Ø§Ù†ÙˆÛŒ', inChargeId: null, roomNumber: '201', monthlyFee: 800, admissionFee: 1500 },
                    { name: 'Ø³Ø§ØªÙˆÛŒÚº Ø¬Ù…Ø§Ø¹Øª', level: 'Ø«Ø§Ù†ÙˆÛŒ', inChargeId: null, roomNumber: '202', monthlyFee: 800, admissionFee: 1500 },
                    { name: 'Ø¢Ù¹Ú¾ÙˆÛŒÚº Ø¬Ù…Ø§Ø¹Øª', level: 'Ø«Ø§Ù†ÙˆÛŒ', inChargeId: null, roomNumber: '203', monthlyFee: 900, admissionFee: 1500 },
                    { name: 'Ù†ÙˆÛŒÚº Ø¬Ù…Ø§Ø¹Øª', level: 'Ø³ÛŒÙ†ÛŒØ¦Ø±', inChargeId: null, roomNumber: '301', monthlyFee: 1000, admissionFee: 2000 },
                    { name: 'Ø¯Ø³ÙˆÛŒÚº Ø¬Ù…Ø§Ø¹Øª', level: 'Ø³ÛŒÙ†ÛŒØ¦Ø±', inChargeId: null, roomNumber: '302', monthlyFee: 1000, admissionFee: 2000 },
                    { name: 'Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù†', level: 'Ø®ØµÙˆØµÛŒ', inChargeId: null, roomNumber: '401', monthlyFee: 1200, admissionFee: 2500 },
                    { name: 'Ù†Ø§Ø¸Ø±Û Ù‚Ø±Ø¢Ù†', level: 'Ø®ØµÙˆØµÛŒ', inChargeId: null, roomNumber: '402', monthlyFee: 800, admissionFee: 1500 },
                ];
                const classIds = [];
                for (const classData of classesData) {
                    const id = await addToStore(STORES.CLASSES, classData);
                    classIds.push(id);
                }
                const sectionNames = ['Ø§Ù„Ù', 'Ø¨', 'Ø¬'];
                for (const classId of classIds) {
                    for (const sectionName of sectionNames) {
                        await addToStore(STORES.SECTIONS, {
                            classId: classId,
                            name: sectionName,
                            inChargeId: null,
                            createdAt: new Date().toISOString()
                        });
                    }
                }
                const subjectsData = [
                    { name: 'Ù‚Ø±Ø¢Ù† Ù…Ø¬ÛŒØ¯', code: 'QUR', type: 'Ù‚Ø±Ø¢Ù†', periods: 5, details: 'Ù‚Ø±Ø¢Ù† Ù…Ø¬ÛŒØ¯ Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…' },
                    { name: 'Ù†Ø§Ø¸Ø±Û Ù‚Ø±Ø¢Ù†', code: 'NAZ', type: 'Ù‚Ø±Ø¢Ù†', periods: 5, details: 'Ù‚Ø±Ø¢Ù† Ù…Ø¬ÛŒØ¯ Ú©ÛŒ Ù†Ø§Ø¸Ø±Û ØªØ¹Ù„ÛŒÙ…' },
                    { name: 'Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù†', code: 'HIF', type: 'Ù‚Ø±Ø¢Ù†', periods: 10, details: 'Ù‚Ø±Ø¢Ù† Ù…Ø¬ÛŒØ¯ Ú©Ø§ Ø­ÙØ¸' },
                    { name: 'ØªØ¬ÙˆÛŒØ¯', code: 'TAJ', type: 'Ù‚Ø±Ø¢Ù†', periods: 3, details: 'Ù‚Ø±Ø¢Ù† Ù…Ø¬ÛŒØ¯ Ú©ÛŒ ØµØ­ÛŒØ­ Ù‚Ø±Ø£Øª' },
                    { name: 'ØªÙØ³ÛŒØ± Ù‚Ø±Ø¢Ù†', code: 'TAF', type: 'Ù‚Ø±Ø¢Ù†', periods: 3, details: 'Ù‚Ø±Ø¢Ù† Ù…Ø¬ÛŒØ¯ Ú©ÛŒ ØªÙØ³ÛŒØ±' },
                    { name: 'Ø­Ø¯ÛŒØ«', code: 'HAD', type: 'Ø­Ø¯ÛŒØ«', periods: 4, details: 'Ø§Ø­Ø§Ø¯ÛŒØ« Ù†Ø¨ÙˆÛŒ ØµÙ„ÛŒ Ø§Ù„Ù„Û Ø¹Ù„ÛŒÛ ÙˆØ³Ù„Ù… Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…' },
                    { name: 'ÙÙ‚Û', code: 'FIQ', type: 'ÙÙ‚Û', periods: 3, details: 'Ø§Ø³Ù„Ø§Ù…ÛŒ ÙÙ‚Û Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…' },
                    { name: 'Ø¹Ù‚Ø§Ø¦Ø¯', code: 'AQA', type: 'Ø¹Ù‚ÛŒØ¯Û', periods: 2, details: 'Ø§Ø³Ù„Ø§Ù…ÛŒ Ø¹Ù‚Ø§Ø¦Ø¯ Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…' },
                    { name: 'Ø³ÛŒØ±Øª Ø§Ù„Ù†Ø¨ÛŒ', code: 'SIR', type: 'Ø³ÛŒØ±Øª', periods: 2, details: 'Ø³ÛŒØ±Øª Ø§Ù„Ù†Ø¨ÛŒ ØµÙ„ÛŒ Ø§Ù„Ù„Û Ø¹Ù„ÛŒÛ ÙˆØ³Ù„Ù… Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…' },
                    { name: 'Ø§Ø®Ù„Ø§Ù‚ÛŒØ§Øª', code: 'AKH', type: 'Ø§Ø®Ù„Ø§Ù‚', periods: 2, details: 'Ø§Ø³Ù„Ø§Ù…ÛŒ Ø§Ø®Ù„Ø§Ù‚ÛŒØ§Øª Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…' },
                    { name: 'Ø¹Ø±Ø¨ÛŒ', code: 'ARB', type: 'Ø¹Ø±Ø¨ÛŒ', periods: 4, details: 'Ø¹Ø±Ø¨ÛŒ Ø²Ø¨Ø§Ù† Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…' },
                    { name: 'Ø§Ø±Ø¯Ùˆ', code: 'URD', type: 'Ø§Ø±Ø¯Ùˆ', periods: 4, details: 'Ø§Ø±Ø¯Ùˆ Ø²Ø¨Ø§Ù† Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…' },
                    { name: 'Ø§Ù†Ú¯Ø±ÛŒØ²ÛŒ', code: 'ENG', type: 'Ø§Ù†Ú¯Ø±ÛŒØ²ÛŒ', periods: 4, details: 'Ø§Ù†Ú¯Ø±ÛŒØ²ÛŒ Ø²Ø¨Ø§Ù† Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…' },
                    { name: 'Ø±ÛŒØ§Ø¶ÛŒ', code: 'MAT', type: 'Ø±ÛŒØ§Ø¶ÛŒ', periods: 5, details: 'Ø±ÛŒØ§Ø¶ÛŒ Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…' },
                    { name: 'Ø³Ø§Ø¦Ù†Ø³', code: 'SCI', type: 'Ø³Ø§Ø¦Ù†Ø³', periods: 4, details: 'Ø³Ø§Ø¦Ù†Ø³ Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…' },
                    { name: 'Ø³Ù…Ø§Ø¬ÛŒ Ø¹Ù„ÙˆÙ…', code: 'SOC', type: 'Ø³Ù…Ø§Ø¬ÛŒ Ø¹Ù„ÙˆÙ…', periods: 3, details: 'Ø³Ù…Ø§Ø¬ÛŒ Ø¹Ù„ÙˆÙ… Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…' },
                    { name: 'Ù¾Ø§Ú©Ø³ØªØ§Ù† Ø³Ù¹ÚˆÛŒØ²', code: 'PAK', type: 'Ø³Ù…Ø§Ø¬ÛŒ Ø¹Ù„ÙˆÙ…', periods: 2, details: 'Ù¾Ø§Ú©Ø³ØªØ§Ù† Ú©ÛŒ ØªØ§Ø±ÛŒØ® Ø§ÙˆØ± Ø¬ØºØ±Ø§ÙÛŒÛ' },
                    { name: 'Ø§Ø³Ù„Ø§Ù…ÛŒØ§Øª', code: 'ISL', type: 'Ø§Ø³Ù„Ø§Ù…ÛŒØ§Øª', periods: 3, details: 'Ø§Ø³Ù„Ø§Ù…ÛŒØ§Øª Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…' },
                    { name: 'Ú©Ù…Ù¾ÛŒÙˆÙ¹Ø±', code: 'COM', type: 'Ú©Ù…Ù¾ÛŒÙˆÙ¹Ø±', periods: 2, details: 'Ú©Ù…Ù¾ÛŒÙˆÙ¹Ø± Ú©ÛŒ ØªØ¹Ù„ÛŒÙ…' },
                    { name: 'ØµØ­Øª Ùˆ Ø¬Ø³Ù…Ø§Ù†ÛŒ ØªØ¹Ù„ÛŒÙ…', code: 'PHY', type: 'ØµØ­Øª', periods: 2, details: 'ØµØ­Øª Ø§ÙˆØ± Ø¬Ø³Ù…Ø§Ù†ÛŒ ØªØ¹Ù„ÛŒÙ…' },
                ];
                const subjectIds = [];
                for (const subjectData of subjectsData) {
                    const id = await addToStore(STORES.SUBJECTS, subjectData);
                    subjectIds.push(id);
                }
                const teachersData = [
                    {
                        employeeId: 'T001',
                        name: 'Ù‚Ø§Ø±ÛŒ Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯',
                        fatherName: 'Ù…Ø­Ù…Ø¯ ÛŒÙˆØ³Ù',
                        gender: 'Ù…Ø±Ø¯',
                        dob: '1980-05-15',
                        qualification: 'Ø¹Ø§Ù„Ù… ÙØ§Ø¶Ù„ØŒ Ù‚Ø§Ø±ÛŒ',
                        specialization: 'Ù‚Ø±Ø¢Ù† Ùˆ Ø­Ø¯ÛŒØ«',
                        subjects: ['1', '6', '7'],
                        contact: '0300-1234567',
                        email: 'ahmad@example.com',
                        address: 'Ø­Ø§ÙØ¸ Ø¢Ø¨Ø§Ø¯ØŒ Ù„Ø§ÛÙˆØ±',
                        cnic: '35201-1234567-1',
                        joiningDate: '2015-03-01',
                        basicSalary: 25000,
                        allowances: 5000,
                        deductions: 0,
                        photo: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        employeeId: 'T002',
                        name: 'Ù…ÙˆÙ„Ø§Ù†Ø§ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù†',
                        fatherName: 'Ø¹Ø¨Ø¯Ø§Ù„ØºÙÙˆØ±',
                        gender: 'Ù…Ø±Ø¯',
                        dob: '1975-09-20',
                        qualification: 'Ø´ÛŒØ® Ø§Ù„Ø­Ø¯ÛŒØ«ØŒ Ù…ÙØªÛŒ',
                        specialization: 'ÙÙ‚Û Ùˆ Ø§ØµÙˆÙ„',
                        subjects: ['1', '6', '7'],
                        contact: '0300-2345678',
                        email: 'abdulrehman@example.com',
                        address: 'Ø¬ÙˆÛØ± Ù¹Ø§Ø¤Ù†ØŒ Ù„Ø§ÛÙˆØ±',
                        cnic: '35201-2345678-1',
                        joiningDate: '2010-01-15',
                        basicSalary: 30000,
                        allowances: 7000,
                        deductions: 0,
                        photo: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        employeeId: 'T003',
                        name: 'Ø­Ø§ÙØ¸ Ù…Ø­Ù…Ø¯ Ø¹Ù…Ø±',
                        fatherName: 'Ù…Ø­Ù…Ø¯ Ø§Ø³Ù„Ù…',
                        gender: 'Ù…Ø±Ø¯',
                        dob: '1985-03-10',
                        qualification: 'Ø­Ø§ÙØ¸ØŒ Ø¹Ø§Ù„Ù…',
                        specialization: 'Ù‚Ø±Ø¢Ù† Ùˆ ØªØ¬ÙˆÛŒØ¯',
                        subjects: ['1', '6', '7'],
                        contact: '0300-3456789',
                        email: 'umar@example.com',
                        address: 'Ù¹Ø§Ø¤Ù† Ø´Ù¾ØŒ Ù„Ø§ÛÙˆØ±',
                        cnic: '35201-3456789-1',
                        joiningDate: '2018-08-01',
                        basicSalary: 22000,
                        allowances: 3000,
                        deductions: 0,
                        photo: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        employeeId: 'T004',
                        name: 'Ø§Ø³ØªØ§Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÛŒ',
                        fatherName: 'Ù…Ø­Ù…Ø¯ Ø§Ú©Ø±Ù…',
                        gender: 'Ù…Ø±Ø¯',
                        dob: '1982-12-05',
                        qualification: 'Ø§ÛŒÙ… Ø§Û’ Ø¹Ø±Ø¨ÛŒØŒ Ø¨ÛŒ Ø§ÛŒÚˆ',
                        specialization: 'Ø¹Ø±Ø¨ÛŒ Ùˆ Ø§Ø±Ø¯Ùˆ',
                        subjects: ['1', '6', '7'],
                        contact: '0300-4567890',
                        email: 'ali@example.com',
                        address: 'ÙÛŒØµÙ„ Ù¹Ø§Ø¤Ù†ØŒ Ù„Ø§ÛÙˆØ±',
                        cnic: '35201-4567890-1',
                        joiningDate: '2016-04-15',
                        basicSalary: 20000,
                        allowances: 4000,
                        deductions: 0,
                        photo: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        employeeId: 'T005',
                        name: 'Ø§Ø³ØªØ§Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù…Ø±Ø§Ù†',
                        fatherName: 'Ù…Ø­Ù…Ø¯ Ø§ÙØ¶Ù„',
                        gender: 'Ù…Ø±Ø¯',
                        dob: '1988-07-25',
                        qualification: 'Ø§ÛŒÙ… Ø§ÛŒØ³ Ø³ÛŒ Ø±ÛŒØ§Ø¶ÛŒØŒ Ø¨ÛŒ Ø§ÛŒÚˆ',
                        specialization: 'Ø±ÛŒØ§Ø¶ÛŒ Ùˆ Ø³Ø§Ø¦Ù†Ø³',
                        subjects: ['1', '6', '7'],
                        contact: '0300-5678901',
                        email: 'imran@example.com',
                        address: 'Ù…Ø§ÚˆÙ„ Ù¹Ø§Ø¤Ù†ØŒ Ù„Ø§ÛÙˆØ±',
                        cnic: '35201-5678901-1',
                        joiningDate: '2017-09-01',
                        basicSalary: 23000,
                        allowances: 5000,
                        deductions: 0,
                        photo: null,
                        createdAt: new Date(),
                        specialization: 'Ø±ÛŒØ§Ø¶ÛŒ Ùˆ Ø³Ø§Ø¦Ù†Ø³',
                        subjects: ['14', '15'],
                        contact: '0300-5678901',
                        email: 'imran@example.com',
                        address: 'Ù…Ø§ÚˆÙ„ Ù¹Ø§Ø¤Ù†ØŒ Ù„Ø§ÛÙˆØ±',
                        cnic: '35201-5678901-1',
                        joiningDate: '2017-09-01',
                        basicSalary: 23000,
                        allowances: 5000,
                        deductions: 0,
                        photo: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        employeeId: 'T006',
                        name: 'Ù…Ø¹Ù„Ù…Û Ø¹Ø§Ø¦Ø´Û',
                        fatherName: 'Ø¹Ø¨Ø¯Ø§Ù„Ø³ØªØ§Ø±',
                        gender: 'Ø¹ÙˆØ±Øª',
                        dob: '1990-11-12',
                        qualification: 'Ø¹Ø§Ù„Ù…Û ÙØ§Ø¶Ù„ÛØŒ Ø¨ÛŒ Ø§ÛŒÚˆ',
                        specialization: 'Ø§Ø³Ù„Ø§Ù…ÛŒØ§Øª Ùˆ Ø§Ø±Ø¯Ùˆ',
                        subjects: ['12', '18'],
                        contact: '0300-6789012',
                        email: 'ayesha@example.com',
                        address: 'Ú¯Ù„Ø´Ù† Ø±Ø§ÙˆÛŒØŒ Ù„Ø§ÛÙˆØ±',
                        cnic: '35201-6789012-2',
                        joiningDate: '2019-03-15',
                        basicSalary: 20000,
                        allowances: 3000,
                        deductions: 0,
                        photo: null,
                        createdAt: new Date().toISOString()
                    }
                ];
                const teacherIds = [];
                for (const teacherData of teachersData) {
                    const id = await addToStore(STORES.TEACHERS, teacherData);
                    teacherIds.push(id);
                }
                for (let i = 0; i < Math.min(classIds.length, teacherIds.length); i++) {
                    await updateInStore(STORES.CLASSES, classIds[i], { inChargeId: teacherIds[i % teacherIds.length] });
                }
                const staffData = [
                    {
                        employeeId: 'S001',
                        name: 'Ù…Ø­Ù…Ø¯ Ø¹Ø§Ø±Ù',
                        fatherName: 'Ù…Ø­Ù…Ø¯ Ø§Ø³Ù„Ù…',
                        gender: 'Ù…Ø±Ø¯',
                        dob: '1985-06-20',
                        designation: 'Ø¯ÙØªØ±ÛŒ Ú©Ù„Ø±Ú©',
                        department: 'Ø§Ù†ØªØ¸Ø§Ù…ÛŒÛ',
                        qualification: 'Ø¨ÛŒ Ø§Û’',
                        responsibilities: 'Ø¯ÙØªØ±ÛŒ Ú©Ø§Ù…ØŒ Ø¯Ø§Ø®Ù„ÛØŒ Ø±Ø¬Ø³Ù¹Ø±ÛŒØ´Ù†',
                        contact: '0300-7890123',
                        email: 'arif@example.com',
                        address: 'ÙÛŒØµÙ„ Ù¹Ø§Ø¤Ù†ØŒ Ù„Ø§ÛÙˆØ±',
                        cnic: '35201-7890123-1',
                        joiningDate: '2018-01-15',
                        basicSalary: 18000,
                        allowances: 2000,
                        deductions: 0,
                        photo: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        employeeId: 'S002',
                        name: 'Ù…Ø­Ù…Ø¯ ØµØ¯ÛŒÙ‚',
                        fatherName: 'Ù…Ø­Ù…Ø¯ ÛŒÙˆØ³Ù',
                        gender: 'Ù…Ø±Ø¯',
                        dob: '1970-04-10',
                        designation: 'Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒÙ†',
                        department: 'Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒ',
                        qualification: 'Ø§ÛŒÙ… Ø§Û’ Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒ Ø³Ø§Ø¦Ù†Ø³',
                        responsibilities: 'Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒ Ù…ÛŒÚº Ú©ØªØ§Ø¨ÙˆÚº Ú©Ø§ Ø§Ù†ØªØ¸Ø§Ù…ØŒ Ø§Ø¬Ø±Ø§Ø¡ Ùˆ ÙˆØ§Ù¾Ø³ÛŒ',
                        contact: '0300-8901234',
                        email: 'siddique@example.com',
                        address: 'Ù¹Ø§Ø¤Ù† Ø´Ù¾ØŒ Ù„Ø§ÛÙˆØ±',
                        cnic: '35201-8901234-1',
                        joiningDate: '2015-05-01',
                        basicSalary: 20000,
                        allowances: 3000,
                        deductions: 0,
                        photo: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        employeeId: 'S003',
                        name: 'Ø¹Ø¨Ø¯Ø§Ù„ØºÙÙˆØ±',
                        fatherName: 'Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø²Ø§Ù‚',
                        gender: 'Ù…Ø±Ø¯',
                        dob: '1975-08-15',
                        designation: 'Ø³ÛŒÚ©ÛŒÙˆØ±Ù¹ÛŒ Ú¯Ø§Ø±Úˆ',
                        department: 'Ø³ÛŒÚ©ÛŒÙˆØ±Ù¹ÛŒ',
                        qualification: 'Ù…ÛŒÙ¹Ø±Ú©',
                        responsibilities: 'Ù…Ø¯Ø±Ø³Û Ú©ÛŒ Ø³ÛŒÚ©ÛŒÙˆØ±Ù¹ÛŒØŒ Ú¯ÛŒÙ¹ Ù¾Ø± Ú†ÛŒÚ©Ù†Ú¯',
                        contact: '0300-9012345',
                        email: null,
                        address: 'Ø¨ÛŒÚ¯Ù… Ù¾ÙˆØ±ÛØŒ Ù„Ø§ÛÙˆØ±',
                        cnic: '35201-9012345-1',
                        joiningDate: '2017-03-01',
                        basicSalary: 15000,
                        allowances: 2000,
                        deductions: 0,
                        photo: null,
                        createdAt: new Date().toISOString()
                    }
                ];
                for (const staffMember of staffData) {
                    await addToStore(STORES.STAFF, staffMember);
                }
                const usersData = [
                    {
                        username: 'admin',
                        password: 'admin123',
                        name: 'Ø³Ø³Ù¹Ù… Ø§ÛŒÚˆÙ…Ù†',
                        email: 'admin@deenimadrasa.com',
                        role: 'admin',
                        status: 'active',
                        mobile: '0300-1234567',
                        address: 'Ù„Ø§ÛÙˆØ±',
                        photo: null,
                        lastLogin: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        username: 'teacher1',
                        password: 'teacher123',
                        name: 'Ù‚Ø§Ø±ÛŒ Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯',
                        email: 'ahmad@example.com',
                        role: 'teacher',
                        status: 'active',
                        mobile: '0300-1234567',
                        address: 'Ø­Ø§ÙØ¸ Ø¢Ø¨Ø§Ø¯ØŒ Ù„Ø§ÛÙˆØ±',
                        photo: null,
                        lastLogin: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        username: 'librarian',
                        password: 'library123',
                        name: 'Ù…Ø­Ù…Ø¯ ØµØ¯ÛŒÙ‚',
                        email: 'siddique@example.com',
                        role: 'librarian',
                        status: 'active',
                        mobile: '0300-8901234',
                        address: 'Ù¹Ø§Ø¤Ù† Ø´Ù¾ØŒ Ù„Ø§ÛÙˆØ±',
                        photo: null,
                        lastLogin: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        username: 'accountant',
                        password: 'account123',
                        name: 'Ù…Ø­Ù…Ø¯ Ø¹Ø§Ø±Ù',
                        email: 'arif@example.com',
                        role: 'accountant',
                        status: 'active',
                        mobile: '0300-7890123',
                        address: 'ÙÛŒØµÙ„ Ù¹Ø§Ø¤Ù†ØŒ Ù„Ø§ÛÙˆØ±',
                        photo: null,
                        lastLogin: null,
                        createdAt: new Date().toISOString()
                    }
                ];
                for (const userData of usersData) {
                    await addToStore(STORES.USERS, userData);
                }
                const rolesData = [
                    {
                        name: 'admin',
                        description: 'Ø³Ø³Ù¹Ù… Ø§ÛŒÚˆÙ…Ù†Ø³Ù¹Ø±ÛŒÙ¹Ø±',
                        permissions: {
                            dashboard: true,
                            students: true,
                            teachers: true,
                            staff: true,
                            classes: true,
                            subjects: true,
                            attendance: true,
                            exams: true,
                            fees: true,
                            salaries: true,
                            library: true,
                            users: true,
                            reports: true,
                            settings: true,
                            backup: true
                        },
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: 'teacher',
                        description: 'Ø§Ø³ØªØ§Ø¯',
                        permissions: {
                            dashboard: true,
                            students: true,
                            teachers: false,
                            staff: false,
                            classes: true,
                            subjects: true,
                            attendance: true,
                            exams: true,
                            fees: false,
                            salaries: false,
                            library: true,
                            users: false,
                            reports: true,
                            settings: false,
                            backup: false
                        },
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: 'librarian',
                        description: 'Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒÙ†',
                        permissions: {
                            dashboard: true,
                            students: true,
                            teachers: true,
                            staff: false,
                            classes: false,
                            subjects: false,
                            attendance: false,
                            exams: false,
                            fees: false,
                            salaries: false,
                            library: true,
                            users: false,
                            reports: true,
                            settings: false,
                            backup: false
                        },
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: 'accountant',
                        description: 'Ø§Ú©Ø§Ø¤Ù†Ù¹Ù†Ù¹',
                        permissions: {
                            dashboard: true,
                            students: true,
                            teachers: true,
                            staff: true,
                            classes: false,
                            subjects: false,
                            attendance: false,
                            exams: false,
                            fees: true,
                            salaries: true,
                            library: false,
                            users: false,
                            reports: true,
                            settings: false,
                            backup: false
                        },
                        createdAt: new Date().toISOString()
                    }
                ];
                for (const roleData of rolesData) {
                    await addToStore(STORES.ROLES, roleData);
                }
                const booksData = [
                    {
                        name: 'Ù‚Ø±Ø¢Ù† Ù…Ø¬ÛŒØ¯ Ù…Ø¹ Ø§Ø±Ø¯Ùˆ ØªØ±Ø¬Ù…Û',
                        author: 'Ù…ÙˆÙ„Ø§Ù†Ø§ ÙØªØ­ Ù…Ø­Ù…Ø¯ Ø¬Ø§Ù„Ù†Ø¯Ú¾Ø±ÛŒ',
                        category: 'Ù‚Ø±Ø¢Ù†',
                        publisher: 'Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ú©ÛŒÚˆÙ…ÛŒ',
                        publicationYear: 2015,
                        isbn: '978-0123456789',
                        copies: 10,
                        availableCopies: 10,
                        shelf: 'A1',
                        description: 'Ù‚Ø±Ø¢Ù† Ù…Ø¬ÛŒØ¯ Ù…Ø¹ Ø§Ø±Ø¯Ùˆ ØªØ±Ø¬Ù…Û',
                        image: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: 'ØµØ­ÛŒØ­ Ø¨Ø®Ø§Ø±ÛŒ',
                        author: 'Ø§Ù…Ø§Ù… Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø§Ø³Ù…Ø§Ø¹ÛŒÙ„ Ø¨Ø®Ø§Ø±ÛŒ',
                        category: 'Ø­Ø¯ÛŒØ«',
                        publisher: 'Ø¯Ø§Ø±Ø§Ù„Ø³Ù„Ø§Ù… Ù¾Ø¨Ù„Ø´Ø±Ø²',
                        publicationYear: 2010,
                        isbn: '978-0123456790',
                        copies: 5,
                        availableCopies: 5,
                        shelf: 'B1',
                        description: 'ØµØ­ÛŒØ­ Ø¨Ø®Ø§Ø±ÛŒ Ø­Ø¯ÛŒØ« Ú©ÛŒ Ù…Ø´ÛÙˆØ± Ú©ØªØ§Ø¨',
                        image: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: 'ØµØ­ÛŒØ­ Ù…Ø³Ù„Ù…',
                        author: 'Ø§Ù…Ø§Ù… Ù…Ø³Ù„Ù… Ø¨Ù† Ø­Ø¬Ø§Ø¬',
                        category: 'Ø­Ø¯ÛŒØ«',
                        publisher: 'Ø¯Ø§Ø±Ø§Ù„Ø³Ù„Ø§Ù… Ù¾Ø¨Ù„Ø´Ø±Ø²',
                        publicationYear: 2012,
                        isbn: '978-0123456791',
                        copies: 5,
                        availableCopies: 5,
                        shelf: 'B2',
                        description: 'ØµØ­ÛŒØ­ Ù…Ø³Ù„Ù… Ø­Ø¯ÛŒØ« Ú©ÛŒ Ù…Ø´ÛÙˆØ± Ú©ØªØ§Ø¨',
                        image: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: 'Ø±ÛŒØ§Ø¶ Ø§Ù„ØµØ§Ù„Ø­ÛŒÙ†',
                        author: 'Ø§Ù…Ø§Ù… Ù†ÙˆÙˆÛŒ',
                        category: 'Ø­Ø¯ÛŒØ«',
                        publisher: 'Ø¯Ø§Ø± Ø§Ø¨Ù† Ú©Ø«ÛŒØ±',
                        publicationYear: 2014,
                        isbn: '978-0123456792',
                        copies: 8,
                        availableCopies: 8,
                        shelf: 'B3',
                        description: 'Ø§Ø­Ø§Ø¯ÛŒØ« Ú©Ø§ Ù…Ø´ÛÙˆØ± Ù…Ø¬Ù…ÙˆØ¹Û',
                        image: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: 'ØªÙØ³ÛŒØ± Ø§Ø¨Ù† Ú©Ø«ÛŒØ±',
                        author: 'Ø§Ù…Ø§Ù… Ø§Ø¨Ù† Ú©Ø«ÛŒØ±',
                        category: 'ØªÙØ³ÛŒØ±',
                        publisher: 'Ø¯Ø§Ø± Ø·ÛŒØ¨Û',
                        publicationYear: 2000,
                        isbn: '978-0123456793',
                        copies: 3,
                        availableCopies: 3,
                        shelf: 'C1',
                        description: 'Ù‚Ø±Ø¢Ù† Ú©Ø±ÛŒÙ… Ú©ÛŒ Ù…Ø¹Ø±ÙˆÙ ØªÙØ³ÛŒØ±',
                        image: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: 'Ø³ÛŒØ±Øª Ø§Ù„Ù†Ø¨ÛŒ',
                        author: 'Ø´Ø¨Ù„ÛŒ Ù†Ø¹Ù…Ø§Ù†ÛŒØŒ Ø³ÛŒØ¯ Ø³Ù„ÛŒÙ…Ø§Ù† Ù†Ø¯ÙˆÛŒ',
                        category: 'Ø³ÛŒØ±Øª',
                        publisher: 'Ù…Ú©ØªØ¨Û Ø±Ø­Ù…Ø§Ù†ÛŒÛ',
                        publicationYear: 2005,
                        isbn: '978-0123456794',
                        copies: 7,
                        availableCopies: 7,
                        shelf: 'D1',
                        description: 'Ø­Ø¶ÙˆØ± Ø§Ú©Ø±Ù… ØµÙ„ÛŒ Ø§Ù„Ù„Û Ø¹Ù„ÛŒÛ ÙˆØ³Ù„Ù… Ú©ÛŒ Ø³ÛŒØ±Øª Ù…Ø¨Ø§Ø±Ú©Û',
                        image: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: 'Ø¨ÛØ´ØªÛŒ Ø²ÛŒÙˆØ±',
                        author: 'Ù…ÙˆÙ„Ø§Ù†Ø§ Ø§Ø´Ø±Ù Ø¹Ù„ÛŒ ØªÚ¾Ø§Ù†ÙˆÛŒ',
                        category: 'ÙÙ‚Û',
                        publisher: 'Ø¯Ø§Ø± Ø§Ù„Ø§Ø´Ø§Ø¹Øª',
                        publicationYear: 2008,
                        isbn: '978-0123456795',
                        copies: 10,
                        availableCopies: 10,
                        shelf: 'E1',
                        description: 'Ø®ÙˆØ§ØªÛŒÙ† Ú©Û’ Ù„ÛŒÛ’ Ø¯ÛŒÙ†ÛŒ ÛØ¯Ø§ÛŒØ§Øª',
                        image: null,
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: 'ØªØ¹Ù„ÛŒÙ… Ø§Ù„Ø§Ø³Ù„Ø§Ù…',
                        author: 'Ù…ÙˆÙ„Ø§Ù†Ø§ Ù…Ø­Ù…Ø¯ Ø¸ÙØ± Ø§Ù„Ø¯ÛŒÙ†',
                        category: 'Ø§Ø³Ù„Ø§Ù…ÛŒØ§Øª',
                        publisher: 'Ù…Ú©ØªØ¨Û Ø§Ø³Ù„Ø§Ù…ÛŒÛ',
                        publicationYear: 2018,
                        isbn: '978-0123456796',
                        copies: 15,
                        availableCopies: 15,
                        shelf: 'F1',
                        description: 'Ø¨Ú†ÙˆÚº Ú©Û’ Ù„ÛŒÛ’ Ø§Ø³Ù„Ø§Ù…ÛŒ ØªØ¹Ù„ÛŒÙ…Ø§Øª',
                        image: null,
                        createdAt: new Date().toISOString()
                    }
                ];
                for (const bookData of booksData) {
                    await addToStore(STORES.BOOKS, bookData);
                }
                const feeStructureData = [];
                for (const classId of classIds) {
                    const classData = await getFromStore(STORES.CLASSES, classId);
                    feeStructureData.push({
                        classId: classId,
                        category: 'Ø¹Ø§Ù…',
                        monthlyFee: classData.monthlyFee,
                        admissionFee: classData.admissionFee,
                        examFee: classData.monthlyFee * 0.5,
                        computerFee: 100,
                        transportFee: 500,
                        otherFee: 0,
                        createdAt: new Date().toISOString()
                    });
                    feeStructureData.push({
                        classId: classId,
                        category: 'Ù…Ø³ØªØ­Ù‚',
                        monthlyFee: classData.monthlyFee * 0.5,
                        admissionFee: classData.admissionFee * 0.5,
                        examFee: classData.monthlyFee * 0.25,
                        computerFee: 50,
                        transportFee: 250,
                        otherFee: 0,
                        createdAt: new Date().toISOString()
                    });
                    feeStructureData.push({
                        classId: classId,
                        category: 'Ø§Ø³Ú©Ø§Ù„Ø±Ø´Ù¾',
                        monthlyFee: 0,
                        admissionFee: 0,
                        examFee: 0,
                        computerFee: 0,
                        transportFee: 0,
                        otherFee: 0,
                        createdAt: new Date().toISOString()
                    });
                }
                for (const feeStructure of feeStructureData) {
                    await addToStore(STORES.FEE_STRUCTURE, feeStructure);
                }
                const sections = await getAllFromStore(STORES.SECTIONS);
                const maleFirstNames = ['Ù…Ø­Ù…Ø¯', 'Ø§Ø­Ù…Ø¯', 'Ø¹Ù„ÛŒ', 'Ø¹Ù…Ø±', 'Ø¹Ø«Ù…Ø§Ù†', 'Ø­Ø³Ù†', 'Ø­Ø³ÛŒÙ†', 'Ø§Ø¨Ø±Ø§ÛÛŒÙ…', 'Ø§Ø³Ù…Ø§Ø¹ÛŒÙ„', 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Û', 'Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù†', 'ÙÛŒØµÙ„', 'Ø¹Ù…Ø±Ø§Ù†', 'Ø·Ø§Ø±Ù‚', 'Ø§Ø³Ù„Ù…', 'Ø§Ú©Ø±Ù…', 'Ø¨Ù„Ø§Ù„', 'Ø¹Ø§Ø¯Ù„', 'Ø¹Ø§Ø±Ù', 'ÙˆØ³ÛŒÙ…'];
                const femaleFirstNames = ['Ø¹Ø§Ø¦Ø´Û', 'ÙØ§Ø·Ù…Û', 'Ù…Ø±ÛŒÙ…', 'Ø²ÛŒÙ†Ø¨', 'Ø®Ø¯ÛŒØ¬Û', 'Ø­ÙØµÛ', 'Ø³Ù…ÛŒÛ', 'Ø±Ø§Ø¨Ø¹Û', 'Ø¢Ù…Ù†Û', 'ØµÙÛŒÛ', 'Ø­Ù„ÛŒÙ…Û', 'Ù†Ø³Ø±ÛŒÙ†', 'Ø´ÛÙ†Ø§Ø²', 'Ø±Ø¶ÙˆØ§Ù†Û', 'Ø´Ø¨Ù†Ù…', 'ØµØ¨Ø§Ø¡', 'Ø¹Ø§ÙÛŒÛ', 'Ø³Ù„Ù…ÛŒ', 'Ø±Ø®Ø³Ø§Ù†Û', 'Ù†Ø´ÙˆÛ'];
                const lastNames = ['Ø§Ø­Ù…Ø¯', 'Ù…Ø­Ù…ÙˆØ¯', 'Ø®Ø§Ù†', 'Ù…Ù„Ú©', 'Ú†ÙˆØ¯Ú¾Ø±ÛŒ', 'Ø´ÛŒØ®', 'Ø³ÛŒØ¯', 'ÛØ§Ø´Ù…ÛŒ', 'Ù‚Ø±ÛŒØ´ÛŒ', 'Ø¹Ø¨Ø§Ø³ÛŒ', 'Ø¨Ø®Ø§Ø±ÛŒ', 'Ú¯ÛŒÙ„Ø§Ù†ÛŒ', 'Ù†Ù‚ÙˆÛŒ', 'Ø±Ø¶ÙˆÛŒ', 'Ø¹Ø§Ù„Ù…', 'Ø§Ø¹Ø¬Ø§Ø²', 'ØµØ¯ÛŒÙ‚ÛŒ', 'ÙØ§Ø±ÙˆÙ‚ÛŒ', 'Ø¹Ø«Ù…Ø§Ù†ÛŒ', 'Ø§Ù†ØµØ§Ø±ÛŒ'];
                const fatherNames = ['Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯', 'Ù…Ø­Ù…Ø¯ Ø¹Ù„ÛŒ', 'Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù†', 'Ø¹Ø¨Ø¯Ø§Ù„ØºÙÙˆØ±', 'Ù…Ø­Ù…Ø¯ Ø§Ø³Ù„Ù…', 'Ù…Ø­Ù…Ø¯ Ø§Ú©Ø±Ù…', 'Ù…Ø­Ù…Ø¯ ÛŒÙˆØ³Ù', 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Û', 'Ù…Ø­Ù…Ø¯ Ø¹Ù…Ø±', 'Ù…Ø­Ù…Ø¯ Ø·Ø§Ø±Ù‚', 'Ù…Ø­Ù…Ø¯ ØµØ¯ÛŒÙ‚', 'Ù…Ø­Ù…Ø¯ Ø³Ù„ÛŒÙ…', 'Ù…Ø­Ù…Ø¯ Ø±ÙÛŒÙ‚', 'Ù…Ø­Ù…Ø¯ Ø§ÙØ¶Ù„', 'Ù…Ø­Ù…Ø¯ Ø§Ø´Ø±Ù', 'Ù…Ø­Ù…Ø¯ Ø§Ù†ÙˆØ±', 'Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÛŒØ²', 'Ø¹Ø¨Ø¯Ø§Ù„Ù‚Ø§Ø¯Ø±', 'Ù…Ø­Ù…Ø¯ Ø±ÛŒØ§Ø¶', 'Ù…Ø­Ù…Ø¯ Ø´ÙÛŒÙ‚'];
                const addresses = [
                    'Ø­Ø§ÙØ¸ Ø¢Ø¨Ø§Ø¯ØŒ Ù„Ø§ÛÙˆØ±',
                    'Ø¬ÙˆÛØ± Ù¹Ø§Ø¤Ù†ØŒ Ù„Ø§ÛÙˆØ±',
                    'Ù¹Ø§Ø¤Ù† Ø´Ù¾ØŒ Ù„Ø§ÛÙˆØ±',
                    'ÙÛŒØµÙ„ Ù¹Ø§Ø¤Ù†ØŒ Ù„Ø§ÛÙˆØ±',
                    'Ù…Ø§ÚˆÙ„ Ù¹Ø§Ø¤Ù†ØŒ Ù„Ø§ÛÙˆØ±',
                    'Ú¯Ù„Ø´Ù† Ø±Ø§ÙˆÛŒØŒ Ù„Ø§ÛÙˆØ±',
                    'Ø§Ù‚Ø¨Ø§Ù„ Ù¹Ø§Ø¤Ù†ØŒ Ù„Ø§ÛÙˆØ±',
                    'Ø¹Ù„Ø§Ù…Û Ø§Ù‚Ø¨Ø§Ù„ Ù¹Ø§Ø¤Ù†ØŒ Ù„Ø§ÛÙˆØ±',
                    'ÙˆØ­Ø¯Øª Ø±ÙˆÚˆØŒ Ù„Ø§ÛÙˆØ±',
                    'Ú¯Ù„Ø¨Ø±Ú¯ØŒ Ù„Ø§ÛÙˆØ±'
                ];
                const studentsData = [];
                const currentYear = new Date().getFullYear();
                let rollNumber = 1;
                for (const section of sections) {
                    const classData = await getFromStore(STORES.CLASSES, section.classId);
                    for (let i = 0; i < 10; i++) {
                        const gender = Math.random() > 0.5 ? 'Ù…Ø±Ø¯' : 'Ø¹ÙˆØ±Øª';
                        const firstName = gender === 'Ù…Ø±Ø¯'
                            ? maleFirstNames[Math.floor(Math.random() * maleFirstNames.length)]
                            : femaleFirstNames[Math.floor(Math.random() * femaleFirstNames.length)];
                        const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                        const name = firstName + ' ' + lastName;
                        const fatherName = fatherNames[Math.floor(Math.random() * fatherNames.length)];
                        const age = 7 + Math.floor(Math.random() * 9);
                        const dob = new Date(currentYear - age, Math.floor(Math.random() * 12), 1 + Math.floor(Math.random() * 28));
                        const yearsAgo = Math.floor(Math.random() * 3);
                        const admissionDate = new Date(currentYear - yearsAgo, Math.floor(Math.random() * 12), 1 + Math.floor(Math.random() * 28));
                        const address = addresses[Math.floor(Math.random() * addresses.length)];
                        const mobilePrefix = ['0300', '0301', '0302', '0303', '0304', '0305', '0310', '0311', '0312', '0313'][Math.floor(Math.random() * 10)];
                        const mobileNumber = mobilePrefix + '-' + Math.floor(1000000 + Math.random() * 9000000);
                        const feeCategories = ['Ø¹Ø§Ù…', 'Ø¹Ø§Ù…', 'Ø¹Ø§Ù…', 'Ø¹Ø§Ù…', 'Ù…Ø³ØªØ­Ù‚', 'Ù…Ø³ØªØ­Ù‚', 'Ø§Ø³Ú©Ø§Ù„Ø±Ø´Ù¾'];
                        const feeCategory = feeCategories[Math.floor(Math.random() * feeCategories.length)];
                        studentsData.push({
                            rollNumber: rollNumber++,
                            name: name,
                            fatherName: fatherName,
                            gender: gender,
                            dob: dob.toISOString().split('T'),
                            classId: section.classId,
                            className: classData.name,
                            sectionId: section.id,
                            sectionName: section.name,
                            contact: mobileNumber,
                            email: firstName.toLowerCase() + rollNumber + '@example.com',
                            guardian: fatherName,
                            guardianContact: mobileNumber,
                            address: address,
                            photo: null,
                            admissionDate: admissionDate.toISOString().split('T'),
                            feeCategory: feeCategory,
                            monthlyFee: classData.monthlyFee,
                            notes: '',
                            createdAt: new Date().toISOString()
                        });
                    }
                }
                for (const studentData of studentsData) {
                    await addToStore(STORES.STUDENTS, studentData);
                }
                const today = new Date().toISOString().split('T');
                for (const student of studentsData) {
                    const random = Math.random();
                    let status = 'present';
                    if (random > 0.9) {
                        status = 'absent';
                    } else if (random > 0.85) {
                        status = 'leave';
                    }
                    await addToStore(STORES.ATTENDANCE, {
                        date: today,
                        classId: student.classId,
                        sectionId: student.sectionId,
                        studentId: student.id || (await getStudentByRollNumber(student.rollNumber)).id,
                        status: status,
                        isLate: random > 0.8 && random <= 0.85,
                        notes: '',
                        createdAt: new Date().toISOString()
                    });
                }
                const examsData = [
                    {
                        name: 'Ù¾ÛÙ„Ø§ Ù…Ø§ÛØ§Ù†Û Ø§Ù…ØªØ­Ø§Ù†',
                        type: 'Ù…Ø§ÛØ§Ù†Û',
                        startDate: new Date(currentYear, 3, 25).toISOString().split('T'),
                        endDate: new Date(currentYear, 3, 30).toISOString().split('T'),
                        classes: classIds,
                        passingPercent: 33,
                        details: 'Ù¾ÛÙ„Ø§ Ù…Ø§ÛØ§Ù†Û Ø§Ù…ØªØ­Ø§Ù† Ø§Ù¾Ø±ÛŒÙ„ Ù…ÛŒÚº Ù…Ù†Ø¹Ù‚Ø¯ Ú©ÛŒØ§ Ø¬Ø§Ø¦Û’ Ú¯Ø§',
                        status: 'completed',
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: 'Ø¯ÙˆØ³Ø±Ø§ Ù…Ø§ÛØ§Ù†Û Ø§Ù…ØªØ­Ø§Ù†',
                        type: 'Ù…Ø§ÛØ§Ù†Û',
                        startDate: new Date(currentYear, 4, 25).toISOString().split('T'),
                        endDate: new Date(currentYear, 4, 30).toISOString().split('T'),
                        classes: classIds,
                        passingPercent: 33,
                        details: 'Ø¯ÙˆØ³Ø±Ø§ Ù…Ø§ÛØ§Ù†Û Ø§Ù…ØªØ­Ø§Ù† Ù…Ø¦ÛŒ Ù…ÛŒÚº Ù…Ù†Ø¹Ù‚Ø¯ Ú©ÛŒØ§ Ø¬Ø§Ø¦Û’ Ú¯Ø§',
                        status: 'completed',
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: 'Ø³Û Ù…Ø§ÛÛŒ Ø§Ù…ØªØ­Ø§Ù†',
                        type: 'Ø³Û Ù…Ø§ÛÛŒ',
                        startDate: new Date(currentYear, 5, 15).toISOString().split('T'),
                        endDate: new Date(currentYear, 5, 25).toISOString().split('T'),
                        classes: classIds,
                        passingPercent: 33,
                        details: 'Ø³Û Ù…Ø§ÛÛŒ Ø§Ù…ØªØ­Ø§Ù† Ø¬ÙˆÙ† Ù…ÛŒÚº Ù…Ù†Ø¹Ù‚Ø¯ Ú©ÛŒØ§ Ø¬Ø§Ø¦Û’ Ú¯Ø§',
                        status: 'completed',
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: 'Ø´Ø´Ù…Ø§ÛÛŒ Ø§Ù…ØªØ­Ø§Ù†',
                        type: 'Ø´Ø´Ù…Ø§ÛÛŒ',
                        startDate: new Date(currentYear, 8, 15).toISOString().split('T'),
                        endDate: new Date(currentYear, 8, 30).toISOString().split('T'),
                        classes: classIds,
                        passingPercent: 33,
                        details: 'Ø´Ø´Ù…Ø§ÛÛŒ Ø§Ù…ØªØ­Ø§Ù† Ø³ØªÙ…Ø¨Ø± Ù…ÛŒÚº Ù…Ù†Ø¹Ù‚Ø¯ Ú©ÛŒØ§ Ø¬Ø§Ø¦Û’ Ú¯Ø§',
                        status: 'pending',
                        createdAt: new Date().toISOString()
                    },
                    {
                        name: 'Ø³Ø§Ù„Ø§Ù†Û Ø§Ù…ØªØ­Ø§Ù†',
                        type: 'Ø³Ø§Ù„Ø§Ù†Û',
                        startDate: new Date(currentYear + 1, 2, 15).toISOString().split('T'),
                        endDate: new Date(currentYear + 1, 2, 31).toISOString().split('T'),
                        classes: classIds,
                        passingPercent: 33,
                        details: 'Ø³Ø§Ù„Ø§Ù†Û Ø§Ù…ØªØ­Ø§Ù† Ù…Ø§Ø±Ú† Ù…ÛŒÚº Ù…Ù†Ø¹Ù‚Ø¯ Ú©ÛŒØ§ Ø¬Ø§Ø¦Û’ Ú¯Ø§',
                        status: 'pending',
                        createdAt: new Date().toISOString()
                    }
                ];
                const examIds = [];
                for (const examData of examsData) {
                    const id = await addToStore(STORES.EXAMS, examData);
                    examIds.push(id);
                }
                const eventsData = [
                    {
                        title: 'ØªÙ‚Ø³ÛŒÙ… Ø§Ù†Ø¹Ø§Ù…Ø§Øª ØªÙ‚Ø±ÛŒØ¨',
                        date: new Date(currentYear, new Date().getMonth() + 1, 15).toISOString().split('T'),
                        location: 'Ù…Ø¯Ø±Ø³Û ÛØ§Ù„',
                        type: 'ØªÙ‚Ø±ÛŒØ¨',
                        description: 'Ø³Ø§Ù„Ø§Ù†Û ØªÙ‚Ø³ÛŒÙ… Ø§Ù†Ø¹Ø§Ù…Ø§Øª Ú©ÛŒ ØªÙ‚Ø±ÛŒØ¨',
                        createdAt: new Date().toISOString()
                    },
                    {
                        title: 'ÙˆØ§Ù„Ø¯ÛŒÙ† Ø³Û’ Ù…Ù„Ø§Ù‚Ø§Øª',
                        date: new Date(currentYear, new Date().getMonth() + 1, 20).toISOString().split('T'),
                        location: 'Ú©Ù„Ø§Ø³ Ø±ÙˆÙ…Ø²',
                        type: 'Ù…ÛŒÙ¹Ù†Ú¯',
                        description: 'ÙˆØ§Ù„Ø¯ÛŒÙ† Ø³Û’ Ù…Ù„Ø§Ù‚Ø§Øª Ú©Ø§ Ø¯Ù†',
                        createdAt: new Date().toISOString()
                    },
                    {
                        title: 'Ø³ÛŒØ±Øª Ø§Ù„Ù†Ø¨ÛŒ Ú©Ø§Ù†ÙØ±Ù†Ø³',
                        date: new Date(currentYear, 10, 12).toISOString().split('T'),
                        location: 'Ù…Ø¯Ø±Ø³Û Ú¯Ø±Ø§Ø¤Ù†Úˆ',
                        type: 'Ú©Ø§Ù†ÙØ±Ù†Ø³',
                        description: 'Ø³ÛŒØ±Øª Ø§Ù„Ù†Ø¨ÛŒ ØµÙ„ÛŒ Ø§Ù„Ù„Û Ø¹Ù„ÛŒÛ ÙˆØ³Ù„Ù… Ù¾Ø± Ø®ØµÙˆØµÛŒ Ú©Ø§Ù†ÙØ±Ù†Ø³',
                        createdAt: new Date().toISOString()
                    },
                    {
                        title: 'Ù‚Ø±Ø¢Ù† Ø®ÙˆØ§Ù†ÛŒ Ù…Ù‚Ø§Ø¨Ù„Û',
                        date: new Date(currentYear, 8, 5).toISOString().split('T'),
                        location: 'Ù…Ø³Ø¬Ø¯ ÛØ§Ù„',
                        type: 'Ù…Ù‚Ø§Ø¨Ù„Û',
                        description: 'Ø·Ù„Ø¨Ø§Ø¡ Ú©Û’ Ø¯Ø±Ù…ÛŒØ§Ù† Ù‚Ø±Ø¢Ù† Ø®ÙˆØ§Ù†ÛŒ Ú©Ø§ Ù…Ù‚Ø§Ø¨Ù„Û',
                        createdAt: new Date().toISOString()
                    },
                    {
                        title: 'Ø³Ø§Ù„Ø§Ù†Û Ø¬Ù„Ø³Û',
                        date: new Date(currentYear, 2, 23).toISOString().split('T'),
                        location: 'Ù…Ø¯Ø±Ø³Û Ú¯Ø±Ø§Ø¤Ù†Úˆ',
                        type: 'Ø¬Ù„Ø³Û',
                        description: 'Ù…Ø¯Ø±Ø³Û Ú©Ø§ Ø³Ø§Ù„Ø§Ù†Û Ø¬Ù„Ø³Û',
                        createdAt: new Date().toISOString()
                    }
                ];
                for (const eventData of eventsData) {
                    await addToStore(STORES.EVENTS, eventData);
                }
                const activitiesData = [
                    {
                        description: 'Ù†Ø¦Û’ Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ú©Ø§ Ø¯Ø§Ø®Ù„Û',
                        date: new Date(new Date().setDate(new Date().getDate() - 1)).toISOString(),
                        type: 'Ø¯Ø§Ø®Ù„Û',
                        user: 'Ø³Ø³Ù¹Ù… Ø§ÛŒÚˆÙ…Ù†',
                        userId: 1,
                        details: 'Ù…Ø­Ù…Ø¯ Ø¹Ù„ÛŒ Ú©Ø§ Ù¾ÛÙ„ÛŒ Ø¬Ù…Ø§Ø¹Øª Ù…ÛŒÚº Ø¯Ø§Ø®Ù„Û',
                        createdAt: new Date().toISOString()
                    },
                    {
                        description: 'ÙÛŒØ³ Ø¬Ù…Ø¹ Ú©Ø±Ø§Ø¦ÛŒ Ú¯Ø¦ÛŒ',
                        date: new Date(new Date().setDate(new Date().getDate() - 2)).toISOString(),
                        type: 'ÙÛŒØ³',
                        user: 'Ø³Ø³Ù¹Ù… Ø§ÛŒÚˆÙ…Ù†',
                        userId: 1,
                        details: 'Ø§Ø­Ù…Ø¯ Ø®Ø§Ù† Ù†Û’ Ù…Ø¦ÛŒ Ú©ÛŒ Ù…Ø§ÛØ§Ù†Û ÙÛŒØ³ Ø¬Ù…Ø¹ Ú©Ø±Ø§Ø¦ÛŒ',
                        createdAt: new Date().toISOString()
                    },
                    {
                        description: 'Ú©ØªØ§Ø¨ Ø¬Ø§Ø±ÛŒ Ú©ÛŒ Ú¯Ø¦ÛŒ',
                        date: new Date(new Date().setDate(new Date().getDate() - 3)).toISOString(),
                        type: 'Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒ',
                        user: 'Ù…Ø­Ù…Ø¯ ØµØ¯ÛŒÙ‚',
                        userId: 3,
                        details: 'Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ø¹Ù…Ø± Ù†Û’ Ú©ØªØ§Ø¨ "Ø±ÛŒØ§Ø¶ Ø§Ù„ØµØ§Ù„Ø­ÛŒÙ†" Ø¬Ø§Ø±ÛŒ Ú©Ø±Ø§Ø¦ÛŒ',
                        createdAt: new Date().toISOString()
                    },
                    {
                        description: 'ØªÙ†Ø®ÙˆØ§Û Ø§Ø¯Ø§ Ú©ÛŒ Ú¯Ø¦ÛŒ',
                        date: new Date(new Date().setDate(new Date().getDate() - 5)).toISOString(),
                        type: 'ØªÙ†Ø®ÙˆØ§Û',
                        user: 'Ù…Ø­Ù…Ø¯ Ø¹Ø§Ø±Ù',
                        userId: 4,
                        details: 'Ø§Ø³Ø§ØªØ°Û Ú©ÛŒ Ù…Ø¦ÛŒ Ù…Ø§Û Ú©ÛŒ ØªÙ†Ø®ÙˆØ§ÛÛŒÚº Ø§Ø¯Ø§ Ú©ÛŒ Ú¯Ø¦ÛŒÚº',
                        createdAt: new Date().toISOString()
                    },
                    {
                        description: 'Ø§Ù…ØªØ­Ø§Ù†ÛŒ Ù†ØªØ§Ø¦Ø¬ Ú©Ø§ Ø§Ø¹Ù„Ø§Ù†',
                        date: new Date(new Date().setDate(new Date().getDate() - 7)).toISOString(),
                        type: 'Ø§Ù…ØªØ­Ø§Ù†',
                        user: 'Ø³Ø³Ù¹Ù… Ø§ÛŒÚˆÙ…Ù†',
                        userId: 1,
                        details: 'Ù…Ø§ÛØ§Ù†Û Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ú©Û’ Ù†ØªØ§Ø¦Ø¬ Ú©Ø§ Ø§Ø¹Ù„Ø§Ù† Ú©ÛŒØ§ Ú¯ÛŒØ§',
                        createdAt: new Date().toISOString()
                    }
                ];
                for (const activityData of activitiesData) {
                    await addToStore(STORES.ACTIVITIES, activityData);
                }
                await loadDropdownData();
                await loadDashboardData();
                console.log('Sample data loaded successfully');
                showNotification('Ø³ÛŒÙ…Ù¾Ù„ ÚˆÛŒÙ¹Ø§ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù„ÙˆÚˆ ÛÙˆ Ú¯ÛŒØ§ ÛÛ’', 'success');
            } catch (error) {
                console.error('Error loading sample data:', error);
                showNotification('Ø³ÛŒÙ…Ù¾Ù„ ÚˆÛŒÙ¹Ø§ Ù„ÙˆÚˆÙ†Ú¯ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        function setupFormHandlers() {
            document.getElementById('student-form').addEventListener('submit', function (e) { e.preventDefault(); addStudent(); });
            document.getElementById('teacher-form').addEventListener('submit', function (e) { e.preventDefault(); addTeacher(); });
            document.getElementById('staff-form').addEventListener('submit', function (e) { e.preventDefault(); addStaff(); });
            document.getElementById('class-form').addEventListener('submit', function (e) { e.preventDefault(); addClass(); });
            document.getElementById('subject-form').addEventListener('submit', function (e) { e.preventDefault(); addSubject(); });
            document.getElementById('save-class-subject').addEventListener('click', saveClassSubject);
            document.getElementById('save-section').addEventListener('click', saveSection);
            document.getElementById('attendance-form').addEventListener('submit', function (e) { e.preventDefault(); saveAttendance(); });
            document.getElementById('exam-form').addEventListener('submit', function (e) { e.preventDefault(); addExam(); });
            document.getElementById('marks-form').addEventListener('submit', function (e) { e.preventDefault(); saveMarks(); });
            document.getElementById('fee-form').addEventListener('submit', function (e) { e.preventDefault(); collectFee(); });
            document.getElementById('fee-structure-form').addEventListener('submit', function (e) { e.preventDefault(); saveFeeStructure(); });
            document.getElementById('salary-form').addEventListener('submit', function (e) { e.preventDefault(); paySalary(); });
            document.getElementById('save-salary-structure').addEventListener('click', saveSalaryStructure);
            document.getElementById('book-form').addEventListener('submit', function (e) { e.preventDefault(); addBook(); });
            document.getElementById('issue-form').addEventListener('submit', function (e) { e.preventDefault(); issueBook(); });
            document.getElementById('return-form').addEventListener('submit', function (e) { e.preventDefault(); returnBook(); });
            document.getElementById('user-form').addEventListener('submit', function (e) { e.preventDefault(); addUser(); });
            document.getElementById('role-form').addEventListener('submit', function (e) { e.preventDefault(); addRole(); });
        }
        function setCurrentDateDefaults() {
            const today = new Date().toISOString().split('T');
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth() + 1;
            document.querySelectorAll('input[type="date"]').forEach(input => {
                if (!input.value) {
                    input.value = today;
                }
            });
            document.querySelectorAll('input[id$="-year"]').forEach(input => {
                if (!input.value) {
                    input.value = currentYear;
                }
            });
            document.querySelectorAll('select[id$="-month"]').forEach(select => {
                if (!select.value) {
                    const options = select.querySelectorAll('option');
                    options.forEach(option => {
                        if (option.value == currentMonth) {
                            option.selected = true;
                        }
                    });
                }
            });
        }
        async function loadSchoolSettings() {
            try {
                const settings = await getFromStore(STORES.SETTINGS, 'general') || {};
                document.getElementById('school-name').value = settings.schoolName || '';
                document.getElementById('principal-name').value = settings.principalName || '';
                document.getElementById('school-address').value = settings.schoolAddress || '';
                document.getElementById('school-contact').value = settings.schoolPhone || '';
                document.getElementById('school-email').value = settings.schoolEmail || '';
                document.getElementById('auto-backup-freq').value = settings.autoBackupFrequency || 'daily';
                document.getElementById('system-language').value = settings.language || 'ur';
            } catch (e) {
                console.error("Error loading school settings:", e);
            }
        }
        async function populateLibraryDropdowns() {
            try {
                const books = await getAllFromStore(STORES.BOOKS);
                const students = await getAllFromStore(STORES.STUDENTS);
                const issued = await getAllFromStore(STORES.BOOK_ISSUES);
                const bookSelect = document.getElementById('issue-book-select');
                bookSelect.innerHTML = '<option value="">Ú©ØªØ§Ø¨ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</option>';
                books.forEach(book => {
                    if (book.availableCopies > 0) {
                        bookSelect.innerHTML += `<option value="${book.id}">${book.name}</option>`;
                    }
                });
                const studentSelect = document.getElementById('issue-student-select');
                studentSelect.innerHTML = '<option value="">Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</option>';
                students.forEach(student => {
                    studentSelect.innerHTML += `<option value="${student.id}">${student.name} (${student.rollNumber})</option>`;
                });
                const returnSelect = document.getElementById('return-book-select');
                returnSelect.innerHTML = '<option value="">Ø¬Ø§Ø±ÛŒ Ø´Ø¯Û Ú©ØªØ§Ø¨ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</option>';
                const activeIssues = issued.filter(i => i.status === 'issued');
                for (const issue of activeIssues) {
                    const book = books.find(b => b.id === issue.bookId);
                    const student = students.find(s => s.id === issue.studentId);
                    if (book && student) {
                        returnSelect.innerHTML += `<option value="${issue.id}">${book.name} - Ø¬Ø§Ø±ÛŒ: ${student.name}</option>`;
                    }
                }
            } catch (e) {
                console.error("Error populating library dropdowns:", e);
            }
        }
        async function loadSchoolSettings() {
            try {
                const settings = await getFromStore(STORES.SETTINGS, 'general') || {};
                document.getElementById('school-name').value = settings.schoolName || '';
                document.getElementById('principal-name').value = settings.principalName || '';
                document.getElementById('school-address').value = settings.schoolAddress || '';
                document.getElementById('school-contact').value = settings.schoolPhone || '';
                document.getElementById('school-email').value = settings.schoolEmail || '';
                document.getElementById('auto-backup-freq').value = settings.autoBackupFrequency || 'daily';
                document.getElementById('system-language').value = settings.language || 'ur';
            } catch (e) {
                console.error("Error loading school settings:", e);
            }
        }
        async function populateLibraryDropdowns() {
            try {
                const [books, students, issued] = await Promise.all([
                    getAllFromStore(STORES.BOOKS),
                    getAllFromStore(STORES.STUDENTS),
                    getAllFromStore(STORES.BOOK_ISSUES)
                ]);
                const bookSelect = document.getElementById('issue-book-select');
                bookSelect.innerHTML = '<option value="">Ú©ØªØ§Ø¨ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</option>';
                books.forEach(book => {
                    if (book.availableCopies > 0) {
                        bookSelect.innerHTML += `<option value="${book.id}">${book.name}</option>`;
                    }
                });
                const studentSelect = document.getElementById('issue-student-select');
                studentSelect.innerHTML = '<option value="">Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</option>';
                students.forEach(student => {
                    studentSelect.innerHTML += `<option value="${student.id}">${student.name} (${student.rollNumber})</option>`;
                });
                const returnSelect = document.getElementById('return-book-select');
                returnSelect.innerHTML = '<option value="">Ø¬Ø§Ø±ÛŒ Ø´Ø¯Û Ú©ØªØ§Ø¨ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</option>';
                const activeIssues = issued.filter(i => i.status === 'issued');
                for (const issue of activeIssues) {
                    const book = books.find(b => b.id === issue.bookId);
                    const student = students.find(s => s.id === issue.studentId);
                    if (book && student) {
                        returnSelect.innerHTML += `<option value="${issue.id}">${book.name} - Ø¬Ø§Ø±ÛŒ: ${student.name}</option>`;
                    }
                }
            } catch (e) {
                console.error("Error populating library dropdowns:", e);
            }
        }
        function showLoading() {
            document.getElementById('loading').style.display = 'flex';
        }
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification ' + type;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('ur-PK', { year: 'numeric', month: 'long', day: 'numeric' });
        }
        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return '-';
            const date = new Date(dateTimeString);
            return date.toLocaleDateString('ur-PK', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        function formatCurrency(amount) {
            return amount.toLocaleString('ur-PK') + ' Ø±ÙˆÙ¾Û’';
        }
        function calculateSalaryTotal() {
            const basicSalary = parseFloat(document.getElementById('salary-payment-basic').value) || 0;
            const allowances = parseFloat(document.getElementById('salary-payment-allowances').value) || 0;
            const bonus = parseFloat(document.getElementById('salary-payment-bonus').value) || 0;
            const deductions = parseFloat(document.getElementById('salary-payment-deductions').value) || 0;
            const absenceDeduction = parseFloat(document.getElementById('salary-payment-absence').value) || 0;
            const tax = parseFloat(document.getElementById('salary-payment-tax').value) || 0;
            const totalSalary = basicSalary + allowances + bonus - deductions - absenceDeduction - tax;
            document.getElementById('salary-payment-total').value = totalSalary;
        }
        function calculateFeeTotal() {
            const feeAmount = parseFloat(document.getElementById('fee-amount').value) || 0;
            const fine = parseFloat(document.getElementById('fee-fine').value) || 0;
            const discount = parseFloat(document.getElementById('fee-discount').value) || 0;
            const totalFee = feeAmount + fine - discount;
            document.getElementById('fee-total').value = totalFee;
        }
        function getFromStore(storeName, id) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.get(id);
                request.onsuccess = () => {
                    resolve(request.result);
                };
                request.onerror = () => {
                    reject(request.error);
                };
            });
        }
        function getAllFromStore(storeName, limit = null) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();
                request.onsuccess = () => {
                    let results = request.result;
                    if (limit && typeof limit === 'number') {
                        results = results.slice(0, limit);
                    }
                    resolve(results);
                };
                request.onerror = () => {
                    reject(request.error);
                };
            });
        }
        function getAllFromIndex(storeName, indexName, value) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readonly');
                const store = transaction.objectStore(storeName);
                const index = store.index(indexName);
                const request = value ? index.getAll(value) : index.getAll();
                request.onsuccess = () => {
                    resolve(request.result);
                };
                request.onerror = () => {
                    reject(request.error);
                };
            });
        }
        function addToStore(storeName, data) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.add(data);
                request.onsuccess = () => {
                    resolve(request.result);
                };
                request.onerror = () => {
                    reject(request.error);
                };
            });
        }
        function updateInStore(storeName, id, data) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);
                const getRequest = store.get(id);
                getRequest.onsuccess = () => {
                    const existingData = getRequest.result;
                    if (!existingData) {
                        reject(new Error('Item not found'));
                        return;
                    }
                    const updatedData = { ...existingData, ...data };
                    const updateRequest = store.put(updatedData);
                    updateRequest.onsuccess = () => {
                        resolve(updateRequest.result);
                    };
                    updateRequest.onerror = () => {
                        reject(updateRequest.error);
                    };
                };
                getRequest.onerror = () => {
                    reject(getRequest.error);
                };
            });
        }
        function deleteFromStore(storeName, id) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.delete(id);
                request.onsuccess = () => {
                    resolve(true);
                };
                request.onerror = () => {
                    reject(request.error);
                };
            });
        }
        function getCount(storeName) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.count();
                request.onsuccess = () => {
                    resolve(request.result);
                };
                request.onerror = () => {
                    reject(request.error);
                };
            });
        }
        async function getStudentByRollNumber(rollNumber) {
            try {
                const transaction = db.transaction(STORES.STUDENTS, 'readonly');
                const store = transaction.objectStore(STORES.STUDENTS);
                const index = store.index('rollNumber');
                const request = index.get(rollNumber);
                return new Promise((resolve, reject) => {
                    request.onsuccess = () => {
                        resolve(request.result);
                    };
                    request.onerror = () => {
                        reject(request.error);
                    };
                });
            } catch (error) {
                console.error('Error getting student by roll number:', error);
                throw error;
            }
        }
        function toggleFeeReportFields() {
            const reportType = document.getElementById('fee-report-type').value;
            document.getElementById('fee-report-date-row').style.display = 'none';
            document.getElementById('fee-report-month-row').style.display = 'none';
            document.getElementById('fee-report-class-row').style.display = 'none';
            switch (reportType) {
                case 'daily':
                    document.getElementById('fee-report-date-row').style.display = 'flex';
                    break;
                case 'monthly':
                    document.getElementById('fee-report-month-row').style.display = 'flex';
                    break;
                case 'yearly':
                    document.getElementById('fee-report-year').parentElement.parentElement.style.display = 'flex';
                    break;
                case 'class':
                    document.getElementById('fee-report-class-row').style.display = 'flex';
                    document.getElementById('fee-report-month-row').style.display = 'flex';
                    break;
            }
        }
        function toggleSalaryReportFields() {
            const reportType = document.getElementById('salary-report-type').value;
            document.getElementById('salary-report-month-row').style.display = 'none';
            document.getElementById('salary-report-employee-row').style.display = 'none';
            switch (reportType) {
                case 'monthly':
                    document.getElementById('salary-report-month-row').style.display = 'flex';
                    break;
                case 'yearly':
                    document.getElementById('salary-report-year').parentElement.parentElement.style.display = 'flex';
                    break;
                case 'employee':
                    document.getElementById('salary-report-employee-row').style.display = 'flex';
                    loadEmployeesForSalaryReport();
                    break;
            }
        }
        async function loadEmployeesForSalaryStructure() {
            try {
                const employeeType = document.getElementById('structure-employee-type').value;
                const dropdown = document.getElementById('structure-employee');
                dropdown.innerHTML = '';
                let employees;
                if (employeeType === 'teacher') {
                    employees = await getAllFromStore(STORES.TEACHERS);
                } else {
                    employees = await getAllFromStore(STORES.STAFF);
                }
                employees.forEach(employee => {
                    const option = document.createElement('option');
                    option.value = employee.id;
                    option.textContent = employee.name;
                    dropdown.appendChild(option);
                });
                console.log(`Loaded ${employees.length} employees for salary structure`);
            } catch (error) {
                console.error('Error loading employees for salary structure:', error);
                showNotification('ØªÙ†Ø®ÙˆØ§Û Ø³Ù¹Ø±Ú©Ú†Ø± Ú©Û’ Ù„ÛŒÛ’ Ù…Ù„Ø§Ø²Ù…ÛŒÙ† Ù„ÙˆÚˆÙ†Ú¯ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            }
        }
        async function loadEmployeesForSalaryReport() {
            try {
                const employeeType = document.getElementById('salary-report-employee-type').value;
                const dropdown = document.getElementById('salary-report-employee');
                dropdown.innerHTML = '';
                const allOption = document.createElement('option');
                allOption.value = 'all';
                allOption.textContent = 'ØªÙ…Ø§Ù… Ù…Ù„Ø§Ø²Ù…ÛŒÙ†';
                dropdown.appendChild(allOption);
                if (employeeType === 'all') {
                    const teachers = await getAllFromStore(STORES.TEACHERS);
                    const staff = await getAllFromStore(STORES.STAFF);
                    const teachersGroup = document.createElement('optgroup');
                    teachersGroup.label = 'Ø§Ø³Ø§ØªØ°Û';
                    teachers.forEach(teacher => {
                        const option = document.createElement('option');
                        option.value = `teacher_${teacher.id}`;
                        option.textContent = teacher.name;
                        teachersGroup.appendChild(option);
                    });
                    dropdown.appendChild(teachersGroup);
                    const staffGroup = document.createElement('optgroup');
                    staffGroup.label = 'Ø¹Ù…Ù„Û';
                    staff.forEach(staffMember => {
                        const option = document.createElement('option');
                        option.value = `staff_${staffMember.id}`;
                        option.textContent = staffMember.name;
                        staffGroup.appendChild(option);
                    });
                    dropdown.appendChild(staffGroup);
                } else if (employeeType === 'teacher') {
                    const teachers = await getAllFromStore(STORES.TEACHERS);
                    teachers.forEach(teacher => {
                        const option = document.createElement('option');
                        option.value = teacher.id;
                        option.textContent = teacher.name;
                        dropdown.appendChild(option);
                    });
                } else {
                    const staff = await getAllFromStore(STORES.STAFF);
                    staff.forEach(staffMember => {
                        const option = document.createElement('option');
                        option.value = staffMember.id;
                        option.textContent = staffMember.name;
                        dropdown.appendChild(option);
                    });
                }
                console.log('Employees loaded for salary report');
            } catch (error) {
                console.error('Error loading employees for salary report:', error);
                showNotification('ØªÙ†Ø®ÙˆØ§Û Ø±Ù¾ÙˆØ±Ù¹ Ú©Û’ Ù„ÛŒÛ’ Ù…Ù„Ø§Ø²Ù…ÛŒÙ† Ù„ÙˆÚˆÙ†Ú¯ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            }
        }
        async function addStaff() {
            showLoading();
            const form = document.getElementById('staff-form');
            const editId = form.dataset.editId ? parseInt(form.dataset.editId) : null;
            try {
                const staffData = {
                    name: document.getElementById('staff-name').value,
                    fatherName: document.getElementById('staff-father').value,
                    dob: document.getElementById('staff-dob').value,
                    gender: document.getElementById('staff-gender').value,
                    designation: document.getElementById('staff-designation').value,
                    department: document.getElementById('staff-department').value,
                    qualification: document.getElementById('staff-qualification').value,
                    responsibilities: document.getElementById('staff-responsibilities').value,
                    contact: document.getElementById('staff-contact').value,
                    email: document.getElementById('staff-email').value,
                    address: document.getElementById('staff-address').value,
                    cnic: document.getElementById('staff-cnic').value,
                    joiningDate: document.getElementById('staff-joining-date').value,
                    basicSalary: parseFloat(document.getElementById('staff-basic-salary').value),
                    allowances: parseFloat(document.getElementById('staff-allowances').value) || 0,
                    deductions: parseFloat(document.getElementById('staff-deductions').value) || 0,
                    notes: document.getElementById('staff-notes').value,
                };
                if (editId) {
                    await updateInStore(STORES.STAFF, editId, staffData);
                    showNotification('Ø¹Ù…Ù„Û’ Ú©Ø§ Ø±ÛŒÚ©Ø§Ø±Úˆ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø± Ø¯ÛŒØ§ Ú¯ÛŒØ§Û”', 'success');
                } else {
                    const staffCount = await getCount(STORES.STAFF);
                    staffData.employeeId = 'S' + String(staffCount + 1).padStart(3, '0');
                    await addToStore(STORES.STAFF, staffData);
                    showNotification('Ø¹Ù…Ù„Û Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¯Ø§Ø®Ù„ Ú©Ø± Ù„ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’Û”', 'success');
                }
                form.reset();
                delete form.dataset.editId;
                form.querySelector('button[type="submit"]').textContent = 'Ø¹Ù…Ù„Û Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº';
                document.querySelector('.tab[data-tab="staff-list"]').click();
            } catch (error) {
                console.error('Error saving staff:', error);
                showNotification('Ø¹Ù…Ù„Û’ Ú©Ùˆ Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”', 'error');
            } finally {
                hideLoading();
            }
        }
        async function addTeacher() {
            try {
                showLoading();
                const name = document.getElementById('teacher-name').value;
                const fatherName = document.getElementById('teacher-father').value;
                const dob = document.getElementById('teacher-dob').value;
                const gender = document.getElementById('teacher-gender').value;
                const qualification = document.getElementById('teacher-qualification').value;
                const specialization = document.getElementById('teacher-specialization').value;
                const subjects = Array.from(document.getElementById('teacher-subject').selectedOptions).map(option => option.value);
                const classes = Array.from(document.getElementById('teacher-class').selectedOptions).map(option => option.value);
                const contact = document.getElementById('teacher-contact').value;
                const email = document.getElementById('teacher-email').value;
                const address = document.getElementById('teacher-address').value;
                const cnic = document.getElementById('teacher-cnic').value;
                const photoInput = document.getElementById('teacher-photo');
                const joiningDate = document.getElementById('teacher-joining-date').value;
                const basicSalary = document.getElementById('teacher-basic-salary').value;
                const allowances = document.getElementById('teacher-allowances').value;
                const deductions = document.getElementById('teacher-deductions').value;
                const notes = document.getElementById('teacher-notes').value;
                const teachersCount = await getCount(STORES.TEACHERS);
                const employeeId = 'T' + String(teachersCount + 1).padStart(3, '0');
                let photo = null;
                if (photoInput.files && photoInput.files) {
                    photo = await fileToBase64(photoInput.files);
                }
                const teacherData = {
                    employeeId: employeeId,
                    name: name,
                    fatherName: fatherName,
                    gender: gender,
                    dob: dob,
                    qualification: qualification,
                    specialization: specialization,
                    subjects: subjects,
                    classes: classes,
                    contact: contact,
                    email: email,
                    address: address,
                    cnic: cnic,
                    photo: photo,
                    joiningDate: joiningDate,
                    basicSalary: parseFloat(basicSalary),
                    allowances: parseFloat(allowances) || 0,
                    deductions: parseFloat(deductions) || 0,
                    notes: notes,
                    createdAt: new Date().toISOString()
                };
                const teacherId = await addToStore(STORES.TEACHERS, teacherData);
                await addToStore(STORES.SALARY_STRUCTURE, {
                    employeeId: teacherId,
                    employeeType: 'teacher',
                    basicSalary: parseFloat(basicSalary),
                    houseRent: parseFloat(basicSalary) * 0.45,
                    transport: 2000,
                    medical: 1500,
                    otherAllowances: parseFloat(allowances) || 0,
                    deductions: parseFloat(deductions) || 0,
                    createdAt: new Date().toISOString()
                });
                await addToStore(STORES.ACTIVITIES, {
                    description: 'Ù†ÛŒØ§ Ø§Ø³ØªØ§Ø¯ Ø¯Ø§Ø®Ù„ Ú©ÛŒØ§ Ú¯ÛŒØ§',
                    date: new Date().toISOString(),
                    type: 'Ø¨Ú¾Ø±ØªÛŒ',
                    user: 'Ø³Ø³Ù¹Ù… Ø§ÛŒÚˆÙ…Ù†',
                    userId: 1,
                    details: `${name} (${employeeId}) Ú©Ùˆ Ø¨Ø·ÙˆØ± Ø§Ø³ØªØ§Ø¯ Ø¨Ú¾Ø±ØªÛŒ Ú©ÛŒØ§ Ú¯ÛŒØ§`,
                    createdAt: new Date().toISOString()
                });
                document.getElementById('teacher-form').reset();
                loadTeachersTable();
                loadTeacherDropdowns();
                showNotification('Ø§Ø³ØªØ§Ø¯ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¯Ø§Ø®Ù„ Ú©Ø± Ù„ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’', 'success');
                document.querySelector('.tab[data-tab="teachers-list"]').click();
            } catch (error) {
                console.error('Error adding teacher:', error);
                showNotification('Ø§Ø³ØªØ§Ø¯ Ø¯Ø§Ø®Ù„ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function addClass() {
            showLoading();
            const form = document.getElementById('class-form');
            const editId = form.dataset.editId ? parseInt(form.dataset.editId) : null;
            try {
                const classData = {
                    name: document.getElementById('class-name').value,
                    inChargeId: parseInt(document.getElementById('class-incharge').value),
                    level: document.getElementById('class-level').value,
                    roomNumber: document.getElementById('class-room').value,
                    feeCategory: document.getElementById('class-fee-category').value,
                    monthlyFee: parseFloat(document.getElementById('class-monthly-fee').value),
                    admissionFee: parseFloat(document.getElementById('class-admission-fee').value),
                    notes: document.getElementById('class-notes').value,
                };
                if (editId) {
                    await updateInStore(STORES.CLASSES, editId, classData);
                    showNotification('Ú©Ù„Ø§Ø³ Ú©Ø§ Ø±ÛŒÚ©Ø§Ø±Úˆ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø± Ø¯ÛŒØ§ Ú¯ÛŒØ§Û”', 'success');
                } else {
                    const newClassId = await addToStore(STORES.CLASSES, classData);
                    const sections = Array.from(document.getElementById('class-sections').selectedOptions).map(opt => opt.value);
                    for (const sectionName of sections) {
                        await addToStore(STORES.SECTIONS, { classId: newClassId, name: sectionName, inChargeId: null });
                    }
                    showNotification('Ú©Ù„Ø§Ø³ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¨Ù†Ø§ Ù„ÛŒ Ú¯Ø¦ÛŒ ÛÛ’Û”', 'success');
                }
                form.reset();
                delete form.dataset.editId;
                form.querySelector('button[type="submit"]').textContent = 'Ú©Ù„Ø§Ø³ Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº';
                document.querySelector('.tab[data-tab="classes-list"]').click();
                loadDropdownData();
            } catch (error) { console.error('Error saving class:', error); } finally { hideLoading(); }
        }
        async function addSubject() {
            showLoading();
            const form = document.getElementById('subject-form');
            const editId = form.dataset.editId ? parseInt(form.dataset.editId) : null;
            try {
                const subjectData = {
                    name: document.getElementById('subject-name').value,
                    code: document.getElementById('subject-code').value,
                    type: document.getElementById('subject-type').value,
                    periods: parseInt(document.getElementById('subject-periods').value),
                    details: document.getElementById('subject-details').value,
                };
                if (editId) {
                    await updateInStore(STORES.SUBJECTS, editId, subjectData);
                    showNotification('Ù…Ø¶Ù…ÙˆÙ† Ú©Ø§ Ø±ÛŒÚ©Ø§Ø±Úˆ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø± Ø¯ÛŒØ§ Ú¯ÛŒØ§Û”', 'success');
                } else {
                    await addToStore(STORES.SUBJECTS, subjectData);
                    showNotification('Ù…Ø¶Ù…ÙˆÙ† Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¨Ù†Ø§ Ù„ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’Û”', 'success');
                }
                form.reset();
                delete form.dataset.editId;
                form.querySelector('button[type="submit"]').textContent = 'Ù…Ø¶Ù…ÙˆÙ† Ø¯Ø§Ø®Ù„ Ú©Ø±ÛŒÚº';
                document.querySelector('.tab[data-tab="subjects-list"]').click();
                loadDropdownData();
            } catch (error) { console.error('Error saving subject:', error); } finally { hideLoading(); }
        }
        async function saveClassSubject() {
            try {
                showLoading();
                const classId = document.getElementById('class-subject-class').value;
                const subjectId = document.getElementById('class-subject-subject').value;
                const teacherId = document.getElementById('class-subject-teacher').value;
                if (!classId || !subjectId || !teacherId) {
                    showNotification('Ø¨Ø±Ø§Ø¦Û’ Ù…ÛØ±Ø¨Ø§Ù†ÛŒ ØªÙ…Ø§Ù… ÙÛŒÙ„ÚˆØ² Ù¾Ø± Ú©Ø±ÛŒÚº', 'error');
                    return;
                }
                const classData = await getFromStore(STORES.CLASSES, parseInt(classId));
                const subjectData = await getFromStore(STORES.SUBJECTS, parseInt(subjectId));
                const teacherData = await getFromStore(STORES.TEACHERS, parseInt(teacherId));
                const existingClassSubjects = await getAllFromStore(STORES.CLASS_SUBJECTS);
                const existingRecord = existingClassSubjects.find(record =>
                    record.classId === parseInt(classId) && record.subjectId === parseInt(subjectId)
                );
                if (existingRecord) {
                    await updateInStore(STORES.CLASS_SUBJECTS, existingRecord.id, {
                        teacherId: parseInt(teacherId),
                        teacherName: teacherData ? teacherData.name : '',
                        updatedAt: new Date().toISOString()
                    });
                    showNotification('Ú©Ù„Ø§Ø³ Ù…Ø¶Ù…ÙˆÙ† Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø± Ø¯ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’', 'success');
                } else {
                    const classSubjectData = {
                        classId: parseInt(classId),
                        className: classData ? classData.name : '',
                        subjectId: parseInt(subjectId),
                        subjectName: subjectData ? subjectData.name : '',
                        teacherId: parseInt(teacherId),
                        teacherName: teacherData ? teacherData.name : '',
                        createdAt: new Date().toISOString()
                    };
                    await addToStore(STORES.CLASS_SUBJECTS, classSubjectData);
                    showNotification('Ú©Ù„Ø§Ø³ Ù…Ø¶Ù…ÙˆÙ† Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù…Ø­ÙÙˆØ¸ Ú©Ø± Ù„ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’', 'success');
                }
                loadClassSubjectsTable();
            } catch (error) {
                console.error('Error saving class subject:', error);
                showNotification('Ú©Ù„Ø§Ø³ Ù…Ø¶Ù…ÙˆÙ† Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function saveSection() {
            try {
                showLoading();
                const classId = document.getElementById('section-class').value;
                const sectionName = document.getElementById('section-name').value;
                const inChargeId = document.getElementById('section-incharge').value;
                if (!classId || !sectionName || !inChargeId) {
                    showNotification('Ø¨Ø±Ø§Ø¦Û’ Ù…ÛØ±Ø¨Ø§Ù†ÛŒ ØªÙ…Ø§Ù… ÙÛŒÙ„ÚˆØ² Ù¾Ø± Ú©Ø±ÛŒÚº', 'error');
                    return;
                }
                const existingSections = await getAllFromStore(STORES.SECTIONS);
                const existingSection = existingSections.find(section =>
                    section.classId === parseInt(classId) && section.name === sectionName
                );
                if (existingSection) {
                    await updateInStore(STORES.SECTIONS, existingSection.id, {
                        inChargeId: parseInt(inChargeId),
                        updatedAt: new Date().toISOString()
                    });
                    showNotification('Ø³ÛŒÚ©Ø´Ù† Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø± Ø¯ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’', 'success');
                } else {
                    const sectionData = {
                        classId: parseInt(classId),
                        name: sectionName,
                        inChargeId: parseInt(inChargeId),
                        createdAt: new Date().toISOString()
                    };
                    await addToStore(STORES.SECTIONS, sectionData);
                    showNotification('Ø³ÛŒÚ©Ø´Ù† Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù…Ø­ÙÙˆØ¸ Ú©Ø± Ù„ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’', 'success');
                }
                loadSectionsTable();
            } catch (error) {
                console.error('Error saving section:', error);
                showNotification('Ø³ÛŒÚ©Ø´Ù† Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function saveAttendance() {
            try {
                showLoading();
                const date = document.getElementById('attendance-date').value;
                const classId = parseInt(document.getElementById('attendance-class').value);
                const sectionId = parseInt(document.getElementById('attendance-section').value);
                const table = document.getElementById('attendance-table');
                const tbody = table.querySelector('tbody');
                const rows = tbody.querySelectorAll('tr');
                const attendanceData = [];
                for (const row of rows) {
                    const studentId = parseInt(row.getAttribute('data-student-id'));
                    const statusRadios = row.querySelectorAll('input[name="status_' + studentId + '"]');
                    let status = '';
                    for (const radio of statusRadios) {
                        if (radio.checked) {
                            status = radio.value;
                            break;
                        }
                    }
                    const isLate = row.querySelector('input[name="late_' + studentId + '"]').checked;
                    const isLeave = row.querySelector('input[name="leave_' + studentId + '"]').checked;
                    const notes = row.querySelector('input[name="notes_' + studentId + '"]').value;
                    attendanceData.push({
                        date: date,
                        classId: classId,
                        sectionId: sectionId,
                        studentId: studentId,
                        status: status,
                        isLate: isLate,
                        isLeave: isLeave,
                        notes: notes,
                        createdAt: new Date().toISOString()
                    });
                }
                const existingAttendance = await getAllFromIndex(STORES.ATTENDANCE, 'dateClassSection', [date, classId, sectionId]);
                if (existingAttendance && existingAttendance.length > 0) {
                    for (const record of existingAttendance) {
                        await deleteFromStore(STORES.ATTENDANCE, record.id);
                    }
                }
                for (const record of attendanceData) {
                    await addToStore(STORES.ATTENDANCE, record);
                }
                await addToStore(STORES.ACTIVITIES, {
                    description: 'Ø­Ø§Ø¶Ø±ÛŒ Ù…Ø­ÙÙˆØ¸ Ú©ÛŒ Ú¯Ø¦ÛŒ',
                    date: new Date().toISOString(),
                    type: 'Ø­Ø§Ø¶Ø±ÛŒ',
                    user: 'Ø³Ø³Ù¹Ù… Ø§ÛŒÚˆÙ…Ù†',
                    userId: 1,
                    details: `ØªØ§Ø±ÛŒØ® ${date} Ú©Û’ Ù„ÛŒÛ’ Ú©Ù„Ø§Ø³ Ø§ÙˆØ± Ø³ÛŒÚ©Ø´Ù† Ú©ÛŒ Ø­Ø§Ø¶Ø±ÛŒ Ù…Ø­ÙÙˆØ¸ Ú©ÛŒ Ú¯Ø¦ÛŒ`,
                    createdAt: new Date().toISOString()
                });
                showNotification('Ø­Ø§Ø¶Ø±ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù…Ø­ÙÙˆØ¸ Ú©Ø± Ù„ÛŒ Ú¯Ø¦ÛŒ ÛÛ’', 'success');
                document.getElementById('attendance-table-container').style.display = 'none';
                document.querySelector('.tab[data-tab="view-attendance"]').click();
            } catch (error) {
                console.error('Error saving attendance:', error);
                showNotification('Ø­Ø§Ø¶Ø±ÛŒ Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function addExam() {
            try {
                showLoading();
                const name = document.getElementById('exam-name').value;
                const type = document.getElementById('exam-type').value;
                const startDate = document.getElementById('exam-start-date').value;
                const endDate = document.getElementById('exam-end-date').value;
                const classes = Array.from(document.getElementById('exam-classes').selectedOptions).map(option => parseInt(option.value));
                const passingPercent = document.getElementById('exam-passing-percent').value;
                const details = document.getElementById('exam-details').value;
                const examData = {
                    name: name,
                    type: type,
                    startDate: startDate,
                    endDate: endDate,
                    classes: classes,
                    passingPercent: parseInt(passingPercent),
                    details: details,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };
                const examId = await addToStore(STORES.EXAMS, examData);
                await addToStore(STORES.ACTIVITIES, {
                    description: 'Ù†ÛŒØ§ Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù†Ø§ÛŒØ§ Ú¯ÛŒØ§',
                    date: new Date().toISOString(),
                    type: 'Ø§Ù…ØªØ­Ø§Ù†',
                    user: 'Ø³Ø³Ù¹Ù… Ø§ÛŒÚˆÙ…Ù†',
                    userId: 1,
                    details: `${name} Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù†Ø§ÛŒØ§ Ú¯ÛŒØ§ØŒ Ø¬Ùˆ ${startDate} Ø³Û’ ${endDate} ØªÚ© Ù…Ù†Ø¹Ù‚Ø¯ ÛÙˆÚ¯Ø§`,
                    createdAt: new Date().toISOString()
                });
                await addToStore(STORES.EVENTS, {
                    title: `${name} - ${type}`,
                    date: startDate,
                    location: 'Ù…Ø¯Ø±Ø³Û',
                    type: 'Ø§Ù…ØªØ­Ø§Ù†',
                    description: `${name} Ø§Ù…ØªØ­Ø§Ù† Ø´Ø±ÙˆØ¹ ÛÙˆÚ¯Ø§`,
                    createdAt: new Date().toISOString()
                });
                document.getElementById('exam-form').reset();
                loadExamsTable();
                showNotification('Ø§Ù…ØªØ­Ø§Ù† Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¨Ù†Ø§ Ù„ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’', 'success');
                document.querySelector('.tab[data-tab="exams-list"]').click();
            } catch (error) {
                console.error('Error adding exam:', error);
                showNotification('Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function saveMarks() {
            try {
                showLoading();
                const examId = parseInt(document.getElementById('marks-exam').value);
                const classId = parseInt(document.getElementById('marks-class').value);
                const sectionId = parseInt(document.getElementById('marks-section').value);
                const subjectId = parseInt(document.getElementById('marks-subject').value);
                const totalMarks = parseInt(document.getElementById('marks-total').value);
                const table = document.getElementById('marks-table');
                const tbody = table.querySelector('tbody');
                const rows = tbody.querySelectorAll('tr');
                const marksData = [];
                for (const row of rows) {
                    const studentId = parseInt(row.getAttribute('data-student-id'));
                    const obtainedMarks = parseFloat(row.querySelector('input[name="marks_' + studentId + '"]').value);
                    const percentage = (obtainedMarks / totalMarks) * 100;
                    let grade = '';
                    if (percentage >= 90) grade = 'A+';
                    else if (percentage >= 80) grade = 'A';
                    else if (percentage >= 70) grade = 'B';
                    else if (percentage >= 60) grade = 'C';
                    else if (percentage >= 50) grade = 'D';
                    else if (percentage >= 33) grade = 'E';
                    else grade = 'F';
                    const notes = row.querySelector('input[name="notes_' + studentId + '"]').value;
                    marksData.push({
                        examId: examId,
                        classId: classId,
                        sectionId: sectionId,
                        subjectId: subjectId,
                        studentId: studentId,
                        totalMarks: totalMarks,
                        obtainedMarks: obtainedMarks,
                        percentage: percentage,
                        grade: grade,
                        isPassed: percentage >= 33,
                        notes: notes,
                        createdAt: new Date().toISOString()
                    });
                }
                for (const markRecord of marksData) {
                    const existingMarks = await getAllFromIndex(STORES.MARKS, 'examStudentSubject', [markRecord.examId, markRecord.studentId, markRecord.subjectId]);
                    if (existingMarks && existingMarks.length > 0) {
                        markRecord.id = existingMarks.id;
                        await updateInStore(STORES.MARKS, existingMarks.id, markRecord);
                    } else {
                        await addToStore(STORES.MARKS, markRecord);
                    }
                }
                await addToStore(STORES.ACTIVITIES, {
                    description: 'Ù†Ù…Ø¨Ø± Ù…Ø­ÙÙˆØ¸ Ú©ÛŒÛ’ Ú¯Ø¦Û’',
                    date: new Date().toISOString(),
                    type: 'Ø§Ù…ØªØ­Ø§Ù†',
                    user: 'Ø³Ø³Ù¹Ù… Ø§ÛŒÚˆÙ…Ù†',
                    userId: 1,
                    details: `Ø§Ù…ØªØ­Ø§Ù† Ú©Û’ Ù†Ù…Ø¨Ø± Ù…Ø­ÙÙˆØ¸ Ú©ÛŒÛ’ Ú¯Ø¦Û’`,
                    createdAt: new Date().toISOString()
                });
                showNotification('Ù†Ù…Ø¨Ø± Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù…Ø­ÙÙˆØ¸ Ú©Ø± Ù„ÛŒÛ’ Ú¯Ø¦Û’ ÛÛŒÚº', 'success');
                document.getElementById('marks-table-container').style.display = 'none';
                document.querySelector('.tab[data-tab="result-cards"]').click();
            } catch (error) {
                console.error('Error saving marks:', error);
                showNotification('Ù†Ù…Ø¨Ø± Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function collectFee() {
            try {
                showLoading();
                const studentId = parseInt(document.getElementById('fee-roll-number').getAttribute('data-student-id'));
                const studentName = document.getElementById('fee-student-name').value;
                const month = document.getElementById('fee-month').value;
                const year = parseInt(document.getElementById('fee-year').value);
                const amount = parseFloat(document.getElementById('fee-amount').value);
                const fine = parseFloat(document.getElementById('fee-fine').value) || 0;
                const discount = parseFloat(document.getElementById('fee-discount').value) || 0;
                const total = parseFloat(document.getElementById('fee-total').value);
                const paymentDate = document.getElementById('fee-payment-date').value;
                const paymentMethod = document.getElementById('fee-payment-method').value;
                const notes = document.getElementById('fee-notes').value;
                const receiptNumber = 'FEE' + Date.now().toString().slice(-6);
                const feeData = {
                    receiptNumber: receiptNumber,
                    studentId: studentId,
                    studentName: studentName,
                    month: month,
                    year: year,
                    amount: amount,
                    fine: fine,
                    discount: discount,
                    total: total,
                    date: paymentDate,
                    paymentMethod: paymentMethod,
                    notes: notes,
                    createdAt: new Date().toISOString()
                };
                const existingFee = await getAllFromIndex(STORES.FEES, 'studentMonthYear', [studentId, month, year]);
                if (existingFee && existingFee.length > 0) {
                    showNotification('Ø§Ø³ Ù…ÛÛŒÙ†Û’ Ú©ÛŒ ÙÛŒØ³ Ù¾ÛÙ„Û’ ÛÛŒ Ø¬Ù…Ø¹ Ú©Ø±ÙˆØ§Ø¦ÛŒ Ø¬Ø§ Ú†Ú©ÛŒ ÛÛ’', 'error');
                    return;
                }
                const feeId = await addToStore(STORES.FEES, feeData);
                await addToStore(STORES.ACTIVITIES, {
                    description: 'ÙÛŒØ³ Ø¬Ù…Ø¹ Ú©ÛŒ Ú¯Ø¦ÛŒ',
                    date: new Date().toISOString(),
                    type: 'ÙÛŒØ³',
                    user: 'Ø³Ø³Ù¹Ù… Ø§ÛŒÚˆÙ…Ù†',
                    userId: 1,
                    details: `${studentName} Ù†Û’ ${month} ${year} Ú©ÛŒ ÙÛŒØ³ ${total} Ø±ÙˆÙ¾Û’ Ø¬Ù…Ø¹ Ú©Ø±ÙˆØ§Ø¦ÛŒ`,
                    createdAt: new Date().toISOString()
                });
                await loadFeeHistory(studentId);
                showNotification('ÙÛŒØ³ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¬Ù…Ø¹ Ú©Ø±ÙˆØ§ Ù„ÛŒ Ú¯Ø¦ÛŒ ÛÛ’', 'success');
                document.getElementById('print-receipt').disabled = false;
            } catch (error) {
                console.error('Error collecting fee:', error);
                showNotification('ÙÛŒØ³ Ø¬Ù…Ø¹ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function saveFeeStructure() {
            try {
                showLoading();
                const classId = parseInt(document.getElementById('fee-structure-class').value);
                const category = document.getElementById('fee-structure-category').value;
                const monthlyFee = parseFloat(document.getElementById('fee-structure-monthly').value);
                const admissionFee = parseFloat(document.getElementById('fee-structure-admission').value);
                const examFee = parseFloat(document.getElementById('fee-structure-exam').value);
                const computerFee = parseFloat(document.getElementById('fee-structure-computer').value) || 0;
                const transportFee = parseFloat(document.getElementById('fee-structure-transport').value) || 0;
                const otherFee = parseFloat(document.getElementById('fee-structure-other').value) || 0;
                const details = document.getElementById('fee-structure-details').value;
                const existingStructure = await getAllFromIndex(STORES.FEE_STRUCTURE, 'classCategory', [classId, category]);
                if (existingStructure && existingStructure.length > 0) {
                    await updateInStore(STORES.FEE_STRUCTURE, existingStructure.id, {
                        monthlyFee: monthlyFee,
                        admissionFee: admissionFee,
                        examFee: examFee,
                        computerFee: computerFee,
                        transportFee: transportFee,
                        otherFee: otherFee,
                        details: details,
                        updatedAt: new Date().toISOString()
                    });
                    showNotification('ÙÛŒØ³ Ø³Ù¹Ø±Ú©Ú†Ø± Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø± Ø¯ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’', 'success');
                } else {
                    const feeStructureData = {
                        classId: classId,
                        category: category,
                        monthlyFee: monthlyFee,
                        admissionFee: admissionFee,
                        examFee: examFee,
                        computerFee: computerFee,
                        transportFee: transportFee,
                        otherFee: otherFee,
                        details: details,
                        createdAt: new Date().toISOString()
                    };
                    await addToStore(STORES.FEE_STRUCTURE, feeStructureData);
                    showNotification('ÙÛŒØ³ Ø³Ù¹Ø±Ú©Ú†Ø± Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù…Ø­ÙÙˆØ¸ Ú©Ø± Ù„ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’', 'success');
                }
                loadFeeStructureTable();
            } catch (error) {
                console.error('Error saving fee structure:', error);
                showNotification('ÙÛŒØ³ Ø³Ù¹Ø±Ú©Ú†Ø± Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function paySalary() {
            try {
                showLoading();
                const employeeType = document.getElementById('salary-employee-type').value;
                const employeeId = parseInt(document.getElementById('salary-employee-id').getAttribute('data-employee-id'));
                const employeeName = document.getElementById('salary-employee-name').value;
                const month = document.getElementById('salary-month').value;
                const year = parseInt(document.getElementById('salary-year').value);
                const basicSalary = parseFloat(document.getElementById('salary-payment-basic').value);
                const allowances = parseFloat(document.getElementById('salary-payment-allowances').value) || 0;
                const bonus = parseFloat(document.getElementById('salary-payment-bonus').value) || 0;
                const deductions = parseFloat(document.getElementById('salary-payment-deductions').value) || 0;
                const absenceDeduction = parseFloat(document.getElementById('salary-payment-absence').value) || 0;
                const tax = parseFloat(document.getElementById('salary-payment-tax').value) || 0;
                const total = parseFloat(document.getElementById('salary-payment-total').value);
                const paymentDate = document.getElementById('salary-payment-date').value;
                const paymentMethod = document.getElementById('salary-payment-method').value;
                const transactionId = document.getElementById('salary-payment-transaction').value;
                const notes = document.getElementById('salary-payment-notes').value;
                const voucherNumber = 'SAL' + Date.now().toString().slice(-6);
                const salaryData = {
                    voucherNumber: voucherNumber,
                    employeeId: employeeId,
                    employeeType: employeeType,
                    employeeName: employeeName,
                    month: month,
                    year: year,
                    basicSalary: basicSalary,
                    allowances: allowances,
                    bonus: bonus,
                    deductions: deductions,
                    absenceDeduction: absenceDeduction,
                    tax: tax,
                    total: total,
                    date: paymentDate,
                    paymentMethod: paymentMethod,
                    transactionId: transactionId,
                    notes: notes,
                    createdAt: new Date().toISOString()
                };
                const existingSalary = await getAllFromIndex(STORES.SALARY, 'employeeMonthYear', [employeeId, month, year]);
                if (existingSalary && existingSalary.length > 0) {
                    showNotification('Ø§Ø³ Ù…ÛÛŒÙ†Û’ Ú©ÛŒ ØªÙ†Ø®ÙˆØ§Û Ù¾ÛÙ„Û’ ÛÛŒ Ø§Ø¯Ø§ Ú©ÛŒ Ø¬Ø§ Ú†Ú©ÛŒ ÛÛ’', 'error');
                    return;
                }
                const salaryId = await addToStore(STORES.SALARY, salaryData);
                await addToStore(STORES.ACTIVITIES, {
                    description: 'ØªÙ†Ø®ÙˆØ§Û Ø§Ø¯Ø§ Ú©ÛŒ Ú¯Ø¦ÛŒ',
                    date: new Date().toISOString(),
                    type: 'ØªÙ†Ø®ÙˆØ§Û',
                    user: 'Ø³Ø³Ù¹Ù… Ø§ÛŒÚˆÙ…Ù†',
                    userId: 1,
                    details: `${employeeName} Ú©Ùˆ ${month} ${year} Ú©ÛŒ ØªÙ†Ø®ÙˆØ§Û ${total} Ø±ÙˆÙ¾Û’ Ø§Ø¯Ø§ Ú©ÛŒ Ú¯Ø¦ÛŒ`,
                    createdAt: new Date().toISOString()
                });
                await loadSalaryHistory(employeeId, employeeType);
                showNotification('ØªÙ†Ø®ÙˆØ§Û Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§Ø¯Ø§ Ú©Ø± Ø¯ÛŒ Ú¯Ø¦ÛŒ ÛÛ’', 'success');
                document.getElementById('print-salary-slip').disabled = false;
            } catch (error) {
                console.error('Error paying salary:', error);
                showNotification('ØªÙ†Ø®ÙˆØ§Û Ø§Ø¯Ø§ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function saveSalaryStructure() {
            try {
                showLoading();
                const employeeType = document.getElementById('structure-employee-type').value;
                const employeeId = parseInt(document.getElementById('structure-employee').value);
                const basicSalary = parseFloat(document.getElementById('structure-basic-salary').value);
                const houseRent = parseFloat(document.getElementById('structure-house-rent').value) || 0;
                const transport = parseFloat(document.getElementById('structure-transport').value) || 0;
                const medical = parseFloat(document.getElementById('structure-medical').value) || 0;
                const otherAllowances = parseFloat(document.getElementById('structure-other-allowances').value) || 0;
                const deductions = parseFloat(document.getElementById('structure-deductions').value) || 0;
                const totalSalary = parseFloat(document.getElementById('structure-total-salary').value);
                const details = document.getElementById('structure-details').value;
                const existingStructure = await getAllFromIndex(STORES.SALARY_STRUCTURE, 'employeeTypeId', [employeeType, employeeId]);
                if (existingStructure && existingStructure.length > 0) {
                    await updateInStore(STORES.SALARY_STRUCTURE, existingStructure.id, {
                        basicSalary: basicSalary,
                        houseRent: houseRent,
                        transport: transport,
                        medical: medical,
                        otherAllowances: otherAllowances,
                        deductions: deductions,
                        totalSalary: totalSalary,
                        details: details,
                        updatedAt: new Date().toISOString()
                    });
                    showNotification('ØªÙ†Ø®ÙˆØ§Û Ø³Ù¹Ø±Ú©Ú†Ø± Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø± Ø¯ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’', 'success');
                } else {
                    const salaryStructureData = {
                        employeeId: employeeId,
                        employeeType: employeeType,
                        basicSalary: basicSalary,
                        houseRent: houseRent,
                        transport: transport,
                        medical: medical,
                        otherAllowances: otherAllowances,
                        deductions: deductions,
                        totalSalary: totalSalary,
                        details: details,
                        createdAt: new Date().toISOString()
                    };
                    await addToStore(STORES.SALARY_STRUCTURE, salaryStructureData);
                    showNotification('ØªÙ†Ø®ÙˆØ§Û Ø³Ù¹Ø±Ú©Ú†Ø± Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù…Ø­ÙÙˆØ¸ Ú©Ø± Ù„ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’', 'success');
                }
                loadSalaryStructureTable();
            } catch (error) {
                console.error('Error saving salary structure:', error);
                showNotification('ØªÙ†Ø®ÙˆØ§Û Ø³Ù¹Ø±Ú©Ú†Ø± Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function addBook() {
            showLoading();
            const form = document.getElementById('add-book-form');
            const editId = form.dataset.editId ? parseInt(form.dataset.editId) : null;
            try {
                const bookData = {
                    name: document.getElementById('book-name').value,
                    author: document.getElementById('book-author').value,
                    category: document.getElementById('book-category').value,
                    isbn: document.getElementById('book-isbn').value,
                    copies: parseInt(document.getElementById('book-copies').value),
                    shelf: document.getElementById('book-shelf').value,
                };
                if (editId) {
                    const existingBook = await getFromStore(STORES.BOOKS, editId);
                    const diff = bookData.copies - existingBook.copies;
                    bookData.availableCopies = existingBook.availableCopies + diff;
                    await updateInStore(STORES.BOOKS, editId, bookData);
                    showNotification('Ú©ØªØ§Ø¨ Ú©Ø§ Ø±ÛŒÚ©Ø§Ø±Úˆ Ø§Ù¾ÚˆÛŒÙ¹ Ú©Ø± Ø¯ÛŒØ§ Ú¯ÛŒØ§Û”', 'success');
                } else {
                    bookData.availableCopies = bookData.copies;
                    await addToStore(STORES.BOOKS, bookData);
                    showNotification('Ú©ØªØ§Ø¨ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯Ø¦ÛŒÛ”', 'success');
                }
                form.reset();
                delete form.dataset.editId;
                form.querySelector('button[type="submit"]').textContent = 'Ú©ØªØ§Ø¨ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº';
                document.querySelector('.tab[data-tab="books-list"]').click();
            } catch (e) { console.error(e); } finally { hideLoading(); }
        }
        async function issueBook() {
            try {
                showLoading();
                const bookId = parseInt(document.getElementById('issue-book-id').value);
                const memberType = document.getElementById('issue-member-type').value;
                const memberId = parseInt(document.getElementById('issue-member-id').value);
                const memberName = document.getElementById('issue-member-name').value;
                const issueDate = document.getElementById('issue-date').value;
                const returnDate = document.getElementById('issue-return-date').value;
                const bookData = await getFromStore(STORES.BOOKS, bookId);
                if (!bookData) {
                    showNotification('Ú©ØªØ§Ø¨ Ù†ÛÛŒÚº Ù…Ù„ÛŒ', 'error');
                    return;
                }
                if (bookData.availableCopies <= 0) {
                    showNotification('Ú©ØªØ§Ø¨ Ú©ÛŒ Ú©ÙˆØ¦ÛŒ Ú©Ø§Ù¾ÛŒ Ø¯Ø³ØªÛŒØ§Ø¨ Ù†ÛÛŒÚº ÛÛ’', 'error');
                    return;
                }
                const issueId = 'ISU' + Date.now().toString().slice(-6);
                const issueData = {
                    issueId: issueId,
                    bookId: bookId,
                    bookName: bookData.name,
                    memberId: memberId,
                    memberName: memberName,
                    memberType: memberType,
                    issueDate: issueDate,
                    returnDate: returnDate,
                    status: 'issued',
                    actualReturnDate: null,
                    fine: 0,
                    condition: 'good',
                    notes: '',
                    createdAt: new Date().toISOString()
                };
                await addToStore(STORES.BOOK_ISSUES, issueData);
                await updateInStore(STORES.BOOKS, bookId, {
                    availableCopies: bookData.availableCopies - 1
                });
                await addToStore(STORES.ACTIVITIES, {
                    description: 'Ú©ØªØ§Ø¨ Ø¬Ø§Ø±ÛŒ Ú©ÛŒ Ú¯Ø¦ÛŒ',
                    date: new Date().toISOString(),
                    type: 'Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒ',
                    user: 'Ø³Ø³Ù¹Ù… Ø§ÛŒÚˆÙ…Ù†',
                    userId: 1,
                    details: `${bookData.name} Ú©ØªØ§Ø¨ ${memberName} Ú©Ùˆ Ø¬Ø§Ø±ÛŒ Ú©ÛŒ Ú¯Ø¦ÛŒ`,
                    createdAt: new Date().toISOString()
                });
                document.getElementById('issue-form').reset();
                document.getElementById('issue-book-details').style.display = 'none';
                document.getElementById('issue-member-form').style.display = 'none';
                document.getElementById('issue-member-details').style.display = 'none';
                document.getElementById('issue-date-details').style.display = 'none';
                document.getElementById('issue-submit').style.display = 'none';
                showNotification('Ú©ØªØ§Ø¨ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¬Ø§Ø±ÛŒ Ú©Ø± Ø¯ÛŒ Ú¯Ø¦ÛŒ ÛÛ’', 'success');
            } catch (error) {
                console.error('Error issuing book:', error);
                showNotification('Ú©ØªØ§Ø¨ Ø¬Ø§Ø±ÛŒ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function returnBook() {
            try {
                showLoading();
                const issueId = document.getElementById('return-issue-id').value;
                const bookName = document.getElementById('return-book-name').value;
                const memberName = document.getElementById('return-member-name').value;
                const issueDate = document.getElementById('return-issue-date').value;
                const dueDate = document.getElementById('return-due-date').value;
                const actualDate = document.getElementById('return-actual-date').value;
                const fine = parseFloat(document.getElementById('return-fine').value) || 0;
                const condition = document.getElementById('return-condition').value;
                const damageFine = parseFloat(document.getElementById('return-damage-fine').value) || 0;
                const notes = document.getElementById('return-notes').value;
                const issues = await getAllFromStore(STORES.BOOK_ISSUES);
                const issue = issues.find(i => i.issueId === issueId);
                if (!issue) {
                    showNotification('Ø§Ø¬Ø±Ø§Ø¡ Ø±ÛŒÚ©Ø§Ø±Úˆ Ù†ÛÛŒÚº Ù…Ù„Ø§', 'error');
                    return;
                }
                await updateInStore(STORES.BOOK_ISSUES, issue.id, {
                    status: 'returned',
                    actualReturnDate: actualDate,
                    fine: fine + damageFine,
                    condition: condition,
                    notes: notes,
                    updatedAt: new Date().toISOString()
                });
                const book = await getFromStore(STORES.BOOKS, issue.bookId);
                if (book) {
                    await updateInStore(STORES.BOOKS, book.id, {
                        availableCopies: book.availableCopies + 1
                    });
                }
                await addToStore(STORES.ACTIVITIES, {
                    description: 'Ú©ØªØ§Ø¨ ÙˆØ§Ù¾Ø³ Ú©ÛŒ Ú¯Ø¦ÛŒ',
                    date: new Date().toISOString(),
                    type: 'Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒ',
                    user: 'Ø³Ø³Ù¹Ù… Ø§ÛŒÚˆÙ…Ù†',
                    userId: 1,
                    details: `${bookName} Ú©ØªØ§Ø¨ ${memberName} Ù†Û’ ÙˆØ§Ù¾Ø³ Ú©ÛŒ`,
                    createdAt: new Date().toISOString()
                });
                document.getElementById('return-form').reset();
                document.getElementById('return-form-container').style.display = 'none';
                document.getElementById('return-book-table-container').style.display = 'none';
                showNotification('Ú©ØªØ§Ø¨ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ ÙˆØ§Ù¾Ø³ Ú©Ø± Ù„ÛŒ Ú¯Ø¦ÛŒ ÛÛ’', 'success');
            } catch (error) {
                console.error('Error returning book:', error);
                showNotification('Ú©ØªØ§Ø¨ ÙˆØ§Ù¾Ø³ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function addUser() {
            try {
                showLoading();
                const username = document.getElementById('user-username').value;
                const password = document.getElementById('user-password').value;
                const confirmPassword = document.getElementById('user-confirm-password').value;
                const name = document.getElementById('user-name').value;
                const email = document.getElementById('user-email').value;
                const role = document.getElementById('user-role').value;
                const photoInput = document.getElementById('user-photo');
                const mobile = document.getElementById('user-mobile').value;
                const status = document.getElementById('user-status').value;
                const address = document.getElementById('user-address').value;
                if (password !== confirmPassword) {
                    showNotification('Ù¾Ø§Ø³ ÙˆØ±Úˆ Ù…ÛŒÚ† Ù†ÛÛŒÚº Ú©Ø±ØªÛ’', 'error');
                    return;
                }
                const existingUsers = await getAllFromStore(STORES.USERS);
                const userExists = existingUsers.some(user => user.username === username || user.email === email);
                if (userExists) {
                    showNotification('ÛŒÛ ØµØ§Ø±Ù Ù†Ø§Ù… ÛŒØ§ Ø§ÛŒ Ù…ÛŒÙ„ Ù¾ÛÙ„Û’ Ø³Û’ Ù…ÙˆØ¬ÙˆØ¯ ÛÛ’', 'error');
                    return;
                }
                let photo = null;
                if (photoInput.files && photoInput.files) {
                    photo = await fileToBase64(photoInput.files);
                }
                const userData = {
                    username: username,
                    password: password,
                    name: name,
                    email: email,
                    role: role,
                    photo: photo,
                    mobile: mobile,
                    status: status,
                    address: address,
                    lastLogin: null,
                    createdAt: new Date().toISOString()
                };
                const userId = await addToStore(STORES.USERS, userData);
                document.getElementById('user-form').reset();
                loadUsersTable();
                showNotification('ØµØ§Ø±Ù Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¨Ù†Ø§ Ù„ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’', 'success');
                document.querySelector('.tab[data-tab="users-list"]').click();
            } catch (error) {
                console.error('Error adding user:', error);
                showNotification('ØµØ§Ø±Ù Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function addRole() {
            try {
                showLoading();
                const name = document.getElementById('role-name').value;
                const description = document.getElementById('role-description').value;
                const permissions = {
                    dashboard: document.getElementById('perm-dashboard').checked,
                    students: document.getElementById('perm-students').checked,
                    teachers: document.getElementById('perm-teachers').checked,
                    staff: document.getElementById('perm-staff').checked,
                    classes: document.getElementById('perm-classes').checked,
                    subjects: document.getElementById('perm-subjects').checked,
                    attendance: document.getElementById('perm-attendance').checked,
                    exams: document.getElementById('perm-exams').checked,
                    fees: document.getElementById('perm-fees').checked,
                    salaries: document.getElementById('perm-salaries').checked,
                    library: document.getElementById('perm-library').checked,
                    users: document.getElementById('perm-users').checked,
                    reports: document.getElementById('perm-reports').checked,
                    settings: document.getElementById('perm-settings').checked,
                    backup: document.getElementById('perm-backup').checked
                };
                const existingRoles = await getAllFromStore(STORES.ROLES);
                const roleExists = existingRoles.some(role => role.name === name);
                if (roleExists) {
                    showNotification('ÛŒÛ Ø±ÙˆÙ„ Ù¾ÛÙ„Û’ Ø³Û’ Ù…ÙˆØ¬ÙˆØ¯ ÛÛ’', 'error');
                    return;
                }
                const roleData = {
                    name: name,
                    description: description,
                    permissions: permissions,
                    createdAt: new Date().toISOString()
                };
                const roleId = await addToStore(STORES.ROLES, roleData);
                document.getElementById('role-form').reset();
                loadRolesTable();
                showNotification('Ø±ÙˆÙ„ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¨Ù†Ø§ Ù„ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’', 'success');
            } catch (error) {
                console.error('Error adding role:', error);
                showNotification('Ø±ÙˆÙ„ Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function saveGeneralSettings(e) {
            e.preventDefault();
            try {
                showLoading();
                const schoolName = document.getElementById('setting-school-name').value;
                const schoolShortName = document.getElementById('setting-school-short-name').value;
                const schoolAddress = document.getElementById('setting-school-address').value;
                const schoolPhone = document.getElementById('setting-school-phone').value;
                const schoolEmail = document.getElementById('setting-school-email').value;
                const schoolWebsite = document.getElementById('setting-school-website').value;
                const logoInput = document.getElementById('setting-school-logo');
                let logo = null;
                if (logoInput.files && logoInput.files) {
                    logo = await fileToBase64(logoInput.files);
                }
                const settings = await getFromStore(STORES.SETTINGS, 'general') || {};
                const updatedSettings = {
                    ...settings,
                    id: 'general',
                    schoolName: schoolName,
                    schoolShortName: schoolShortName,
                    schoolAddress: schoolAddress,
                    schoolPhone: schoolPhone,
                    schoolEmail: schoolEmail,
                    schoolWebsite: schoolWebsite,
                    updatedAt: new Date().toISOString()
                };
                if (logo) {
                    updatedSettings.schoolLogo = logo;
                }
                await updateInStore(STORES.SETTINGS, 'general', updatedSettings);
                showNotification('Ø¹Ø§Ù… ØªØ±ØªÛŒØ¨Ø§Øª Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù…Ø­ÙÙˆØ¸ Ú©Ø± Ù„ÛŒ Ú¯Ø¦ÛŒ ÛÛŒÚº', 'success');
            } catch (error) {
                console.error('Error saving general settings:', error);
                showNotification('ØªØ±ØªÛŒØ¨Ø§Øª Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function saveAcademicSettings(e) {
            e.preventDefault();
            try {
                showLoading();
                const currentSession = document.getElementById('setting-current-session').value;
                const sessionStart = document.getElementById('setting-session-start').value;
                const sessionEnd = document.getElementById('setting-session-end').value;
                const schoolTimeStart = document.getElementById('setting-school-time-start').value;
                const schoolTimeEnd = document.getElementById('setting-school-time-end').value;
                const periodDuration = document.getElementById('setting-period-duration').value;
                const weeklyHoliday = Array.from(document.getElementById('setting-weekly-holiday').selectedOptions).map(option => option.value);
                const feeDueDay = document.getElementById('setting-fee-due-day').value;
                const feeLateFinÃ© = document.getElementById('setting-fee-late-fine').value;
                const libraryReturnDays = document.getElementById('setting-library-return-days').value;
                const libraryLateFine = document.getElementById('setting-library-late-fine').value;
                const settings = await getFromStore(STORES.SETTINGS, 'general') || {};
                const updatedSettings = {
                    ...settings,
                    id: 'general',
                    currentSession: currentSession,
                    sessionStart: sessionStart,
                    sessionEnd: sessionEnd,
                    schoolTimeStart: schoolTimeStart,
                    schoolTimeEnd: schoolTimeEnd,
                    periodDuration: parseInt(periodDuration),
                    weeklyHoliday: weeklyHoliday,
                    feeDueDay: parseInt(feeDueDay),
                    feeLateFinÃ©: parseFloat(feeLateFinÃ©),
                    libraryReturnDays: parseInt(libraryReturnDays),
                    libraryLateFine: parseFloat(libraryLateFine),
                    updatedAt: new Date().toISOString()
                };
                await updateInStore(STORES.SETTINGS, 'general', updatedSettings);
                showNotification('ØªØ¹Ù„ÛŒÙ…ÛŒ ØªØ±ØªÛŒØ¨Ø§Øª Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù…Ø­ÙÙˆØ¸ Ú©Ø± Ù„ÛŒ Ú¯Ø¦ÛŒ ÛÛŒÚº', 'success');
            } catch (error) {
                console.error('Error saving academic settings:', error);
                showNotification('ØªØ±ØªÛŒØ¨Ø§Øª Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function saveThemeSettings(e) {
            e.preventDefault();
            try {
                showLoading();
                const primaryColor = document.getElementById('setting-primary-color').value;
                const secondaryColor = document.getElementById('setting-secondary-color').value;
                const fontSize = document.getElementById('setting-font-size').value;
                const fontFamily = document.getElementById('setting-font-family').value;
                const sidebarPosition = document.getElementById('setting-sidebar-position').value;
                const sidebarTheme = document.getElementById('setting-sidebar-theme').value;
                const settings = await getFromStore(STORES.SETTINGS, 'general') || {};
                const updatedSettings = {
                    ...settings,
                    id: 'general',
                    primaryColor: primaryColor,
                    secondaryColor: secondaryColor,
                    fontSize: fontSize,
                    fontFamily: fontFamily,
                    sidebarPosition: sidebarPosition,
                    sidebarTheme: sidebarTheme,
                    updatedAt: new Date().toISOString()
                };
                await updateInStore(STORES.SETTINGS, 'general', updatedSettings);
                applySettings();
                showNotification('ØªÚ¾ÛŒÙ… ØªØ±ØªÛŒØ¨Ø§Øª Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù…Ø­ÙÙˆØ¸ Ú©Ø± Ù„ÛŒ Ú¯Ø¦ÛŒ ÛÛŒÚº', 'success');
            } catch (error) {
                console.error('Error saving theme settings:', error);
                showNotification('ØªØ±ØªÛŒØ¨Ø§Øª Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function resetThemeSettings() {
            try {
                showLoading();
                const defaultThemeSettings = {
                    primaryColor: '#3498db',
                    secondaryColor: '#2c3e50',
                    fontSize: 'medium',
                    fontFamily: 'Jameel Noori Nastaleeq',
                    sidebarPosition: 'right',
                    sidebarTheme: 'dark'
                };
                const settings = await getFromStore(STORES.SETTINGS, 'general') || {};
                const updatedSettings = {
                    ...settings,
                    ...defaultThemeSettings,
                    id: 'general',
                    updatedAt: new Date().toISOString()
                };
                await updateInStore(STORES.SETTINGS, 'general', updatedSettings);
                document.getElementById('setting-primary-color').value = defaultThemeSettings.primaryColor;
                document.getElementById('setting-secondary-color').value = defaultThemeSettings.secondaryColor;
                document.getElementById('setting-font-size').value = defaultThemeSettings.fontSize;
                document.getElementById('setting-font-family').value = defaultThemeSettings.fontFamily;
                document.getElementById('setting-sidebar-position').value = defaultThemeSettings.sidebarPosition;
                document.getElementById('setting-sidebar-theme').value = defaultThemeSettings.sidebarTheme;
                applySettings();
                showNotification('ØªÚ¾ÛŒÙ… ØªØ±ØªÛŒØ¨Ø§Øª ÚˆÛŒÙØ§Ù„Ù¹ Ù¾Ø± Ø³ÛŒÙ¹ Ú©Ø± Ø¯ÛŒ Ú¯Ø¦ÛŒ ÛÛŒÚº', 'success');
            } catch (error) {
                console.error('Error resetting theme settings:', error);
                showNotification('ØªØ±ØªÛŒØ¨Ø§Øª Ø±ÛŒ Ø³ÛŒÙ¹ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function createBackup() {
            try {
                showLoading();
                const backupType = document.getElementById('backup-type').value;
                const backupFormat = document.getElementById('backup-format').value;
                let data = {};
                if (backupType === 'full') {
                    for (const store in STORES) {
                        data[STORES[store]] = await getAllFromStore(STORES[store]);
                    }
                } else {
                    data[STORES[backupType.toUpperCase()]] = await getAllFromStore(STORES[backupType.toUpperCase()]);
                }
                const backupData = {
                    type: backupType,
                    format: backupFormat,
                    date: new Date().toISOString(),
                    data: data
                };
                const backupBlob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
                const backupName = `deeni_madrasa_backup_${backupType}_${new Date().toISOString().slice(0, 10)}.json`;
                const downloadLink = document.createElement('a');
                downloadLink.href = URL.createObjectURL(backupBlob);
                downloadLink.download = backupName;
                downloadLink.click();
                await addToStore(STORES.BACKUP, {
                    type: backupType,
                    format: backupFormat,
                    date: new Date().toISOString(),
                    size: backupBlob.size,
                    filename: backupName,
                    createdAt: new Date().toISOString()
                });
                loadBackupHistoryTable();
                showNotification('Ø¨ÛŒÚ© Ø§Ù¾ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¨Ù†Ø§ Ù„ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’', 'success');
            } catch (error) {
                console.error('Error creating backup:', error);
                showNotification('Ø¨ÛŒÚ© Ø§Ù¾ Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function loadTeacherDropdowns() {
            try {
                const teachers = await getAllFromStore(STORES.TEACHERS);
                const teacherDropdowns = document.querySelectorAll('select[id$="-teacher"], select[id$="-incharge"], select[id$="Teacher"]');
                teacherDropdowns.forEach(dropdown => {
                    const currentVal = dropdown.value;
                    const fixedOptions = Array.from(dropdown.options).filter(opt => opt.value === "" || opt.value === "all" || opt.dataset.fixed);
                    dropdown.innerHTML = '';
                    fixedOptions.forEach(opt => dropdown.appendChild(opt.cloneNode(true)));
                    teachers.forEach(teacher => {
                        const option = document.createElement('option');
                        option.value = teacher.id;
                        option.textContent = teacher.name;
                        dropdown.appendChild(option);
                    });
                    if (Array.from(dropdown.options).some(opt => opt.value === currentVal)) {
                        dropdown.value = currentVal;
                    }
                });
            } catch (error) {
                console.error('Error loading teacher dropdowns:', error);
            }
        }
        async function loadStudentsForAttendance() {
            const classIdElement = document.getElementById('attendance-class');
            const sectionIdElement = document.getElementById('attendance-section');
            const dateElement = document.getElementById('attendance-date');
            if (!classIdElement || !sectionIdElement || !dateElement) {
                console.error("Attendance filter elements not found.");
                showNotification('Ø­Ø§Ø¶Ø±ÛŒ Ú©Û’ Ù„ÛŒÛ’ Ø¶Ø±ÙˆØ±ÛŒ Ø¹Ù†Ø§ØµØ± Ù†ÛÛŒÚº Ù…Ù„Û’Û”', 'error');
                return;
            }
            const classId = parseInt(classIdElement.value);
            const sectionId = parseInt(sectionIdElement.value);
            const date = dateElement.value;
            if (isNaN(classId) || isNaN(sectionId) || !date) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªØ§Ø±ÛŒØ®ØŒ Ú©Ù„Ø§Ø³ Ø§ÙˆØ± Ø³ÛŒÚ©Ø´Ù† Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”', 'error');
                return;
            }
            showLoading();
            try {
                const allStudents = await getAllFromStore(STORES.STUDENTS);
                const classStudents = allStudents.filter(s => s.classId === classId && s.sectionId === sectionId);
                const attendanceTableBody = document.querySelector('#attendance-table tbody');
                const attendanceTableContainer = document.getElementById('attendance-table-container');
                if (!attendanceTableBody || !attendanceTableContainer) {
                    console.error("Attendance table elements not found.");
                    hideLoading();
                    return;
                }
                attendanceTableBody.innerHTML = '';
                if (classStudents.length === 0) {
                    attendanceTableBody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Ø§Ø³ Ú©Ù„Ø§Ø³/Ø³ÛŒÚ©Ø´Ù† Ù…ÛŒÚº Ú©ÙˆØ¦ÛŒ Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ù†ÛÛŒÚº ÛÛ’Û”</td></tr>';
                } else {
                    const existingAttendanceRecords = await getAllFromIndex(STORES.ATTENDANCE, 'dateClassSection', [date, classId, sectionId]);
                    const existingAttendanceMap = new Map();
                    existingAttendanceRecords.forEach(rec => existingAttendanceMap.set(rec.studentId, rec));
                    classStudents.forEach(student => {
                        const existingRecord = existingAttendanceMap.get(student.id);
                        const isPresent = existingRecord ? existingRecord.status === 'present' : true;
                        const isLate = existingRecord ? existingRecord.isLate : false;
                        const onLeave = existingRecord ? existingRecord.isLeave : false;
                        const notes = existingRecord ? existingRecord.notes : '';
                        const row = document.createElement('tr');
                        row.dataset.studentId = student.id;
                        row.innerHTML = `
                    <td>${student.rollNumber}</td>
                    <td>${student.name}</td>
                    <td>
                        <label style="margin-right: 5px;"><input type="radio" name="status_${student.id}" value="present" ${isPresent && !onLeave ? 'checked' : ''}> Ø­Ø§Ø¶Ø±</label>
                        <label style="margin-right: 5px;"><input type="radio" name="status_${student.id}" value="absent" ${!isPresent && !onLeave ? 'checked' : ''}> ØºÛŒØ± Ø­Ø§Ø¶Ø±</label>
                    </td>
                    <td><input type="checkbox" name="late_${student.id}" ${isLate ? 'checked' : ''}></td>
                    <td><input type="checkbox" name="leave_${student.id}" ${onLeave ? 'checked' : ''}></td>
                    <td><input type="text" class="form-control" name="notes_${student.id}" value="${notes}"></td>
                `;
                        attendanceTableBody.appendChild(row);
                        const leaveCheckbox = row.querySelector(`input[name="leave_${student.id}"]`);
                        const presentRadio = row.querySelector(`input[name="status_${student.id}"][value="present"]`);
                        const absentRadio = row.querySelector(`input[name="status_${student.id}"][value="absent"]`);
                        if (leaveCheckbox) {
                            leaveCheckbox.addEventListener('change', (e) => {
                                if (e.target.checked) {
                                    if (presentRadio) presentRadio.checked = false;
                                    if (absentRadio) absentRadio.checked = false;
                                    if (presentRadio) presentRadio.disabled = true;
                                    if (absentRadio) absentRadio.disabled = true;
                                } else {
                                    if (presentRadio) presentRadio.disabled = false;
                                    if (absentRadio) absentRadio.disabled = false;
                                    if (presentRadio && !absentRadio.checked) presentRadio.checked = true;
                                }
                            });
                            if (onLeave) {
                                if (presentRadio) presentRadio.checked = false;
                                if (absentRadio) absentRadio.checked = false;
                                if (presentRadio) presentRadio.disabled = true;
                                if (absentRadio) absentRadio.disabled = true;
                            }
                        }
                    });
                }
                attendanceTableContainer.style.display = 'block';
            } catch (error) {
                console.error("Error loading students for attendance:", error);
                showNotification('Ø­Ø§Ø¶Ø±ÛŒ Ú©Û’ Ù„ÛŒÛ’ Ø·Ù„Ø¨Ø§Ø¡ Ú©Ùˆ Ù„ÙˆÚˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”', 'error');
            } finally {
                hideLoading();
            }
        }
        async function restoreBackup() {
            try {
                showLoading();
                const fileInput = document.getElementById('restore-file');
                if (!fileInput.files || fileInput.files.length === 0) {
                    showNotification('Ø¨Ø±Ø§Ø¦Û’ Ù…ÛØ±Ø¨Ø§Ù†ÛŒ Ø¨ÛŒÚ© Ø§Ù¾ ÙØ§Ø¦Ù„ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                    return;
                }
                const file = fileInput.files;
                const reader = new FileReader();
                reader.onload = async function (e) {
                    try {
                        const backupData = JSON.parse(e.target.result);
                        if (!backupData || !backupData.data) {
                            showNotification('ØºÙ„Ø· Ø¨ÛŒÚ© Ø§Ù¾ ÙØ§Ø¦Ù„ ÙØ§Ø±Ù…ÛŒÙ¹', 'error');
                            return;
                        }
                        const confirmation = confirm('ÚˆÛŒÙ¹Ø§ Ø¨ÛŒØ³ Ú©ÛŒ Ø¨Ø­Ø§Ù„ÛŒ Ù…ÙˆØ¬ÙˆØ¯Û ÚˆÛŒÙ¹Ø§ Ú©Ùˆ Ù…Ù¹Ø§ Ø¯Û’ Ú¯ÛŒÛ” Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ø¬Ø§Ø±ÛŒ Ø±Ú©Ú¾Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ');
                        if (!confirmation) {
                            hideLoading();
                            return;
                        }
                        for (const storeName in backupData.data) {
                            const storeData = backupData.data[storeName];
                            if (!storeData || !Array.isArray(storeData)) continue;
                            const transaction = db.transaction(storeName, 'readwrite');
                            const store = transaction.objectStore(storeName);
                            await new Promise((resolve, reject) => {
                                const clearRequest = store.clear();
                                clearRequest.onsuccess = resolve;
                                clearRequest.onerror = reject;
                            });
                            for (const item of storeData) {
                                await new Promise((resolve, reject) => {
                                    const addRequest = store.add(item);
                                    addRequest.onsuccess = resolve;
                                    addRequest.onerror = reject;
                                });
                            }
                        }
                        showNotification('ÚˆÛŒÙ¹Ø§ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø¨Ø­Ø§Ù„ Ú©Ø± Ù„ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’', 'success');
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                    } catch (error) {
                        console.error('Error parsing or restoring backup:', error);
                        showNotification('Ø¨ÛŒÚ© Ø§Ù¾ Ø¨Ø­Ø§Ù„ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
                        hideLoading();
                    }
                };
                reader.readAsText(file);
            } catch (error) {
                console.error('Error restoring backup:', error);
                showNotification('Ø¨ÛŒÚ© Ø§Ù¾ Ø¨Ø­Ø§Ù„ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
                hideLoading();
            }
        }
        async function saveAutoBackupSettings() {
            try {
                showLoading();
                const isEnabled = document.getElementById('auto-backup-enable').checked;
                const frequency = document.getElementById('auto-backup-frequency').value;
                const retention = document.getElementById('auto-backup-retention').value;
                const settings = await getFromStore(STORES.SETTINGS, 'general') || {};
                const updatedSettings = {
                    ...settings,
                    id: 'general',
                    autoBackupEnabled: isEnabled,
                    autoBackupFrequency: frequency,
                    autoBackupRetention: parseInt(retention),
                    updatedAt: new Date().toISOString()
                };
                await updateInStore(STORES.SETTINGS, 'general', updatedSettings);
                showNotification('Ø¢Ù¹ÙˆÙ…ÛŒÙ¹Ú© Ø¨ÛŒÚ© Ø§Ù¾ ØªØ±ØªÛŒØ¨Ø§Øª Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ù…Ø­ÙÙˆØ¸ Ú©Ø± Ù„ÛŒ Ú¯Ø¦ÛŒ ÛÛŒÚº', 'success');
            } catch (error) {
                console.error('Error saving auto backup settings:', error);
                showNotification('ØªØ±ØªÛŒØ¨Ø§Øª Ù…Ø­ÙÙˆØ¸ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ ÛÛ’', 'error');
            } finally {
                hideLoading();
            }
        }
        async function fileToBase64(file) {
            if (!file || !(file instanceof Blob)) {
                return null;
            }
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContainer = document.getElementById('mainContainer');
            const menuToggle = document.getElementById('menuToggle');
            if (!sidebar || !mainContainer || !menuToggle) {
                console.error("Error: Required elements (sidebar, mainContainer, or menuToggle) not found.");
                return;
            }
            let isActive;
            if (sidebar.dataset.isActive === undefined) {
                if (window.innerWidth <= 768) {
                    isActive = sidebar.style.transform === 'translateX(0px)';
                } else {
                    isActive = true;
                }
            } else {
                isActive = sidebar.dataset.isActive === 'true';
            }
            isActive = !isActive;
            sidebar.dataset.isActive = isActive;
            const icon = menuToggle.querySelector('i');
            if (window.innerWidth <= 768) {
                if (isActive) {
                    sidebar.style.transform = 'translateX(0)';
                    if (icon) icon.innerHTML = 'Ã—';
                } else {
                    sidebar.style.transform = 'translateX(100%)';
                    if (icon) icon.innerHTML = 'â˜°';
                }
            } else {
                if (isActive) {
                    sidebar.style.transform = 'translateX(0)';
                    sidebar.style.width = '250px';
                    mainContainer.style.marginRight = '250px';
                    mainContainer.style.width = 'calc(100% - 250px)';
                    if (icon) icon.innerHTML = 'Ã—';
                } else {
                    sidebar.style.transform = 'translateX(100%)';
                    mainContainer.style.marginRight = '0';
                    mainContainer.style.width = '100%';
                    if (icon) icon.innerHTML = 'â˜°';
                }
            }
        }
        function initializeDynamicViews() {
            initializeLibraryView();
            initializeReportsView();
            initializeSettingsView();
            initializeUserRolesForm();
        }
        function attachDynamicEventListeners() {
            const mainContainer = document.getElementById('mainContainer');
            mainContainer.addEventListener('click', function (e) {
                const target = e.target;
                if (target.matches('#issue-book-search-btn')) searchBookForIssue();
                if (target.matches('#issue-member-search-btn')) searchMemberForIssue();
                if (target.matches('#issue-book-btn')) issueBook();
                if (target.matches('#return-search-btn')) searchIssueForReturn();
                if (target.matches('#return-book-btn')) {
                    const issueId = parseInt(target.dataset.issueId);
                    const bookId = parseInt(target.dataset.bookId);
                    returnBook(issueId, bookId);
                }
                if (target.matches('#generate-report-btn')) generateReport();
                if (target.matches('#reset-theme-btn')) resetThemeSettings();
            });
            mainContainer.addEventListener('submit', function (e) {
                if (e.target.matches('form')) {
                    e.preventDefault();
                }
                const formId = e.target.id;
                switch (formId) {
                    case 'add-book-form':
                        addBook();
                        break;
                    case 'general-settings-form':
                        saveGeneralSettings();
                        break;
                    case 'academic-settings-form':
                        saveAcademicSettings();
                        break;
                    case 'theme-settings-form':
                        saveThemeSettings();
                        break;
                }
            });
            mainContainer.addEventListener('change', function (e) {
                if (e.target.matches('#report-type')) {
                    toggleReportFilters();
                }
            });
            console.log("Delegated event listeners attached to main container.");
        }
        function initializeLibraryView() {
            const container = document.getElementById('library-view');
            if (container.querySelector('.tabs')) return;
            container.innerHTML = `
        <h2>Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒ</h2>
        <div class="tabs">
            <div class="tab active" data-tab="books-list">Ú©ØªØ§Ø¨ÙˆÚº Ú©ÛŒ ÙÛØ±Ø³Øª</div>
            <div class="tab" data-tab="add-book-tab">Ù†Ø¦ÛŒ Ú©ØªØ§Ø¨ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</div>
            <div class="tab" data-tab="issue-book-tab">Ú©ØªØ§Ø¨ Ø¬Ø§Ø±ÛŒ Ú©Ø±ÛŒÚº</div>
        </div>
        <div class="tab-content active" id="books-list">
            <div class="table-container"><table class="table" id="books-table"><thead><tr><th>ID</th><th>Ú©ØªØ§Ø¨ Ú©Ø§ Ù†Ø§Ù…</th><th>Ù…ØµÙ†Ù</th><th>Ø¯Ø³ØªÛŒØ§Ø¨</th><th>Ø¹Ù…Ù„</th></tr></thead><tbody></tbody></table></div>
        </div>
        <div class="tab-content" id="add-book-tab">
            <div class="form-container">
                <form id="add-book-form" onsubmit="event.preventDefault(); addBook();">
                    <div class="form-title">Ù†Ø¦ÛŒ Ú©ØªØ§Ø¨ Ú©ÛŒ ØªÙØµÛŒÙ„Ø§Øª</div>
                    <div class="form-group"><label>Ù†Ø§Ù…</label><input type="text" id="book-name" class="form-control" required></div>
                    <div class="form-group"><label>Ù…ØµÙ†Ù</label><input type="text" id="book-author" class="form-control" required></div>
                    <div class="form-group"><label>Ú©ÛŒÙ¹ÛŒÚ¯Ø±ÛŒ</label><input type="text" id="book-category" class="form-control" required></div>
                    <div class="form-group"><label>Ú©Ù„ Ú©Ø§Ù¾ÛŒØ§Úº</label><input type="number" id="book-copies" class="form-control" required min="1"></div>
                    <button type="submit" class="btn btn-primary">Ú©ØªØ§Ø¨ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº</button>
                </form>
            </div>
        </div>
        <div class="tab-content" id="issue-book-tab">
            <div class="form-container"><p>Ú©ØªØ§Ø¨ Ø¬Ø§Ø±ÛŒ Ú©Ø±Ù†Û’ Ø§ÙˆØ± ÙˆØ§Ù¾Ø³ Ù„ÛŒÙ†Û’ Ú©Ø§ ÙÛŒÚ†Ø± Ø²ÛŒØ± ØªØ¹Ù…ÛŒØ± ÛÛ’Û”</p></div>
        </div>
    `;
            container.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function () {
                    tab.parentElement.querySelector('.active').classList.remove('active');
                    tab.classList.add('active');
                    tab.closest('.section-view').querySelector('.tab-content.active').classList.remove('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });
        }
        async function loadBooksTable() {
            const tbody = document.querySelector('#books-table tbody');
            tbody.innerHTML = '';
            const books = await getAllFromStore(STORES.BOOKS);
            if (!books || books.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Ú©ÙˆØ¦ÛŒ Ú©ØªØ§Ø¨ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’Û”</td></tr>';
                return;
            }
            books.forEach(book => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${book.id}</td>
                    <td>${book.name}</td>
                    <td>${book.author}</td>
                    <td>${book.category}</td>
                    <td>${book.availableCopies}</td> 
                    <td><button class="btn btn-danger btn-sm" onclick="deleteBook(${book.id})">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button></td>
                `;
                tbody.appendChild(row);
            });
        }
        async function addBook() {
            const bookData = {
                name: document.getElementById('book-name').value,
                author: document.getElementById('book-author').value,
                category: document.getElementById('book-category').value,
                isbn: document.getElementById('book-isbn').value,
                copies: parseInt(document.getElementById('book-copies').value),
                availableCopies: parseInt(document.getElementById('book-copies').value),
                shelf: document.getElementById('book-shelf').value,
            };
            await addToStore(STORES.BOOKS, bookData);
            showNotification('Ú©ØªØ§Ø¨ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯Ø¦ÛŒ', 'success');
            document.getElementById('add-book-form').reset();
            loadBooksTable();
            document.querySelector('[data-tab="books-list"]').click();
        }
        async function deleteBook(id) {
            if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø³ Ú©ØªØ§Ø¨ Ú©Ùˆ Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) {
                await deleteFromStore(STORES.BOOKS, id);
                showNotification('Ú©ØªØ§Ø¨ Ø­Ø°Ù Ú©Ø± Ø¯ÛŒ Ú¯Ø¦ÛŒ', 'success');
                loadBooksTable();
            }
        }
        async function searchBookForIssue() {
            const searchTerm = document.getElementById('issue-book-search').value.toLowerCase();
            const books = await getAllFromStore(STORES.BOOKS);
            const book = books.find(b => String(b.id) === searchTerm || b.name.toLowerCase().includes(searchTerm));
            const detailsDiv = document.getElementById('issue-book-details');
            if (book) {
                if (book.availableCopies > 0) {
                    detailsDiv.innerHTML = `<p><b>Ú©ØªØ§Ø¨:</b> ${book.name} (ID: ${book.id})<br><b>Ø¯Ø³ØªÛŒØ§Ø¨:</b> ${book.availableCopies}</p>`;
                    detailsDiv.dataset.bookId = book.id;
                } else {
                    detailsDiv.innerHTML = `<p class="text-danger">Ú©ØªØ§Ø¨ "${book.name}" Ø¯Ø³ØªÛŒØ§Ø¨ Ù†ÛÛŒÚº ÛÛ’</p>`;
                    detailsDiv.dataset.bookId = '';
                }
                detailsDiv.style.display = 'block';
            } else {
                detailsDiv.innerHTML = `<p class="text-danger">Ú©ÙˆØ¦ÛŒ Ú©ØªØ§Ø¨ Ù†ÛÛŒÚº Ù…Ù„ÛŒ</p>`;
                detailsDiv.style.display = 'block';
                detailsDiv.dataset.bookId = '';
            }
            checkIssueReady();
        }
        async function searchMemberForIssue() {
            const searchTerm = document.getElementById('issue-member-search').value.toLowerCase();
            const students = await getAllFromStore(STORES.STUDENTS);
            const member = students.find(s => String(s.rollNumber) === searchTerm || s.name.toLowerCase().includes(searchTerm));
            const detailsDiv = document.getElementById('issue-member-details');
            if (member) {
                detailsDiv.innerHTML = `<p><b>Ù…Ù…Ø¨Ø±:</b> ${member.name} (ID: ${member.id}, ${member.className})</p>`;
                detailsDiv.dataset.memberId = member.id;
                detailsDiv.dataset.memberType = 'student';
            } else {
                detailsDiv.innerHTML = `<p class="text-danger">Ú©ÙˆØ¦ÛŒ Ù…Ù…Ø¨Ø± Ù†ÛÛŒÚº Ù…Ù„Ø§</p>`;
                detailsDiv.dataset.memberId = '';
            }
            detailsDiv.style.display = 'block';
            checkIssueReady();
        }
        function checkIssueReady() {
            const bookId = document.getElementById('issue-book-details').dataset.bookId;
            const memberId = document.getElementById('issue-member-details').dataset.memberId;
            document.getElementById('issue-book-btn').style.display = (bookId && memberId) ? 'block' : 'none';
        }
        async function issueBook() {
            const bookId = parseInt(document.getElementById('issue-book-details').dataset.bookId);
            const memberId = parseInt(document.getElementById('issue-member-details').dataset.memberId);
            const memberType = document.getElementById('issue-member-details').dataset.memberType;
            const book = await getFromStore(STORES.BOOKS, bookId);
            const issueData = {
                bookId: bookId,
                memberId: memberId,
                memberType: memberType,
                issueDate: new Date().toISOString(),
                returnDate: null,
                status: 'issued'
            };
            await addToStore(STORES.BOOK_ISSUES, issueData);
            await updateInStore(STORES.BOOKS, bookId, { availableCopies: book.availableCopies - 1 });
            showNotification(`Ú©ØªØ§Ø¨ "${book.name}" Ø¬Ø§Ø±ÛŒ Ú©Ø± Ø¯ÛŒ Ú¯Ø¦ÛŒ`, 'success');
            document.getElementById('issue-book-search').value = '';
            document.getElementById('issue-member-search').value = '';
            document.getElementById('issue-book-details').style.display = 'none';
            document.getElementById('issue-member-details').style.display = 'none';
            document.getElementById('issue-book-btn').style.display = 'none';
        }
        async function searchIssueForReturn() {
            const searchTerm = document.getElementById('return-search').value;
            const issues = await getAllFromStore(STORES.BOOK_ISSUES);
            const activeIssues = issues.filter(i => i.status === 'issued');
            const issue = activeIssues.find(i => String(i.bookId) === searchTerm || String(i.memberId) === searchTerm);
            const detailsDiv = document.getElementById('return-details');
            if (issue) {
                const book = await getFromStore(STORES.BOOKS, issue.bookId);
                const member = await getFromStore(STORES.STUDENTS, issue.memberId);
                detailsDiv.innerHTML = `
            <p><b>Ú©ØªØ§Ø¨:</b> ${book.name}</p>
            <p><b>Ù…Ù…Ø¨Ø±:</b> ${member.name}</p>
            <p><b>Ø¬Ø§Ø±ÛŒ Ø´Ø¯Û ØªØ§Ø±ÛŒØ®:</b> ${formatDate(issue.issueDate)}</p>
            <button class="btn btn-success" id="return-book-btn" data-issue-id="${issue.id}" data-book-id="${issue.bookId}">Ú©ØªØ§Ø¨ ÙˆØ§Ù¾Ø³ Ú©Ø±ÛŒÚº</button>
        `;
            } else {
                detailsDiv.innerHTML = `<p class="text-danger">Ú©ÙˆØ¦ÛŒ ÙØ¹Ø§Ù„ Ø§Ø¬Ø±Ø§Ø¡ Ù†ÛÛŒÚº Ù…Ù„Ø§</p>`;
            }
            detailsDiv.style.display = 'block';
        }
        async function returnBook(issueId, bookId) {
            await updateInStore(STORES.BOOK_ISSUES, issueId, { status: 'returned', returnDate: new Date().toISOString() });
            const book = await getFromStore(STORES.BOOKS, bookId);
            await updateInStore(STORES.BOOKS, bookId, { availableCopies: book.availableCopies + 1 });
            showNotification('Ú©ØªØ§Ø¨ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ ÙˆØ§Ù¾Ø³ ÛÙˆ Ú¯Ø¦ÛŒ', 'success');
            document.getElementById('return-search').value = '';
            document.getElementById('return-details').style.display = 'none';
        }
        function initializeUserRolesForm() {
            const container = document.querySelector('#add-user .form-container');
            const roleForm = document.getElementById('role-form');
            const permsHTML = `
        <div class="form-title">Ø§Ø¬Ø§Ø²ØªÛŒÚº</div>
        <div class="form-row" id="permissions-container" style="flex-direction: column; align-items: start; gap: 5px;">
                   </div>`;
            roleForm.querySelector('.form-row:last-child').insertAdjacentHTML('beforebegin', permsHTML);
            const permissions = ['dashboard', 'students', 'teachers', 'staff', 'classes', 'subjects', 'attendance', 'exams', 'fees', 'salaries', 'library', 'users', 'reports', 'settings', 'backup'];
            const permsContainer = document.getElementById('permissions-container');
            permissions.forEach(p => {
                permsContainer.innerHTML += `
            <label><input type="checkbox" id="perm-${p}" value="${p}"> ${p.charAt(0).toUpperCase() + p.slice(1)}</label>
        `;
            });
        }
        async function loadUsersTable() {
            const tbody = document.querySelector('#users-table tbody');
            tbody.innerHTML = '';
            const users = await getAllFromStore(STORES.USERS);
            if (!users || users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Ú©ÙˆØ¦ÛŒ ØµØ§Ø±Ù Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’Û”</td></tr>';
                return;
            }
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${user.username}</td>
            <td>${user.name}</td>
            <td>${user.email}</td>
            <td>${user.role}</td>
            <td><span class="badge ${user.status === 'active' ? 'bg-success' : 'bg-danger'}">${user.status}</span></td>
            <td><button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button></td>
        `;
                tbody.appendChild(row);
            });
        }
        async function deleteUser(id) {
            if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø³ ØµØ§Ø±Ù Ú©Ùˆ Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) {
                await deleteFromStore(STORES.USERS, id);
                showNotification('ØµØ§Ø±Ù Ø­Ø°Ù Ú©Ø± Ø¯ÛŒØ§ Ú¯ÛŒØ§', 'success');
                loadUsersTable();
            }
        }
        async function addRole() {
            const permissions = {};
            document.querySelectorAll('#permissions-container input[type="checkbox"]').forEach(cb => {
                permissions[cb.value] = cb.checked;
            });
            const roleData = {
                name: document.getElementById('role-name').value,
                description: document.getElementById('role-description').value,
                permissions: permissions
            };
            await addToStore(STORES.ROLES, roleData);
            showNotification('Ø±ÙˆÙ„ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ Ø³Û’ Ø´Ø§Ù…Ù„ ÛÙˆ Ú¯ÛŒØ§', 'success');
            document.getElementById('role-form').reset();
            loadRolesTable();
        }
        async function loadRolesTable() {
            const tbody = document.querySelector('#roles-table tbody');
            tbody.innerHTML = '';
            const roles = await getAllFromStore(STORES.ROLES);
            if (!roles || roles.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;">Ú©ÙˆØ¦ÛŒ Ø±ÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’Û”</td></tr>';
                return;
            }
            roles.forEach(role => {
                const row = document.createElement('tr');
                row.innerHTML = `
            <td>${role.name}</td>
            <td>${role.description}</td>
            <td><button class="btn btn-danger btn-sm" onclick="deleteRole(${role.id})">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button></td>
        `;
                tbody.appendChild(row);
            });
        }
        async function deleteRole(id) {
            if (confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø³ Ø±ÙˆÙ„ Ú©Ùˆ Ø­Ø°Ù Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ')) {
                await deleteFromStore(STORES.ROLES, id);
                showNotification('Ø±ÙˆÙ„ Ø­Ø°Ù Ú©Ø± Ø¯ÛŒØ§ Ú¯ÛŒØ§', 'success');
                loadRolesTable();
            }
        }
        function handleReportTypeChangeJS() {
            const reportType = document.getElementById('js-report-type-select').value;
            const filtersArea = document.getElementById('js-report-filters-area');
            filtersArea.innerHTML = '';
            filtersArea.style.display = 'none';
            switch (reportType) {
                case 'student_strength_by_class':
                    filtersArea.style.display = 'none';
                    break;
                case 'class_fee_summary':
                    filtersArea.style.display = 'block';
                    const monthGroup = createElementJS('div', { class: 'form-group' });
                    monthGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-month' }, 'Ù…ÛÛŒÙ†Û'));
                    const monthSelect = createElementJS('select', { class: 'form-control', id: 'js-filter-month' });
                    const months = ["Ø¬Ù†ÙˆØ±ÛŒ", "ÙØ±ÙˆØ±ÛŒ", "Ù…Ø§Ø±Ú†", "Ø§Ù¾Ø±ÛŒÙ„", "Ù…Ø¦ÛŒ", "Ø¬ÙˆÙ†", "Ø¬ÙˆÙ„Ø§Ø¦ÛŒ", "Ø§Ú¯Ø³Øª", "Ø³ØªÙ…Ø¨Ø±", "Ø§Ú©ØªÙˆØ¨Ø±", "Ù†ÙˆÙ…Ø¨Ø±", "Ø¯Ø³Ù…Ø¨Ø±"];
                    months.forEach((m, i) => monthSelect.appendChild(createElementJS('option', { value: i + 1 }, m)));
                    monthGroup.appendChild(monthSelect);
                    filtersArea.appendChild(monthGroup);
                    const yearGroup = createElementJS('div', { class: 'form-group' });
                    yearGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-year' }, 'Ø³Ø§Ù„'));
                    const currentYear = new Date().getFullYear();
                    const yearInput = createElementJS('input', { type: 'number', class: 'form-control', id: 'js-filter-year', value: currentYear });
                    yearGroup.appendChild(yearInput);
                    filtersArea.appendChild(yearGroup);
                    break;
            }
        }
        async function generateSelectedReportJS() {
            const reportType = document.getElementById('js-report-type-select').value;
            const outputDiv = document.getElementById('js-report-output-area');
            outputDiv.innerHTML = '';
            if (!reportType) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø±Ù¾ÙˆØ±Ù¹ Ú©ÛŒ Ù‚Ø³Ù… Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”', 'error');
                return;
            }
            showLoading();
            let reportHTML = '';
            try {
                switch (reportType) {
                    case 'student_strength_by_class':
                        reportHTML = await generateStudentStrengthByClassReportJS();
                        break;
                    case 'class_fee_summary':
                        const month = document.getElementById('js-filter-month').value;
                        const year = document.getElementById('js-filter-year').value;
                        reportHTML = await generateClassFeeSummaryReportJS(parseInt(month), parseInt(year));
                        break;
                    default:
                        reportHTML = '<p>Ù…Ù†ØªØ®Ø¨ Ú©Ø±Ø¯Û Ø±Ù¾ÙˆØ±Ù¹ Ú©ÛŒ Ù‚Ø³Ù… Ú©Û’ Ù„ÛŒÛ’ Ú©ÙˆØ¦ÛŒ Ø¹Ù…Ù„ Ø¯Ø±Ø¢Ù…Ø¯ Ù†ÛÛŒÚº ÛÛ’Û”</p>';
                }
                outputDiv.innerHTML = reportHTML;
            } catch (error) {
                console.error(`Error generating report '${reportType}':`, error);
                outputDiv.innerHTML = `<p style="color:red;">Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ: ${error.message}</p>`;
                showNotification('Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”', 'error');
            } finally {
                hideLoading();
            }
        }
        async function generateStudentStrengthByClassReportJS() {
            const classes = await getAllFromStore(STORES.CLASSES);
            const students = await getAllFromStore(STORES.STUDENTS);
            let totalStudents = 0;
            const reportData = classes.map(cls => {
                const classStudents = students.filter(s => s.classId === cls.id);
                totalStudents += classStudents.length;
                return { className: cls.name, studentCount: classStudents.length };
            });
            let tableHTML = `<h3>Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ù„Ø­Ø§Ø¸ Ú©Ù„Ø§Ø³</h3>
                     <div class="table-container">
                       <table class="table">
                         <thead><tr><th>Ú©Ù„Ø§Ø³ Ú©Ø§ Ù†Ø§Ù…</th><th>Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ØªØ¹Ø¯Ø§Ø¯</th></tr></thead>
                         <tbody>`;
            reportData.forEach(data => {
                tableHTML += `<tr><td>${data.className}</td><td>${data.studentCount}</td></tr>`;
            });
            tableHTML += `</tbody>
                  <tfoot><tr><td><strong>Ú©Ù„ Ø·Ù„Ø¨Ø§Ø¡</strong></td><td><strong>${totalStudents}</strong></td></tr></tfoot>
                  </table></div>`;
            const chartContainerId = `chart-student-strength-${Date.now()}`;
            tableHTML += `<div id="${chartContainerId}" style="height: 300px; margin-top: 20px;"></div>
                  <p><em>Chart would be rendered here using a library like Chart.js.</em></p>`;
            const chartLabels = reportData.map(d => d.className);
            const chartDataValues = reportData.map(d => d.studentCount);
            return tableHTML;
        }
        async function generateClassFeeSummaryReportJS(month, year) {
            if (isNaN(month) || isNaN(year)) {
                return "<p>ÙÛŒØ³ Ø³Ù…Ø±ÛŒ Ø±Ù¾ÙˆØ±Ù¹ Ú©Û’ Ù„ÛŒÛ’ Ù…ÛÛŒÙ†Û Ø§ÙˆØ± Ø³Ø§Ù„ Ø¯Ø±Ø³Øª ÛÙˆÙ†Û’ Ú†Ø§ÛØ¦ÛŒÚºÛ”</p>";
            }
            const classes = await getAllFromStore(STORES.CLASSES);
            const feeRecords = await getAllFromStore(STORES.FEES);
            const students = await getAllFromStore(STORES.STUDENTS);
            let totalCollectedOverall = 0;
            const monthName = new Date(year, month - 1, 1).toLocaleDateString('ur-PK', { month: 'long' });
            const reportData = await Promise.all(classes.map(async (cls) => {
                const studentsInClass = students.filter(s => s.classId === cls.id);
                let classTotalCollected = 0;
                let classPaidCount = 0;
                studentsInClass.forEach(student => {
                    const studentFeeRecord = feeRecords.find(
                        fr => fr.studentId === student.id && parseInt(fr.month) === month && parseInt(fr.year) === year
                    );
                    if (studentFeeRecord) {
                        classTotalCollected += studentFeeRecord.total || 0;
                        classPaidCount++;
                    }
                });
                totalCollectedOverall += classTotalCollected;
                return {
                    className: cls.name,
                    totalStudents: studentsInClass.length,
                    paidStudents: classPaidCount,
                    collectedAmount: classTotalCollected
                };
            }));
            let tableHTML = `<h3>Ú©Ù„Ø§Ø³ ÙˆØ§Ø± ÙÛŒØ³ Ú©Ø§ Ø®Ù„Ø§ØµÛ Ø¨Ø±Ø§Ø¦Û’ ${monthName}ØŒ ${year}</h3>
                     <div class="table-container">
                       <table class="table">
                         <thead><tr><th>Ú©Ù„Ø§Ø³ Ú©Ø§ Ù†Ø§Ù…</th><th>Ú©Ù„ Ø·Ù„Ø¨Ø§Ø¡</th><th>ÙÛŒØ³ Ø¯ÛÙ†Ø¯Ú¯Ø§Ù†</th><th>Ø¬Ù…Ø¹ Ø´Ø¯Û Ø±Ù‚Ù…</th></tr></thead>
                         <tbody>`;
            reportData.forEach(data => {
                tableHTML += `<tr>
                        <td>${data.className}</td>
                        <td>${data.totalStudents}</td>
                        <td>${data.paidStudents}</td>
                        <td>${formatCurrency(data.collectedAmount)}</td>
                      </tr>`;
            });
            tableHTML += `</tbody>
                  <tfoot><tr><td colspan="3"><strong>Ú©Ù„ Ø¬Ù…Ø¹ Ø´Ø¯Û Ø±Ù‚Ù…</strong></td><td><strong>${formatCurrency(totalCollectedOverall)}</strong></td></tr></tfoot>
                  </table></div>`;
            const chartContainerId = `chart-fee-summary-${Date.now()}`;
            tableHTML += `<div id="${chartContainerId}" style="max-width: 400px; margin: 20px auto;"></div>
                  <p><em>Pie chart (Collection by Class) would be rendered here.</em></p>`;
            return tableHTML;
        }
        function toggleReportFilters() {
            const type = document.getElementById('report-type').value;
            const filtersDiv = document.getElementById('report-filters');
            filtersDiv.innerHTML = '';
            switch (type) {
                case 'class_list':
                case 'fee_defaulters':
                    filtersDiv.innerHTML = `
                <div class="form-group">
                    <label class="form-label">Ú©Ù„Ø§Ø³ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</label>
                    <select id="report-filter-class" class="form-control"></select>
                </div>
             `;
                    loadClassDropdownsForReport();
                    break;
            }
        }
        async function loadClassDropdownsForReport() {
            const select = document.getElementById('report-filter-class');
            select.innerHTML = '<option value="all">ØªÙ…Ø§Ù… Ú©Ù„Ø§Ø³Ø²</option>';
            const classes = await getAllFromStore(STORES.CLASSES);
            classes.forEach(c => {
                select.innerHTML += `<option value="${c.id}">${c.name}</option>`;
            });
        }
        async function generateReport() {
            const type = document.getElementById('report-type').value;
            const outputDiv = document.getElementById('report-output');
            if (!type) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø±Ù¾ÙˆØ±Ù¹ Ú©ÛŒ Ù‚Ø³Ù… Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº', 'error');
                return;
            }
            outputDiv.style.display = 'block';
            outputDiv.innerHTML = '<div class="spinner"></div>';
            let html = '';
            switch (type) {
                case 'student_strength':
                    html = await generateStudentStrengthReport();
                    break;
                case 'class_list':
                    html = await generateClassListReport();
                    break;
                case 'fee_defaulters':
                    html = await generateDefaultersReport();
                    break;
            }
            outputDiv.innerHTML = html;
        }
        async function generateStudentStrengthReport() {
            const classes = await getAllFromStore(STORES.CLASSES);
            let table = `<table class="table"><thead><tr><th>Ú©Ù„Ø§Ø³</th><th>Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ØªØ¹Ø¯Ø§Ø¯</th></tr></thead><tbody>`;
            let totalStudents = 0;
            for (const cls of classes) {
                const students = await getAllFromIndex(STORES.STUDENTS, 'classId', cls.id);
                table += `<tr><td>${cls.name}</td><td>${students.length}</td></tr>`;
                totalStudents += students.length;
            }
            table += `</tbody><tfoot><tr><th>Ú©Ù„ ØªØ¹Ø¯Ø§Ø¯</th><th>${totalStudents}</th></tr></tfoot></table>`;
            return `<h3>Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ú©ÛŒ Ø±Ù¾ÙˆØ±Ù¹</h3>` + table;
        }
        async function generateClassListReport() {
            const classId = document.getElementById('report-filter-class').value;
            let students = await getAllFromStore(STORES.STUDENTS);
            if (classId !== 'all') {
                students = students.filter(s => s.classId === parseInt(classId));
            }
            let table = `<table class="table"><thead><tr><th>Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø±</th><th>Ù†Ø§Ù…</th><th>ÙˆØ§Ù„Ø¯ Ú©Ø§ Ù†Ø§Ù…</th><th>Ú©Ù„Ø§Ø³</th></tr></thead><tbody>`;
            students.forEach(s => {
                table += `<tr><td>${s.rollNumber}</td><td>${s.name}</td><td>${s.fatherName}</td><td>${s.className}</td></tr>`;
            });
            table += `</tbody></table>`;
            const className = classId !== 'all' ? (await getFromStore(STORES.CLASSES, parseInt(classId))).name : 'ØªÙ…Ø§Ù… Ú©Ù„Ø§Ø³Ø²';
            return `<h3>${className} Ú©ÛŒ Ù„Ø³Ù¹</h3>` + table;
        }
        function initializeSettingsView() {
            const container = document.getElementById('settings-view');
            if (container.querySelector('.tabs')) {
                loadAllSettings();
                return;
            }
            container.innerHTML = `
        <h2>ØªØ±ØªÛŒØ¨Ø§Øª</h2>
        <div class="tabs">
            <div class="tab active" data-tab="general-settings">Ø¹Ù…ÙˆÙ…ÛŒ ØªØ±ØªÛŒØ¨Ø§Øª</div>
        </div>
        <div class="tab-content active" id="general-settings">
            <div class="form-container">
                <form id="general-settings-form" onsubmit="event.preventDefault(); saveGeneralSettings();">
                    <div class="form-title">Ø§Ø¯Ø§Ø±Û’ Ú©ÛŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</div>
                    <div class="form-group"><label>Ø§Ø¯Ø§Ø±Û’ Ú©Ø§ Ù†Ø§Ù…</label><input type="text" class="form-control" id="setting-school-name"></div>
                    <div class="form-group"><label>Ù¾ØªÛ</label><input type="text" class="form-control" id="setting-school-address"></div>
                    <div class="form-group"><label>ÙÙˆÙ†</label><input type="text" class="form-control" id="setting-school-phone"></div>
                    <div class="form-group"><label>Ø§ÛŒ Ù…ÛŒÙ„</label><input type="email" class="form-control" id="setting-school-email"></div>
                    <button type="submit" class="btn btn-primary">Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
                </form>
            </div>
        </div>
    `;
            loadAllSettings();
        }
        async function loadAllSettings() {
            console.log('[DEBUG] Running loadAllSettings...');
            try {
                const settings = await getFromStore(STORES.SETTINGS, 'general') || {};
                const schoolNameInput = document.getElementById('setting-school-name');
                if (schoolNameInput) schoolNameInput.value = settings.schoolName || ''; else console.error("[DEBUG] 'setting-school-name' not found!");
                const schoolAddressInput = document.getElementById('setting-school-address');
                if (schoolAddressInput) schoolAddressInput.value = settings.schoolAddress || ''; else console.error("[DEBUG] 'setting-school-address' not found!");
                const schoolPhoneInput = document.getElementById('setting-school-phone');
                if (schoolPhoneInput) schoolPhoneInput.value = settings.schoolPhone || ''; else console.error("[DEBUG] 'setting-school-phone' not found!");
                const schoolEmailInput = document.getElementById('setting-school-email');
                if (schoolEmailInput) schoolEmailInput.value = settings.schoolEmail || ''; else console.error("[DEBUG] 'setting-school-email' not found!");
                const primaryColorInput = document.getElementById('setting-primary-color');
                if (primaryColorInput) primaryColorInput.value = settings.primaryColor || '#3498db'; else console.error("[DEBUG] 'setting-primary-color' not found!");
                console.log('[DEBUG] Finished loading values into settings form.');
            } catch (e) {
                console.error('[DEBUG] Error inside loadAllSettings:', e);
            }
        }
        async function saveGeneralSettings() {
            const existing = await getFromStore(STORES.SETTINGS, 'general') || { id: 'general' };
            const updated = {
                ...existing,
                schoolName: document.getElementById('setting-school-name').value,
                schoolAddress: document.getElementById('setting-school-address').value,
                schoolPhone: document.getElementById('setting-school-phone').value,
                schoolEmail: document.getElementById('setting-school-email').value,
            };
            await addToStore(STORES.SETTINGS, updated, true);
            showNotification('Ø¹Ù…ÙˆÙ…ÛŒ ØªØ±ØªÛŒØ¨Ø§Øª Ù…Ø­ÙÙˆØ¸ ÛÙˆ Ú¯Ø¦ÛŒÚº', 'success');
        }
        async function saveAcademicSettings() {
            const existing = await getFromStore(STORES.SETTINGS, 'general') || { id: 'general' };
            const updated = {
                ...existing,
                currentSession: document.getElementById('setting-current-session').value,
                feeDueDay: parseInt(document.getElementById('setting-fee-due-day').value),
                feeLateFine: parseFloat(document.getElementById('setting-fee-late-fine').value),
            };
            await addToStore(STORES.SETTINGS, updated, true);
            showNotification('ØªØ¹Ù„ÛŒÙ…ÛŒ ØªØ±ØªÛŒØ¨Ø§Øª Ù…Ø­ÙÙˆØ¸ ÛÙˆ Ú¯Ø¦ÛŒÚº', 'success');
        }
        async function saveThemeSettings() {
            const existing = await getFromStore(STORES.SETTINGS, 'general') || { id: 'general' };
            const primaryColor = document.getElementById('setting-primary-color').value;
            const updated = { ...existing, primaryColor: primaryColor };
            await addToStore(STORES.SETTINGS, updated, true);
            applyTheme(primaryColor);
            showNotification('ØªÚ¾ÛŒÙ… Ú©ÛŒ ØªØ±ØªÛŒØ¨Ø§Øª Ù…Ø­ÙÙˆØ¸ ÛÙˆ Ú¯Ø¦ÛŒÚº', 'success');
        }
        function applyTheme(color) {
            document.documentElement.style.setProperty('--primary-color', color);
            document.querySelector('.header').style.backgroundColor = color;
        }
        async function resetThemeSettings() {
            const defaultColor = '#2c3e50';
            document.getElementById('setting-primary-color').value = defaultColor;
            const existing = await getFromStore(STORES.SETTINGS, 'general') || { id: 'general' };
            const updated = { ...existing, primaryColor: defaultColor };
            await addToStore(STORES.SETTINGS, updated, true);
            applyTheme(defaultColor);
            showNotification('ØªÚ¾ÛŒÙ… ÚˆÛŒÙØ§Ù„Ù¹ Ù¾Ø± Ø±ÛŒ Ø³ÛŒÙ¹ ÛÙˆ Ú¯ÛŒØ§', 'success');
        }
        async function populateAttendanceSections(classDropdownId, sectionDropdownId) {
            const classId = parseInt(document.getElementById(classDropdownId).value);
            const sectionDropdown = document.getElementById(sectionDropdownId);
            sectionDropdown.innerHTML = '<option value="">...</option>';
            if (isNaN(classId)) {
                sectionDropdown.innerHTML = '<option value="">Ù¾ÛÙ„Û’ Ú©Ù„Ø§Ø³ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</option>';
                return;
            }
            try {
                const sections = await getAllFromIndex(STORES.SECTIONS, 'classId', classId);
                if (sections && sections.length > 0) {
                    sectionDropdown.innerHTML = '<option value="">Ø³ÛŒÚ©Ø´Ù† Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</option>';
                    sections.forEach(section => {
                        const option = document.createElement('option');
                        option.value = section.id;
                        option.textContent = section.name;
                        sectionDropdown.appendChild(option);
                    });
                } else {
                    sectionDropdown.innerHTML = '<option value="">Ú©ÙˆØ¦ÛŒ Ø³ÛŒÚ©Ø´Ù† Ù†ÛÛŒÚº Ù…Ù„Ø§</option>';
                }
            } catch (error) {
                console.error('Error populating sections:', error);
                sectionDropdown.innerHTML = '<option value="">Ø³ÛŒÚ©Ø´Ù† Ù„ÙˆÚˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ</option>';
            }
        }
        async function addToStore(storeName, data, upsert = false) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction(storeName, 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = upsert ? store.put(data) : store.add(data);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }
        function createElementJS(tag, attributes = {}, textContent = null) {
            const element = document.createElement(tag);
            let hasInnerHTML = false;
            for (const key in attributes) {
                if (key === 'style' && typeof attributes[key] === 'object') {
                    for (const styleProp in attributes[key]) {
                        element.style[styleProp] = attributes[key][styleProp];
                    }
                } else if (key === 'dataset' && typeof attributes[key] === 'object') {
                    for (const dataKey in attributes[key]) {
                        element.dataset[dataKey] = attributes[key][dataKey];
                    }
                } else if (key === 'innerHTML') {
                    element.innerHTML = attributes[key];
                    hasInnerHTML = true;
                } else if (typeof attributes[key] === 'boolean') {
                    if (attributes[key]) {
                        element.setAttribute(key, '');
                    }
                } else {
                    element.setAttribute(key, attributes[key]);
                }
            }
            if (!hasInnerHTML && textContent !== null && textContent !== undefined) {
                element.textContent = textContent;
            }
            return element;
        }
        async function createCollapsibleFilterUI(targetListDivId, filterContainerId, filterTitleTextContent, createFilterRowsFn, populateDropdownsFn, applyFiltersFn, resetFiltersFn, specificDropdownChangeHandlers = []) {
            const listDiv = document.getElementById(targetListDivId);
            if (!listDiv) {
                console.error(`Target div '${targetListDivId}' not found for creating filters.`);
                return;
            }
            if (document.getElementById(filterContainerId)) {
                if (populateDropdownsFn) await populateDropdownsFn();
                return;
            }
            const existingSearchContainer = listDiv.querySelector('.form-container:not(.js-filter-container)');
            const filterContainer = createElementJS('div', {
                id: filterContainerId,
                class: 'form-container js-filter-container',
                style: { marginBottom: '20px' }
            });
            const filterHeader = createElementJS('div', {
                class: 'form-title filter-header-toggle',
                style: { cursor: 'pointer', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }
            });
            const filterTitleSpan = createElementJS('span', {}, filterTitleTextContent);
            const filterToggleIcon = createElementJS('span', { class: 'filter-toggle-icon', innerHTML: 'â–¾' });
            filterHeader.appendChild(filterTitleSpan);
            filterHeader.appendChild(filterToggleIcon);
            filterContainer.appendChild(filterHeader);
            const filterContent = createElementJS('div', { class: 'filter-content', style: { display: 'none', paddingTop: '15px' } });
            await createFilterRowsFn(filterContent);
            filterContainer.appendChild(filterContent);
            if (existingSearchContainer) {
                listDiv.insertBefore(filterContainer, existingSearchContainer);
            } else {
                listDiv.appendChild(filterContainer);
            }
            filterHeader.addEventListener('click', () => {
                const isVisible = filterContent.style.display === 'block';
                filterContent.style.display = isVisible ? 'none' : 'block';
                filterToggleIcon.innerHTML = isVisible ? 'â–¾' : 'â–´';
            });
            if (populateDropdownsFn) {
                await populateDropdownsFn();
            }
            specificDropdownChangeHandlers.forEach(handlerConfig => {
                const dropdown = filterContent.querySelector(`#${handlerConfig.dropdownId}`);
                if (dropdown) {
                    dropdown.addEventListener('change', handlerConfig.handlerFn);
                }
            });
            const applyButton = filterContent.querySelector('button[id^="js-apply-"]');
            if (applyButton && applyFiltersFn) applyButton.addEventListener('click', applyFiltersFn);
            const resetButton = filterContent.querySelector('button[id^="js-reset-"]');
            if (resetButton && resetFiltersFn) resetButton.addEventListener('click', resetFiltersFn);
        }
        async function createStudentFilterRows(filterContentDiv) {
            const row1 = createElementJS('div', { class: 'form-row' });
            const classGroup = createElementJS('div', { class: 'form-group' });
            classGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-student-class' }, 'Ú©Ù„Ø§Ø³'));
            classGroup.appendChild(createElementJS('select', { class: 'form-control', id: 'js-filter-student-class', multiple: true, style: { height: '100px' } }));
            row1.appendChild(classGroup);
            const sectionGroup = createElementJS('div', { class: 'form-group' });
            sectionGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-student-section' }, 'Ø³ÛŒÚ©Ø´Ù†'));
            sectionGroup.appendChild(createElementJS('select', { class: 'form-control', id: 'js-filter-student-section', multiple: true, style: { height: '100px' } }));
            row1.appendChild(sectionGroup);
            filterContentDiv.appendChild(row1);
            const row2 = createElementJS('div', { class: 'form-row' });
            const genderGroup = createElementJS('div', { class: 'form-group' });
            genderGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-student-gender' }, 'Ø¬Ù†Ø³'));
            const genderSelect = createElementJS('select', { class: 'form-control', id: 'js-filter-student-gender' });
            genderSelect.appendChild(createElementJS('option', { value: '' }, 'ØªÙ…Ø§Ù…'));
            genderSelect.appendChild(createElementJS('option', { value: 'Ù…Ø±Ø¯' }, 'Ù…Ø±Ø¯'));
            genderSelect.appendChild(createElementJS('option', { value: 'Ø¹ÙˆØ±Øª' }, 'Ø¹ÙˆØ±Øª'));
            genderGroup.appendChild(genderSelect);
            row2.appendChild(genderGroup);
            const feeCategoryGroup = createElementJS('div', { class: 'form-group' });
            feeCategoryGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-student-fee-category' }, 'ÙÛŒØ³ Ú©ÛŒÙ¹ÛŒÚ¯Ø±ÛŒ'));
            const feeCategorySelect = createElementJS('select', { class: 'form-control', id: 'js-filter-student-fee-category' });
            feeCategorySelect.appendChild(createElementJS('option', { value: '' }, 'ØªÙ…Ø§Ù…'));
            ['Ø¹Ø§Ù…', 'Ù…Ø³ØªØ­Ù‚', 'Ø§Ø³Ú©Ø§Ù„Ø±Ø´Ù¾', 'Ù…Ú©Ù…Ù„ Ù…Ø¹Ø§Ù'].forEach(cat => {
                feeCategorySelect.appendChild(createElementJS('option', { value: cat }, cat));
            });
            feeCategoryGroup.appendChild(feeCategorySelect);
            row2.appendChild(feeCategoryGroup);
            filterContentDiv.appendChild(row2);
            const row3 = createElementJS('div', { class: 'form-row' });
            const dateFromGroup = createElementJS('div', { class: 'form-group' });
            dateFromGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-admission-date-from' }, 'Ø¯Ø§Ø®Ù„Û ØªØ§Ø±ÛŒØ® (Ø³Û’)'));
            dateFromGroup.appendChild(createElementJS('input', { type: 'date', class: 'form-control', id: 'js-filter-admission-date-from' }));
            row3.appendChild(dateFromGroup);
            const dateToGroup = createElementJS('div', { class: 'form-group' });
            dateToGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-admission-date-to' }, 'Ø¯Ø§Ø®Ù„Û ØªØ§Ø±ÛŒØ® (ØªÚ©)'));
            dateToGroup.appendChild(createElementJS('input', { type: 'date', class: 'form-control', id: 'js-filter-admission-date-to' }));
            row3.appendChild(dateToGroup);
            filterContentDiv.appendChild(row3);
            const row4 = createElementJS('div', { class: 'form-row' });
            row4.appendChild(createElementJS('button', { class: 'btn btn-primary', id: 'js-apply-student-filters-btn' }, 'ÙÙ„Ù¹Ø± Ú©Ø±ÛŒÚº'));
            row4.appendChild(createElementJS('button', { class: 'btn btn-danger', id: 'js-reset-student-filters-btn', style: { marginRight: '10px' } }, 'ÙÙ„Ù¹Ø± Ø±ÛŒ Ø³ÛŒÙ¹'));
            filterContentDiv.appendChild(row4);
        }
        async function populateStudentFilterDropdownsJS() {
            try {
                const classes = await getAllFromStore(STORES.CLASSES);
                const classFilterDropdown = document.getElementById('js-filter-student-class');
                if (!classFilterDropdown) return;
                classFilterDropdown.innerHTML = '';
                classes.forEach(cls => {
                    classFilterDropdown.appendChild(createElementJS('option', { value: cls.id }, cls.name));
                });
                await populateStudentFilterSectionsJS();
            } catch (error) {
                console.error('Error populating student class filter dropdown (JS):', error);
            }
        }
        async function populateStudentFilterSectionsJS() {
            const classFilterDropdown = document.getElementById('js-filter-student-class');
            const sectionFilterDropdown = document.getElementById('js-filter-student-section');
            if (!classFilterDropdown || !sectionFilterDropdown) return;
            sectionFilterDropdown.innerHTML = '';
            const selectedClassIds = Array.from(classFilterDropdown.selectedOptions).map(opt => parseInt(opt.value));
            if (selectedClassIds.length === 0) {
                const allSections = await getAllFromStore(STORES.SECTIONS);
                for (const section of allSections) {
                    const classData = await getFromStore(STORES.CLASSES, section.classId);
                    sectionFilterDropdown.appendChild(
                        createElementJS('option', { value: section.id }, `${section.name} (${classData?.name || 'N/A'})`)
                    );
                }
                return;
            }
            for (const classId of selectedClassIds) {
                if (isNaN(classId)) continue;
                try {
                    const sections = await getAllFromIndex(STORES.SECTIONS, 'classId', classId);
                    const classData = await getFromStore(STORES.CLASSES, classId);
                    sections.forEach(section => {
                        sectionFilterDropdown.appendChild(
                            createElementJS('option', { value: section.id }, `${section.name} (${classData?.name || 'N/A'})`)
                        );
                    });
                } catch (error) {
                    console.error(`Error populating JS sections for class ID ${classId}:`, error);
                }
            }
        }
        async function applyStudentFiltersJS() {
            showLoading();
            try {
                const selectedClassIds = Array.from(document.getElementById('js-filter-student-class').selectedOptions).map(opt => parseInt(opt.value));
                const selectedSectionIds = Array.from(document.getElementById('js-filter-student-section').selectedOptions).map(opt => parseInt(opt.value));
                const selectedGender = document.getElementById('js-filter-student-gender').value;
                const selectedFeeCategory = document.getElementById('js-filter-student-fee-category').value;
                const admissionDateFromStr = document.getElementById('js-filter-admission-date-from').value;
                const admissionDateToStr = document.getElementById('js-filter-admission-date-to').value;
                let students = await getAllFromStore(STORES.STUDENTS);
                if (selectedClassIds.length > 0) {
                    students = students.filter(student => selectedClassIds.includes(student.classId));
                }
                if (selectedSectionIds.length > 0) {
                    students = students.filter(student => selectedSectionIds.includes(student.sectionId));
                }
                if (selectedGender) {
                    students = students.filter(student => student.gender === selectedGender);
                }
                if (selectedFeeCategory) {
                    students = students.filter(student => student.feeCategory === selectedFeeCategory);
                }
                if (admissionDateFromStr) {
                    const fromDate = new Date(admissionDateFromStr);
                    students = students.filter(student => student.admissionDate && new Date(student.admissionDate) >= fromDate);
                }
                if (admissionDateToStr) {
                    const toDate = new Date(admissionDateToStr);
                    students = students.filter(student => student.admissionDate && new Date(student.admissionDate) <= toDate);
                }
                loadStudentsTable(students);
            } catch (error) {
                console.error("Error applying student filters (JS):", error);
                showNotification('ÙÙ„Ù¹Ø± Ø§Ù¾Ù„Ø§Ø¦ÛŒ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”', 'error');
            } finally {
                hideLoading();
            }
        }
        function resetStudentFiltersJS() {
            const classSelect = document.getElementById('js-filter-student-class');
            if (classSelect) Array.from(classSelect.options).forEach(opt => opt.selected = false);
            const sectionSelect = document.getElementById('js-filter-student-section');
            if (sectionSelect) sectionSelect.innerHTML = '';
            populateStudentFilterSectionsJS();
            const genderSelect = document.getElementById('js-filter-student-gender');
            if (genderSelect) genderSelect.value = '';
            const feeCatSelect = document.getElementById('js-filter-student-fee-category');
            if (feeCatSelect) feeCatSelect.value = '';
            const dateFrom = document.getElementById('js-filter-admission-date-from');
            if (dateFrom) dateFrom.value = '';
            const dateTo = document.getElementById('js-filter-admission-date-to');
            if (dateTo) dateTo.value = '';
            loadStudentsTable();
        }
        async function createTeacherFilterRows(filterContentDiv) {
            const row1 = createElementJS('div', { class: 'form-row' });
            const subjectGroup = createElementJS('div', { class: 'form-group' });
            subjectGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-teacher-subject' }, 'Ù…Ø¶Ù…ÙˆÙ†'));
            subjectGroup.appendChild(createElementJS('select', { class: 'form-control', id: 'js-filter-teacher-subject', multiple: true, style: { height: '100px' } }));
            row1.appendChild(subjectGroup);
            const qualGroup = createElementJS('div', { class: 'form-group' });
            qualGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-teacher-qualification' }, 'Ù‚Ø§Ø¨Ù„ÛŒØª (ØªÙ„Ø§Ø´)'));
            qualGroup.appendChild(createElementJS('input', { type: 'text', class: 'form-control', id: 'js-filter-teacher-qualification', placeholder: 'Ù…Ø«Ø§Ù„: Ø¹Ø§Ù„Ù…ØŒ ÙØ§Ø¶Ù„' }));
            row1.appendChild(qualGroup);
            filterContentDiv.appendChild(row1);
            const row2 = createElementJS('div', { class: 'form-row' });
            const dateFromGroup = createElementJS('div', { class: 'form-group' });
            dateFromGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-teacher-joining-from' }, 'Ø´Ù…ÙˆÙ„ÛŒØª ØªØ§Ø±ÛŒØ® (Ø³Û’)'));
            dateFromGroup.appendChild(createElementJS('input', { type: 'date', class: 'form-control', id: 'js-filter-teacher-joining-from' }));
            row2.appendChild(dateFromGroup);
            const dateToGroup = createElementJS('div', { class: 'form-group' });
            dateToGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-teacher-joining-to' }, 'Ø´Ù…ÙˆÙ„ÛŒØª ØªØ§Ø±ÛŒØ® (ØªÚ©)'));
            dateToGroup.appendChild(createElementJS('input', { type: 'date', class: 'form-control', id: 'js-filter-teacher-joining-to' }));
            row2.appendChild(dateToGroup);
            filterContentDiv.appendChild(row2);
            const row3 = createElementJS('div', { class: 'form-row' });
            row3.appendChild(createElementJS('button', { class: 'btn btn-primary', id: 'js-apply-teacher-filters-btn' }, 'ÙÙ„Ù¹Ø± Ú©Ø±ÛŒÚº'));
            row3.appendChild(createElementJS('button', { class: 'btn btn-danger', id: 'js-reset-teacher-filters-btn', style: { marginRight: '10px' } }, 'ÙÙ„Ù¹Ø± Ø±ÛŒ Ø³ÛŒÙ¹'));
            filterContentDiv.appendChild(row3);
        }
        async function populateTeacherFilterDropdownsJS() {
            try {
                const subjects = await getAllFromStore(STORES.SUBJECTS);
                const subjectFilterDropdown = document.getElementById('js-filter-teacher-subject');
                if (!subjectFilterDropdown) return;
                subjectFilterDropdown.innerHTML = '';
                subjects.forEach(sub => {
                    subjectFilterDropdown.appendChild(createElementJS('option', { value: sub.id }, sub.name));
                });
            } catch (error) {
                console.error('Error populating teacher subject filter (JS):', error);
            }
        }
        async function applyTeacherFiltersJS() {
            showLoading();
            try {
                const selectedSubjectIds = Array.from(document.getElementById('js-filter-teacher-subject').selectedOptions).map(opt => parseInt(opt.value));
                const qualificationSearch = document.getElementById('js-filter-teacher-qualification').value.toLowerCase();
                const joiningDateFromStr = document.getElementById('js-filter-teacher-joining-from').value;
                const joiningDateToStr = document.getElementById('js-filter-teacher-joining-to').value;
                let teachers = await getAllFromStore(STORES.TEACHERS);
                if (selectedSubjectIds.length > 0) {
                    teachers = teachers.filter(teacher => teacher.subjects && teacher.subjects.some(subId => selectedSubjectIds.includes(parseInt(subId))));
                }
                if (qualificationSearch) {
                    teachers = teachers.filter(teacher => teacher.qualification && teacher.qualification.toLowerCase().includes(qualificationSearch));
                }
                if (joiningDateFromStr) {
                    const fromDate = new Date(joiningDateFromStr);
                    teachers = teachers.filter(teacher => teacher.joiningDate && new Date(teacher.joiningDate) >= fromDate);
                }
                if (joiningDateToStr) {
                    const toDate = new Date(joiningDateToStr);
                    teachers = teachers.filter(teacher => teacher.joiningDate && new Date(teacher.joiningDate) <= toDate);
                }
                loadTeachersTable(teachers);
            } catch (error) {
                console.error("Error applying teacher filters (JS):", error);
            } finally {
                hideLoading();
            }
        }
        function resetTeacherFiltersJS() {
            const subjectSelect = document.getElementById('js-filter-teacher-subject');
            if (subjectSelect) Array.from(subjectSelect.options).forEach(opt => opt.selected = false);
            const qualInput = document.getElementById('js-filter-teacher-qualification');
            if (qualInput) qualInput.value = '';
            const dateFrom = document.getElementById('js-filter-teacher-joining-from');
            if (dateFrom) dateFrom.value = '';
            const dateTo = document.getElementById('js-filter-teacher-joining-to');
            if (dateTo) dateTo.value = '';
            loadTeachersTable();
        }
        async function createStaffFilterRows(filterContentDiv) {
            const row1 = createElementJS('div', { class: 'form-row' });
            const desigGroup = createElementJS('div', { class: 'form-group' });
            desigGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-staff-designation' }, 'Ø¹ÛØ¯Û'));
            const desigSelect = createElementJS('select', { class: 'form-control', id: 'js-filter-staff-designation' });
            desigSelect.appendChild(createElementJS('option', { value: '' }, 'ØªÙ…Ø§Ù…'));
            ['Ø¯ÙØªØ±ÛŒ Ú©Ù„Ø±Ú©', 'Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒÙ†', 'Ø³ÛŒÚ©ÛŒÙˆØ±Ù¹ÛŒ Ú¯Ø§Ø±Úˆ', 'ØµÙØ§Ø¦ÛŒ Ú©Ø±Ù†Û’ ÙˆØ§Ù„Ø§', 'ÚˆØ±Ø§Ø¦ÛŒÙˆØ±', 'Ø¯ÛŒÚ¯Ø±'].forEach(d => {
                desigSelect.appendChild(createElementJS('option', { value: d }, d));
            });
            desigGroup.appendChild(desigSelect);
            row1.appendChild(desigGroup);
            const deptGroup = createElementJS('div', { class: 'form-group' });
            deptGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-staff-department' }, 'Ø´Ø¹Ø¨Û'));
            const deptSelect = createElementJS('select', { class: 'form-control', id: 'js-filter-staff-department' });
            deptSelect.appendChild(createElementJS('option', { value: '' }, 'ØªÙ…Ø§Ù…'));
            ['Ø§Ù†ØªØ¸Ø§Ù…ÛŒÛ', 'Ø§Ú©Ø§Ø¤Ù†Ù¹Ø³', 'Ù„Ø§Ø¦Ø¨Ø±ÛŒØ±ÛŒ', 'Ø³ÛŒÚ©ÛŒÙˆØ±Ù¹ÛŒ', 'Ù¹Ø±Ø§Ù†Ø³Ù¾ÙˆØ±Ù¹', 'ØµÙØ§Ø¦ÛŒ', 'Ø¯ÛŒÚ¯Ø±'].forEach(d => {
                deptSelect.appendChild(createElementJS('option', { value: d }, d));
            });
            deptGroup.appendChild(deptSelect);
            row1.appendChild(deptGroup);
            filterContentDiv.appendChild(row1);
            const row2 = createElementJS('div', { class: 'form-row' });
            const dateFromGroup = createElementJS('div', { class: 'form-group' });
            dateFromGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-staff-joining-from' }, 'Ø´Ù…ÙˆÙ„ÛŒØª ØªØ§Ø±ÛŒØ® (Ø³Û’)'));
            dateFromGroup.appendChild(createElementJS('input', { type: 'date', class: 'form-control', id: 'js-filter-staff-joining-from' }));
            row2.appendChild(dateFromGroup);
            const dateToGroup = createElementJS('div', { class: 'form-group' });
            dateToGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-staff-joining-to' }, 'Ø´Ù…ÙˆÙ„ÛŒØª ØªØ§Ø±ÛŒØ® (ØªÚ©)'));
            dateToGroup.appendChild(createElementJS('input', { type: 'date', class: 'form-control', id: 'js-filter-staff-joining-to' }));
            row2.appendChild(dateToGroup);
            filterContentDiv.appendChild(row2);
            const row3 = createElementJS('div', { class: 'form-row' });
            row3.appendChild(createElementJS('button', { class: 'btn btn-primary', id: 'js-apply-staff-filters-btn' }, 'ÙÙ„Ù¹Ø± Ú©Ø±ÛŒÚº'));
            row3.appendChild(createElementJS('button', { class: 'btn btn-danger', id: 'js-reset-staff-filters-btn', style: { marginRight: '10px' } }, 'ÙÙ„Ù¹Ø± Ø±ÛŒ Ø³ÛŒÙ¹'));
            filterContentDiv.appendChild(row3);
        }
        async function applyStaffFiltersJS() {
            showLoading();
            try {
                const selectedDesignation = document.getElementById('js-filter-staff-designation').value;
                const selectedDepartment = document.getElementById('js-filter-staff-department').value;
                const joiningDateFromStr = document.getElementById('js-filter-staff-joining-from').value;
                const joiningDateToStr = document.getElementById('js-filter-staff-joining-to').value;
                let staffList = await getAllFromStore(STORES.STAFF);
                if (selectedDesignation) {
                    staffList = staffList.filter(staff => staff.designation === selectedDesignation);
                }
                if (selectedDepartment) {
                    staffList = staffList.filter(staff => staff.department === selectedDepartment);
                }
                if (joiningDateFromStr) {
                    const fromDate = new Date(joiningDateFromStr);
                    staffList = staffList.filter(staff => staff.joiningDate && new Date(staff.joiningDate) >= fromDate);
                }
                if (joiningDateToStr) {
                    const toDate = new Date(joiningDateToStr);
                    staffList = staffList.filter(staff => staff.joiningDate && new Date(staff.joiningDate) <= toDate);
                }
                loadStaffTable(staffList);
            } catch (error) {
                console.error("Error applying staff filters (JS):", error);
            } finally {
                hideLoading();
            }
        }
        function resetStaffFiltersJS() {
            const desigSelect = document.getElementById('js-filter-staff-designation');
            if (desigSelect) desigSelect.value = '';
            const deptSelect = document.getElementById('js-filter-staff-department');
            if (deptSelect) deptSelect.value = '';
            const dateFrom = document.getElementById('js-filter-staff-joining-from');
            if (dateFrom) dateFrom.value = '';
            const dateTo = document.getElementById('js-filter-staff-joining-to');
            if (dateTo) dateTo.value = '';
            loadStaffTable();
        }
        async function loadTeachersTable(teachersToLoad = null) {
            try {
                const teachers = teachersToLoad === null ? await getAllFromStore(STORES.TEACHERS) : teachersToLoad;
                const tbody = document.querySelector('#teachers-table tbody');
                tbody.innerHTML = '';
                if (!teachers || teachers.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Ú©ÙˆØ¦ÛŒ Ø§Ø³ØªØ§Ø¯ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’ ÛŒØ§ ÙÙ„Ù¹Ø± Ø³Û’ Ú©ÙˆØ¦ÛŒ Ù†ØªÛŒØ¬Û Ù†ÛÛŒÚº Ù…Ù„Ø§Û”</td></tr>';
                    return;
                }
                for (const teacher of teachers) {
                    const row = document.createElement('tr');
                    let subjectNames = '-';
                    if (teacher.subjects && teacher.subjects.length > 0) {
                        const subjectPromises = teacher.subjects.map(id => getFromStore(STORES.SUBJECTS, parseInt(id)));
                        const subjectObjects = await Promise.all(subjectPromises);
                        subjectNames = subjectObjects.filter(s => s).map(s => s.name).join(', ');
                    }
                    row.innerHTML = `
                <td>${teacher.employeeId}</td>
                <td>${teacher.name}</td>
                <td>${teacher.qualification}</td>
                <td>${subjectNames}</td>
                <td>${teacher.contact}</td>
                <td>${formatDate(teacher.joiningDate)}</td>
                <td>${teacher.basicSalary ? formatCurrency(teacher.basicSalary) : 'N/A'}</td>
                <td class="no-print">
                    <button class="btn btn-primary btn-sm" onclick="editTeacher(${teacher.id})">ØªØ±Ù…ÛŒÙ…</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteItem('${STORES.TEACHERS}', ${teacher.id})">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button>
                </td>
            `;
                    tbody.appendChild(row);
                }
            } catch (error) {
                console.error('Error loading teachers table:', error);
                const tbody = document.querySelector('#teachers-table tbody');
                if (tbody) tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Ø§Ø³Ø§ØªØ°Û Ú©ÛŒ ÙÛØ±Ø³Øª Ù„ÙˆÚˆ Ú©Ø±Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒÛ”</td></tr>';
            }
        }
        async function loadStaffTable(staffToLoad = null) {
            try {
                let staffArray;
                if (staffToLoad === null) {
                    staffArray = await getAllFromStore(STORES.STAFF);
                } else if (Array.isArray(staffToLoad)) {
                    staffArray = staffToLoad;
                } else {
                    console.warn('loadStaffTable called with non-array. Defaulting to all.', staffToLoad);
                    staffArray = await getAllFromStore(STORES.STAFF);
                }
                const tbody = document.querySelector('#staff-table tbody');
                if (!tbody) {
                    console.error("Staff table body not found!");
                    return;
                }
                tbody.innerHTML = '';
                if (!staffArray || !Array.isArray(staffArray) || staffArray.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Ú©ÙˆØ¦ÛŒ Ø¹Ù…Ù„Û Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº ÛÛ’ ÛŒØ§ ÙÙ„Ù¹Ø± Ø³Û’ Ú©ÙˆØ¦ÛŒ Ù†ØªÛŒØ¬Û Ù†ÛÛŒÚº Ù…Ù„Ø§Û”</td></tr>';
                    return;
                }
                staffArray.forEach(staff => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                <td>${staff.employeeId}</td>
                <td>${staff.name}</td>
                <td>${staff.designation}</td>
                <td>${staff.department}</td>
                <td>${staff.contact}</td>
                <td>${formatDate(staff.joiningDate)}</td>
                <td>${staff.basicSalary ? formatCurrency(staff.basicSalary) : 'N/A'}</td>
                <td class="no-print">
                    <button class="btn btn-primary btn-sm" onclick="editStaff(${staff.id})">ØªØ±Ù…ÛŒÙ…</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteItem('${STORES.STAFF}', ${staff.id})">Ø­Ø°Ù Ú©Ø±ÛŒÚº</button>
                </td>
            `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading staff table:', error);
            }
        }
        const REPORT_CONFIG = {
            students: [
                { id: 'student_strength_by_class', name: 'Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ù„Ø­Ø§Ø¸ Ú©Ù„Ø§Ø³', filters: [], generator: generateStudentStrengthByClassReportJS, chartType: 'bar' },
                { id: 'student_gender_ratio_by_class', name: 'Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ØµÙ†ÙÛŒ ØªÙ†Ø§Ø³Ø¨ (Ú©Ù„Ø§Ø³ ÙˆØ§Ø±)', filters: ['class_optional'], generator: generateStudentGenderRatioByClassReportJS, chartType: 'pie_multi' },
                { id: 'student_admission_trend', name: 'Ø¯Ø§Ø®Ù„ÙˆÚº Ú©Ø§ Ù…Ø§ÛØ§Ù†Û Ø±Ø¬Ø­Ø§Ù†', filters: ['year_optional'], generator: generateStudentAdmissionTrendReportJS, chartType: 'line' },
                { id: 'student_list_filtered', name: 'Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ÙÛØ±Ø³Øª (ÙÙ„Ù¹Ø± Ø´Ø¯Û)', filters: ['class_optional', 'section_optional', 'gender_optional'], generator: generateFilteredStudentListReportJS, chartType: null }
            ],
            attendance: [
                { id: 'daily_attendance_summary', name: 'Ø±ÙˆØ²Ø§Ù†Û Ø­Ø§Ø¶Ø±ÛŒ Ú©Ø§ Ø®Ù„Ø§ØµÛ', filters: ['date', 'class_optional', 'section_optional'], generator: generateDailyAttendanceSummaryReportJS, chartType: 'pie' },
                { id: 'monthly_attendance_student', name: 'Ù…Ø§ÛØ§Ù†Û Ø­Ø§Ø¶Ø±ÛŒ ÙÛŒ Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù…', filters: ['month_year', 'class', 'section', 'student_optional'], generator: generateMonthlyAttendanceByStudentReportJS, chartType: 'bar_grouped' },
                { id: 'class_attendance_percentage_range', name: 'Ú©Ù„Ø§Ø³ ÙˆØ§Ø± Ø­Ø§Ø¶Ø±ÛŒ Ú©Ø§ ÙÛŒØµØ¯ (Ù…Ø¯Øª)', filters: ['date_range', 'class_optional'], generator: generateClassAttendancePercentageRangeReportJS, chartType: 'bar' }
            ],
            fees: [
                { id: 'fee_collection_daily_summary', name: 'Ø±ÙˆØ²Ø§Ù†Û ÙÛŒØ³ ÙˆØµÙˆÙ„ÛŒ Ú©Ø§ Ø®Ù„Ø§ØµÛ', filters: ['date'], generator: generateFeeCollectionDailySummaryReportJS, chartType: 'summary_cards' },
                { id: 'fee_collection_monthly_class', name: 'Ù…Ø§ÛØ§Ù†Û ÙÛŒØ³ ÙˆØµÙˆÙ„ÛŒ (Ú©Ù„Ø§Ø³ ÙˆØ§Ø±)', filters: ['month_year', 'class_optional'], generator: generateFeeCollectionMonthlyByClassReportJS, chartType: 'bar' },
                { id: 'fee_defaulters_list', name: 'ÙÛŒØ³ Ù†Ø§Ø¯ÛÙ†Ø¯Ú¯Ø§Ù† Ú©ÛŒ ÙÛØ±Ø³Øª', filters: ['month_year', 'class_optional', 'section_optional'], generator: generateFeeDefaultersListReportJS, chartType: null },
                { id: 'fee_category_wise_collection', name: 'ÙÛŒØ³ Ú©ÛŒÙ¹ÛŒÚ¯Ø±ÛŒ ÙˆØ§Ø± ÙˆØµÙˆÙ„ÛŒ (Ù…Ø¯Øª)', filters: ['date_range'], generator: generateFeeCategoryWiseCollectionReportJS, chartType: 'pie' }
            ],
        };
        let currentReportChart = null;
        async function initializeReportsViewJS() {
            const reportsViewDiv = document.getElementById('reports-view');
            if (!reportsViewDiv) {
                console.error("Reports view container 'reports-view' not found.");
                return;
            }
            const h2 = reportsViewDiv.querySelector('h2');
            reportsViewDiv.innerHTML = '';
            if (h2) reportsViewDiv.appendChild(h2);
            const formContainer = createElementJS('div', { class: 'form-container' });
            reportsViewDiv.appendChild(formContainer);
            formContainer.appendChild(createElementJS('div', { class: 'form-title' }, 'Ø±Ù¾ÙˆØ±Ù¹ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº'));
            const reportTypeRow = createElementJS('div', { class: 'form-row' });
            const reportTypeGroup = createElementJS('div', { class: 'form-group', style: { flexBasis: '100%' } });
            reportTypeGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-report-type-select' }, 'Ø±Ù¾ÙˆØ±Ù¹ Ú©ÛŒ Ù‚Ø³Ù…'));
            const reportTypeSelect = createElementJS('select', { class: 'form-control', id: 'js-report-type-select' });
            reportTypeSelect.appendChild(createElementJS('option', { value: '' }, '--- Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº ---'));
            for (const categoryKey in REPORT_CONFIG) {
                let categoryLabel = categoryKey.charAt(0).toUpperCase() + categoryKey.slice(1);
                if (categoryKey === 'students') categoryLabel = 'Ø·Ù„Ø¨Ø§Ø¡';
                if (categoryKey === 'attendance') categoryLabel = 'Ø­Ø§Ø¶Ø±ÛŒ';
                if (categoryKey === 'fees') categoryLabel = 'ÙÛŒØ³';
                const optgroup = createElementJS('optgroup', { label: categoryLabel });
                REPORT_CONFIG[categoryKey].forEach(report => {
                    optgroup.appendChild(createElementJS('option', { value: `${categoryKey}:${report.id}` }, report.name));
                });
                reportTypeSelect.appendChild(optgroup);
            }
            reportTypeGroup.appendChild(reportTypeSelect);
            reportTypeRow.appendChild(reportTypeGroup);
            formContainer.appendChild(reportTypeRow);
            const filtersArea = createElementJS('div', { id: 'js-report-filters-area', class: 'form-row', style: { marginTop: '15px', display: 'none', flexWrap: 'wrap', gap: '15px' } });
            formContainer.appendChild(filtersArea);
            const generateBtnRow = createElementJS('div', { class: 'form-row', style: { marginTop: '15px' } });
            const generateBtn = createElementJS('button', { class: 'btn btn-primary', id: 'js-generate-report-btn' }, 'Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ø¦ÛŒÚº');
            generateBtnRow.appendChild(generateBtn);
            formContainer.appendChild(generateBtnRow);
            const reportOutputDiv = createElementJS('div', { id: 'js-report-output-area', style: { marginTop: '20px' } });
            reportsViewDiv.appendChild(reportOutputDiv);
            reportTypeSelect.addEventListener('change', handleReportTypeChangeJS);
            generateBtn.addEventListener('click', generateSelectedReportJS);
            handleReportTypeChangeJS();
        }
        async function handleReportTypeChangeJS() {
            const selectedValue = document.getElementById('js-report-type-select').value;
            const filtersArea = document.getElementById('js-report-filters-area');
            filtersArea.innerHTML = '';
            filtersArea.style.display = 'none';
            if (!selectedValue) return;
            const [category, reportId] = selectedValue.split(':');
            const reportConfig = REPORT_CONFIG[category]?.find(r => r.id === reportId);
            if (!reportConfig || !reportConfig.filters || reportConfig.filters.length === 0) return;
            filtersArea.style.display = 'flex';
            for (const filterType of reportConfig.filters) {
                const filterGroup = createElementJS('div', { class: 'form-group' });
                let requiresRepopulate = false;
                switch (filterType) {
                    case 'date':
                        filterGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-date' }, 'ØªØ§Ø±ÛŒØ®'));
                        filterGroup.appendChild(createElementJS('input', { type: 'date', class: 'form-control', id: 'js-filter-date', value: new Date().toISOString().split('T')[0] }));
                        break;
                    case 'date_range':
                    case 'date_range_year_month':
                        filterGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-date-from' }, 'ØªØ§Ø±ÛŒØ® (Ø³Û’)'));
                        filterGroup.appendChild(createElementJS('input', { type: 'date', class: 'form-control', id: 'js-filter-date-from' }));
                        filterGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-date-to', style: { marginTop: '5px' } }, 'ØªØ§Ø±ÛŒØ® (ØªÚ©)'));
                        filterGroup.appendChild(createElementJS('input', { type: 'date', class: 'form-control', id: 'js-filter-date-to' }));
                        break;
                    case 'month_year':
                        filterGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-month' }, 'Ù…ÛÛŒÙ†Û'));
                        const monthSelect = createElementJS('select', { class: 'form-control', id: 'js-filter-month' });
                        const months = ["Ø¬Ù†ÙˆØ±ÛŒ", "ÙØ±ÙˆØ±ÛŒ", "Ù…Ø§Ø±Ú†", "Ø§Ù¾Ø±ÛŒÙ„", "Ù…Ø¦ÛŒ", "Ø¬ÙˆÙ†", "Ø¬ÙˆÙ„Ø§Ø¦ÛŒ", "Ø§Ú¯Ø³Øª", "Ø³ØªÙ…Ø¨Ø±", "Ø§Ú©ØªÙˆØ¨Ø±", "Ù†ÙˆÙ…Ø¨Ø±", "Ø¯Ø³Ù…Ø¨Ø±"];
                        months.forEach((m, i) => monthSelect.appendChild(createElementJS('option', { value: i + 1 }, m)));
                        monthSelect.value = new Date().getMonth() + 1;
                        filterGroup.appendChild(monthSelect);
                        filterGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-year', style: { marginTop: '5px' } }, 'Ø³Ø§Ù„'));
                        filterGroup.appendChild(createElementJS('input', { type: 'number', class: 'form-control', id: 'js-filter-year', value: new Date().getFullYear() }));
                        break;
                    case 'year_optional':
                        filterGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-year-optional' }, 'Ø³Ø§Ù„ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)'));
                        const yearOptionalInput = createElementJS('input', { type: 'number', class: 'form-control', id: 'js-filter-year-optional', placeholder: 'Ø®Ø§Ù„ÛŒ Ú†Ú¾ÙˆÚ‘ÛŒÚº Ù…ÙˆØ¬ÙˆØ¯Û Ø³Ø§Ù„ Ú©Û’ Ù„ÛŒÛ’' });
                        filterGroup.appendChild(yearOptionalInput);
                        break;
                    case 'class':
                    case 'class_optional':
                        filterGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-class' }, 'Ú©Ù„Ø§Ø³'));
                        const classSelect = createElementJS('select', { class: 'form-control', id: 'js-filter-class' });
                        if (filterType === 'class_optional') {
                            classSelect.appendChild(createElementJS('option', { value: '' }, 'ØªÙ…Ø§Ù… Ú©Ù„Ø§Ø³Ø²'));
                        }
                        const classes = await getAllFromStore(STORES.CLASSES);
                        classes.forEach(c => classSelect.appendChild(createElementJS('option', { value: c.id }, c.name)));
                        filterGroup.appendChild(classSelect);
                        if (reportConfig.filters.includes('section_optional') || reportConfig.filters.includes('section')) {
                            classSelect.addEventListener('change', () => populateReportFilterSectionsJS(reportConfig.filters.includes('section_optional')));
                            requiresRepopulate = true;
                        }
                        if (reportConfig.filters.includes('student_optional')) {
                            classSelect.addEventListener('change', populateReportFilterStudentsJS);
                        }
                        break;
                    case 'section':
                    case 'section_optional':
                        filterGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-section' }, 'Ø³ÛŒÚ©Ø´Ù†'));
                        const sectionSelect = createElementJS('select', { class: 'form-control', id: 'js-filter-section' });
                        filterGroup.appendChild(sectionSelect);
                        if (reportConfig.filters.includes('student_optional')) {
                            sectionSelect.addEventListener('change', populateReportFilterStudentsJS);
                        }
                        requiresRepopulate = true;
                        break;
                    case 'gender_optional':
                        filterGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-gender' }, 'Ø¬Ù†Ø³'));
                        const genderSelect = createElementJS('select', { class: 'form-control', id: 'js-filter-gender' });
                        genderSelect.appendChild(createElementJS('option', { value: '' }, 'ØªÙ…Ø§Ù…'));
                        genderSelect.appendChild(createElementJS('option', { value: 'Ù…Ø±Ø¯' }, 'Ù…Ø±Ø¯'));
                        genderSelect.appendChild(createElementJS('option', { value: 'Ø¹ÙˆØ±Øª' }, 'Ø¹ÙˆØ±Øª'));
                        filterGroup.appendChild(genderSelect);
                        break;
                    case 'student_optional':
                        filterGroup.appendChild(createElementJS('label', { class: 'form-label', for: 'js-filter-student' }, 'Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù…'));
                        const studentSelect = createElementJS('select', { class: 'form-control', id: 'js-filter-student' });
                        filterGroup.appendChild(studentSelect);
                        requiresRepopulate = true;
                        break;
                }
                filtersArea.appendChild(filterGroup);
                if (requiresRepopulate) {
                    if (filterType.includes('section')) await populateReportFilterSectionsJS(filterType === 'section_optional');
                    if (filterType.includes('student')) await populateReportFilterStudentsJS();
                }
            }
        }
        async function populateReportFilterSectionsJS(isOptional = false) {
            const classSelect = document.getElementById('js-filter-class');
            const sectionSelect = document.getElementById('js-filter-section');
            if (!sectionSelect) return;
            sectionSelect.innerHTML = '';
            if (isOptional) {
                sectionSelect.appendChild(createElementJS('option', { value: '' }, 'ØªÙ…Ø§Ù… Ø³ÛŒÚ©Ø´Ù†Ø²'));
            }
            const classId = classSelect ? parseInt(classSelect.value) : null;
            if (classId && !isNaN(classId)) {
                const sections = await getAllFromIndex(STORES.SECTIONS, 'classId', classId);
                sections.forEach(s => sectionSelect.appendChild(createElementJS('option', { value: s.id }, s.name)));
            } else if (!classId && isOptional) {
                const allSections = await getAllFromStore(STORES.SECTIONS);
                for (const s of allSections) {
                    const c = await getFromStore(STORES.CLASSES, s.classId);
                    sectionSelect.appendChild(createElementJS('option', { value: s.id }, `${s.name} (${c?.name || ''})`));
                }
            } else if (!classId && !isOptional) {
                sectionSelect.appendChild(createElementJS('option', { value: '' }, 'Ù¾ÛÙ„Û’ Ú©Ù„Ø§Ø³ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº'));
            }
        }
        async function populateReportFilterStudentsJS() {
            const studentSelect = document.getElementById('js-filter-student');
            if (!studentSelect) return;
            studentSelect.innerHTML = '';
            studentSelect.appendChild(createElementJS('option', { value: '' }, 'ØªÙ…Ø§Ù… Ø·Ù„Ø¨Ø§Ø¡'));
            const classIdVal = document.getElementById('js-filter-class')?.value;
            const sectionIdVal = document.getElementById('js-filter-section')?.value;
            const classId = classIdVal ? parseInt(classIdVal) : null;
            const sectionId = sectionIdVal ? parseInt(sectionIdVal) : null;
            let students = await getAllFromStore(STORES.STUDENTS);
            if (classId && !isNaN(classId)) {
                students = students.filter(s => s.classId === classId);
            }
            if (sectionId && !isNaN(sectionId)) {
                students = students.filter(s => s.sectionId === sectionId);
            }
            students.sort((a, b) => (a.name || "").localeCompare(b.name || "", 'ur'));
            students.forEach(s => studentSelect.appendChild(createElementJS('option', { value: s.id }, `${s.name || 'Ø¨Ù„Ø§ Ù†Ø§Ù…'} (${s.rollNumber || 'N/A'})`)));
        }
        async function generateSelectedReportJS() {
            const selectedValue = document.getElementById('js-report-type-select').value;
            const outputDiv = document.getElementById('js-report-output-area');
            outputDiv.innerHTML = '';
            if (currentReportChart) {
                currentReportChart.destroy();
                currentReportChart = null;
            }
            if (!selectedValue) {
                showNotification('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø±Ù¾ÙˆØ±Ù¹ Ú©ÛŒ Ù‚Ø³Ù… Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”', 'error');
                return;
            }
            showLoading();
            const [category, reportId] = selectedValue.split(':');
            const reportConfig = REPORT_CONFIG[category]?.find(r => r.id === reportId);
            if (!reportConfig || !reportConfig.generator) {
                outputDiv.innerHTML = '<p>Ø±Ù¾ÙˆØ±Ù¹ Ø¬Ù†Ø±ÛŒÙ¹Ø± ÙÙ†Ú©Ø´Ù† Ù†ÛÛŒÚº Ù…Ù„Ø§Û”</p>';
                hideLoading();
                return;
            }
            try {
                const filterValues = {};
                if (reportConfig.filters) {
                    reportConfig.filters.forEach(filterKey => {
                        if (filterKey === 'date') filterValues.date = document.getElementById('js-filter-date')?.value;
                        if (filterKey === 'date_range' || filterKey === 'date_range_year_month') {
                            filterValues.dateFrom = document.getElementById('js-filter-date-from')?.value;
                            filterValues.dateTo = document.getElementById('js-filter-date-to')?.value;
                        }
                        if (filterKey === 'month_year') {
                            filterValues.month = parseInt(document.getElementById('js-filter-month')?.value);
                            filterValues.year = parseInt(document.getElementById('js-filter-year')?.value);
                        }
                        if (filterKey === 'year_optional') {
                            const yearVal = document.getElementById('js-filter-year-optional')?.value;
                            filterValues.year = yearVal ? parseInt(yearVal) : new Date().getFullYear();
                        }
                        if (filterKey === 'class' || filterKey === 'class_optional') {
                            const val = document.getElementById('js-filter-class')?.value;
                            filterValues.classId = val ? parseInt(val) : null;
                        }
                        if (filterKey === 'section' || filterKey === 'section_optional') {
                            const val = document.getElementById('js-filter-section')?.value;
                            filterValues.sectionId = val ? parseInt(val) : null;
                        }
                        if (filterKey === 'gender_optional') {
                            filterValues.gender = document.getElementById('js-filter-gender')?.value || null;
                        }
                        if (filterKey === 'student_optional') {
                            const val = document.getElementById('js-filter-student')?.value;
                            filterValues.studentId = val ? parseInt(val) : null;
                        }
                    });
                }
                const { html, chartData } = await reportConfig.generator(filterValues);
                outputDiv.innerHTML = html;
                if (chartData && reportConfig.chartType && chartData.canvasId) {
                    if (typeof Chart === 'undefined') {
                        console.warn("Chart.js library is not loaded. Skipping chart rendering.");
                        const placeholder = document.getElementById(chartData.canvasId);
                        if (placeholder) placeholder.innerHTML = '<p style="text-align:center; color: #777;"><em>Chart.js library not loaded.</em></p>';
                    } else {
                        renderChart(reportConfig.chartType, chartData.canvasId, chartData.title, chartData.labels, chartData.datasets, chartData.options);
                    }
                }
            } catch (error) {
                console.error(`Error generating report '${reportConfig.name}':`, error);
                outputDiv.innerHTML = `<p style="color:red;">Ø±Ù¾ÙˆØ±Ù¹ Ø¨Ù†Ø§Ù†Û’ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ ÛÙˆØ¦ÛŒ: ${error.message}</p>`;
            } finally {
                hideLoading();
            }
        }
        function renderChart(type, canvasId, chartTitle, labels, datasets, chartOptions = {}) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) {
                console.warn("Canvas not found for chart:", canvasId);
                return;
            }
            if (currentReportChart) {
                currentReportChart.destroy();
            }
            const defaultOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: { display: true, text: chartTitle, font: { size: 16, family: "'Jameel Noori Nastaleeq', 'Noto Nastaliq Urdu', sans-serif" } },
                    legend: { labels: { font: { family: "'Jameel Noori Nastaleeq', 'Noto Nastaliq Urdu', sans-serif" } } }
                },
            };
            if (type === 'bar' || type === 'line' || type === 'bar_grouped') {
                defaultOptions.scales = { y: { beginAtZero: true, ticks: { font: { family: "'Jameel Noori Nastaleeq', 'Noto Nastaliq Urdu', sans-serif" } } }, x: { ticks: { font: { family: "'Jameel Noori Nastaleeq', 'Noto Nastaliq Urdu', sans-serif" } } } };
            }
            currentReportChart = new Chart(ctx, {
                type: type === 'bar_grouped' ? 'bar' : type,
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: { ...defaultOptions, ...chartOptions }
            });
        }
        async function generateStudentStrengthByClassReportJS(filters) {
            const classes = await getAllFromStore(STORES.CLASSES);
            const students = await getAllFromStore(STORES.STUDENTS);
            let totalStudentsOverall = 0;
            const reportDataItems = classes.map(cls => {
                const classStudents = students.filter(s => s.classId === cls.id);
                totalStudentsOverall += classStudents.length;
                return { className: cls.name, studentCount: classStudents.length };
            });
            let tableHTML = `<h3>Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ù„Ø­Ø§Ø¸ Ú©Ù„Ø§Ø³</h3>
                     <div class="table-container">
                       <table class="table">
                         <thead><tr><th>Ú©Ù„Ø§Ø³ Ú©Ø§ Ù†Ø§Ù…</th><th>Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ØªØ¹Ø¯Ø§Ø¯</th></tr></thead><tbody>`;
            reportDataItems.forEach(data => {
                tableHTML += `<tr><td>${data.className}</td><td>${data.studentCount}</td></tr>`;
            });
            tableHTML += `</tbody><tfoot><tr><td><strong>Ú©Ù„ Ø·Ù„Ø¨Ø§Ø¡</strong></td><td><strong>${totalStudentsOverall}</strong></td></tr></tfoot></table></div>`;
            const chartCanvasId = `chart-std-strength-${Date.now()}`;
            tableHTML += `<div style="height: 350px; margin-top: 20px; position: relative;"><canvas id="${chartCanvasId}"></canvas></div>`;
            const chartData = {
                canvasId: chartCanvasId,
                title: 'Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ù„Ø­Ø§Ø¸ Ú©Ù„Ø§Ø³',
                labels: reportDataItems.map(d => d.className),
                datasets: [{
                    label: 'Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ØªØ¹Ø¯Ø§Ø¯',
                    data: reportDataItems.map(d => d.studentCount),
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            };
            return { html: tableHTML, chartData: chartData };
        }
        async function generateStudentGenderRatioByClassReportJS(filters) {
            let classesToReportOn = [];
            if (filters.classId && !isNaN(filters.classId)) {
                const cls = await getFromStore(STORES.CLASSES, filters.classId);
                if (cls) classesToReportOn.push(cls);
            } else {
                classesToReportOn = await getAllFromStore(STORES.CLASSES);
            }
            const students = await getAllFromStore(STORES.STUDENTS);
            let overallMale = 0;
            let overallFemale = 0;
            let overallOther = 0;
            let html = `<h3>Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ØµÙ†ÙÛŒ ØªÙ†Ø§Ø³Ø¨ Ø¨Ù„Ø­Ø§Ø¸ Ú©Ù„Ø§Ø³</h3>`;
            const chartDataSets = [];
            for (const cls of classesToReportOn) {
                const classStudents = students.filter(s => s.classId === cls.id);
                const maleCount = classStudents.filter(s => s.gender === 'Ù…Ø±Ø¯').length;
                const femaleCount = classStudents.filter(s => s.gender === 'Ø¹ÙˆØ±Øª').length;
                overallMale += maleCount;
                overallFemale += femaleCount;
                html += `<div class="form-container" style="margin-bottom:15px;">
                    <h4>Ú©Ù„Ø§Ø³: ${cls.name} (Ú©Ù„: ${classStudents.length})</h4>
                    <p>Ù…Ø±Ø¯: ${maleCount} (${classStudents.length > 0 ? ((maleCount / classStudents.length) * 100).toFixed(1) : 0}%)</p>
                    <p>Ø¹ÙˆØ±Øª: ${femaleCount} (${classStudents.length > 0 ? ((femaleCount / classStudents.length) * 100).toFixed(1) : 0}%)</p>
                    <div style="height: 250px; position: relative;"><canvas id="chart-gender-${cls.id}-${Date.now()}"></canvas></div>
                 </div>`;
                chartDataSets.push({
                    canvasId: `chart-gender-${cls.id}-${Date.now()}`,
                    title: `ØµÙ†ÙÛŒ ØªÙ†Ø§Ø³Ø¨ - ${cls.name}`,
                    labels: ['Ù…Ø±Ø¯', 'Ø¹ÙˆØ±Øª'],
                    datasets: [{
                        data: [maleCount, femaleCount],
                        backgroundColor: ['rgba(54, 162, 235, 0.7)', 'rgba(255, 99, 132, 0.7)'],
                    }]
                });
            }
            html += `<div class="form-container"><h4>Ù…Ø¬Ù…ÙˆØ¹ÛŒ ØµÙ†ÙÛŒ ØªÙ†Ø§Ø³Ø¨</h4>
                <p>Ú©Ù„ Ù…Ø±Ø¯: ${overallMale}</p>
                <p>Ú©Ù„ Ø¹ÙˆØ±Øª: ${overallFemale}</p>
                <div style="height: 300px; position: relative;"><canvas id="chart-gender-overall-${Date.now()}"></canvas></div>
              </div>`;
            chartDataSets.push({
                canvasId: `chart-gender-overall-${Date.now()}`,
                title: `Ù…Ø¬Ù…ÙˆØ¹ÛŒ ØµÙ†ÙÛŒ ØªÙ†Ø§Ø³Ø¨`,
                labels: ['Ù…Ø±Ø¯', 'Ø¹ÙˆØ±Øª'],
                datasets: [{
                    data: [overallMale, overallFemale],
                    backgroundColor: ['rgba(75, 192, 192, 0.7)', 'rgba(255, 159, 64, 0.7)'],
                }]
            });
            return { html: html, chartData: chartDataSets, chartType: 'pie_multi' };
        }
        async function generateStudentAdmissionTrendReportJS(filters) {
            const year = filters.year || new Date().getFullYear();
            const students = await getAllFromStore(STORES.STUDENTS);
            const monthlyAdmissions = Array(12).fill(0);
            students.forEach(s => {
                if (s.admissionDate) {
                    const admissionDate = new Date(s.admissionDate);
                    if (admissionDate.getFullYear() === year) {
                        monthlyAdmissions[admissionDate.getMonth()]++;
                    }
                }
            });
            const monthsUrdu = ["Ø¬Ù†ÙˆØ±ÛŒ", "ÙØ±ÙˆØ±ÛŒ", "Ù…Ø§Ø±Ú†", "Ø§Ù¾Ø±ÛŒÙ„", "Ù…Ø¦ÛŒ", "Ø¬ÙˆÙ†", "Ø¬ÙˆÙ„Ø§Ø¦ÛŒ", "Ø§Ú¯Ø³Øª", "Ø³ØªÙ…Ø¨Ø±", "Ø§Ú©ØªÙˆØ¨Ø±", "Ù†ÙˆÙ…Ø¨Ø±", "Ø¯Ø³Ù…Ø¨Ø±"];
            let tableHTML = `<h3>${year} Ù…ÛŒÚº Ù…Ø§ÛØ§Ù†Û Ø¯Ø§Ø®Ù„ÙˆÚº Ú©Ø§ Ø±Ø¬Ø­Ø§Ù†</h3>
                     <div class="table-container">
                       <table class="table">
                         <thead><tr><th>Ù…ÛÛŒÙ†Û</th><th>Ù†Ø¦Û’ Ø¯Ø§Ø®Ù„Û’</th></tr></thead><tbody>`;
            monthlyAdmissions.forEach((count, index) => {
                tableHTML += `<tr><td>${monthsUrdu[index]}</td><td>${count}</td></tr>`;
            });
            tableHTML += `</tbody></table></div>`;
            const chartCanvasId = `chart-admission-trend-${Date.now()}`;
            tableHTML += `<div style="height: 350px; margin-top: 20px; position: relative;"><canvas id="${chartCanvasId}"></canvas></div>`;
            const chartData = {
                canvasId: chartCanvasId,
                title: `${year} Ù…ÛŒÚº Ù…Ø§ÛØ§Ù†Û Ø¯Ø§Ø®Ù„ÙˆÚº Ú©Ø§ Ø±Ø¬Ø­Ø§Ù†`,
                labels: monthsUrdu,
                datasets: [{
                    label: 'Ù†Ø¦Û’ Ø¯Ø§Ø®Ù„Û’',
                    data: monthlyAdmissions,
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                }]
            };
            return { html: tableHTML, chartData: chartData };
        }
        async function generateFilteredStudentListReportJS(filters) {
            let students = await getAllFromStore(STORES.STUDENTS);
            if (filters.classId) {
                students = students.filter(s => s.classId === filters.classId);
            }
            if (filters.sectionId) {
                students = students.filter(s => s.sectionId === filters.sectionId);
            }
            if (filters.gender) {
                students = students.filter(s => s.gender === filters.gender);
            }
            let title = "Ø·Ù„Ø¨Ø§Ø¡ Ú©ÛŒ ÙÛØ±Ø³Øª";
            if (filters.classId || filters.sectionId || filters.gender) title += " (ÙÙ„Ù¹Ø± Ø´Ø¯Û)";
            let tableHTML = `<h3>${title} (Ú©Ù„: ${students.length})</h3>
                     <div class="table-container">
                       <table class="table">
                         <thead><tr><th>Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø±</th><th>Ù†Ø§Ù…</th><th>ÙˆØ§Ù„Ø¯ Ú©Ø§ Ù†Ø§Ù…</th><th>Ú©Ù„Ø§Ø³</th><th>Ø³ÛŒÚ©Ø´Ù†</th><th>Ø¬Ù†Ø³</th><th>Ø±Ø§Ø¨Ø·Û</th><th>Ø¯Ø§Ø®Ù„Û ØªØ§Ø±ÛŒØ®</th></tr></thead><tbody>`;
            for (const student of students) {
                const classData = student.classId ? await getFromStore(STORES.CLASSES, student.classId) : null;
                const sectionData = student.sectionId ? await getFromStore(STORES.SECTIONS, student.sectionId) : null;
                tableHTML += `<tr>
                        <td>${student.rollNumber || 'N/A'}</td>
                        <td>${student.name || 'N/A'}</td>
                        <td>${student.fatherName || 'N/A'}</td>
                        <td>${classData ? classData.name : 'N/A'}</td>
                        <td>${sectionData ? sectionData.name : 'N/A'}</td>
                        <td>${student.gender || 'N/A'}</td>
                        <td>${student.contact || 'N/A'}</td>
                        <td>${student.admissionDate ? formatDate(student.admissionDate) : 'N/A'}</td>
                      </tr>`;
            }
            tableHTML += `</tbody></table></div>`;
            return { html: tableHTML, chartData: null };
        }
        async function generateDailyAttendanceSummaryReportJS(filters) {
            const { date, classId, sectionId } = filters;
            if (!date) return { html: "<p>Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªØ§Ø±ÛŒØ® Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”</p>", chartData: null };
            let attendanceRecords = await getAllFromIndex(STORES.ATTENDANCE, 'date', date);
            let allStudentsInScope = await getAllFromStore(STORES.STUDENTS);
            let reportTitle = `${formatDate(date)} Ú©ÛŒ Ø±ÙˆØ²Ø§Ù†Û Ø­Ø§Ø¶Ø±ÛŒ Ú©Ø§ Ø®Ù„Ø§ØµÛ`;
            if (classId && !isNaN(classId)) {
                const classInfo = await getFromStore(STORES.CLASSES, classId);
                reportTitle += ` - Ú©Ù„Ø§Ø³: ${classInfo?.name || 'N/A'}`;
                allStudentsInScope = allStudentsInScope.filter(s => s.classId === classId);
                attendanceRecords = attendanceRecords.filter(r => r.classId === classId);
                if (sectionId && !isNaN(sectionId)) {
                    const sectionInfo = await getFromStore(STORES.SECTIONS, sectionId);
                    reportTitle += ` - Ø³ÛŒÚ©Ø´Ù†: ${sectionInfo?.name || 'N/A'}`;
                    allStudentsInScope = allStudentsInScope.filter(s => s.sectionId === sectionId);
                    attendanceRecords = attendanceRecords.filter(r => r.sectionId === sectionId);
                }
            }
            const totalStudents = allStudentsInScope.length;
            let presentCount = 0;
            let absentCount = 0;
            let leaveCount = 0;
            let lateCount = 0;
            const studentAttendanceMap = new Map();
            attendanceRecords.forEach(rec => studentAttendanceMap.set(rec.studentId, rec));
            allStudentsInScope.forEach(student => {
                const record = studentAttendanceMap.get(student.id);
                if (record) {
                    if (record.isLeave) leaveCount++;
                    else if (record.status === 'present') presentCount++;
                    else if (record.status === 'absent') absentCount++;
                    if (record.isLate) lateCount++;
                } else {
                    absentCount++;
                }
            });
            const attendancePercentage = totalStudents > 0 ? ((presentCount / totalStudents) * 100).toFixed(1) : 0;
            let html = `<h3>${reportTitle}</h3>`;
            html += `<div class="dashboard-cards" style="justify-content: space-around; flex-wrap:wrap;">
                <div class="card" style="min-width:150px; margin:5px;"><div class="card-title">Ú©Ù„ Ø·Ù„Ø¨Ø§Ø¡</div><div class="card-value">${totalStudents}</div></div>
                <div class="card" style="min-width:150px; margin:5px;"><div class="card-title">Ø­Ø§Ø¶Ø±</div><div class="card-value" style="color: #2ecc71;">${presentCount}</div></div>
                <div class="card" style="min-width:150px; margin:5px;"><div class="card-title">ØºÛŒØ± Ø­Ø§Ø¶Ø±</div><div class="card-value" style="color: #e74c3c;">${absentCount}</div></div>
                <div class="card" style="min-width:150px; margin:5px;"><div class="card-title">Ø±Ø®ØµØª</div><div class="card-value" style="color: #f39c12;">${leaveCount}</div></div>
                <div class="card" style="min-width:150px; margin:5px;"><div class="card-title">Ø¯ÛŒØ± Ø³Û’</div><div class="card-value" style="color: #e67e22;">${lateCount}</div></div>
                <div class="card" style="min-width:150px; margin:5px;"><div class="card-title">Ø­Ø§Ø¶Ø±ÛŒ %</div><div class="card-value" style="color: #3498db;">${attendancePercentage}%</div></div>
             </div>`;
            const chartCanvasId = `chart-daily-attendance-${Date.now()}`;
            html += `<div style="height: 300px; margin-top: 20px; position: relative;"><canvas id="${chartCanvasId}"></canvas></div>`;
            const chartData = {
                canvasId: chartCanvasId,
                title: 'Ø±ÙˆØ²Ø§Ù†Û Ø­Ø§Ø¶Ø±ÛŒ Ú©ÛŒ ØªÙ‚Ø³ÛŒÙ…',
                labels: ['Ø­Ø§Ø¶Ø±', 'ØºÛŒØ± Ø­Ø§Ø¶Ø±', 'Ø±Ø®ØµØª'],
                datasets: [{
                    data: [presentCount, absentCount, leaveCount],
                    backgroundColor: ['rgba(46, 204, 113, 0.7)', 'rgba(231, 76, 60, 0.7)', 'rgba(243, 156, 18, 0.7)'],
                }]
            };
            return { html: html, chartData: chartData };
        }
        async function generateMonthlyAttendanceByStudentReportJS(filters) {
            const { month, year, classId, sectionId, studentId } = filters;
            if (!month || !year || !classId) {
                return { html: "<p>Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù…ÛÛŒÙ†ÛØŒ Ø³Ø§Ù„ Ø§ÙˆØ± Ú©Ù„Ø§Ø³ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ” Ø³ÛŒÚ©Ø´Ù† Ø§Ø®ØªÛŒØ§Ø±ÛŒ ÛÛ’Û”</p>", chartData: null };
            }
            const monthName = new Date(year, month - 1, 1).toLocaleDateString('ur-PK', { month: 'long' });
            let html = `<h3>${monthName}ØŒ ${year} Ú©ÛŒ Ù…Ø§ÛØ§Ù†Û Ø­Ø§Ø¶Ø±ÛŒ Ø±Ù¾ÙˆØ±Ù¹</h3>`;
            const sClass = await getFromStore(STORES.CLASSES, classId);
            html += `<p><strong>Ú©Ù„Ø§Ø³:</strong> ${sClass?.name || '-'}`;
            if (sectionId) {
                const sSection = await getFromStore(STORES.SECTIONS, sectionId);
                html += ` - <strong>Ø³ÛŒÚ©Ø´Ù†:</strong> ${sSection?.name || '-'}`;
            }
            html += `</p>`;
            let studentsToReport = [];
            if (studentId && !isNaN(studentId)) {
                const student = await getFromStore(STORES.STUDENTS, studentId);
                if (student && student.classId === classId && (!sectionId || student.sectionId === sectionId)) studentsToReport.push(student);
            } else {
                studentsToReport = (await getAllFromStore(STORES.STUDENTS)).filter(s => s.classId === classId && (!sectionId || s.sectionId === sectionId));
            }
            if (studentsToReport.length === 0) return { html: html + "<p>Ø§Ø³ Ù…Ø¹ÛŒØ§Ø± Ù¾Ø± Ú©ÙˆØ¦ÛŒ Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… Ù†ÛÛŒÚº Ù…Ù„Ø§Û”</p>", chartData: null };
            const allAttendance = await getAllFromStore(STORES.ATTENDANCE);
            html += `<div class="table-container"><table class="table">
                <thead><tr><th>Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø±</th><th>Ù†Ø§Ù…</th><th>Ú©Ù„ Ø§ÛŒØ§Ù… (Ø±ÛŒÚ©Ø§Ø±Úˆ Ø´Ø¯Û)</th><th>Ø­Ø§Ø¶Ø±</th><th>ØºÛŒØ± Ø­Ø§Ø¶Ø±</th><th>Ø±Ø®ØµØª</th><th>Ø¯ÛŒØ± Ø³Û’</th><th>Ø­Ø§Ø¶Ø±ÛŒ %</th></tr></thead>
                <tbody>`;
            const chartLabels = [];
            const presentDataset = [];
            const absentDataset = [];
            const leaveDataset = [];
            for (const student of studentsToReport) {
                const studentMonthlyAttendance = allAttendance.filter(r =>
                    r.studentId === student.id &&
                    new Date(r.date).getFullYear() === year &&
                    new Date(r.date).getMonth() + 1 === month
                );
                const totalRecordedDays = studentMonthlyAttendance.length;
                const present = studentMonthlyAttendance.filter(r => r.status === 'present' && !r.isLeave).length;
                const absent = studentMonthlyAttendance.filter(r => r.status === 'absent' && !r.isLeave).length;
                const onLeave = studentMonthlyAttendance.filter(r => r.isLeave).length;
                const late = studentMonthlyAttendance.filter(r => r.isLate).length;
                const effectiveDaysForPercentage = present + absent;
                const percentage = effectiveDaysForPercentage > 0 ? ((present / effectiveDaysForPercentage) * 100).toFixed(1) : (onLeave > 0 ? 'Ø±Ø®ØµØª' : '0.0');
                html += `<tr>
                    <td>${student.rollNumber}</td>
                    <td>${student.name}</td>
                    <td>${totalRecordedDays}</td>
                    <td>${present}</td>
                    <td>${absent}</td>
                    <td>${onLeave}</td>
                    <td>${late}</td>
                    <td>${percentage}${percentage !== 'Ø±Ø®ØµØª' ? '%' : ''}</td>
                 </tr>`;
                if (studentsToReport.length <= 15) {
                    chartLabels.push(student.name.split(" ")[0]);
                    presentDataset.push(present);
                    absentDataset.push(absent);
                    leaveDataset.push(onLeave);
                }
            }
            html += `</tbody></table></div>`;
            let chartData = null;
            if (studentsToReport.length > 0 && studentsToReport.length <= 15) {
                const chartCanvasId = `chart-monthly-stud-att-${Date.now()}`;
                html += `<div style="height: 400px; margin-top: 20px; position: relative;"><canvas id="${chartCanvasId}"></canvas></div>`;
                chartData = {
                    canvasId: chartCanvasId,
                    title: `${sClass?.name || ''} ${sectionId ? '- ' + (await getFromStore(STORES.SECTIONS, sectionId))?.name : ''} - Ù…Ø§ÛØ§Ù†Û Ø­Ø§Ø¶Ø±ÛŒ`,
                    labels: chartLabels,
                    datasets: [
                        { label: 'Ø­Ø§Ø¶Ø±', data: presentDataset, backgroundColor: 'rgba(46, 204, 113, 0.7)' },
                        { label: 'ØºÛŒØ± Ø­Ø§Ø¶Ø±', data: absentDataset, backgroundColor: 'rgba(231, 76, 60, 0.7)' },
                        { label: 'Ø±Ø®ØµØª', data: leaveDataset, backgroundColor: 'rgba(243, 156, 18, 0.7)' }
                    ]
                };
            }
            return { html: html, chartData: chartData };
        }
        async function generateClassAttendancePercentageRangeReportJS(filters) {
            const { dateFrom, dateTo, classId } = filters;
            if (!dateFrom || !dateTo) {
                return { html: "<p>Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªØ§Ø±ÛŒØ® Ú©ÛŒ Ù…Ø¯Øª Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”</p>", chartData: null };
            }
            let classesToReport = [];
            if (classId && !isNaN(classId)) {
                const cls = await getFromStore(STORES.CLASSES, classId);
                if (cls) classesToReport.push(cls);
            } else {
                classesToReport = await getAllFromStore(STORES.CLASSES);
            }
            if (classesToReport.length === 0) return { html: "<p>Ú©ÙˆØ¦ÛŒ Ú©Ù„Ø§Ø³ Ù…Ù†ØªØ®Ø¨ Ù†ÛÛŒÚº ÛŒØ§ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚºÛ”</p>", chartData: null };
            const allAttendance = await getAllFromStore(STORES.ATTENDANCE);
            const allStudents = await getAllFromStore(STORES.STUDENTS);
            let html = `<h3>Ú©Ù„Ø§Ø³ ÙˆØ§Ø± Ø­Ø§Ø¶Ø±ÛŒ Ú©Ø§ ÙÛŒØµØ¯ (${formatDate(dateFrom)} - ${formatDate(dateTo)})</h3>`;
            html += `<div class="table-container"><table class="table">
               <thead><tr><th>Ú©Ù„Ø§Ø³</th><th>Ú©Ù„ Ø·Ù„Ø¨Ø§Ø¡</th><th>Ú©Ù„ Ø­Ø§Ø¶Ø±ÛŒØ§Úº (Ø±ÛŒÚ©Ø§Ø±Úˆ Ø´Ø¯Û)</th><th>Ú©Ù„ Ù…Ù…Ú©Ù†Û Ø­Ø§Ø¶Ø±ÛŒØ§Úº</th><th>Ø­Ø§Ø¶Ø±ÛŒ %</th></tr></thead>
               <tbody>`;
            const chartLabels = [];
            const chartPercentages = [];
            for (const cls of classesToReport) {
                const studentsInClass = allStudents.filter(s => s.classId === cls.id);
                let totalPresentInClass = 0;
                let totalPossibleAttendancesInClass = 0;
                let totalRecordedAttendancesByStudents = 0;
                for (const student of studentsInClass) {
                    const studentAttendanceInRange = allAttendance.filter(r => {
                        const recordDate = new Date(r.date);
                        return r.studentId === student.id &&
                            recordDate >= new Date(dateFrom) &&
                            recordDate <= new Date(dateTo) &&
                            !r.isLeave;
                    });
                    totalRecordedAttendancesByStudents += studentAttendanceInRange.length;
                    totalPresentInClass += studentAttendanceInRange.filter(r => r.status === 'present').length;
                }
                totalPossibleAttendancesInClass = totalRecordedAttendancesByStudents;
                const classPercentage = totalPossibleAttendancesInClass > 0 ?
                    ((totalPresentInClass / totalPossibleAttendancesInClass) * 100).toFixed(1) : 0;
                html += `<tr>
                    <td>${cls.name}</td>
                    <td>${studentsInClass.length}</td>
                    <td>${totalPresentInClass}</td>
                    <td>${totalPossibleAttendancesInClass}</td>
                    <td>${classPercentage}%</td>
                 </tr>`;
                chartLabels.push(cls.name);
                chartPercentages.push(parseFloat(classPercentage));
            }
            html += `</tbody></table></div>`;
            const chartCanvasId = `chart-class-att-perc-${Date.now()}`;
            html += `<div style="height: 350px; margin-top: 20px; position: relative;"><canvas id="${chartCanvasId}"></canvas></div>`;
            const chartData = {
                canvasId: chartCanvasId,
                title: `Ú©Ù„Ø§Ø³ ÙˆØ§Ø± Ø­Ø§Ø¶Ø±ÛŒ Ú©Ø§ ÙÛŒØµØ¯ (${formatDate(dateFrom)} - ${formatDate(dateTo)})`,
                labels: chartLabels,
                datasets: [{
                    label: 'Ø­Ø§Ø¶Ø±ÛŒ %',
                    data: chartPercentages,
                    backgroundColor: chartLabels.map(() => `rgba(${Math.floor(Math.random() * 155) + 100}, ${Math.floor(Math.random() * 155) + 100}, ${Math.floor(Math.random() * 155) + 100}, 0.7)`),
                    borderColor: chartLabels.map(() => `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 1)`),
                    borderWidth: 1
                }]
            };
            return { html: html, chartData: chartData };
        }
        async function generateFeeCollectionDailySummaryReportJS(filters) {
            const { date } = filters;
            if (!date) return { html: "<p>Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªØ§Ø±ÛŒØ® Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”</p>", chartData: null };
            const feeRecords = (await getAllFromStore(STORES.FEES)).filter(fr => fr.date === date);
            let totalCollected = 0;
            let byMethod = {};
            let byClass = {};
            const students = await getAllFromStore(STORES.STUDENTS);
            const studentMap = new Map(students.map(s => [s.id, s]));
            const classes = await getAllFromStore(STORES.CLASSES);
            const classMap = new Map(classes.map(c => [c.id, c]));
            feeRecords.forEach(rec => {
                totalCollected += rec.total || 0;
                byMethod[rec.paymentMethod] = (byMethod[rec.paymentMethod] || 0) + (rec.total || 0);
                const student = studentMap.get(rec.studentId);
                if (student && student.classId) {
                    const className = classMap.get(student.classId)?.name || 'Ø¯ÛŒÚ¯Ø±';
                    byClass[className] = (byClass[className] || 0) + (rec.total || 0);
                }
            });
            let html = `<h3>${formatDate(date)} Ú©ÛŒ Ø±ÙˆØ²Ø§Ù†Û ÙÛŒØ³ ÙˆØµÙˆÙ„ÛŒ Ú©Ø§ Ø®Ù„Ø§ØµÛ</h3>`;
            html += `<div class="dashboard-cards" style="justify-content: space-around; flex-wrap:wrap;">
               <div class="card" style="min-width:200px; margin:5px;">
                 <div class="card-title">Ú©Ù„ ÙˆØµÙˆÙ„ÛŒ</div>
                 <div class="card-value">${formatCurrency(totalCollected)}</div>
               </div>
               <div class="card" style="min-width:200px; margin:5px;">
                 <div class="card-title">Ù¹Ø±Ø§Ù†Ø²ÛŒÚ©Ø´Ù†Ø² Ú©ÛŒ ØªØ¹Ø¯Ø§Ø¯</div>
                 <div class="card-value">${feeRecords.length}</div>
               </div>
            </div>`;
            html += `<h4>ÙˆØµÙˆÙ„ÛŒ Ø¨Ù„Ø­Ø§Ø¸ Ø·Ø±ÛŒÙ‚Û Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ</h4><div class="table-container"><table class="table">
               <thead><tr><th>Ø·Ø±ÛŒÙ‚Û</th><th>Ø±Ù‚Ù…</th></tr></thead><tbody>`;
            for (const method in byMethod) {
                html += `<tr><td>${method}</td><td>${formatCurrency(byMethod[method])}</td></tr>`;
            }
            html += `</tbody></table></div>`;
            const chartCanvasIdMethods = `chart-fee-methods-${Date.now()}`;
            html += `<div style="height: 300px; margin-top: 20px; position: relative;"><canvas id="${chartCanvasIdMethods}"></canvas></div>`;
            const charts = [];
            charts.push({
                type: 'pie',
                canvasId: chartCanvasIdMethods,
                title: 'ÙˆØµÙˆÙ„ÛŒ Ø¨Ù„Ø­Ø§Ø¸ Ø·Ø±ÛŒÙ‚Û Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ',
                labels: Object.keys(byMethod),
                datasets: [{ data: Object.values(byMethod), backgroundColor: Object.keys(byMethod).map(() => `rgba(${Math.floor(Math.random() * 200) + 55}, ${Math.floor(Math.random() * 200) + 55}, ${Math.floor(Math.random() * 200) + 55}, 0.7)`) }]
            });
            html += `<h4 style="margin-top:20px;">ÙˆØµÙˆÙ„ÛŒ Ø¨Ù„Ø­Ø§Ø¸ Ú©Ù„Ø§Ø³</h4><div class="table-container"><table class="table">
               <thead><tr><th>Ú©Ù„Ø§Ø³</th><th>Ø±Ù‚Ù…</th></tr></thead><tbody>`;
            for (const className in byClass) {
                html += `<tr><td>${className}</td><td>${formatCurrency(byClass[className])}</td></tr>`;
            }
            html += `</tbody></table></div>`;
            const chartCanvasIdClasses = `chart-fee-classes-${Date.now()}`;
            html += `<div style="height: 300px; margin-top: 20px; position: relative;"><canvas id="${chartCanvasIdClasses}"></canvas></div>`;
            charts.push({
                type: 'bar',
                canvasId: chartCanvasIdClasses,
                title: 'ÙˆØµÙˆÙ„ÛŒ Ø¨Ù„Ø­Ø§Ø¸ Ú©Ù„Ø§Ø³',
                labels: Object.keys(byClass),
                datasets: [{ label: 'ÙˆØµÙˆÙ„ Ø´Ø¯Û Ø±Ù‚Ù…', data: Object.values(byClass), backgroundColor: 'rgba(153, 102, 255, 0.6)' }]
            });
            return { html: html, chartData: charts, chartType: 'multi' };
        }
        async function generateFeeCollectionMonthlyByClassReportJS(filters) {
            const { month, year, classId } = filters;
            if (!month || !year) return { html: "<p>Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù…ÛÛŒÙ†Û Ø§ÙˆØ± Ø³Ø§Ù„ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”</p>", chartData: null };
            let classesToReport = [];
            if (classId && !isNaN(classId)) {
                const cls = await getFromStore(STORES.CLASSES, classId);
                if (cls) classesToReport.push(cls);
            } else {
                classesToReport = await getAllFromStore(STORES.CLASSES);
            }
            if (classesToReport.length === 0) return { html: "<p>Ú©ÙˆØ¦ÛŒ Ú©Ù„Ø§Ø³ Ù…Ù†ØªØ®Ø¨ Ù†ÛÛŒÚº ÛŒØ§ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚºÛ”</p>", chartData: null };
            const feeRecords = (await getAllFromStore(STORES.FEES)).filter(fr => parseInt(fr.month) === month && parseInt(fr.year) === year);
            const students = await getAllFromStore(STORES.STUDENTS);
            const monthName = new Date(year, month - 1, 1).toLocaleDateString('ur-PK', { month: 'long' });
            let html = `<h3>${monthName}ØŒ ${year} Ú©ÛŒ Ù…Ø§ÛØ§Ù†Û ÙÛŒØ³ ÙˆØµÙˆÙ„ÛŒ (Ú©Ù„Ø§Ø³ ÙˆØ§Ø±)</h3>`;
            html += `<div class="table-container"><table class="table">
               <thead><tr><th>Ú©Ù„Ø§Ø³</th><th>Ú©Ù„ Ø·Ù„Ø¨Ø§Ø¡</th><th>ÙÛŒØ³ Ø¯ÛÙ†Ø¯Ú¯Ø§Ù†</th><th>Ú©Ù„ Ù…ØªÙˆÙ‚Ø¹ ÙÛŒØ³</th><th>Ú©Ù„ ÙˆØµÙˆÙ„ Ø´Ø¯Û</th><th>ÙˆØµÙˆÙ„ÛŒ %</th></tr></thead>
               <tbody>`;
            const chartLabels = [];
            const chartCollected = [];
            const chartExpected = [];
            let grandTotalExpected = 0;
            let grandTotalCollected = 0;
            for (const cls of classesToReport) {
                const studentsInClass = students.filter(s => s.classId === cls.id);
                let classTotalCollected = 0;
                let classPaidCount = 0;
                let classTotalExpected = 0;
                studentsInClass.forEach(student => {
                    const studentFeeStructure = getFeeStructureForStudent(student.id, cls.id, student.feeCategory);
                    classTotalExpected += studentFeeStructure?.monthlyFee || student.monthlyFee || 0;
                    const studentFeeRecord = feeRecords.find(fr => fr.studentId === student.id);
                    if (studentFeeRecord) {
                        classTotalCollected += studentFeeRecord.total || 0;
                        classPaidCount++;
                    }
                });
                grandTotalExpected += classTotalExpected;
                grandTotalCollected += classTotalCollected;
                const collectionPercentage = classTotalExpected > 0 ? ((classTotalCollected / classTotalExpected) * 100).toFixed(1) : 0;
                html += `<tr>
                    <td>${cls.name}</td>
                    <td>${studentsInClass.length}</td>
                    <td>${classPaidCount}</td>
                    <td>${formatCurrency(classTotalExpected)}</td>
                    <td>${formatCurrency(classTotalCollected)}</td>
                    <td>${collectionPercentage}%</td>
                 </tr>`;
                chartLabels.push(cls.name);
                chartCollected.push(classTotalCollected);
                chartExpected.push(classTotalExpected);
            }
            html += `</tbody><tfoot>
                <tr>
                    <td colspan="3"><strong>Ù…Ø¬Ù…ÙˆØ¹ÛŒ</strong></td>
                    <td><strong>${formatCurrency(grandTotalExpected)}</strong></td>
                    <td><strong>${formatCurrency(grandTotalCollected)}</strong></td>
                    <td><strong>${grandTotalExpected > 0 ? ((grandTotalCollected / grandTotalExpected) * 100).toFixed(1) : 0}%</strong></td>
                </tr>
             </tfoot></table></div>`;
            const chartCanvasId = `chart-monthly-fee-class-${Date.now()}`;
            html += `<div style="height: 350px; margin-top: 20px; position: relative;"><canvas id="${chartCanvasId}"></canvas></div>`;
            const chartData = {
                canvasId: chartCanvasId,
                title: `${monthName}ØŒ ${year} - ÙÛŒØ³ ÙˆØµÙˆÙ„ÛŒ (Ù…ØªÙˆÙ‚Ø¹ Ø¨Ù…Ù‚Ø§Ø¨Ù„Û ÙˆØµÙˆÙ„ Ø´Ø¯Û)`,
                labels: chartLabels,
                datasets: [
                    {
                        label: 'Ù…ØªÙˆÙ‚Ø¹ ÙÛŒØ³',
                        data: chartExpected,
                        backgroundColor: 'rgba(255, 159, 64, 0.5)',
                        borderColor: 'rgba(255, 159, 64, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'ÙˆØµÙˆÙ„ Ø´Ø¯Û ÙÛŒØ³',
                        data: chartCollected,
                        backgroundColor: 'rgba(75, 192, 192, 0.5)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }
                ]
            };
            return { html: html, chartData: chartData };
        }
        async function getFeeStructureForStudent(studentId, classId, feeCategory) {
            const feeStructures = await getAllFromStore(STORES.FEE_STRUCTURE);
            return feeStructures.find(fs => fs.classId === classId && fs.category === feeCategory) || { monthlyFee: 0 };
        }
        async function generateFeeDefaultersListReportJS(filters) {
            const { month, year, classId, sectionId } = filters;
            if (!month || !year) return { html: "<p>Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù…ÛÛŒÙ†Û Ø§ÙˆØ± Ø³Ø§Ù„ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”</p>", chartData: null };
            let studentsToList = await getAllFromStore(STORES.STUDENTS);
            const feeRecordsForMonth = (await getAllFromStore(STORES.FEES)).filter(fr => parseInt(fr.month) === month && parseInt(fr.year) === year);
            const paidStudentIds = new Set(feeRecordsForMonth.map(fr => fr.studentId));
            let reportTitle = `${new Date(year, month - 1, 1).toLocaleDateString('ur-PK', { month: 'long' })}ØŒ ${year} Ú©Û’ ÙÛŒØ³ Ù†Ø§Ø¯ÛÙ†Ø¯Ú¯Ø§Ù†`;
            if (classId && !isNaN(classId)) {
                studentsToList = studentsToList.filter(s => s.classId === classId);
                const clsInfo = await getFromStore(STORES.CLASSES, classId);
                reportTitle += ` - Ú©Ù„Ø§Ø³: ${clsInfo?.name || 'N/A'}`;
                if (sectionId && !isNaN(sectionId)) {
                    studentsToList = studentsToList.filter(s => s.sectionId === sectionId);
                    const secInfo = await getFromStore(STORES.SECTIONS, sectionId);
                    reportTitle += ` - Ø³ÛŒÚ©Ø´Ù†: ${secInfo?.name || 'N/A'}`;
                }
            }
            const defaulters = studentsToList.filter(s => !paidStudentIds.has(s.id));
            let html = `<h3>${reportTitle} (Ú©Ù„ Ù†Ø§Ø¯ÛÙ†Ø¯Ú¯Ø§Ù†: ${defaulters.length})</h3>`;
            if (defaulters.length === 0) {
                html += "<p>Ø§Ø³ Ù…ÛÛŒÙ†Û’ Ú©ÙˆØ¦ÛŒ Ù†Ø§Ø¯ÛÙ†Ø¯Û Ù†ÛÛŒÚº ÛÛ’Û” Ø´Ø§Ø¨Ø§Ø´!</p>";
                return { html: html, chartData: null };
            }
            html += `<div class="table-container"><table class="table">
               <thead><tr><th>Ø±ÙˆÙ„ Ù†Ù…Ø¨Ø±</th><th>Ù†Ø§Ù…</th><th>ÙˆØ§Ù„Ø¯ Ú©Ø§ Ù†Ø§Ù…</th><th>Ú©Ù„Ø§Ø³</th><th>Ø³ÛŒÚ©Ø´Ù†</th><th>Ù…ØªÙˆÙ‚Ø¹ ÙÛŒØ³</th><th>Ø±Ø§Ø¨Ø·Û Ù†Ù…Ø¨Ø±</th></tr></thead>
               <tbody>`;
            let totalDefaultAmount = 0;
            for (const student of defaulters) {
                const classData = student.classId ? await getFromStore(STORES.CLASSES, student.classId) : null;
                const sectionData = student.sectionId ? await getFromStore(STORES.SECTIONS, student.sectionId) : null;
                const feeStructure = await getFeeStructureForStudent(student.id, student.classId, student.feeCategory);
                const expectedFee = feeStructure?.monthlyFee || student.monthlyFee || 0;
                totalDefaultAmount += expectedFee;
                html += `<tr>
                    <td>${student.rollNumber || 'N/A'}</td>
                    <td>${student.name || 'N/A'}</td>
                    <td>${student.fatherName || 'N/A'}</td>
                    <td>${classData?.name || 'N/A'}</td>
                    <td>${sectionData?.name || 'N/A'}</td>
                    <td>${formatCurrency(expectedFee)}</td>
                    <td>${student.contact || 'N/A'}</td>
                 </tr>`;
            }
            html += `</tbody><tfoot><tr><td colspan="5"><strong>Ú©Ù„ ÙˆØ§Ø¬Ø¨ Ø§Ù„Ø§Ø¯Ø§ Ø±Ù‚Ù…</strong></td><td colspan="2"><strong>${formatCurrency(totalDefaultAmount)}</strong></td></tr></tfoot></table></div>`;
            return { html: html, chartData: null };
        }
        async function generateFeeCategoryWiseCollectionReportJS(filters) {
            const { dateFrom, dateTo } = filters;
            if (!dateFrom || !dateTo) {
                return { html: "<p>Ø¨Ø±Ø§Û Ú©Ø±Ù… ØªØ§Ø±ÛŒØ® Ú©ÛŒ Ù…Ø¯Øª Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”</p>", chartData: null };
            }
            const feeRecords = (await getAllFromStore(STORES.FEES)).filter(fr => {
                const recDate = new Date(fr.date);
                return recDate >= new Date(dateFrom) && recDate <= new Date(dateTo);
            });
            const students = await getAllFromStore(STORES.STUDENTS);
            const studentMap = new Map(students.map(s => [s.id, s]));
            const collectionByCategory = {};
            let totalCollected = 0;
            feeRecords.forEach(rec => {
                const student = studentMap.get(rec.studentId);
                const category = student?.feeCategory || 'Ù†Ø§Ù…Ø¹Ù„ÙˆÙ…';
                collectionByCategory[category] = (collectionByCategory[category] || 0) + (rec.total || 0);
                totalCollected += (rec.total || 0);
            });
            let html = `<h3>ÙÛŒØ³ Ú©ÛŒÙ¹ÛŒÚ¯Ø±ÛŒ ÙˆØ§Ø± ÙˆØµÙˆÙ„ÛŒ (${formatDate(dateFrom)} - ${formatDate(dateTo)})</h3>`;
            html += `<p><strong>Ú©Ù„ ÙˆØµÙˆÙ„ Ø´Ø¯Û: ${formatCurrency(totalCollected)}</strong></p>`;
            html += `<div class="table-container"><table class="table">
               <thead><tr><th>ÙÛŒØ³ Ú©ÛŒÙ¹ÛŒÚ¯Ø±ÛŒ</th><th>ÙˆØµÙˆÙ„ Ø´Ø¯Û Ø±Ù‚Ù…</th><th>Ø­ØµÛ %</th></tr></thead><tbody>`;
            for (const category in collectionByCategory) {
                const percentage = totalCollected > 0 ? ((collectionByCategory[category] / totalCollected) * 100).toFixed(1) : 0;
                html += `<tr>
                    <td>${category}</td>
                    <td>${formatCurrency(collectionByCategory[category])}</td>
                    <td>${percentage}%</td>
                 </tr>`;
            }
            html += `</tbody></table></div>`;
            const chartCanvasId = `chart-fee-cat-coll-${Date.now()}`;
            html += `<div style="height: 350px; margin-top: 20px; position: relative;"><canvas id="${chartCanvasId}"></canvas></div>`;
            const chartData = {
                canvasId: chartCanvasId,
                title: 'ÙÛŒØ³ Ú©ÛŒÙ¹ÛŒÚ¯Ø±ÛŒ ÙˆØ§Ø± ÙˆØµÙˆÙ„ÛŒ',
                labels: Object.keys(collectionByCategory),
                datasets: [{
                    data: Object.values(collectionByCategory),
                    backgroundColor: Object.keys(collectionByCategory).map((_, i) => `hsl(${(i * 360 / Object.keys(collectionByCategory).length) % 360}, 70%, 60%)`),
                }]
            };
            return { html: html, chartData: chartData };
        }
    </script>
</body>
</html>